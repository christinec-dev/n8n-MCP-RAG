{
  "source": "docs/hosting/scaling/external-storage.md",
  "index": 4,
  "content": "### Setup\n\nCreate and configure a bucket following the [AWS documentation](https://docs.aws.amazon.com/AmazonS3/latest/userguide/creating-bucket.html). You can use the following policy, replacing `<bucket-name>` with the name of the bucket you created:\n\n```json\n{\n \"Version\": \"2012-10-17\",\n \"Statement\": [\n  {\n   \"Sid\": \"VisualEditor0\",\n   \"Effect\": \"Allow\",\n   \"Action\": [\"s3:*\"],\n   \"Resource\": [\"arn:aws:s3:::<bucket-name>\", \"arn:aws:s3:::<bucket-name>/*\"]\n  }\n ]\n}\n```\n\nSet a bucket-level lifecycle configuration so that S3 automatically deletes old binary data. n8n delegates pruning of binary data to S3, so setting a lifecycle configuration is required unless you want to preserve binary data indefinitely.\n\nOnce you finish creating the bucket, you will have a host, bucket name and region, and an access key ID and secret access key. You need to set them in n8n's environment:\n\n```sh\nexport N8N_EXTERNAL_STORAGE_S3_HOST=... # example: s3.us-east-1.amazonaws.com\nexport N8N_EXTERNAL_STORAGE_S3_BUCKET_NAME=...\nexport N8N_EXTERNAL_STORAGE_S3_BUCKET_REGION=...\nexport N8N_EXTERNAL_STORAGE_S3_ACCESS_KEY=...\nexport N8N_EXTERNAL_STORAGE_S3_ACCESS_SECRET=...\n```\n\n/// note | No region\nIf your provider doesn't require a region, you can set `N8N_EXTERNAL_STORAGE_S3_BUCKET_REGION` to `'auto'`.\n///\nTell n8n to store binary data in S3:\n\n```sh\nexport N8N_AVAILABLE_BINARY_DATA_MODES=filesystem,s3\nexport N8N_DEFAULT_BINARY_DATA_MODE=s3\n```\n\n\n/// note | Auth autodetection\nTo automatically detect credentials to authenticate your S3 calls, set `N8N_EXTERNAL_STORAGE_S3_AUTH_AUTO_DETECT` to `true`. This will use the default [credential provider chain](https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/setting-credentials-node.html#credchain).\n///\n\nRestart the server to load the new configuration."
}