{
  "source": "1484_Wait_Code_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"HBUhVkSsjslXAojw\",\n  \"meta\": {\n    \"instanceId\": \"1e003a7ea4715b6b35e9947791386a7d07edf3b5bf8d4c9b7ee4fdcbec0447d7\"\n  },\n  \"name\": \"Motion-illustration Workflow Generated with Midjourney and Kling API\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"963603c8-dbe5-4d07-bd1e-74518ddd7a4c\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -1780,\n        -80\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"76717322-4eee-483b-9ab9-dd4e9b0f510a\",\n      \"name\": \"Kling Video Generator\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -820,\n        -180\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.piapi.ai/api/v1/task\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n    \\\"model\\\": \\\"kling\\\",\\n    \\\"task_type\\\": \\\"video_generation\\\",\\n    \\\"input\\\": {\\n        \\\"version\\\": \\\"1.6\\\",\\n        \\n        \\\"image_url\\\":\\\"{{ $json.random_temp_url }}\\\",\\n\\n        \\\"prompt\\\": \\\"A young girl sits on a sunlit grassy meadow, gently petting a fluffy white rabbit\\\"\\n       \\n    }\\n} \",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"x-api-key\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"842c1874-47ab-4efb-baad-155071fd29bb\",\n      \"name\": \"Get Video\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -620,\n        -60\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.piapi.ai/api/v1/task/{{ $json.data.task_id }}\",\n        \"options\": {},\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"x-api-key\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"9f36d2ba-ea56-48b8-9c83-60d741c394cb\",\n      \"name\": \"Get Image\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        -1000,\n        -180\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// JavaScript Code for Function Node\\nreturn {\\n  random_temp_url: $input.all()[0].json.data.output.temporary_image_urls[\\n    Math.floor(Math.random() * $input.all()[0].json.data.output.temporary_image_urls.length)\\n  ]\\n};\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"14995fd1-937a-4e82-a2bb-19dbb65773c4\",\n      \"name\": \"Basic Prompt\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -1560,\n        -80\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.piapi.ai/api/v1/task\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"{\\n  \\\"model\\\": \\\"midjourney\\\",\\n  \\\"task_type\\\": \\\"imagine\\\",\\n  \\\"input\\\": {\\n    \\\"prompt\\\": \\\"A gentle girl and a fluffy rabbit explore a sunlit forest together, playing by a sparkling stream. Butterflies flutter around them as golden sunlight filters through green leaves. Warm and peaceful atmosphere, 4K nature documentary style. --s 500 --sref 4028286908  --niji 6\\\",\\n    \\\"aspect_ratio\\\": \\\"1:1\\\",\\n    \\\"process_mode\\\": \\\"turbo\\\",\\n    \\\"skip_prompt_check\\\": false\\n  }\\n}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"x-api-key\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"791dae4a-4d99-4bdf-a259-20d3df12b92c\",\n      \"name\": \"Get Data Status\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -1180,\n        -80\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"a0f8758e-d6fd-44f8-bd79-bc3c4dceddcf\",\n              \"operator\": {\n                \"name\": \"filter.operator.equals\",\n                \"type\": \"string\",\n                \"operation\": \"equals\"\n              },\n              \"leftValue\": \"={{ $json.data.status }}\",\n              \"rightValue\": \"completed\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"adb13639-1dd9-45af-be7e-c99b6b1219f3\",\n      \"name\": \"Wait for Image Generation\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        -1220,\n        200\n      ],\n      \"webhookId\": \"f3bcf634-8c4b-4bf9-a7f2-d4ee369f5349\",\n      \"parameters\": {},\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"58ad9c2d-fad7-471b-ad5d-f248b3cfbe29\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1820,\n        -300\n      ],\n      \"parameters\": {\n        \"width\": 280,\n        \"content\": \"## Motion-illustration\\nThis workflow is primarily designed to generate dynamic illustrations for content creators and social media professionals with APIs provided by PiAPI.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2571d9ea-1f32-49b0-84da-ad12177714f3\",\n      \"name\": \"Midjourney Image Generator\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -1360,\n        -80\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.piapi.ai/api/v1/task/{{ $json.data.task_id }}\",\n        \"options\": {},\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"x-api-key\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"159df2d3-6c5d-436d-b229-1b3d527daf48\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1820,\n        160\n      ],\n      \"parameters\": {\n        \"width\": 360,\n        \"height\": 200,\n        \"content\": \"## Step-by-step Instruction\\n1. Fill in your x-api-key of your PiAPI account in the Midjourney Image Generator and Kling Video Generator nodes.\\n2. Enter your desired image prompt in **Basic Prompt** node.\\n3. Click Test workflow.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"00de8ec3-102b-41b4-9839-e8fc8cd48253\",\n      \"name\": \"Wait for Video Generation\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        -440,\n        200\n      ],\n      \"webhookId\": \"c7b2590d-96a3-4c7c-8821-3023fead254b\",\n      \"parameters\": {\n        \"amount\": 20\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"75531dff-04d5-4439-ae04-3291ef9cfcde\",\n      \"name\": \"Get Final Video URL\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        -140,\n        80\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Process the entire response\\nreturn {\\n  video_url: $input.all()[0].json.data.output.video_url,\\n  watermark_free_url: $input.all()[0].json.data.output.works[0].video.resource_without_watermark\\n};\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"1fe883e9-64ee-4bec-8b12-238251089df3\",\n      \"name\": \"Verify Data Status\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -440,\n        -60\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"f36fa981-22e0-46db-af8c-c2ac55242c27\",\n              \"operator\": {\n                \"name\": \"filter.operator.equals\",\n                \"type\": \"string\",\n                \"operation\": \"equals\"\n              },\n              \"leftValue\": \"={{ $json.data.status }}\",\n              \"rightValue\": \"completed\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"7f0854bb-7c13-4e67-ba32-809959f47647\",\n  \"connections\": {\n    \"Get Image\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Kling Video Generator\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Video\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Verify Data Status\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Basic Prompt\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Midjourney Image Generator\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Data Status\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Image\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Wait for Image Generation\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Verify Data Status\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Final Video URL\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Wait for Video Generation\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Kling Video Generator\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Video\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Wait for Image Generation\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Midjourney Image Generator\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Wait for Video Generation\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Video\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Midjourney Image Generator\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Data Status\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Basic Prompt\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.code",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.if",
      "n8n-nodes-base.wait",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.wait",
      "n8n-nodes-base.code",
      "n8n-nodes-base.if"
    ],
    "trigger": null
  }
}