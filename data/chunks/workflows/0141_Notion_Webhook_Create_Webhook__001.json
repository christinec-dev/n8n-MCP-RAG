{
  "source": "0141_Notion_Webhook_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"name\": \"Extract Name and Email\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        950,\n        130\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"Name\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"name\\\"]}}\"\n            },\n            {\n              \"name\": \"Email\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"email\\\"]}}\"\n            }\n          ],\n          \"boolean\": []\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Sign Up\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"notes\": \"Example Input Data: {\\\"name\\\":\\\"John Doe\\\",\\\"email\\\":\\\"doe.j@northeastern.edu\\\"}\",\n      \"position\": [\n        720,\n        130\n      ],\n      \"webhookId\": \"6d60a1b4-6706-4f21-a5fb-bace13c24b53\",\n      \"parameters\": {\n        \"path\": \"sign-up\",\n        \"options\": {\n          \"responseData\": \"\"\n        },\n        \"httpMethod\": \"POST\",\n        \"authentication\": \"basicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"11\",\n          \"name\": \"Oasis Basic Auth Creds\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"If user exists\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1560,\n        150\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [],\n          \"boolean\": [\n            {\n              \"value1\": \"={{Object.keys($json).includes(\\\"id\\\") }}\",\n              \"value2\": true\n            }\n          ]\n        }\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"name\": \"Create User\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        1750,\n        240\n      ],\n      \"parameters\": {\n        \"resource\": \"databasePage\",\n        \"databaseId\": \"27a30c5b-c418-4200-8f48-d7fb7b043fbe\",\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Name|title\",\n              \"title\": \"={{$json[\\\"Name\\\"]}}\"\n            },\n            {\n              \"key\": \"Email|email\",\n              \"emailValue\": \"={{$json[\\\"Email\\\"]}}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"3\",\n          \"name\": \"Oasis Hub Production\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Query for User\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        1150,\n        230\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"filter\": {\n            \"singleCondition\": {\n              \"key\": \"Email|email\",\n              \"condition\": \"equals\",\n              \"emailValue\": \"={{$json[\\\"Email\\\"]}}\"\n            }\n          }\n        },\n        \"resource\": \"databasePage\",\n        \"operation\": \"getAll\",\n        \"databaseId\": \"27a30c5b-c418-4200-8f48-d7fb7b043fbe\"\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"3\",\n          \"name\": \"Oasis Hub Production\"\n        }\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"name\": \"Query Current Semester\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        2180,\n        -30\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"sort\": {\n            \"sortValue\": [\n              {\n                \"key\": \"created_time\",\n                \"direction\": \"descending\",\n                \"timestamp\": true\n              }\n            ]\n          },\n          \"filter\": {\n            \"singleCondition\": {\n              \"key\": \"Is Current?|checkbox\",\n              \"condition\": \"equals\",\n              \"checkboxValue\": true\n            }\n          }\n        },\n        \"resource\": \"databasePage\",\n        \"operation\": \"getAll\",\n        \"returnAll\": true,\n        \"databaseId\": \"2003319a-bc73-423a-9378-01999b4884fb\"\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"3\",\n          \"name\": \"Oasis Hub Production\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Select Semester ID\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2370,\n        -30\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"number\": [],\n          \"string\": [\n            {\n              \"name\": \"currentSemesterID\",\n              \"value\": \"={{$json[\\\"id\\\"]}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Update Semester for User\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        3050,\n        110\n      ],\n      \"parameters\": {\n        \"pageId\": \"={{$json[\\\"id\\\"]}}\",\n        \"resource\": \"databasePage\",\n        \"operation\": \"update\",\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Semesters|relation\",\n              \"relationValue\": [\n                \"={{$json[\\\"allSemesterIDs\\\"].join(',')}}\"\n              ]\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"3\",\n          \"name\": \"Oasis Hub Production\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Merge Semester ID\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        2590,\n        110\n      ],\n      \"parameters\": {\n        \"mode\": \"multiplex\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Concatenate Semester IDs\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        2820,\n        110\n      ],\n      \"parameters\": {\n        \"functionCode\": \"for (item of items) {\\n  // Get the current semester ID\\n  const currentSemesterID = item.json[\\\"currentSemesterID\\\"]\\n  let allSemesterIDs = [currentSemesterID];\\n\\n  // Add semesters that the user is already associated with\\n  if (item.json[\\\"Semesters\\\"]?.length > 0) {\\n    allSemesterIDs = allSemesterIDs.concat(item.json[\\\"Semesters\\\"].filter(semesterID => semesterID !== currentSemesterID));\\n  }\\n\\n  // Set allSemesterIDs which is used to update the relation\\n  item.json[\\\"allSemesterIDs\\\"] = allSemesterIDs\\n}\\n\\nreturn items;\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1340,\n        150\n      ],\n      \"parameters\": {\n        \"mode\": \"mergeByKey\",\n        \"propertyName1\": \"Email\",\n        \"propertyName2\": \"Email\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Query User\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        1950,\n        130\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"filter\": {\n            \"singleCondition\": {\n              \"key\": \"Email|email\",\n              \"condition\": \"equals\",\n              \"emailValue\": \"={{$json[\\\"Email\\\"]}}\"\n            }\n          }\n        },\n        \"resource\": \"databasePage\",\n        \"operation\": \"getAll\",\n        \"returnAll\": true,\n        \"databaseId\": \"27a30c5b-c418-4200-8f48-d7fb7b043fbe\"\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"3\",\n          \"name\": \"Oasis Hub Production\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    }\n  ],\n  \"connections\": {\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If user exists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Sign Up\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract Name and Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Query User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Query Current Semester\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Merge Semester ID\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Create User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Query User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If user exists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Query User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Create User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Query for User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Merge Semester ID\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Concatenate Semester IDs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Select Semester ID\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge Semester ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract Name and Email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Query for User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Query Current Semester\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Select Semester ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Concatenate Semester IDs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Semester for User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.set",
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.if",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.set",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.function",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.notion"
    ],
    "trigger": null
  }
}