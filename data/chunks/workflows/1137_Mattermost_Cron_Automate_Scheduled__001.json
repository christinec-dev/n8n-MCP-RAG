{
  "source": "1137_Mattermost_Cron_Automate_Scheduled.json",
  "index": 1,
  "content": "{\n  \"id\": \"7\",\n  \"name\": \"Coffee Bot (Mattermost)\",\n  \"nodes\": [\n    {\n      \"name\": \"Divide into groups\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        1060,\n        300\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const ideal_group_size = 3;\\nlet groups = [];\\nlet data_as_array = [];\\nlet newItems = [];\\n\\n// Take all the users and add them to an array\\nfor (let j = 0; j < items.length; j++) {\\n  data_as_array.push({username: items[j].json.username, email: items[j].json.email});\\n}\\n\\n// Fisher-Yates (aka Knuth) Shuffle\\nfunction shuffle(array) {\\n  var currentIndex = array.length, temporaryValue, randomIndex;\\n\\n  // While there remain elements to shuffle...\\n  while (0 !== currentIndex) {\\n\\n    // Pick a remaining element...\\n    randomIndex = Math.floor(Math.random() * currentIndex);\\n    currentIndex -= 1;\\n\\n    // And swap it with the current element.\\n    temporaryValue = array[currentIndex];\\n    array[currentIndex] = array[randomIndex];\\n    array[randomIndex] = temporaryValue;\\n  }\\n\\n  return array;\\n}\\n\\n// Randomize the sequence of names in the array\\ndata_as_array = shuffle(data_as_array);\\n\\n// Create groups of ideal group size (3)\\nfor (let i = 0; i < data_as_array.length; i += ideal_group_size) {\\n  groups.push(data_as_array.slice(i, i + ideal_group_size));\\n}\\n\\n// Make sure that no group has just one person. If it does, take\\n// one from previous group and add it to that group \\nfor (let k = 0; k < groups.length; k++) {\\n  if (groups[k].length === 1) {\\n    groups[k].push(groups[k-1].shift());\\n  }\\n}\\n\\nfor (let l = 0; l < groups.length; l++) {\\n    newItems.push({json: {groupsUsername: groups[l].map(a=> a.username), groupsEmail: groups[l].map(b=> b.email)}})\\n}\\n\\nreturn newItems;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Greetings\",\n      \"type\": \"n8n-nodes-base.mattermost\",\n      \"position\": [\n        650,\n        300\n      ],\n      \"parameters\": {\n        \"message\": \"üëã Happy Monday\\n\\nGroups for this week's virtual coffee are:\",\n        \"channelId\": \"Enter Your Channel ID\",\n        \"attachments\": [],\n        \"otherOptions\": {}\n      },\n      \"credentials\": {\n        \"mattermostApi\": \"Mattermost Cred\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Weekly trigger on monday\",\n      \"type\": \"n8n-nodes-base.cron\",\n      \"position\": [\n        450,\n        300\n      ],\n      \"parameters\": {\n        \"triggerTimes\": {\n          \"item\": [\n            {\n              \"hour\": 10,\n              \"mode\": \"everyWeek\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Announce groups\",\n      \"type\": \"n8n-nodes-base.mattermost\",\n      \"position\": [\n        1250,\n        200\n      ],\n      \"parameters\": {\n        \"message\": \"=‚òÄÔ∏è {{$node[\\\"Divide into groups\\\"].json[\\\"groupsUsername\\\"].join(', ')}}\",\n        \"channelId\": \"=\",\n        \"attachments\": [],\n        \"otherOptions\": {}\n      },\n      \"credentials\": {\n        \"mattermostApi\": \"Mattermost Cred\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Employees in coffee chat channel\",\n      \"type\": \"n8n-nodes-base.mattermost\",\n      \"position\": [\n        850,\n        300\n      ],\n      \"parameters\": {\n        \"resource\": \"user\",\n        \"operation\": \"getAll\",\n        \"additionalFields\": {\n          \"inChannel\": \"={{$node[\\\"Greetings\\\"].parameter[\\\"channelId\\\"]}}\"\n        }\n      },\n      \"credentials\": {\n        \"mattermostApi\": \"Mattermost Cred\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Send calendar invites\",\n      \"type\": \"n8n-nodes-base.googleCalendar\",\n      \"position\": [\n        1250,\n        400\n      ],\n      \"parameters\": {\n        \"end\": \"2020-12-17T18:38:49.000Z\",\n        \"start\": \"2020-12-17T18:08:49.000Z\",\n        \"calendar\": \"Enter Your Google Calendar\",\n        \"additionalFields\": {\n          \"summary\": \"n8n coffee catchup\",\n          \"attendees\": [\n            \"={{$node[\\\"Divide into groups\\\"].json[\\\"groupsEmail\\\"].join(',')}}\"\n          ],\n          \"guestsCanModify\": true,\n          \"conferenceDataUi\": {\n            \"conferenceDataValues\": {\n              \"conferenceSolution\": \"hangoutsMeet\"\n            }\n          }\n        }\n      },\n      \"credentials\": {\n        \"googleCalendarOAuth2Api\": \"Google Calendar Cred\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"settings\": {},\n  \"connections\": {\n    \"Greetings\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Employees in coffee chat channel\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Divide into groups\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Announce groups\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Send calendar invites\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Weekly trigger on monday\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Greetings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Employees in coffee chat channel\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Divide into groups\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.function",
      "n8n-nodes-base.mattermost",
      "n8n-nodes-base.cron",
      "n8n-nodes-base.mattermost",
      "n8n-nodes-base.mattermost",
      "n8n-nodes-base.googleCalendar"
    ],
    "trigger": "weekly trigger on monday"
  }
}