{
  "source": "0250_Manual_Baserow_Update_Webhook.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"id\": \"70a44436-4b51-458a-ae93-60edeed170de\",\n      \"name\": \"On clicking 'execute'\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        240,\n        300\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d4c2dfa2-30bb-4f06-96c2-5811472302d2\",\n      \"name\": \"Cron\",\n      \"type\": \"n8n-nodes-base.cron\",\n      \"position\": [\n        240,\n        100\n      ],\n      \"parameters\": {\n        \"triggerTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"custom\",\n              \"cronExpression\": \"15 7 * * 1-6\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"86924546-e4f2-4795-8e80-9e49626d2c42\",\n      \"name\": \"Baserow\",\n      \"type\": \"n8n-nodes-base.baserow\",\n      \"position\": [\n        460,\n        200\n      ],\n      \"parameters\": {\n        \"tableId\": 680,\n        \"databaseId\": 146,\n        \"additionalOptions\": {}\n      },\n      \"credentials\": {\n        \"baserowApi\": {\n          \"id\": \"37\",\n          \"name\": \"Baserow account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"36f2947b-67cf-47eb-891f-e7e3b5ba9eac\",\n      \"name\": \"Fetch tradegate stock page\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        680,\n        200\n      ],\n      \"parameters\": {\n        \"url\": \"https://www.tradegate.de/orderbuch.php\",\n        \"options\": {},\n        \"responseFormat\": \"string\",\n        \"queryParametersUi\": {\n          \"parameter\": [\n            {\n              \"name\": \"isin\",\n              \"value\": \"={{$json[\\\"ISIN\\\"]}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b516e751-d1d1-43a0-8f19-6787a5c56ddc\",\n      \"name\": \"Parse tradegate stock page\",\n      \"type\": \"n8n-nodes-base.htmlExtract\",\n      \"position\": [\n        900,\n        200\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"extractionValues\": {\n          \"values\": [\n            {\n              \"key\": \"WKN\",\n              \"cssSelector\": \"#col1_content > table > tbody > tr:nth-child(2) > td:nth-child(1)\"\n            },\n            {\n              \"key\": \"ISIN\",\n              \"cssSelector\": \"#col1_content > table > tbody > tr:nth-child(2) > td:nth-child(3)\"\n            },\n            {\n              \"key\": \"Currency\",\n              \"cssSelector\": \"#col1_content > table > tbody > tr:nth-child(2) > td:nth-child(4)\"\n            },\n            {\n              \"key\": \"Name\",\n              \"cssSelector\": \"#col1_content > h2\"\n            },\n            {\n              \"key\": \"Bid\",\n              \"cssSelector\": \"#bid\"\n            },\n            {\n              \"key\": \"Ask\",\n              \"cssSelector\": \"#ask\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e51556c7-3f3a-4e4d-96e9-942f436422af\",\n      \"name\": \"Build HTML\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        1560,\n        200\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const columns = Object.keys(items[0].json);\\n\\n// Define the basic table structure\\nlet table_header = `<table style=\\\"border: 1px solid black; border-collapse: collapse;\\\"><tr>${columns.map(e => '<th style=\\\"border: 1px solid black; border-collapse: collapse;\\\">' + e + '</th>').join('')}</tr>`;\\nlet table_content = \\\"\\\";\\nlet table_footer = '</table>';\\n\\n// Add content to our table\\nfor (item of items) {\\n    table_content += '<tr>'\\n    for (column of columns) {\\n        table_content += `<td style=\\\\\\\"border: 1px solid black; border-collapse: collapse;\\\\\\\">${item.json[column]}</td>`\\n    }\\n    table_content += '</tr>'\\n}\\n\\n// Prepare HTML email body\\nconst email_html = `<body style=\\\"font-family: Sans-Serif;\\\">\\n<p>Investments as of ${$now.setZone(\\\"Europe/Dublin\\\").setLocale('ie').toFormat('fff')}:</p>\\n${table_header}\\n${table_content}\\n${table_footer}\\n<p>Total: ${items.map(e => parseFloat(e.json['Current Value'])).reduce((a, b) => a + b, 0).toFixed(2)}</p>\\n<p><small>Workflow #${$workflow.id}</small></p>\\n</body>`\\n\\n\\nreturn [{\\n    json: {\\n        html: email_html\\n    }\\n}];\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"361bf8f2-298c-4b96-9f21-4f4620f1e9a9\",\n      \"name\": \"Format result\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1120,\n        200\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"Name\",\n              \"value\": \"={{ $node[\\\"Baserow\\\"].json[\\\"Name\\\"] }}\"\n            },\n            {\n              \"name\": \"ISIN\",\n              \"value\": \"={{ $node[\\\"Baserow\\\"].json[\\\"ISIN\\\"] }}\"\n            },\n            {\n              \"name\": \"Count\",\n              \"value\": \"={{ $node[\\\"Baserow\\\"].json[\\\"Count\\\"] }}\"\n            },\n            {\n              \"name\": \"Purchase Price\",\n              \"value\": \"={{ $node[\\\"Baserow\\\"].json[\\\"Purchase Price\\\"] }}\"\n            },\n            {\n              \"name\": \"Current Value\",\n              \"value\": \"={{ (parseFloat($json[\\\"Bid\\\"].replace(',', '.')) * parseFloat($node[\\\"Baserow\\\"].json[\\\"Count\\\"])).toFixed(2) }}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c2f329dc-3b97-402a-9d63-ed863c2aee84\",\n      \"name\": \"Calculate change\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1340,\n        200\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"Change\",\n              \"value\": \"={{ ( parseFloat($json[\\\"Current Value\\\"]) - parseFloat($json[\\\"Purchase Price\\\"]) ).toFixed(2) }}\"\n            },\n            {\n              \"name\": \"Change (%)\",\n              \"value\": \"={{ ( ( ( parseFloat($json[\\\"Current Value\\\"]) - parseFloat($json[\\\"Purchase Price\\\"]) ) / parseFloat($json[\\\"Purchase Price\\\"]) ) * 100).toFixed(2) }}\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e0876374-c9f3-4253-8764-9aa78faa2193\",\n      \"name\": \"SendGrid\",\n      \"type\": \"n8n-nodes-base.sendGrid\",\n      \"position\": [\n        1780,\n        200\n      ],\n      \"parameters\": {\n        \"subject\": \"Investment report\",\n        \"toEmail\": \"mutedjam@n8n.io\",\n        \"resource\": \"mail\",\n        \"fromEmail\": \"mutedjam@n8n.io\",\n        \"contentType\": \"text/html\",\n        \"contentValue\": \"={{ $json[\\\"html\\\"] }}\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"sendGridApi\": {\n          \"id\": \"143\",\n          \"name\": \"SendGrid account\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Cron\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Baserow\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Baserow\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Fetch tradegate stock page\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Build HTML\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"SendGrid\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Format result\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Calculate change\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Calculate change\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Build HTML\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"On clicking 'execute'\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Baserow\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Fetch tradegate stock page\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Parse tradegate stock page\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Parse tradegate stock page\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Format result\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.cron",
      "n8n-nodes-base.baserow",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.htmlExtract",
      "n8n-nodes-base.function",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.sendGrid"
    ],
    "trigger": null
  }
}