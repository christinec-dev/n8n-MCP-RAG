{
  "source": "0940_Slack_Manual_Automation_Scheduled.json",
  "index": 1,
  "content": "{\n  \"id\": 3,\n  \"name\": \"Orlen\",\n  \"nodes\": [\n    {\n      \"name\": \"On clicking 'execute'\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        240,\n        300\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Current date\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        1160,\n        960\n      ],\n      \"parameters\": {\n        \"functionCode\": \"var today = new Date();\\nvar year = today.getFullYear();\\nvar month = today.getMonth() + 1;\\nvar day = today.getDate();\\n\\nif(month < 10) {\\n  month = \\\"0\\\" + month;\\n}\\n\\nitems[0].json.year = year;\\nitems[0].json.month = month;\\nitems[0].json.day = day;\\n\\nreturn items;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Every 23:45\",\n      \"type\": \"n8n-nodes-base.cron\",\n      \"position\": [\n        960,\n        960\n      ],\n      \"parameters\": {\n        \"triggerTimes\": {\n          \"item\": [\n            {\n              \"hour\": 23,\n              \"minute\": 45\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Get Year folder\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        1360,\n        960\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"fields\": [\n            \"id\"\n          ]\n        },\n        \"operation\": \"list\",\n        \"queryFilters\": {\n          \"name\": [\n            {\n              \"value\": \"={{$json[\\\"year\\\"]}}\",\n              \"operation\": \"is\"\n            }\n          ],\n          \"mimeType\": [\n            {\n              \"mimeType\": \"application/vnd.google-apps.folder\"\n            }\n          ]\n        },\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"7\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Get Month folder\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        1560,\n        960\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"fields\": [\n            \"id\"\n          ]\n        },\n        \"operation\": \"list\",\n        \"queryString\": \"='{{$json[\\\"id\\\"]}}' in parents and name = '{{$node[\\\"Current date\\\"].json[\\\"month\\\"]}}'\",\n        \"authentication\": \"oAuth2\",\n        \"useQueryString\": true\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"7\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Orlen Invoice\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        1760,\n        960\n      ],\n      \"parameters\": {\n        \"resource\": \"message\",\n        \"operation\": \"getAll\",\n        \"returnAll\": true,\n        \"additionalFields\": {\n          \"q\": \"from:(orlenpay@orlen.pl) has:attachment is:unread\",\n          \"format\": \"resolved\"\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"5\",\n          \"name\": \"dbarwikowski Gmail account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Upload Invoice to Google Drive\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        1960,\n        960\n      ],\n      \"parameters\": {\n        \"name\": \"=Orlen {{$binary.attachment_0.directory}}.{{$binary.attachment_0.fileExtension}}\",\n        \"options\": {},\n        \"parents\": [\n          \"={{$node[\\\"Get Month folder\\\"].json[\\\"id\\\"]}}\"\n        ],\n        \"binaryData\": true,\n        \"resolveData\": true,\n        \"authentication\": \"oAuth2\",\n        \"binaryPropertyName\": \"attachment_0\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"7\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Mark as Read\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        2160,\n        960\n      ],\n      \"parameters\": {\n        \"labelIds\": [\n          \"UNREAD\"\n        ],\n        \"resource\": \"messageLabel\",\n        \"messageId\": \"={{$node[\\\"Orlen Invoice\\\"].json[\\\"id\\\"]}}\",\n        \"operation\": \"remove\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"5\",\n          \"name\": \"dbarwikowski Gmail account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        2280,\n        960\n      ],\n      \"parameters\": {\n        \"mode\": \"mergeByIndex\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Slack\",\n      \"type\": \"n8n-nodes-base.slack\",\n      \"position\": [\n        860,\n        540\n      ],\n      \"parameters\": {\n        \"text\": \"=Kapitanie!\\nDodano fakturÄ™ {{$node[\\\"Orlen Invoice\\\"].binary.attachment_0.directory}} do Firma/{{$node[\\\"Current date\\\"].json[\\\"year\\\"]}}/{{$node[\\\"Current date\\\"].json[\\\"month\\\"]}}\",\n        \"channel\": \"n8n\",\n        \"attachments\": [],\n        \"otherOptions\": {},\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"slackOAuth2Api\": {\n          \"id\": \"6\",\n          \"name\": \"Slack account\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": true,\n  \"settings\": {\n    \"timezone\": \"Europe/Warsaw\",\n    \"saveExecutionProgress\": \"DEFAULT\"\n  },\n  \"createdAt\": \"2022-04-11T17:11:34.040Z\",\n  \"updatedAt\": \"2022-04-11T21:59:45.898Z\",\n  \"staticData\": null,\n  \"connections\": {\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload Invoice to Google Drive\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Every 23:45\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Orlen Invoice\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Current date\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Year folder\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Mark as Read\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Slack\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Orlen Invoice\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Get Year folder\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Month folder\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Month folder\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"On clicking 'execute'\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Orlen Invoice\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Upload Invoice to Google Drive\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Mark as Read\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.function",
      "n8n-nodes-base.cron",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.gmail",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.gmail",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.slack"
    ],
    "trigger": null
  }
}