{
  "source": "1801_Wait_Code_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"aOP0D1cAqzGv7Xa8\",\n  \"meta\": {\n    \"instanceId\": \"0a5638e14e0c728ef975d18d109cfb41edae575e3d911724f4f1eccde06a729f\"\n  },\n  \"name\": \"spy tool\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"5690844d-5322-4c62-8c83-eb4d4dc9c481\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1400,\n        340\n      ],\n      \"parameters\": {\n        \"model\": \"gpt-4o\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"ZOKbogCxHnP2W0H5\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3b1c034f-501b-423c-844f-9cb607fa91e6\",\n      \"name\": \"Gmail\",\n      \"type\": \"n8n-nodes-base.gmailTool\",\n      \"position\": [\n        1580,\n        340\n      ],\n      \"webhookId\": \"6a510528-22e0-4140-b987-770bb7a138de\",\n      \"parameters\": {\n        \"sendTo\": \"tom@sleak.chat\",\n        \"message\": \"={{ $fromAI(\\\"change\\\", \\\"What relevant part has changed on the website?\\\") }}\",\n        \"options\": {\n          \"appendAttribution\": false\n        },\n        \"subject\": \"=Relevant changes on {{ $('parse results').item.json.website_url }}\",\n        \"emailType\": \"text\",\n        \"descriptionType\": \"manual\",\n        \"toolDescription\": \"=Use this tool if you need to send an email, but only if the terms in the instructions mentioned explicitly state so\\n\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"jtANm6k92Kl6ent1\",\n          \"name\": \"Gmail account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"4d448a02-4569-451e-8be5-59bfc48f36d8\",\n      \"name\": \"parse results\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1180,\n        -160\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const parsedObject = JSON.parse($('convert message to website url & instruction').first().json.choices[0].message.content);\\n\\nreturn parsedObject\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"238298c4-5bba-4ac1-b3cc-ab5a28888560\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1420,\n        -120\n      ],\n      \"parameters\": {\n        \"width\": 260,\n        \"height\": 180,\n        \"content\": \"## Note: almost never works right away\\nAdjust the prompts in the 'Tools agent' and 'Gmail' node as desired to steer the agent's behavior in the right direction\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0d519c06-aa30-4a33-895f-9185936d27cf\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        480,\n        100\n      ],\n      \"parameters\": {\n        \"width\": 150,\n        \"height\": 80,\n        \"content\": \"Connect your Firecrawl account\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9e327bbe-0096-4a4d-aec2-2e4cae7d91bd\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1740,\n        80\n      ],\n      \"parameters\": {\n        \"width\": 150,\n        \"height\": 80,\n        \"content\": \"Connect your own OpenAI account\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"30ce0e22-f536-462f-8f94-f3fd92ae036f\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1660,\n        300\n      ],\n      \"parameters\": {\n        \"width\": 150,\n        \"height\": 80,\n        \"content\": \"Connect your own Gmail account\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"bc003781-3d91-49b6-b6bb-b2970b39256a\",\n      \"name\": \"convert message to website url & instruction\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        940,\n        -160\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.openai.com/v1/chat/completions\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"model\\\": \\\"gpt-4o-2024-08-06\\\",\\n  \\\"messages\\\": [\\n              {\\n        \\\"role\\\": \\\"user\\\",\\n        \\\"content\\\": \\\"convert the following message to a website url (just the plain text url, NOT formatted or in markdown) and prompt to AI. Make the prompt as verbose as possible. Message: {{ $('New espionage assignment').first().json.assignment_instructions }}\\\"\\n    }\\n  ],\\n  \\\"response_format\\\": {\\n    \\\"type\\\": \\\"json_schema\\\",\\n    \\\"json_schema\\\": {\\n      \\\"name\\\": \\\"variable_extraction\\\",\\n      \\\"schema\\\": {\\n        \\\"type\\\": \\\"object\\\",\\n        \\\"properties\\\": {\\n          \\\"website_url\\\": { \\\"type\\\": \\\"string\\\" },\\n          \\\"prompt\\\": { \\\"type\\\": \\\"string\\\" }\\n        },\\n        \\\"required\\\": [\\\"website_url\\\", \\\"prompt\\\"],\\n        \\\"additionalProperties\\\": false\\n      },\\n      \\\"strict\\\": true\\n    }\\n  }\\n}\\n\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"openAiApi\"\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"ZOKbogCxHnP2W0H5\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"6a8c172d-ac39-4cb0-b601-39fc770695ed\",\n      \"name\": \"New espionage assignment\",\n      \"type\": \"n8n-nodes-base.formTrigger\",\n      \"position\": [\n        700,\n        -160\n      ],\n      \"webhookId\": \"7470334f-93e1-47af-9521-d3a232c38b13\",\n      \"parameters\": {\n        \"options\": {},\n        \"formTitle\": \"New espionage assignment\",\n        \"formFields\": {\n          \"values\": [\n            {\n              \"fieldLabel\": \"assignment_instructions\"\n            }\n          ]\n        }\n      },\n      \"notesInFlow\": false,\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"c5c64e5c-88de-45e3-bb9b-4096e74a6e83\",\n      \"name\": \"wait 1 day\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        940,\n        80\n      ],\n      \"webhookId\": \"22e689e4-b93d-4c59-81e5-43c070833454\",\n      \"parameters\": {\n        \"unit\": \"days\",\n        \"amount\": 1\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"62a278ff-ed00-4e54-a608-001237551113\",\n      \"name\": \"scrape page - 1\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        700,\n        80\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.firecrawl.dev/v1/scrape\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"url\\\": \\\"{{ $('parse results').item.json.website_url }}\\\",\\n  \\\"formats\\\": [\\n    \\\"markdown\\\"\\n  ],\\n  \\\"onlyMainContent\\\": true,\\n  \\\"waitFor\\\": 5000\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"h2XRcXzLcEfvDVKb\",\n          \"name\": \"Unnamed credential\"\n        },\n        \"httpHeaderAuth\": {\n          \"id\": \"FoyIka0WgFG4FPxA\",\n          \"name\": \"Header Auth account 2\"\n        }\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"89c15d8f-7f8e-4391-b24a-07579964ca5c\",\n      \"name\": \"scrape page - 2\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1180,\n        80\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.firecrawl.dev/v1/scrape\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"url\\\": \\\"{{ $('parse results').item.json.website_url }}\\\",\\n  \\\"formats\\\": [\\n    \\\"markdown\\\"\\n  ],\\n  \\\"onlyMainContent\\\": true,\\n  \\\"waitFor\\\": 5000\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"FoyIka0WgFG4FPxA\",\n          \"name\": \"Header Auth account 2\"\n        }\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"7b148c5b-d4ae-498a-b7ef-2ed4ecc0a665\",\n      \"name\": \"send e-mail?\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        1420,\n        80\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $('parse results').item.json.prompt }}\\n\\nNOTE: ONLY send an email if the situation meets the above condition. Otherwise, do NOT use the tool\\n\\nNOTE: this concerns differences between the \\\"old version page\\\" (scrape from yesterday) and \\\"new version page\\\" (scrape from now)\",\n        \"options\": {\n          \"systemMessage\": \"=old version page: \\\\n\\\\n {{ JSON.stringify($('scrape page - 1').item.json[\\\"data\\\"][\\\"markdown\\\"]) }} \\\\n\\\\n /// \\\\n\\\\n new version page: \\\\n\\\\n {{ JSON.stringify($('scrape page - 1').item.json[\\\"data\\\"][\\\"markdown\\\"]) }}\"\n        },\n        \"promptType\": \"define\",\n        \"hasOutputParser\": true\n      },\n      \"typeVersion\": 1.7\n    },\n    {\n      \"id\": \"7897d707-2c27-43bf-9ea0-90ab7996bf4a\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        920,\n        -260\n      ],\n      \"parameters\": {\n        \"width\": 150,\n        \"height\": 80,\n        \"content\": \"Connect your own OpenAI account\\n\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": true,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"dec23eea-1590-4418-ab2b-1cb4a6ccfdc6\",\n  \"connections\": {\n    \"Gmail\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"send e-mail?\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"wait 1 day\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"scrape page - 2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"send e-mail?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"scrape page - 1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"parse results\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"scrape page - 1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"scrape page - 1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"wait 1 day\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"scrape page - 2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"send e-mail?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"send e-mail?\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"New espionage assignment\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"convert message to website url & instruction\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"convert message to website url & instruction\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"parse results\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "n8n-nodes-base.gmailTool",
      "n8n-nodes-base.code",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.formTrigger",
      "n8n-nodes-base.wait",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "@n8n/n8n-nodes-langchain.agent",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}