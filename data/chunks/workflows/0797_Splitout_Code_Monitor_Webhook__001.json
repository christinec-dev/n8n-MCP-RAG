{
  "source": "0797_Splitout_Code_Monitor_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"e634e668fe1fc93a75c4f2a7fc0dad807ca318b79654157eadb9578496acbc76\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"ff5634c3-349b-4181-a03a-97b310e5232b\",\n      \"name\": \"When clicking â€˜Test workflowâ€™\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        120,\n        60\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"66e204fb-3e00-45e0-b1b2-341836476b95\",\n      \"name\": \"Extract page_info \",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        900,\n        120\n      ],\n      \"parameters\": {\n        \"jsCode\": \"function parseNextParams(headerValue) {\\n    // Match the URL inside <>\\n    const urlMatch = headerValue.match(/<([^>]+)>;\\\\s*rel=\\\"next\\\"/);\\n    if (!urlMatch) return null;\\n\\n    const url = urlMatch[1]; // Extracted URL\\n    const paramsString = url.split(\\\"?\\\")[1]; // Get query string\\n\\n    if (!paramsString) return {}; // No params found\\n\\n    // Convert query string to object\\n    return paramsString.split(\\\"&\\\").reduce((acc, param) => {\\n        const [key, value] = param.split(\\\"=\\\");\\n        acc[decodeURIComponent(key)] = decodeURIComponent(value);\\n        return acc;\\n    }, {});\\n}\\n\\n/* Example usage\\n`<https://59b774-3.myshopify.com/admin/api/2025-01/orders.json?limit=250&fields=id%2Cnote%2Cemail%2Cprocessed_at%2Ccustomer&page_info=eyJzdGF0dXMiOiJhbnkiLCJsYXN0X2lkIjo2MzQ5MjI3MDAwMDk0LCJsYXN0X3ZhbHVlIjoiMjAyNC0xMi0zMSAwOToxMzowMi42MTcxNjYiLCJkaXJlY3Rpb24iOiJuZXh0In0>; rel=\\\"next\\\"`\\n*/\\nconst headerValue = $input.first().json.headers.link;\\nconst params = parseNextParams(headerValue);\\nreturn params;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"5b0086ce-f09b-4d55-86b6-9a14574506ab\",\n      \"name\": \"Merge Loop items\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1120,\n        -100\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let results = [],\\n  i = 0;\\n\\ndo {\\n  try {\\n    results = results.concat($(\\\"Get Customers\\\").all(0, i));\\n  } catch (error) {\\n    return results;\\n  }\\n  i++;\\n} while (true);\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"2302257c-51c0-42d7-8745-ecc0b4fc9faf\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        440,\n        -160\n      ],\n      \"parameters\": {\n        \"width\": 232,\n        \"height\": 346,\n        \"content\": \"## Edit this node ðŸ‘‡\\n\\nGet your store URL and replace in the GET url: https://{your-store}.myshopify.com/admin/api/2025-01/customers.json\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d857962a-6599-44b2-acb0-3eb8165e93ce\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1560,\n        -440\n      ],\n      \"parameters\": {\n        \"width\": 272,\n        \"height\": 506,\n        \"content\": \"## Clone this spreadsheet\\n\\nhttps://docs.google.com/spreadsheets/d/1E8i98hwiFW7XG9HuxIZrOWfuLxGFaDm3EOAGQBZjhfk/edit?usp=sharing\\n\\nYour spreadsheet can have up to three columns, and need to be arranged in this order (no header):\\n\\nEmail address\\nFirst name (optional)\\nLast name (optional)\\nShopify Customer ID (will be ignored)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"be7cf143-893a-44f8-ace9-8ad581bddb68\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        120,\n        -120\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {}\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"58097363-29ec-4067-a439-717d355df91f\",\n      \"name\": \"Assign page_info parameter\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1120,\n        120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"57e59bb7-ac20-4a1b-b54a-3468fc0519d3\",\n              \"name\": \"page_info\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.page_info }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"0676abce-4405-42a1-87d3-ba75355fe264\",\n      \"name\": \"Check page_info existence\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        720,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"30d965c3-cbba-430e-81c2-ef8b543665e7\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notContains\"\n              },\n              \"leftValue\": \"={{ $json.headers.link }}\",\n              \"rightValue\": \"rel=\\\"next\\\"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"1cc63979-b2f8-4678-b40b-f3f0ad63d377\",\n      \"name\": \"Get Customers\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        500,\n        0\n      ],\n      \"parameters\": {\n        \"url\": \"https://{your-store}.myshopify.com/admin/api/2025-01/customers.json\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"fullResponse\": true\n            }\n          }\n        },\n        \"sendQuery\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"limit\",\n              \"value\": \"250\"\n            },\n            {\n              \"name\": \"fields\",\n              \"value\": \"id,email,first_name,last_name\"\n            },\n            {\n              \"name\": \"={{ $json.page_info ? \\\"page_info\\\" : \\\"status\\\" }}\",\n              \"value\": \"={{ $json.page_info ? $json.page_info : 'any' }}\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"shopifyAccessTokenApi\"\n      },\n      \"credentials\": {\n        \"shopifyAccessTokenApi\": {\n          \"id\": \"vtyKGPLLdjc7MLea\",\n          \"name\": \"Shopify Access Token account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"ce91af42-1634-4773-944a-2b24dcaf812b\",\n      \"name\": \"List Customers\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        1380,\n        -100\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"body.customers\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"19a0f6a7-b86a-43bd-8504-62e3bd37af89\",\n      \"name\": \"Customers Spreadsheet\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        1620,\n        -100\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"Last name\": \"={{ $json.last_name }}\",\n            \"First name\": \"={{ $json.first_name }}\",\n            \"Email address\": \"={{ $json.email }}\",\n            \"Shopify Customer ID\": \"={{ $json.id }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"Email address\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Email address\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"First name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"First name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Last name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Last name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Shopify Customer ID\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Shopify Customer ID\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"Shopify Customer ID\"\n          ],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {},\n        \"operation\": \"appendOrUpdate\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": 1358690917,\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1yf_RYZGFHpMyOvD3RKGSvIFY2vumvI4474Qm_1t4-jM/edit#gid=1358690917\",\n          \"cachedResultName\": \"sqs_contacts\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1yf_RYZGFHpMyOvD3RKGSvIFY2vumvI4474Qm_1t4-jM\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1yf_RYZGFHpMyOvD3RKGSvIFY2vumvI4474Qm_1t4-jM/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Squarespace automation\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"JgI9maibw5DnBXRP\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"48ec5e3b-9bb5-451c-9495-b03080c9211e\",\n      \"name\": \"Convert to Squarespace contacts csv\",\n      \"type\": \"n8n-nodes-base.convertToFile\",\n      \"position\": [\n        1920,\n        160\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"headerRow\": false\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"8de9174a-af87-4602-a9aa-a5c35a3f0ed4\",\n      \"name\": \"Extract customers data\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1620,\n        160\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"27c42d50-df07-46b4-b67a-13a1b64b5145\",\n              \"name\": \"Email address\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json['Email address'] }}\"\n            },\n            {\n              \"id\": \"9fd2c3fd-9b03-4562-ad78-9ce30da7bb26\",\n              \"name\": \"First name\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json['First name'] }}\"\n            },\n            {\n              \"id\": \"f51b7da6-0065-41ea-b04c-420058ce3b9c\",\n              \"name\": \"Last name\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json['Last name'] }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Get Customers\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check page_info existence\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"List Customers\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Customers Spreadsheet\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Extract customers data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge Loop items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"List Customers\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Customers\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract page_info \": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Assign page_info parameter\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Customers Spreadsheet\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"Extract customers data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Convert to Squarespace contacts csv\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check page_info existence\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge Loop items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Extract page_info \",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Assign page_info parameter\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Customers\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking â€˜Test workflowâ€™\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Customers\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Convert to Squarespace contacts csv\": {\n      \"main\": [\n        []\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.code",
      "n8n-nodes-base.code",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.set",
      "n8n-nodes-base.if",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.convertToFile",
      "n8n-nodes-base.set"
    ],
    "trigger": "schedule trigger"
  }
}