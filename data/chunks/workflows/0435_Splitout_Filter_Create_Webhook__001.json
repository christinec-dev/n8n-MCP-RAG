{
  "source": "0435_Splitout_Filter_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"257476b1ef58bf3cb6a46e65fac7ee34a53a5e1a8492d5c6e4da5f87c9b82833\",\n    \"templateId\": \"2131\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"2b12fb75-ec81-4d2c-a8bb-12ff2bb7e935\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        680,\n        2.662790697674268\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 410.6749642132356,\n        \"height\": 428.2515771212859,\n        \"content\": \"## Setup\\n1. Go to Company Settings -> Data fields -> Organization and add `Domain` as a custom field\\n2. Go to Company Settings -> Data fields -> Leads and add `Enriched at` as a custom date field\\n2. Add your `Pipedrive`, `Clearbit` and `Slack` credentials.\\n3. Fill the `setup` node below. To get the ID of your custom domain fields, simply run the `Show only custom organization fields` and `Show only custom lead fields` nodes below and copy the keys of your domain and enriched at field.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"123ad2e5-f4f2-4411-bf03-5668124b8757\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1800,\n        160\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 223.7628185364029,\n        \"height\": 276.3308728978709,\n        \"content\": \"Adjust condition to filter leads by your desired condition. e.g, revenue, number of employees, etc.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7725dc9e-5c93-475d-9522-f99b4fd1c81f\",\n      \"name\": \"Enrich company\",\n      \"type\": \"n8n-nodes-base.clearbit\",\n      \"position\": [\n        1460,\n        140\n      ],\n      \"parameters\": {\n        \"domain\": \"={{ $json[$('Setup').first().json.domainCustomFieldId2]}}\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"clearbitApi\": {\n          \"id\": \"cKDImrinp9tg0ZHW\",\n          \"name\": \"Clearbit account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f65855c3-d3d2-415b-bda2-e452d4d7e154\",\n      \"name\": \"Get all leads\",\n      \"type\": \"n8n-nodes-base.pipedrive\",\n      \"position\": [\n        1120,\n        280\n      ],\n      \"parameters\": {\n        \"filters\": {\n          \"archived_status\": \"not_archived\"\n        },\n        \"resource\": \"lead\",\n        \"operation\": \"getAll\"\n      },\n      \"credentials\": {\n        \"pipedriveApi\": {\n          \"id\": \"M3l7gIG8DdOex6wX\",\n          \"name\": \"Pipedrive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"39767a37-bd6d-422e-bc38-bfdfcbbf05af\",\n      \"name\": \"Add Organization ID to data\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1640,\n        140\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"71b4c743-fd69-4f5d-8c29-66b3672f7a2a\",\n              \"name\": \"organization_id\",\n              \"type\": \"number\",\n              \"value\": \"={{ $('Get organization details').item.json.id }}\"\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.3\n    },\n    {\n      \"id\": \"4263cd25-dcf3-4521-b716-0ce48d3b2c26\",\n      \"name\": \"Keep leads that match the criteria\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        2320,\n        260\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"1b31b826-e87d-425f-a65d-370b4b20f7e1\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.tags.includes(\\\"B2B\\\") }}\",\n              \"rightValue\": 5000000\n            },\n            {\n              \"id\": \"90ef79a7-807a-4894-ae8c-92f9d46e7177\",\n              \"operator\": {\n                \"type\": \"number\",\n                \"operation\": \"gt\"\n              },\n              \"leftValue\": \"={{ $json.metrics.employees }}\",\n              \"rightValue\": 100\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"98578544-b03d-44aa-a64f-285f8a7cc371\",\n      \"name\": \"Trigger every 5 minutes\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        540,\n        280\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {\n              \"field\": \"minutes\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"69ace950-7f1e-469b-bfca-6c0c81f356b9\",\n      \"name\": \"Setup\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        820,\n        280\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"dba31775-dce0-4f4c-ad61-790359197bb3\",\n              \"name\": \"slackChannel\",\n              \"type\": \"string\",\n              \"value\": \"#yourChannel\"\n            },\n            {\n              \"id\": \"f8206758-7a4f-414d-921c-6cfecd936335\",\n              \"name\": \"domainCustomFieldId\",\n              \"type\": \"string\",\n              \"value\": \"<Run \\\"Show only custom organization fields\\\" and copy the key>\"\n            },\n            {\n              \"id\": \"59c71724-f774-4d41-80e7-5fc76dd27c7d\",\n              \"name\": \"enrichedAtCustomFieldId\",\n              \"type\": \"string\",\n              \"value\": \"<Run \\\"Show only custom lead fields\\\" and copy the key>\"\n            },\n            {\n              \"id\": \"da4ec51e-cc5c-4512-b675-0888d6a0213e\",\n              \"name\": \"enrichedAtCustomFieldId2\",\n              \"type\": \"string\",\n              \"value\": \"68a15ecb2e1255250617c1fd1c06385893334e3c\"\n            },\n            {\n              \"id\": \"43544b80-88d3-44ad-9e36-634e9eeaf013\",\n              \"name\": \"domainCustomFieldId2\",\n              \"type\": \"string\",\n              \"value\": \"ab26f671c92146268edacd244181e76579286e71\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.3\n    },\n    {\n      \"id\": \"63db576a-6bb7-4215-88f3-98e304081b3e\",\n      \"name\": \"Send alert to Slack\",\n      \"type\": \"n8n-nodes-base.slack\",\n      \"position\": [\n        2520,\n        260\n      ],\n      \"parameters\": {\n        \"text\": \"=New high-quality lead ðŸ¤‘\\n*Company Name*: {{ $json.name }} \\n*Website*: {{ \\\"https://\\\" + $json.domain }}\\n*Revenue*: {{ $json.metrics.estimatedAnnualRevenue}}\\n*Number of employees*: {{ $json.metrics.employees }}\",\n        \"select\": \"channel\",\n        \"channelId\": {\n          \"__rl\": true,\n          \"mode\": \"name\",\n          \"value\": \"={{ $('Setup').item.json.slackChannel }}\"\n        },\n        \"otherOptions\": {}\n      },\n      \"credentials\": {\n        \"slackApi\": {\n          \"id\": \"6\",\n          \"name\": \"Idea Bot\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"9bef53b4-3732-4ce5-a72c-81c65a533196\",\n      \"name\": \"Merge data\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1880,\n        260\n      ],\n      \"parameters\": {\n        \"mode\": \"combine\",\n        \"options\": {\n          \"clashHandling\": {\n            \"values\": {\n              \"resolveClash\": \"preferInput2\"\n            }\n          }\n        },\n        \"joinMode\": \"enrichInput2\",\n        \"mergeByFields\": {\n          \"values\": [\n            {\n              \"field1\": \"organization_id\",\n              \"field2\": \"organization_id\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"9c8d106a-ffc6-4295-bc22-8ceddeb0061f\",\n      \"name\": \"Get organization details\",\n      \"type\": \"n8n-nodes-base.pipedrive\",\n      \"position\": [\n        1280,\n        140\n      ],\n      \"parameters\": {\n        \"resource\": \"organization\",\n        \"operation\": \"get\",\n        \"organizationId\": \"={{ $json.organization_id }}\"\n      },\n      \"credentials\": {\n        \"pipedriveApi\": {\n          \"id\": \"M3l7gIG8DdOex6wX\",\n          \"name\": \"Pipedrive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"632477f4-77d1-4c87-a819-2f7022fa6f23\",\n      \"name\": \"Get all organization keys\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        680,\n        620\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.pipedrive.com/v1/organizationFields\",\n        \"options\": {},\n        \"sendQuery\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {}\n          ]\n        },\n        \"nodeCredentialType\": \"pipedriveApi\"\n      },\n      \"credentials\": {\n        \"pipedriveApi\": {\n          \"id\": \"M3l7gIG8DdOex6wX\",\n          \"name\": \"Pipedrive account\"\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"f12c4e56-895d-4f34-8924-c99f5e5fefec\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        997,\n        520\n      ],\n      \"parameters\": {\n        \"width\": 187.68142318756514,\n        \"height\": 276.3308728978709,\n        \"content\": \"Run me to find the Id of your custom domain field\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"229db444-ac48-4557-b393-4dcdc69130fd\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1597,\n        520\n      ],\n      \"parameters\": {\n        \"width\": 187.68142318756514,\n        \"height\": 276.3308728978709,\n        \"content\": \"Run me to find the Id of your enriched at domain field\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ea4b0c82-e52b-4a45-9d3f-7b28b8959574\",\n      \"name\": \"Get all lead keys\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1260,\n        620\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.pipedrive.com/v1/leadFields\",\n        \"options\": {},\n        \"sendQuery\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {}\n          ]\n        },\n        \"nodeCredentialType\": \"pipedriveApi\"\n      },\n      \"credentials\": {\n        \"pipedriveApi\": {\n          \"id\": \"M3l7gIG8DdOex6wX\",\n          \"name\": \"Pipedrive account\"\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"a74a2122-ddd5-4239-baa3-ebbc3de15e03\",\n      \"name\": \"Split out lead field data\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        1440,\n        620\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"data\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"84fded6b-bdeb-4863-b54c-01faf6cb64cc\",\n      \"name\": \"Split out organization field\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        860,\n        620\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"data\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9d9c502e-ccf2-40f9-ae91-7008532e5528\",\n      \"name\": \"Show only custom lead fields\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        1640,\n        620\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"b21201d0-7f9c-417c-ab02-fbaea23a8d24\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.edit_flag }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"a53f58ee-9649-42bc-bee4-b70eea6a0c63\",\n      \"name\": \"Show only custom organization fields\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        1040,\n        620\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"b21201d0-7f9c-417c-ab02-fbaea23a8d24\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.edit_flag }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"f9fa198a-860c-460f-ae82-172c71b5a838\",\n      \"name\": \"Mark lead as enriched in Pipedrive\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2100,\n        260\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.pipedrive.com/v1/leads/{{ $json.id }}\",\n        \"method\": \"PATCH\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"={{ $('Setup').first().json.enrichedAtCustomFieldId2 }}\",\n              \"value\": \"={{ $now.format('yyyy-MM-dd') }}\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"pipedriveApi\"\n      },\n      \"credentials\": {\n        \"pipedriveApi\": {\n          \"id\": \"M3l7gIG8DdOex6wX\",\n          \"name\": \"Pipedrive account\"\n        }\n      },\n      \"typeVersion\": 4.1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Setup\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get all leads\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Mark lead as enriched in Pipedrive\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get all leads\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get organization details\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Merge data\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Enrich company\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add Organization ID to data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get all lead keys\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split out lead field data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Trigger every 5 minutes\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Setup\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get organization details\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Enrich company\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get all organization keys\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split out organization field\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split out lead field data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Show only custom lead fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Add Organization ID to data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split out organization field\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Show only custom organization fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Keep leads that match the criteria\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send alert to Slack\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Mark lead as enriched in Pipedrive\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Keep leads that match the criteria\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.clearbit",
      "n8n-nodes-base.pipedrive",
      "n8n-nodes-base.set",
      "n8n-nodes-base.filter",
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.set",
      "n8n-nodes-base.slack",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.pipedrive",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.filter",
      "n8n-nodes-base.filter",
      "n8n-nodes-base.httpRequest"
    ],
    "trigger": "trigger every 5 minutes"
  }
}