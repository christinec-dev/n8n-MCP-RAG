{
  "source": "1841_Telegram_Manual_Automate_Triggered.json",
  "index": 1,
  "content": "{\n  \"id\": \"dgBdnnnY0622JwGy\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"e205a1ba-9606-457f-9a2f-d433766b3786\",\n      \"name\": \"Gmail Get Email\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        60,\n        840\n      ],\n      \"webhookId\": \"c8979b0a-2ec3-484d-a11b-eac321cc0642\",\n      \"parameters\": {\n        \"filters\": {\n          \"q\": \"=before:{{ $now.minus(14 * $('Increment Loop Var').first().json.page, 'days').format('yyyy/MM/dd') }} after: {{ $now.minus(14 * ($('Increment Loop Var').first().json.page + 1), 'days').format('yyyy/MM/dd') }} -label:n8n-skipped\",\n          \"includeSpamTrash\": false\n        },\n        \"operation\": \"getAll\",\n        \"returnAll\": true\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"jlMSfpSUYNYbMUpo\",\n          \"name\": \"mr.abizareyhan@gmail.com\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 2.1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"380f6e02-7f74-44e4-9229-4784f2f0c66f\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -600,\n        965\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8acc6bc1-c82e-4c1c-a3b0-dd6cb75cf8c3\",\n      \"name\": \"Google Gemini Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        308,\n        1060\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-1.5-flash\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"42fqm71hBhyrAZHp\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f067e64d-bf43-4961-82ff-dcc8ce398375\",\n      \"name\": \"GmailDeleteEmail\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        876,\n        640\n      ],\n      \"webhookId\": \"ab1d1ae0-ebd9-411d-b807-17976867597a\",\n      \"parameters\": {\n        \"messageId\": \"={{ $json.output.emailId }}\",\n        \"operation\": \"delete\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"jlMSfpSUYNYbMUpo\",\n          \"name\": \"mr.abizareyhan@gmail.com\"\n        }\n      },\n      \"retryOnFail\": false,\n      \"typeVersion\": 2.1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"5840c9c6-7afc-4ca1-a8d2-5d0b86339a58\",\n      \"name\": \"AI Check Email\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        280,\n        840\n      ],\n      \"parameters\": {\n        \"text\": \"=Classify the email with decimal values (0 to 1) for isUnwantedConfidence, isMarketingConfidence, and isSpamConfidence, where 0 means clearly wanted (e.g., billing, invoices, orders, job applications, security) and 1 means clearly unwanted (e.g., promotions, setup reminders, irrelevant alerts); treat system-generated alerts or device activity (like sound played, device found, location pinged) as unwanted unless they are security-related; use 0.5 as the baseline for deletion and provide a concise briefReason explaining the classification.\\n\\n{{ JSON.stringify($json) }}\",\n        \"options\": {},\n        \"promptType\": \"define\",\n        \"hasOutputParser\": true\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 1.8,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"e10f96ce-0a92-4817-b340-0d284039a212\",\n      \"name\": \"Unwanted Email Output Parser\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        428,\n        1060\n      ],\n      \"parameters\": {\n        \"schemaType\": \"manual\",\n        \"inputSchema\": \"{\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"required\\\": [\\n    \\\"emailId\\\",\\n    \\\"isUnwantedConfidence\\\",\\n    \\\"isMarketingConfidence\\\",\\n    \\\"isSpamConfidence\\\",\\n    \\\"briefReason\\\",\\n    \\\"emailFrom\\\"\\n  ],\\n  \\\"properties\\\": {\\n    \\\"emailId\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\": \\\"id from the email itself\\\"\\n    },\\n    \\\"isUnwantedConfidence\\\": {\\n      \\\"type\\\": \\\"number\\\",\\n      \\\"minimum\\\": 0,\\n      \\\"maximum\\\": 1,\\n      \\\"description\\\": \\\"confidence that the email is unwanted\\\"\\n    },\\n    \\\"isMarketingConfidence\\\": {\\n      \\\"type\\\": \\\"number\\\",\\n      \\\"minimum\\\": 0,\\n      \\\"maximum\\\": 1,\\n      \\\"description\\\": \\\"confidence that the email is marketing\\\"\\n    },\\n    \\\"isSpamConfidence\\\": {\\n      \\\"type\\\": \\\"number\\\",\\n      \\\"minimum\\\": 0,\\n      \\\"maximum\\\": 1,\\n      \\\"description\\\": \\\"confidence that the email is spam\\\"\\n    },\\n    \\\"briefReason\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\": \\\"a short reason why, more context for the reader\\\"\\n    },\\n    \\\"emailFrom\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\": \\\"the email address of the sender\\\"\\n    }\\n  }\\n}\\n\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"796a0d3e-a1e9-4b2c-8f9c-32466c046d22\",\n      \"name\": \"If Unwanted Marketing or Spam\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        656,\n        740\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"or\",\n          \"conditions\": [\n            {\n              \"id\": \"c2b58601-60ff-45b4-a8a3-0d8543844a2d\",\n              \"operator\": {\n                \"type\": \"number\",\n                \"operation\": \"gt\"\n              },\n              \"leftValue\": \"={{ $json.output.isUnwantedConfidence }}\",\n              \"rightValue\": 0.5\n            },\n            {\n              \"id\": \"ec441e67-046a-4c9c-bce7-85d984b86442\",\n              \"operator\": {\n                \"type\": \"number\",\n                \"operation\": \"gt\"\n              },\n              \"leftValue\": \"={{ $json.output.isMarketingConfidence }}\",\n              \"rightValue\": 0.5\n            },\n            {\n              \"id\": \"80f9ced7-15b0-4dee-97a4-4b3f9ae9c81f\",\n              \"operator\": {\n                \"type\": \"number\",\n                \"operation\": \"gt\"\n              },\n              \"leftValue\": \"={{ $json.output.isSpamConfidence }}\",\n              \"rightValue\": 0.5\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"44a68cfc-b1c7-49c1-b268-42810fcd3eeb\",\n      \"name\": \"Telegram Sent Email Deleted Notification\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        1096,\n        740\n      ],\n      \"webhookId\": \"4b52da48-c12a-45fc-8ba2-9fd2583f2dc5\",\n      \"parameters\": {\n        \"text\": \"=Email Deleted | {{ $('If Unwanted Marketing or Spam').item.json.output.emailFrom }} | {{ $('If Unwanted Marketing or Spam').item.json.output.briefReason }}\",\n        \"chatId\": \"273696245\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"4MEm7g1EdXGbzh6f\",\n          \"name\": \"Telegram account\"\n        }\n      },\n      \"typeVersion\": 1.2,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"01dee5a4-2ba7-4606-98d8-88914621be48\",\n      \"name\": \"Telegram Sent Email Not Deleted Notification\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        1096,\n        940\n      ],\n      \"webhookId\": \"4b52da48-c12a-45fc-8ba2-9fd2583f2dc5\",\n      \"parameters\": {\n        \"text\": \"=Skipping Email | {{ $('If Unwanted Marketing or Spam').item.json.output.emailFrom }} | {{ $('If Unwanted Marketing or Spam').item.json.output.briefReason }}\",\n        \"chatId\": \"273696245\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"4MEm7g1EdXGbzh6f\",\n          \"name\": \"Telegram account\"\n        }\n      },\n      \"typeVersion\": 1.2,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"03292140-5f20-42e8-8d2f-e07a0621844c\",\n      \"name\": \"Telegram Sent AI Error Notification\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        1096,\n        1140\n      ],\n      \"webhookId\": \"4b52da48-c12a-45fc-8ba2-9fd2583f2dc5\",\n      \"parameters\": {\n        \"text\": \"=AI Error | Can't Check Email | Error: {{ JSON.stringify($json) }}\",\n        \"chatId\": \"273696245\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"4MEm7g1EdXGbzh6f\",\n          \"name\": \"Telegram account\"\n        }\n      },\n      \"typeVersion\": 1.2,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"cec5d43c-0e06-45a2-b7bc-f943ef205496\",\n      \"name\": \"Telegram Sent Delete Email Failed Notification\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        1096,\n        540\n      ],\n      \"webhookId\": \"4b52da48-c12a-45fc-8ba2-9fd2583f2dc5\",\n      \"parameters\": {\n        \"text\": \"=Can't Delete Email\",\n        \"chatId\": \"273696245\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"4MEm7g1EdXGbzh6f\",\n          \"name\": \"Telegram account\"\n        }\n      },\n      \"typeVersion\": 1.2,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"bad2dbcc-be22-4470-9b69-06c37929fe65\",\n      \"name\": \"Success\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        1316,\n        840\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1c38ad6f-ef9c-4e34-8b5e-a6d94ddbd221\",\n      \"name\": \"Increment Loop Var\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -160,\n        840\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"596ff68a-1df1-4148-8899-fdfa36238023\",\n              \"name\": \"page\",\n              \"type\": \"number\",\n              \"value\": \"={{ ($('Forward Prev Page Num').isExecuted) ? $('Forward Prev Page Num').first().json.prevPage + 1 : $('Initialize Loop Vars').first().json.page }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"66afc6b4-f36f-4564-bb77-b8da9e35331a\",\n      \"name\": \"Forward Prev Page Num\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1756,\n        1065\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"596ff68a-1df1-4148-8899-fdfa36238023\",\n              \"name\": \"prevPage\",\n              \"type\": \"number\",\n              \"value\": \"={{ $('Increment Loop Var').first().json.page }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"6ab44236-17fa-4790-82b5-a0db8f051d19\",\n      \"name\": \"Initialize Loop Vars\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -380,\n        965\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"5e1583e5-597d-40e9-b656-5f3259b4fe25\",\n              \"name\": \"page\",\n              \"type\": \"number\",\n              \"value\": 0\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"04432130-1a36-4776-9c87-07e935990310\",\n      \"name\": \"Aggregate\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        1536,\n        840\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"aggregate\": \"aggregateAllItemData\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"73fae867-dc79-43e0-80c8-8f60c7e5a8f4\",\n      \"name\": \"Gmail\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        876,\n        940\n      ],\n      \"webhookId\": \"a756798a-0ce2-4735-b65c-2373fe1c0891\",\n      \"parameters\": {\n        \"labelIds\": [\n          \"Label_1321570453811516949\"\n        ],\n        \"messageId\": \"={{ $json.output.emailId }}\",\n        \"operation\": \"addLabels\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"jlMSfpSUYNYbMUpo\",\n          \"name\": \"mr.abizareyhan@gmail.com\"\n        }\n      },\n      \"typeVersion\": 2.1\n    }\n  ],\n  \"pinData\": {},\n  \"settings\": {\n    \"callerPolicy\": \"workflowsFromSameOwner\",\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"9c3ca437-2184-4475-99d6-46a4fcda40a3\",\n  \"connections\": {\n    \"Gmail\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Telegram Sent Email Not Deleted Notification\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Success\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Aggregate\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Aggregate\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Forward Prev Page Num\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"AI Check Email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If Unwanted Marketing or Spam\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Telegram Sent AI Error Notification\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gmail Get Email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"AI Check Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"GmailDeleteEmail\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Telegram Sent Email Deleted Notification\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Telegram Sent Delete Email Failed Notification\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Increment Loop Var\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Gmail Get Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Initialize Loop Vars\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Increment Loop Var\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Forward Prev Page Num\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Initialize Loop Vars\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Gemini Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"AI Check Email\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Unwanted Email Output Parser\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"AI Check Email\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If Unwanted Marketing or Spam\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"GmailDeleteEmail\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Gmail\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Initialize Loop Vars\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Telegram Sent AI Error Notification\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Success\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Success\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Telegram Sent Email Deleted Notification\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Success\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Success\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Telegram Sent Email Not Deleted Notification\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Success\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Success\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Telegram Sent Delete Email Failed Notification\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Success\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Success\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.gmail",
      "n8n-nodes-base.manualTrigger",
      "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "n8n-nodes-base.gmail",
      "@n8n/n8n-nodes-langchain.agent",
      "@n8n/n8n-nodes-langchain.outputParserStructured",
      "n8n-nodes-base.if",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.noOp",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.aggregate",
      "n8n-nodes-base.gmail"
    ],
    "trigger": null
  }
}