{
  "source": "0557_Gitlab_Filter_Create_Scheduled.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"id\": \"3e2820cb-24a4-491b-8f8b-60f97b0748dc\",\n      \"name\": \"Backup Now - Manual Trigger\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        520,\n        320\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"bc5588e5-b67a-4713-b8e7-c21227048a2d\",\n      \"name\": \"n8n\",\n      \"type\": \"n8n-nodes-base.n8n\",\n      \"position\": [\n        980,\n        520\n      ],\n      \"parameters\": {\n        \"filters\": {\n          \"tags\": \"={{ $('Globals').first().json.tags_to_match_for_backup }}\"\n        },\n        \"requestOptions\": {}\n      },\n      \"credentials\": {\n        \"n8nApi\": {\n          \"id\": \"L3X3qWRmwZRYCpV8\",\n          \"name\": \"Source n8n Account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2a5af64d-b5c3-4180-bae5-9efeeaeba99d\",\n      \"name\": \"Globals\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        740,\n        400\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"150135fb-c0fb-444b-aeed-eac851af255d\",\n              \"name\": \"gitlab_owner\",\n              \"type\": \"string\",\n              \"value\": \"mygitlabownername\"\n            },\n            {\n              \"id\": \"8a9359c0-5a16-482b-8f3a-c8b20fbc13c0\",\n              \"name\": \"gitlab_project\",\n              \"type\": \"string\",\n              \"value\": \"n8n_workflow_backups\"\n            },\n            {\n              \"id\": \"00843c18-7d09-4d60-ab70-534ca0791504\",\n              \"name\": \"gitlab_workflow_path\",\n              \"type\": \"string\",\n              \"value\": \"workflow_definitions\"\n            },\n            {\n              \"id\": \"8fbcc201-dbff-440b-b440-42e8f1735548\",\n              \"name\": \"tags_to_match_for_backup\",\n              \"type\": \"string\",\n              \"value\": \"gitlab_backup_enabled\"\n            },\n            {\n              \"id\": \"e17051bc-d8b3-4cef-bad0-efe38a7be464\",\n              \"name\": \"execution_type\",\n              \"type\": \"string\",\n              \"value\": \"={{ ( $('Schedule Trigger').isExecuted) ? 'Scheduled' : 'Manual' }}\"\n            },\n            {\n              \"id\": \"8b90fba9-df11-4e07-a7ae-31405143e831\",\n              \"name\": \"execution_time\",\n              \"type\": \"string\",\n              \"value\": \"={{ $now }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"b6b44b4b-e5a7-4ce6-9cff-e7a21679ad32\",\n      \"name\": \"Create New File(s)\",\n      \"type\": \"n8n-nodes-base.gitlab\",\n      \"position\": [\n        2060,\n        540\n      ],\n      \"parameters\": {\n        \"owner\": \"={{ $('Globals').first().json.gitlab_owner }}\",\n        \"branch\": \"main\",\n        \"filePath\": \"={{ $('Globals').first().json.gitlab_workflow_path }}/{{ $('Derive Filename From Workflow Name').item.json.normalized_filename }}\",\n        \"resource\": \"file\",\n        \"repository\": \"={{ $('Globals').first().json.gitlab_project }}\",\n        \"fileContent\": \"={{ JSON.stringify($('n8n').item.json, null, 4) }}\",\n        \"commitMessage\": \"=(Initial) {{ $('Globals').first().json.execution_type }} Backup - {{ $('Globals').first().json.execution_time }}.\"\n      },\n      \"credentials\": {\n        \"gitlabApi\": {\n          \"id\": \"Nv1DoplS64rrPZVm\",\n          \"name\": \"Target GitLab Account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"167ae6cd-b8dd-4e01-aca4-4888fcaf9958\",\n      \"name\": \"Edit Existing File(s)\",\n      \"type\": \"n8n-nodes-base.gitlab\",\n      \"position\": [\n        2060,\n        340\n      ],\n      \"parameters\": {\n        \"owner\": \"={{ $('Globals').first().json.gitlab_owner }}\",\n        \"branch\": \"main\",\n        \"filePath\": \"={{ $('Globals').first().json.gitlab_workflow_path }}/{{ $('Derive Filename From Workflow Name').item.json.normalized_filename }}\",\n        \"resource\": \"file\",\n        \"operation\": \"edit\",\n        \"repository\": \"={{ $('Globals').first().json.gitlab_project }}\",\n        \"fileContent\": \"={{ JSON.stringify($('n8n').item.json, null, 4) }}\",\n        \"commitMessage\": \"={{ $('Globals').first().json.execution_type }} Backup - {{ $('Globals').first().json.execution_time }}.\"\n      },\n      \"credentials\": {\n        \"gitlabApi\": {\n          \"id\": \"Nv1DoplS64rrPZVm\",\n          \"name\": \"Target GitLab Account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a4437388-9143-4c91-841e-c062ab9af3c0\",\n      \"name\": \"Derive Filename From Workflow Name\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1160,\n        520\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"d2110dc6-1f31-46b3-991e-556b2255d76e\",\n              \"name\": \"normalized_filename\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.name.replace(/[^a-zA-Z0-9]/g, '') }}.json\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"cb0fca8f-dc43-4903-a8e1-5b7acf9157b1\",\n      \"name\": \"Fetch Existing File Content\",\n      \"type\": \"n8n-nodes-base.gitlab\",\n      \"position\": [\n        1640,\n        340\n      ],\n      \"parameters\": {\n        \"owner\": \"={{ $('Globals').first().json.gitlab_owner }}\",\n        \"filePath\": \"={{ $('Globals').first().json.gitlab_workflow_path }}/{{ $('Derive Filename From Workflow Name').item.json.normalized_filename }}\",\n        \"resource\": \"file\",\n        \"operation\": \"get\",\n        \"repository\": \"={{ $('Globals').first().json.gitlab_project }}\",\n        \"asBinaryProperty\": false,\n        \"additionalParameters\": {\n          \"reference\": \"main\"\n        }\n      },\n      \"credentials\": {\n        \"gitlabApi\": {\n          \"id\": \"Nv1DoplS64rrPZVm\",\n          \"name\": \"Target GitLab Account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"816843c4-769c-4033-a38e-1c6ef5325e15\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        940,\n        120\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 401,\n        \"height\": 246,\n        \"content\": \"## Gather Gitlab Info\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"19f3fe4d-acba-4e7b-b92c-ce9024a8f37d\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        940,\n        460\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 398,\n        \"height\": 240,\n        \"content\": \"## Gather n8n Info\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"418bef31-adf6-419b-87f1-faa2581e5766\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1380,\n        280\n      ],\n      \"parameters\": {\n        \"width\": 598,\n        \"height\": 384.41789416257484,\n        \"content\": \"## Decide Whether to Create or Edit or Skip\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f3b98ded-c767-4822-bcf4-25931be03f48\",\n      \"name\": \"Skip Unchanged Files\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        1820,\n        340\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"3298ab8b-9934-4ed7-9c38-03f325dc71e2\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEquals\"\n              },\n              \"leftValue\": \"={{ JSON.stringify($('n8n').item.json, null, 4) }}\",\n              \"rightValue\": \"={{ $json.content.base64Decode() }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"6bbf5146-7129-4ca8-8576-39d5cbe8e0b9\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        480,\n        220\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 402,\n        \"height\": 452,\n        \"content\": \"## Start / Trigger & Configure\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0e5d9c9f-40b4-494d-8233-a2b4fea67d76\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        520,\n        520\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {\n              \"field\": \"cronExpression\",\n              \"expression\": \"30 21 * * 6\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"be08176e-3961-43d7-b182-89a4f45805f6\",\n      \"name\": \"Fetch List of Existing Files\",\n      \"type\": \"n8n-nodes-base.gitlab\",\n      \"position\": [\n        980,\n        180\n      ],\n      \"parameters\": {\n        \"owner\": \"={{ $('Globals').first().json.gitlab_owner }}\",\n        \"filePath\": \"={{ $('Globals').first().json.gitlab_workflow_path }}\",\n        \"resource\": \"file\",\n        \"operation\": \"list\",\n        \"returnAll\": true,\n        \"repository\": \"={{ $('Globals').item.json.gitlab_project }}\",\n        \"additionalParameters\": {\n          \"ref\": \"main\"\n        }\n      },\n      \"credentials\": {\n        \"gitlabApi\": {\n          \"id\": \"Nv1DoplS64rrPZVm\",\n          \"name\": \"Target GitLab Account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"674cdaa8-f8fe-4f6d-8743-062d3fd1ff95\",\n      \"name\": \"Combine Gitlab Existing Files as Single List Item\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        1180,\n        180\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldsToAggregate\": {\n          \"fieldToAggregate\": [\n            {\n              \"renameField\": true,\n              \"outputFieldName\": \"gitlab_existing_filenames\",\n              \"fieldToAggregate\": \"name\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"463ae3fb-4d66-497d-81eb-7e55b5945d84\",\n      \"name\": \"File Exists in Gitlab?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1440,\n        460\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"0740c2be-ab9d-4249-af46-0d94f58c318f\",\n              \"operator\": {\n                \"type\": \"array\",\n                \"operation\": \"contains\",\n                \"rightType\": \"any\"\n              },\n              \"leftValue\": \"={{ $('Combine Gitlab Existing Files as Single List Item').first().json.gitlab_existing_filenames }}\",\n              \"rightValue\": \"={{ $('Derive Filename From Workflow Name').item.json.normalized_filename }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    }\n  ],\n  \"connections\": {\n    \"n8n\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Derive Filename From Workflow Name\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Globals\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Fetch List of Existing Files\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Globals\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Skip Unchanged Files\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Existing File(s)\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"File Exists in Gitlab?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Fetch Existing File Content\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Create New File(s)\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Backup Now - Manual Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Globals\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Fetch Existing File Content\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Skip Unchanged Files\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Fetch List of Existing Files\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Combine Gitlab Existing Files as Single List Item\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Derive Filename From Workflow Name\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"File Exists in Gitlab?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Combine Gitlab Existing Files as Single List Item\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"n8n\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.n8n",
      "n8n-nodes-base.set",
      "n8n-nodes-base.gitlab",
      "n8n-nodes-base.gitlab",
      "n8n-nodes-base.set",
      "n8n-nodes-base.gitlab",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.filter",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.gitlab",
      "n8n-nodes-base.aggregate",
      "n8n-nodes-base.if"
    ],
    "trigger": "backup now - manual trigger"
  }
}