{
  "source": "0503_Splitout_Code_Create_Scheduled.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"84ba6d895254e080ac2b4916d987aa66b000f88d4d919a6b9c76848f9b8a7616\",\n    \"templateId\": \"2285\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"96c1dcb2-1fbe-4be5-b8e3-b5d2626bb5e8\",\n      \"name\": \"If no playlist\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1180,\n        635.2020978272825\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"4cd09fd5-f5bf-4f82-94f4-938e6d6fc1db\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.isEmpty() }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"d17fdd6c-b998-4d41-9e44-34133577067b\",\n      \"name\": \"Create Downloads Playlist\",\n      \"type\": \"n8n-nodes-base.spotify\",\n      \"position\": [\n        1840,\n        435.2020978272825\n      ],\n      \"parameters\": {\n        \"name\": \"Downloads\",\n        \"resource\": \"playlist\",\n        \"operation\": \"create\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"spotifyOAuth2Api\": {\n          \"id\": \"MXfVMBGiR5OTHLNn\",\n          \"name\": \"Spotify account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2250ac0d-5a7c-460c-a9b2-d3b1bcb44ac7\",\n      \"name\": \"Get Liked Tracks\",\n      \"type\": \"n8n-nodes-base.spotify\",\n      \"position\": [\n        2500,\n        735.2020978272825\n      ],\n      \"parameters\": {\n        \"limit\": \"={{ $('Globals').item.json.download_limit }}\",\n        \"resource\": \"library\"\n      },\n      \"credentials\": {\n        \"spotifyOAuth2Api\": {\n          \"id\": \"MXfVMBGiR5OTHLNn\",\n          \"name\": \"Spotify account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ce3eed87-3d8a-4c37-84b7-7f08dd8d91bb\",\n      \"name\": \"Loop Over Items\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        2960,\n        735.2020978272825\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"0d5b326e-7bfa-48b6-a618-083e8e374632\",\n      \"name\": \"Aggregate\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        1400,\n        735.2020978272825\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldsToAggregate\": {\n          \"fieldToAggregate\": [\n            {\n              \"fieldToAggregate\": \"name\"\n            },\n            {\n              \"fieldToAggregate\": \"uri\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"113305f3-8003-4771-a260-2136d62d45ca\",\n      \"name\": \"Split Out\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        1840,\n        735.2020978272825\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"name, uri\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8684eaf3-104e-40b6-91b3-738b15f2b361\",\n      \"name\": \"Add tracks to Downloads\",\n      \"type\": \"n8n-nodes-base.spotify\",\n      \"position\": [\n        3220,\n        835.2020978272825\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $('Filter out Downloads Playlist').item.json.uri }}\",\n        \"trackID\": \"={{ $('Get Liked Tracks').item.json.track.uri }}\",\n        \"resource\": \"playlist\",\n        \"additionalFields\": {\n          \"position\": 0\n        }\n      },\n      \"credentials\": {\n        \"spotifyOAuth2Api\": {\n          \"id\": \"MXfVMBGiR5OTHLNn\",\n          \"name\": \"Spotify account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a9f44907-b324-4a89-b81c-7b514b0a52cb\",\n      \"name\": \"Get Downloads Playlist\",\n      \"type\": \"n8n-nodes-base.spotify\",\n      \"position\": [\n        2280,\n        735.2020978272825\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $json.uri }}\",\n        \"resource\": \"playlist\",\n        \"operation\": \"get\"\n      },\n      \"credentials\": {\n        \"spotifyOAuth2Api\": {\n          \"id\": \"MXfVMBGiR5OTHLNn\",\n          \"name\": \"Spotify account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"75f69264-9653-46de-a571-f080238d0df1\",\n      \"name\": \"Filter out new tracks\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        2720,\n        735.2020978272825\n      ],\n      \"parameters\": {\n        \"jsCode\": \"var downloades_uris = [];\\nfor (const download of $('Get Downloads Playlist').first().json.tracks.items) {\\n  downloades_uris.push(download.track.uri);\\n}\\n\\nvar result = [];\\nfor (const item of $input.all()) {\\n  if (!downloades_uris.includes(item.json.track.uri)) {\\n    result.push(item);\\n  }\\n}\\n\\nreturn result.reverse();\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"54fa426a-f37c-4e9a-a817-f31a9e820d76\",\n      \"name\": \"Get tracks to remove\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        3440,\n        640\n      ],\n      \"parameters\": {\n        \"jsCode\": \"var liked_uris = [];\\nfor (const liked of $('Get Liked Tracks').all()) {\\n  liked_uris.push(liked.json.track.uri);\\n}\\n\\nvar result = [];\\nfor (const item of $input.first().json.tracks.items) {\\n  if (!liked_uris.includes(item.track.uri)) {\\n    result.push(item);\\n  }\\n}\\n\\nreturn result;\"\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"3368ac49-64bc-4c51-8796-0fb5843ad899\",\n      \"name\": \"Remove oldest tracks from Downloads\",\n      \"type\": \"n8n-nodes-base.spotify\",\n      \"position\": [\n        3660,\n        635.2020978272825\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $('Get Downloads Playlist').item.json.uri }}\",\n        \"trackID\": \"={{ $json.track.uri }}\",\n        \"resource\": \"playlist\",\n        \"operation\": \"delete\"\n      },\n      \"credentials\": {\n        \"spotifyOAuth2Api\": {\n          \"id\": \"MXfVMBGiR5OTHLNn\",\n          \"name\": \"Spotify account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6ba744e0-f925-4901-8a01-b6da9c6b9e61\",\n      \"name\": \"Filter out Downloads Playlist\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        2060,\n        735.2020978272825\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"04fec444-230c-4b55-a887-d4dd290c99ee\",\n              \"operator\": {\n                \"name\": \"filter.operator.equals\",\n                \"type\": \"string\",\n                \"operation\": \"equals\"\n              },\n              \"leftValue\": \"={{ $json.name }}\",\n              \"rightValue\": \"Downloads\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"d1a583cb-1c60-44f3-9111-755805e81bf1\",\n      \"name\": \"Get Updated Downloads Playlist\",\n      \"type\": \"n8n-nodes-base.spotify\",\n      \"position\": [\n        3220,\n        635.2020978272825\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $('Filter out Downloads Playlist').item.json.uri }}\",\n        \"resource\": \"playlist\",\n        \"operation\": \"get\"\n      },\n      \"credentials\": {\n        \"spotifyOAuth2Api\": {\n          \"id\": \"MXfVMBGiR5OTHLNn\",\n          \"name\": \"Spotify account\"\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1f976308-b9db-4c59-8321-582a84c45374\",\n      \"name\": \"Get all Playlists\",\n      \"type\": \"n8n-nodes-base.spotify\",\n      \"position\": [\n        960,\n        635.2020978272825\n      ],\n      \"parameters\": {\n        \"resource\": \"playlist\",\n        \"operation\": \"getUserPlaylists\",\n        \"returnAll\": true\n      },\n      \"credentials\": {\n        \"spotifyOAuth2Api\": {\n          \"id\": \"MXfVMBGiR5OTHLNn\",\n          \"name\": \"Spotify account\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"c715d18a-981f-4cfa-b3ca-3ee9753ef7ca\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        460,\n        635.2020978272825\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {}\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"b3afc8a7-39dc-429a-b440-8d2394ab528e\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        640,\n        475.2020978272825\n      ],\n      \"parameters\": {\n        \"width\": 251.77358490566033,\n        \"height\": 334.6415094339622,\n        \"content\": \"## Set Globals\\nDefine the `download_limit` of how many songs should be kept in the Downloads playlist.\\n*This setup currently supports a maximum of 50.*\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1867b7d6-771c-4915-b8ef-227b3ad21c09\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        380,\n        475.2020978272825\n      ],\n      \"parameters\": {\n        \"width\": 251.77358490566033,\n        \"height\": 334.6415094339622,\n        \"content\": \"## Setup Trigger\\nDefine the update interval. By default the playlist gets updated ones a day.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3f48a599-e41f-42ec-94c3-03315039612b\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        380,\n        240\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 511.919459860262,\n        \"height\": 227.98938005910577,\n        \"content\": \"## Information\\nThis workflow automatically creates a playlist in Spotify named \\\"Downloads\\\". It keeps a list of a defined amount of the latest liked songs up to date.\\n\\nThis enables only the Downloads playlist to set for automatic downloading and thus free up space on the device.\\n\\n**Beware that it can take several minutes until a newly created Spotify developer app is fully functioning.**\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6b101255-c9ef-407c-9cf4-d9afde6d8613\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        900,\n        395.2020978272825\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1535.0943396226407,\n        \"height\": 509.28301886792553,\n        \"content\": \"Get the \\\"Downloads\\\" playlist by name. Create it, if it does not exist.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ae08fb14-34e5-454f-95f7-5de3a17dc6f7\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2440,\n        655.2020978272825\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 435.1879320261786,\n        \"height\": 247.95572576973242,\n        \"content\": \"Get all latest liked songs and check whether they already exist in the Downloads playlist.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5603cad0-6b4d-479c-89e4-af0c950a95c3\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2880,\n        575.2020978272825\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 955.93368580286,\n        \"height\": 452.51466620839244,\n        \"content\": \"Add new tracks to the Downloads playlist. Remove tracks if they exceed the defined limit.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6c40ce51-3361-4baf-b81e-b6e9b94a0a1c\",\n      \"name\": \"If no Downloads Playlist found\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1620,\n        735.2020978272825\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"faf80ff7-8870-4f2e-94c0-998535caeac4\",\n              \"operator\": {\n                \"type\": \"array\",\n                \"operation\": \"notContains\",\n                \"rightType\": \"any\"\n              },\n              \"leftValue\": \"={{ $json.name }}\",\n              \"rightValue\": \"Downloads\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"637e0927-387f-46f9-8402-f87300f1fb6d\",\n      \"name\": \"Globals\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        720,\n        640\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"077181f9-80b9-40c2-81db-69d49376da7d\",\n              \"name\": \"download_limit\",\n              \"type\": \"number\",\n              \"value\": 50\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.3\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Globals\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get all Playlists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Aggregate\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If no Downloads Playlist found\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Out\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter out Downloads Playlist\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If no playlist\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Downloads Playlist\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Aggregate\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Updated Downloads Playlist\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Add tracks to Downloads\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Liked Tracks\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter out new tracks\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Globals\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get all Playlists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If no playlist\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get tracks to remove\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Remove oldest tracks from Downloads\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filter out new tracks\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Downloads Playlist\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Liked Tracks\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Add tracks to Downloads\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Downloads Playlist\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get all Playlists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filter out Downloads Playlist\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Downloads Playlist\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Updated Downloads Playlist\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get tracks to remove\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If no Downloads Playlist found\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Downloads Playlist\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Split Out\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.if",
      "n8n-nodes-base.spotify",
      "n8n-nodes-base.spotify",
      "n8n-nodes-base.splitInBatches",
      "n8n-nodes-base.aggregate",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.spotify",
      "n8n-nodes-base.spotify",
      "n8n-nodes-base.code",
      "n8n-nodes-base.code",
      "n8n-nodes-base.spotify",
      "n8n-nodes-base.filter",
      "n8n-nodes-base.spotify",
      "n8n-nodes-base.spotify",
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.if",
      "n8n-nodes-base.set"
    ],
    "trigger": "schedule trigger"
  }
}