{
  "source": "0260_Webhook_Respondtowebhook_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"id\": \"35c4aa9f-7535-4315-9174-fe97afc6de2e\",\n      \"name\": \"On clicking 'execute'\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        240,\n        300\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ed1f4f78-733f-4dd5-9785-969c9ec0d637\",\n      \"name\": \"Get overview page\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        460,\n        300\n      ],\n      \"parameters\": {\n        \"url\": \"https://www.ardaudiothek.de/sendung/kalk-und-welk/10777871/\",\n        \"options\": {},\n        \"responseFormat\": \"string\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"28333c78-aa8f-401a-8033-2007a5e6991c\",\n      \"name\": \"Extract links\",\n      \"type\": \"n8n-nodes-base.htmlExtract\",\n      \"position\": [\n        680,\n        300\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"extractionValues\": {\n          \"values\": [\n            {\n              \"key\": \"links\",\n              \"attribute\": \"href\",\n              \"cssSelector\": \"a[href*=\\\"/episode/\\\"]\",\n              \"returnArray\": true,\n              \"returnValue\": \"attribute\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"58840494-4208-49ce-b82a-d7cf8abd3b29\",\n      \"name\": \"Remove duplicate links\",\n      \"type\": \"n8n-nodes-base.itemLists\",\n      \"position\": [\n        1120,\n        300\n      ],\n      \"parameters\": {\n        \"operation\": \"removeDuplicates\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"17efb905-b947-4538-ab34-d50bf7fdbd75\",\n      \"name\": \"Split out lists\",\n      \"type\": \"n8n-nodes-base.itemLists\",\n      \"position\": [\n        900,\n        300\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"destinationFieldName\": \"link\"\n        },\n        \"fieldToSplitOut\": \"links\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"59a69e64-ebba-42cb-b8d0-8dd73f0ae962\",\n      \"name\": \"Get episode page\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1340,\n        300\n      ],\n      \"parameters\": {\n        \"url\": \"=https://www.ardaudiothek.de{{ $json[\\\"link\\\"] }}\",\n        \"options\": {},\n        \"responseFormat\": \"string\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"68749bff-1499-4ef5-aefd-c4b6233d0fa7\",\n      \"name\": \"Extract script\",\n      \"type\": \"n8n-nodes-base.htmlExtract\",\n      \"position\": [\n        1560,\n        300\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"extractionValues\": {\n          \"values\": [\n            {\n              \"key\": \"script\",\n              \"cssSelector\": \"script:nth-of-type(2)\",\n              \"returnValue\": \"html\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"158e7b18-f58d-453f-80f8-97e65f0b1fde\",\n      \"name\": \"Parse JSON\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1780,\n        300\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"data\",\n              \"value\": \"={{ JSON.parse($json.script) }}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a613c52e-395b-4d88-ab7d-b1cf2b664b43\",\n      \"name\": \"Define feed items\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        2000,\n        300\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const escapeHTML = str => str.replace(/[&<>'\\\"]/g, \\n  tag => ({\\n      '&': '&amp;',\\n      '<': '&lt;',\\n      '>': '&gt;',\\n      \\\"'\\\": '&#39;',\\n      '\\\"': '&quot;'\\n    }[tag]));\\n\\nlet feedItems = [];\\nfor (item of items) {\\n  feedItems.push(`<item>\\n  <title>${escapeHTML(item.json.data.name)}</title>\\n  <enclosure url=\\\"${item.json.data.associatedMedia.contentUrl}\\\" length=\\\"${item.json.data.timeRequired * 20 * 1000}\\\" type=\\\"${item.json.data.encodingFormat}\\\"/>\\n  <guid isPermaLink=\\\"false\\\">${item.json.data.identifier}</guid>\\n  <pubDate>${DateTime.fromISO(item.json.data.datePublished).toRFC2822()}</pubDate>\\n  <description>${escapeHTML(item.json.data.description)}</description>\\n</item>`);\\n}\\n\\nreturn [{\\n  data: `<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n<rss version=\\\"2.0\\\" xmlns:itunes=\\\"http://www.itunes.com/dtds/podcast-1.0.dtd\\\" xmlns:content=\\\"http://purl.org/rss/1.0/modules/content/\\\">\\n  <channel>\\n    <title>${escapeHTML(items[0].json.data.partOfSeries.name)}</title>\\n    <description>${escapeHTML(items[0].json.data.partOfSeries.about)}</description>\\n    <itunes:image href=\\\"${escapeHTML(items[0].json.data.image)}\\\" />\\n    <language>${items[0].json.data.inLanguage}</language>\\n    <itunes:category text=\\\"Comedy\\\" />\\n    <itunes:explicit>no</itunes:explicit>\\n    <link>${items[0].json.data.partOfSeries.url}</link>\\n    <copyright>Â© ${$now.toFormat('yyyy')} ${escapeHTML(items[0].json.data.productionCompany)}</copyright>\\n    <itunes:author>${escapeHTML(items[0].json.data.productionCompany)}</itunes:author>\\n    ${feedItems.join('\\\\n')}\\n  </channel>\\n</rss>\\n`\\n}];\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cbdc367d-a685-4f0b-a9f3-0aedc2c8b3c1\",\n      \"name\": \"Feed\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        240,\n        100\n      ],\n      \"webhookId\": \"3fbd94de-2fb3-4b32-a46e-c237865479b9\",\n      \"parameters\": {\n        \"path\": \"3fbd94de-2fb3-4b32-a46e-c237865479b9.rss\",\n        \"options\": {},\n        \"responseMode\": \"responseNode\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0dfb02cc-1944-4542-b5c5-9e0b198e143d\",\n      \"name\": \"Serve feed\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        2220,\n        300\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"responseCode\": 200,\n          \"responseHeaders\": {\n            \"entries\": [\n              {\n                \"name\": \"Content-Type\",\n                \"value\": \"application/rss+xml\"\n              }\n            ]\n          }\n        },\n        \"respondWith\": \"text\",\n        \"responseBody\": \"={{ $json[\\\"data\\\"] }}\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Feed\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get overview page\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Parse JSON\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Define feed items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract links\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split out lists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract script\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Parse JSON\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split out lists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Remove duplicate links\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get episode page\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract script\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Define feed items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Serve feed\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get overview page\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract links\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"On clicking 'execute'\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get overview page\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Remove duplicate links\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get episode page\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.htmlExtract",
      "n8n-nodes-base.itemLists",
      "n8n-nodes-base.itemLists",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.htmlExtract",
      "n8n-nodes-base.set",
      "n8n-nodes-base.function",
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.respondToWebhook"
    ],
    "trigger": null
  }
}