{
  "source": "0241_Asana_Notion_Create_Triggered.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"237600ca44303ce91fa31ee72babcdc8493f55ee2c0e8aa2b78b3b4ce6f70bd9\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"daaa472a-fff3-41e2-9b6f-f7f54655ea16\",\n      \"name\": \"Determine create/update\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1380,\n        300\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json[\\\"action\\\"] }}\",\n              \"value2\": \"Create\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1b047238-80b4-4144-929d-f860510b68c6\",\n      \"name\": \"Update task\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        1580,\n        420\n      ],\n      \"parameters\": {\n        \"pageId\": \"={{ $json[\\\"database_id\\\"] }}\",\n        \"resource\": \"databasePage\",\n        \"operation\": \"update\",\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Task|title\",\n              \"title\": \"={{ $json[\\\"name\\\"] }}\"\n            },\n            {\n              \"key\": \"Deadline|date\",\n              \"date\": \"={{ $json[\\\"due_on\\\"] }}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"9\",\n          \"name\": \"[UPDATE ME]\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"71801502-14bd-42d2-beb9-e44e90bcac49\",\n      \"name\": \"Create task\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        1580,\n        180\n      ],\n      \"parameters\": {\n        \"title\": \"={{$json[\\\"name\\\"]}}\",\n        \"resource\": \"databasePage\",\n        \"databaseId\": \"6181df20-c949-42e3-9999-7168d746efab\",\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Asana GID|number\",\n              \"numberValue\": \"={{ parseInt($json[\\\"gid\\\"]) }}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"9\",\n          \"name\": \"[UPDATE ME]\"\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"76d95145-89ff-477f-9e28-a64c3601b4ea\",\n      \"name\": \"Get tasks\",\n      \"type\": \"n8n-nodes-base.asana\",\n      \"position\": [\n        780,\n        300\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $json[\\\"gid\\\"] }}\",\n        \"operation\": \"get\"\n      },\n      \"credentials\": {\n        \"asanaApi\": {\n          \"id\": \"8\",\n          \"name\": \"[UPDATE ME]\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"continueOnFail\": true\n    },\n    {\n      \"id\": \"b79c96eb-ad00-4aa7-b02e-306a940396fc\",\n      \"name\": \"Find tasks\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        980,\n        160\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"resource\": \"databasePage\",\n        \"operation\": \"getAll\",\n        \"databaseId\": \"6181df20-c949-42e3-9999-7168d746efab\",\n        \"filterJson\": \"={{$node[\\\"Get unique tasks\\\"].json[\\\"notionfilter\\\"]}}\",\n        \"filterType\": \"json\"\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"9\",\n          \"name\": \"[UPDATE ME]\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"9804b81f-b2f9-45dc-9bbd-a652543668fd\",\n      \"name\": \"Get unique tasks\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        580,\n        300\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const gids = [];\\n\\n// get all the unique Asana task gids\\nfor (item of items) {\\n  var gid = parseInt(item.json.resource.gid);\\n  var resource_type = item.json.resource.resource_type;\\n  if (!(gids.includes(gid)) && resource_type == \\\"task\\\") {\\n    gids.push(gid);\\n  }\\n}\\n\\n// show in output\\nconst new_items = [];\\nfor (gid of gids) {\\n  var new_item = {\\n    \\\"json\\\": {\\n      \\\"gid\\\": 0,\\n      \\\"gids\\\": [],\\n      \\\"notionfilter\\\": \\\"\\\"\\n    }\\n  };\\n  new_item = JSON.stringify(new_item);\\n  new_item = JSON.parse(new_item);\\n  new_item.json.gid = gid;\\n  new_item.json.gids = gids;\\n  new_items.push(new_item);\\n\\n  // Notion filter\\n  notionfilter = {\\n    or: [],\\n  }\\n\\n  for (gid of gids) {\\n    const filter = {\\n      property: 'Asana GID',\\n      number: {\\n        equals: gid\\n      }\\n    }\\n    notionfilter[\\\"or\\\"].push(filter);\\n  }\\n\\n\\n  new_item.json.notionfilter = JSON.stringify(notionfilter); \\n}\\n\\nconsole.log(gids);\\nreturn new_items;\"\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"91883ca1-91f8-41ce-84d5-00f9f3296cc7\",\n      \"name\": \"Determine\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        1180,\n        300\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const gids_to_update = [];\\nconst database_ids = [];\\n\\nfor (item of $items(\\\"Find tasks\\\")) {\\n  gids_to_update.push(parseInt(item.json.property_asana_gid));\\n  database_ids.push(item.json.id);\\n}\\nconsole.log(gids_to_update);\\nconsole.log(database_ids);\\n\\nvar gid;\\nlet i = 0;\\nfor (item of $items(\\\"Get tasks\\\")) {\\n  gid = parseInt(item.json.gid);\\n  if (gids_to_update.includes(gid)) {\\n    item.json.action = \\\"Update\\\"\\n    item.json.database_id = database_ids[i];\\n  } else {\\n    item.json.action = \\\"Create\\\"\\n  }\\n  i++;\\n}\\n\\nreturn $items(\\\"Get tasks\\\");\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8ba512bb-671a-47d2-88fc-19ed358df728\",\n      \"name\": \"Check required fields exist\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1780,\n        180\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $node[\\\"Determine\\\"].json[\\\"due_on\\\"] }}\",\n              \"operation\": \"isNotEmpty\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"512a09e0-c595-4613-a4d9-ed3160fd403b\",\n      \"name\": \"Update deadline\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        1980,\n        180\n      ],\n      \"parameters\": {\n        \"pageId\": \"={{ $json[\\\"id\\\"] }}\",\n        \"resource\": \"databasePage\",\n        \"operation\": \"update\",\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Deadline|date\",\n              \"date\": \"={{ $node[\\\"Determine\\\"].json[\\\"due_on\\\"] }}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": {\n          \"id\": \"9\",\n          \"name\": \"[UPDATE ME]\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"4b08a930-93ef-4f88-8109-9afa45af703e\",\n      \"name\": \"On update\",\n      \"type\": \"n8n-nodes-base.asanaTrigger\",\n      \"position\": [\n        380,\n        300\n      ],\n      \"webhookId\": \"61055fe2-63c7-4b93-adcb-ddb7556c3060\",\n      \"parameters\": {\n        \"resource\": \"1202718722261680\",\n        \"workspace\": \"1177253494675264\"\n      },\n      \"credentials\": {\n        \"asanaApi\": {\n          \"id\": \"8\",\n          \"name\": \"[UPDATE ME]\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Determine\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Determine create/update\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get tasks\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Find tasks\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Determine\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"On update\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get unique tasks\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Find tasks\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Determine\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create task\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check required fields exist\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get unique tasks\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get tasks\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Determine create/update\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create task\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Update task\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check required fields exist\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update deadline\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.if",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.asana",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.function",
      "n8n-nodes-base.function",
      "n8n-nodes-base.if",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.asanaTrigger"
    ],
    "trigger": null
  }
}