{
  "source": "1802_Code_Manual_Import_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"aVienX696oMCH1DR\",\n  \"meta\": {\n    \"instanceId\": \"dce6d05169adc9f802863a06c3edb9925b178c4fce2360953cce9c1b509705cc\"\n  },\n  \"name\": \"Tiktok Downloader\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"4dc30078-c7df-4bcb-91ed-953cd6da4a13\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -280,\n        20\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5598aa10-f667-4023-b9de-fe07e86badec\",\n      \"name\": \"Get TikTok Video Page Data\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        40,\n        20\n      ],\n      \"parameters\": {\n        \"url\": \"https://www.tiktok.com/@randomspamvideos25/video/7251387037834595630\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"fullResponse\": true,\n              \"responseFormat\": \"text\"\n            }\n          }\n        },\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"User-Agent\",\n              \"value\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/91.0.4472.124\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"734a5304-f67f-4ace-a1da-0d268664452c\",\n      \"name\": \"Scrape raw video URL\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        480,\n        20\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const html = $input.first().json.data;\\nconst headers = $input.first().json.headers || {};\\nconst cookies = headers['set-cookie'] || [];\\n\\nif (!html) {\\n  throw new Error(\\\"HTML body is undefined. Check the previous node's output.\\\");\\n}\\nconst regex = /<script id=\\\"__UNIVERSAL_DATA_FOR_REHYDRATION__\\\" type=\\\"application\\\\/json\\\">([\\\\s\\\\S]*?)<\\\\/script>/;\\nconst match = html.match(regex);\\n\\nif (match) {\\n  const jsonStr = match[1];\\n  const data = JSON.parse(jsonStr);\\n  const videoUrl = data?.__DEFAULT_SCOPE__?.[\\\"webapp.video-detail\\\"]?.itemInfo?.itemStruct?.video?.playAddr;\\n  if (!videoUrl) {\\n    throw new Error(\\\"Could not find video URL in the JSON data.\\\");\\n  }\\n  return [{ json: { videoUrl, cookies: cookies.join('; ') } }];\\n} else {\\n  throw new Error(\\\"Could not find __UNIVERSAL_DATA_FOR_REHYDRATION__ script in the HTML.\\\");\\n}\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"f574ccb8-6f5f-4e55-a2d5-7ad775d3c4e5\",\n      \"name\": \"Output video file without watermark\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        900,\n        20\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $json.videoUrl }}\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"responseFormat\": \"file\"\n            }\n          },\n          \"allowUnauthorizedCerts\": true\n        },\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"User-Agent\",\n              \"value\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36\"\n            },\n            {\n              \"name\": \"Referer\",\n              \"value\": \"https://www.tiktok.com/\"\n            },\n            {\n              \"name\": \"Accept\",\n              \"value\": \"video/mp4,video/webm,video/*;q=0.9,application/octet-stream;q=0.8\"\n            },\n            {\n              \"name\": \"Accept-Language\",\n              \"value\": \"en-US,en;q=0.5\"\n            },\n            {\n              \"name\": \"Connection\",\n              \"value\": \"keep-alive\"\n            },\n            {\n              \"name\": \"Cookie\",\n              \"value\": \"={{ $json.cookies }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"73d4ffa7-2264-4a84-9ab2-2004342e3039\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -140,\n        -180\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 460,\n        \"height\": 360,\n        \"content\": \"## 1. Load the video page\\nOpen this node and replace the URL with the one of the video you want to download without a watermark.\\n\\nA Tiktok video URL looks like: https://www.tiktok.com/@Username_here/video/Video_ID_Here\\n\\nOutputs the returned page HTML along with the session cookies\\n\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"848fc04b-2620-4d83-8701-52c053f7c017\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        340,\n        -180\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 380,\n        \"height\": 360,\n        \"content\": \"## 2. Find the raw video URL\\nParses through all of the HTML and finds the section containing the video URL before the watermark is applied\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"40b3a2bd-5733-43a8-951c-d5fa26647615\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        740,\n        -180\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 400,\n        \"height\": 360,\n        \"content\": \"## 3. Output video file without watermark\\nUsing the cookies from step 1, a request is made to access the original video file as shown on TikTok\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"36629265-f139-433f-9603-0670a08be1ed\",\n      \"name\": \"Upload to Google Drive\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        300,\n        360\n      ],\n      \"parameters\": {\n        \"name\": \"={{ $node[\\\"Get TikTok Video Page Data\\\"].parameter[\\\"url\\\"].match(/\\\\/video\\\\/(\\\\d+)/)[1] + \\\".mp4\\\" }}\",\n        \"driveId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"My Drive\"\n        },\n        \"options\": {},\n        \"folderId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"root\",\n          \"cachedResultUrl\": \"https://drive.google.com/drive\",\n          \"cachedResultName\": \"/ (Root folder)\"\n        }\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"ZvDuyVfbZJbDJXcS\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"94364c83-14ce-48c3-afe5-b7cd8addd2a0\",\n      \"name\": \"Set file permissions to public with link\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        560,\n        360\n      ],\n      \"parameters\": {\n        \"fileId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $json.id }}\"\n        },\n        \"options\": {},\n        \"operation\": \"share\",\n        \"permissionsUi\": {\n          \"permissionsValues\": {\n            \"role\": \"writer\",\n            \"type\": \"anyone\",\n            \"allowFileDiscovery\": true\n          }\n        }\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"ZvDuyVfbZJbDJXcS\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"d37ad36c-0b7f-4c2c-9538-dc8bf75e997f\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        260,\n        200\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 500,\n        \"height\": 320,\n        \"content\": \"## (Optional) Upload video to Google Drive\\nAn expression is used to save the file to your Google Drive as Video_ID.mp4\\n\\nNote: Must have Google Drive API enabled in [Google Cloud Console](https://console.cloud.google.com/apis/api/drive.googleapis.com/overview) OAuth ClientID and Client Secret credentials setup\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"70234bbb-ccaf-4291-a50b-063e07303678\",\n  \"connections\": {\n    \"Scrape raw video URL\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Output video file without watermark\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Upload to Google Drive\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set file permissions to public with link\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get TikTok Video Page Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Scrape raw video URL\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get TikTok Video Page Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Output video file without watermark\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload to Google Drive\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.code",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}