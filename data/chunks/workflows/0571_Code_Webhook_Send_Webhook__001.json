{
  "source": "0571_Code_Webhook_Send_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"bb6a1286a4ce98dce786d6c2748b867c1252d53458c87d87fbf6824b862d4c9c\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"faade37e-908d-494c-af74-93c8f01adcc5\",\n      \"name\": \"Everyday at 7PM\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        440,\n        520\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {\n              \"field\": \"cronExpression\",\n              \"expression\": \"0 0 19 * * *\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"4abddfea-fee9-419c-92c4-3055faa2dd09\",\n      \"name\": \"Airtable Get Today's Orders\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"position\": [\n        900,\n        520\n      ],\n      \"parameters\": {\n        \"base\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"appdtUVSpfWswMwNC\",\n          \"cachedResultUrl\": \"https://airtable.com/appdtUVSpfWswMwNC\",\n          \"cachedResultName\": \"Untitled Base\"\n        },\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"tblu6F5rLbR3Axtgj\",\n          \"cachedResultUrl\": \"https://airtable.com/appdtUVSpfWswMwNC/tblu6F5rLbR3Axtgj\",\n          \"cachedResultName\": \"orders\"\n        },\n        \"options\": {},\n        \"operation\": \"search\",\n        \"filterByFormula\": \"=AND(time < \\\"{{ $json.now }}\\\", time > \\\"{{ $json.yesterday }}\\\")\"\n      },\n      \"credentials\": {\n        \"airtableTokenApi\": {\n          \"id\": \"uSxVhc7fcMM7uPM2\",\n          \"name\": \"Airtable Personal Access Token account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"ea29159e-3674-4385-a0bd-2a9df7d7117c\",\n      \"name\": \"Yesterday Date\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        660,\n        520\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Create a new date object for yesterday, 7pm\\nconst yesterday = new Date();\\nyesterday.setDate( new Date().getDate() - 1); \\nyesterday.setHours(19, 0, 0, 0);\\nconst isoString = yesterday.toISOString();\\nreturn {yesterday:isoString, now:new Date().toISOString()}\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"8254aa63-2682-4c48-8843-c93830c724de\",\n      \"name\": \"HTML\",\n      \"type\": \"n8n-nodes-base.html\",\n      \"position\": [\n        1120,\n        520\n      ],\n      \"parameters\": {\n        \"html\": \"<!DOCTYPE html>\\n<html>\\n<head>\\n  <meta charset=\\\"UTF-8\\\" />\\n</head>\\n<body>\\n  <table>\\n    <tr> \\n      {{ Object.keys($input.first().json).map(propname=>'<td>'+propname+'</td>').join('')  \\n      }}\\n    </tr>\\n      \\n    {{ $input.all().map(order=>{\\n        \\n        return \\\"<tr>\\\"+Object.values(order.json).map(prop=>{\\n            return \\\"<td>\\\"+prop+\\\"</td>\\\"\\n          }).join('') +\\\"</tr>\\\"\\n      }).join('') \\n    }}\\n  </table>\\n</body>\\n</html>\\n\\n<style>\\n.container {\\n  background-color: #ffffff;\\n  text-align: center;\\n  padding: 16px;\\n  border-radius: 8px;\\n}\\n\\nh1 {\\n  color: #ff6d5a;\\n  font-size: 24px;\\n  font-weight: bold;\\n  padding: 8px;\\n}\\n\\nh2 {\\n  color: #909399;\\n  font-size: 18px;\\n  font-weight: bold;\\n  padding: 8px;\\n}\\n</style>\\n\"\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"5e9f6ad7-e4fc-41e3-991b-cae9210dfb71\",\n      \"name\": \"Set Order Fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        660,\n        220\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"2c2f9e3c-696a-466a-8bfe-5c8aa942c9ab\",\n              \"name\": \"time\",\n              \"type\": \"string\",\n              \"value\": \"={{ new Date().toISOString() }}\"\n            },\n            {\n              \"id\": \"5618b2a7-8149-469d-87ee-535f1adac121\",\n              \"name\": \"orderID\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.body.orderID }}\"\n            },\n            {\n              \"id\": \"dc31db55-24e4-468f-a9fd-456298f5e5ab\",\n              \"name\": \"orderPrice\",\n              \"type\": \"number\",\n              \"value\": \"={{ $json.body.orderPrice }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"68eaa8f7-3b67-484e-8bad-87e621adc1df\",\n      \"name\": \"Send to Gmail\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        1340,\n        520\n      ],\n      \"parameters\": {\n        \"sendTo\": \"axelrose20272027@gmail.com\",\n        \"message\": \"={{ $json.html }}\",\n        \"options\": {},\n        \"subject\": \"Daily Order Summary\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"qMvN3j2E5MFAguNF\",\n          \"name\": \"Gmail account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"9f22bedc-fbe1-421b-8212-189c7d436cab\",\n      \"name\": \"Store Order\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"position\": [\n        900,\n        220\n      ],\n      \"parameters\": {\n        \"base\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"appdtUVSpfWswMwNC\",\n          \"cachedResultUrl\": \"https://airtable.com/appdtUVSpfWswMwNC\",\n          \"cachedResultName\": \"Untitled Base\"\n        },\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"tblu6F5rLbR3Axtgj\",\n          \"cachedResultUrl\": \"https://airtable.com/appdtUVSpfWswMwNC/tblu6F5rLbR3Axtgj\",\n          \"cachedResultName\": \"orders\"\n        },\n        \"columns\": {\n          \"value\": {\n            \"orderID\": 0,\n            \"customerID\": 0,\n            \"orderPrice\": 0\n          },\n          \"schema\": [\n            {\n              \"id\": \"time\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"time\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"orderID\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"orderID\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"customerID\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"customerID\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"orderPrice\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"orderPrice\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"orderStatus\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": false,\n              \"required\": false,\n              \"displayName\": \"orderStatus\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"autoMapInputData\",\n          \"matchingColumns\": []\n        },\n        \"options\": {\n          \"typecast\": true\n        },\n        \"operation\": \"create\"\n      },\n      \"credentials\": {\n        \"airtableTokenApi\": {\n          \"id\": \"uSxVhc7fcMM7uPM2\",\n          \"name\": \"Airtable Personal Access Token account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"6ace0e8f-85e1-45bc-ae81-331c5722ef46\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        340,\n        160\n      ],\n      \"parameters\": {\n        \"width\": 857.9236217062975,\n        \"height\": 220.18022408852067,\n        \"content\": \"### New order is sent to the Webhook via POST with params {orderID, orderPrice}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6907ae8d-90b7-4e07-883d-3ebd4440d811\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        340,\n        460\n      ],\n      \"parameters\": {\n        \"width\": 1202.2434730902464,\n        \"height\": 235.62797364881823,\n        \"content\": \"### Daily summary sent to email at 7PM\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"848c6acb-2f9c-4d85-8349-a4a31204922b\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -620,\n        -80\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 607.7708924207209,\n        \"height\": 893.1187181589532,\n        \"content\": \"# Aggregate Daily Orders with Airtable\\n### This workflow will collect order data as it is produced, then send a summary email of all orders at the end of every day, formatted in a table.\\n\\n## Setup:\\n 1. Create a new table in Airtable and give it a field *time* with type date, *orderID* with type number, and *orderPrice* also with type number. \\n 2. Create a new access token if you haven't already at https://airtable.com/create/tokens/new. Make sure to give the token the scopes *data.records:read*, *data.records:write*, *schema.bases:read* and access to whichever table you choose to store the orders. A pop-up window appears with the token. Use this token to make `Create New Credential` > `Access Token` for Airtable in the `Store Order` and `Airtable Get Today's Orders` nodes.\\n 3. Create access credentials for your Gmail as described here: https://developers.google.com/workspace/guides/create-credentials. Use the credentials from your *client_secret.json* in the `Send to Gmail` node.\\n 4. In the `Store Order` node, change *Base* and *Table* to the database and table in your Airtable account you wish to use to store orders. Make sure to use these same values in the `Airtable Get Today's Orders` node.\\n 5. Every time an order is created in your system, send a POST request to Webhook from your order software. Each request must contain a single order containing fields *'orderID'* and *'orderPrice'* (or, edit `Set Order Fields` to select which incoming fields you wish to save)\\n 6. Change the schedule time for sending email from `Everyday at 7PM` to whichever time you choose. \\n \\n\\n## Test:\\n- Activate the workflow.\\n- From the node `Webhook`, copy *Production URL*\\n- Send the following CURL request to the URL given to you:\\n` curl -X POST   -H \\\"Content-Type: application/json\\\"   -d '{\\\"orderID\\\": 12345, \\\"orderPrice\\\": 99.99}' YOUR_URL_HERE`\\n- It should say *Node executed successfully*. Now check your Airtable and confirm the order was stored in the right place.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d9a5ef05-beba-480f-967e-840cf1b71248\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        200,\n        240\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 170,\n        \"height\": 80,\n        \"content\": \"- New Order!\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0f433e34-79cd-42d0-9b56-4a306eb91907\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        200,\n        540\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 170,\n        \"height\": 80,\n        \"content\": \" - It's 7PM!\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fb9c4b49-ee1f-4233-8277-4c35fb423fde\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        440,\n        220\n      ],\n      \"webhookId\": \"e9e62c98-390d-4d16-bc77-a13b043bf1cf\",\n      \"parameters\": {\n        \"path\": \"e9e62c98-390d-4d16-bc77-a13b043bf1cf\",\n        \"options\": {},\n        \"httpMethod\": \"POST\"\n      },\n      \"typeVersion\": 2\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"HTML\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send to Gmail\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Order Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Yesterday Date\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Airtable Get Today's Orders\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Everyday at 7PM\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Yesterday Date\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Order Fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Store Order\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Airtable Get Today's Orders\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HTML\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.airtable",
      "n8n-nodes-base.code",
      "n8n-nodes-base.html",
      "n8n-nodes-base.set",
      "n8n-nodes-base.gmail",
      "n8n-nodes-base.airtable",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.webhook"
    ],
    "trigger": null
  }
}