{
  "source": "0707_HTTP_Stripe_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"6f3fb2495ae05d668c93cbf9e1649128d6e08178f8a900941cf97e588f18fdfc\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"7fe02521-c46a-4314-9387-b7b4983fa859\",\n      \"name\": \"POST Sales Receipt\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1320,\n        -120\n      ],\n      \"parameters\": {\n        \"url\": \"https://sandbox-quickbooks.api.intuit.com/v3/company/9341453851324714/salesreceipt?minorversion=73\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"Line\\\": [\\n    {\\n      \\\"Description\\\": \\\"{{ $json.data.object.description }}\\\",\\n      \\\"DetailType\\\": \\\"SalesItemLineDetail\\\",\\n      \\\"SalesItemLineDetail\\\": {\\n        \\\"TaxCodeRef\\\": {\\n          \\\"value\\\": \\\"NON\\\"\\n        },\\n        \\\"Qty\\\": 1,\\n        \\\"UnitPrice\\\": {{ $json.data.object.amount_received / 100 }},\\n        \\\"ItemRef\\\": {\\n          \\\"name\\\": \\\"Subscription\\\", \\n          \\\"value\\\": \\\"10\\\"\\n        }\\n      },\\n      \\\"Amount\\\": {{ $json.data.object.amount / 100 }},\\n      \\\"LineNum\\\": 1\\n    }\\n  ],\\n  \\\"CustomerRef\\\": {\\n    \\\"value\\\": {{ $input.all()[2].json.QueryResponse.Customer[0].BillAddr.Id }},\\n    \\\"name\\\": \\\"{{ $input.all()[2].json.QueryResponse.Customer[0].DisplayName }}\\\"\\n  },\\n  \\\"CurrencyRef\\\": {\\n    \\\"value\\\": \\\"{{ $json.data.object.currency.toUpperCase() }}\\\"\\n  },\\n  \\\"PrivateNote\\\": \\\"Payment from Stripe Payment Intent ID: {{ $json.data.object.id }}\\\"\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"quickBooksOAuth2Api\"\n      },\n      \"credentials\": {\n        \"quickBooksOAuth2Api\": {\n          \"id\": \"IUNAfwwSgnbwWygB\",\n          \"name\": \"QuickBooks Online account\"\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"5ed429d7-c93d-48c8-b603-ca8d7efb57ed\",\n      \"name\": \"GET Quickbooks Customer\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        400,\n        -20\n      ],\n      \"parameters\": {\n        \"url\": \"=https://sandbox-quickbooks.api.intuit.com/v3/company/9341453851324714/query?query=select * from Customer Where PrimaryEmailAddr = '{{ $json.email }}'&minorversion=73\\n\\n\",\n        \"options\": {},\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"quickBooksOAuth2Api\"\n      },\n      \"credentials\": {\n        \"httpCustomAuth\": {\n          \"id\": \"hqXGCVkt6W41KDDK\",\n          \"name\": \"Custom Auth account\"\n        },\n        \"quickBooksOAuth2Api\": {\n          \"id\": \"IUNAfwwSgnbwWygB\",\n          \"name\": \"QuickBooks Online account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"bef5b4c3-4948-4294-bd80-7039342edf0d\",\n      \"name\": \"Get Stripe Customer\",\n      \"type\": \"n8n-nodes-base.stripe\",\n      \"position\": [\n        240,\n        -140\n      ],\n      \"parameters\": {\n        \"resource\": \"customer\",\n        \"customerId\": \"={{ $json.data.object.customer }}\"\n      },\n      \"credentials\": {\n        \"stripeApi\": {\n          \"id\": \"o6KHVZiU8S7O38wq\",\n          \"name\": \"Stripe account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"042fff2c-b5e7-4877-b935-f6a707118c4a\",\n      \"name\": \"New Payment\",\n      \"type\": \"n8n-nodes-base.stripeTrigger\",\n      \"position\": [\n        80,\n        -260\n      ],\n      \"webhookId\": \"5cc15770-f762-4389-8372-1b2926de4570\",\n      \"parameters\": {\n        \"events\": [\n          \"payment_intent.succeeded\"\n        ]\n      },\n      \"credentials\": {\n        \"stripeApi\": {\n          \"id\": \"o6KHVZiU8S7O38wq\",\n          \"name\": \"Stripe account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"12235c25-712b-4e84-b744-60573e00d381\",\n      \"name\": \"If Customer Exists\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        560,\n        100\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"aef7393c-c4ff-4196-887d-6a9b057381f8\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"exists\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.QueryResponse.Customer[0].PrimaryEmailAddr.Address }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"68f63246-cb95-494f-918c-c0c6da5a64f9\",\n      \"name\": \"Use Stripe Customer\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        880,\n        120\n      ],\n      \"parameters\": {},\n      \"executeOnce\": true,\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"e9eea332-7109-479f-8f50-65b3b9438e0e\",\n      \"name\": \"Create QuickBooks Customer\",\n      \"type\": \"n8n-nodes-base.quickbooks\",\n      \"position\": [\n        1100,\n        120\n      ],\n      \"parameters\": {\n        \"operation\": \"create\",\n        \"displayName\": \"={{ $input.all()[0].json.name }}\",\n        \"additionalFields\": {\n          \"Balance\": \"={{ $input.all()[0].json.balance }}\",\n          \"PrimaryEmailAddr\": \"={{ $input.all()[0].json.email }}\"\n        }\n      },\n      \"credentials\": {\n        \"quickBooksOAuth2Api\": {\n          \"id\": \"IUNAfwwSgnbwWygB\",\n          \"name\": \"QuickBooks Online account\"\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f805f03d-93b7-4e3b-8b6a-37d9dd802368\",\n      \"name\": \"Merge Stripe and QuickBooks Data\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1100,\n        -120\n      ],\n      \"parameters\": {\n        \"numberInputs\": 3\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"b9c31838-2bb7-4882-bd15-c096cb97e225\",\n      \"name\": \"Merge Payment and QuickBooks Customer\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1320,\n        120\n      ],\n      \"parameters\": {},\n      \"executeOnce\": true,\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"cb69fcee-8d5d-47ab-be76-9e25cb0a7f42\",\n      \"name\": \"POST Sales Receipt To QuickBooks\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1540,\n        120\n      ],\n      \"parameters\": {\n        \"url\": \"https://sandbox-quickbooks.api.intuit.com/v3/company/9341453851324714/salesreceipt?minorversion=73\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"Line\\\": [\\n    {\\n      \\\"Description\\\": \\\"{{ $json.data.object.description }}\\\",\\n      \\\"DetailType\\\": \\\"SalesItemLineDetail\\\",\\n      \\\"SalesItemLineDetail\\\": {\\n        \\\"TaxCodeRef\\\": {\\n          \\\"value\\\": \\\"NON\\\"\\n        },\\n        \\\"Qty\\\": 1,\\n        \\\"UnitPrice\\\": {{ $json.data.object.amount_received / 100 }},\\n        \\\"ItemRef\\\": {\\n          \\\"name\\\": \\\"Subscription\\\", \\n          \\\"value\\\": \\\"10\\\"\\n        }\\n      },\\n      \\\"Amount\\\": {{ $json.data.object.amount / 100 }},\\n      \\\"LineNum\\\": 1\\n    }\\n  ],\\n  \\\"CustomerRef\\\": {\\n    \\\"value\\\": {{ $input.all()[1].json.Id}},\\n    \\\"name\\\": \\\"{{ $input.all()[1].json.DisplayName }}\\\"\\n  },\\n  \\\"CurrencyRef\\\": {\\n    \\\"value\\\": \\\"{{ $json.data.object.currency.toUpperCase() }}\\\"\\n  },\\n  \\\"PrivateNote\\\": \\\"Payment from Stripe Payment Intent ID: {{ $json.data.object.id }}\\\"\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"quickBooksOAuth2Api\"\n      },\n      \"credentials\": {\n        \"quickBooksOAuth2Api\": {\n          \"id\": \"IUNAfwwSgnbwWygB\",\n          \"name\": \"QuickBooks Online account\"\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 4.2\n    }\n  ],\n  \"pinData\": {\n    \"New Payment\": [\n      {\n        \"id\": \"evt_3Qjf7fJJNVDH5POn01Am9Q1x\",\n        \"data\": {\n          \"object\": {\n            \"id\": \"pi_3Qjf54D14htxZ8341jkWWJJs\",\n            \"amount\": 9500,\n            \"object\": \"payment_intent\",\n            \"review\": null,\n            \"source\": null,\n            \"status\": \"succeeded\",\n            \"created\": 1737456794,\n            \"invoice\": \"in_1Qje8QD14htxZ834S3Gh3Nn6\",\n            \"currency\": \"usd\",\n            \"customer\": \"cus_R4OkhTTT1ebzPl\",\n            \"livemode\": false,\n            \"metadata\": {},\n            \"shipping\": null,\n            \"processing\": null,\n            \"application\": null,\n            \"canceled_at\": null,\n            \"description\": \"Subscription update\",\n            \"next_action\": null,\n            \"on_behalf_of\": null,\n            \"client_secret\": \"pi_3Qjf54D14htxZ8341jkWWJJs_secret_FXltcZHFUDM8I4F0AQjRPE9Vz\",\n            \"latest_charge\": \"ch_3Qjf54D14htxZ8341xwQhggm\",\n            \"receipt_email\": null,\n            \"transfer_data\": null,\n            \"amount_details\": {\n              \"tip\": {}\n            },\n            \"capture_method\": \"automatic\",\n            \"payment_method\": \"pm_1Qh6nED14htxZ834bTgSzUQy\",\n            \"transfer_group\": null,\n            \"amount_received\": 9500,\n            \"amount_capturable\": 0,\n            \"last_payment_error\": null,\n            \"setup_future_usage\": null,\n            \"cancellation_reason\": null,\n            \"confirmation_method\": \"automatic\",\n            \"payment_method_types\": [\n              \"amazon_pay\",\n              \"card\",\n              \"cashapp\",\n              \"link\"\n            ],\n            \"statement_descriptor\": null,\n            \"application_fee_amount\": null,\n            \"payment_method_options\": {\n              \"card\": {\n                \"network\": null,\n                \"installments\": null,\n                \"mandate_options\": null,\n                \"request_three_d_secure\": \"automatic\"\n              },\n              \"link\": {\n                \"persistent_token\": null\n              },\n              \"cashapp\": {},\n              \"amazon_pay\": {\n                \"express_checkout_element_session_id\": null\n              }\n            },\n            \"automatic_payment_methods\": null,\n            \"statement_descriptor_suffix\": null,\n            \"payment_method_configuration_details\": null\n          }\n        },\n        \"type\": \"payment_intent.succeeded\",\n        \"object\": \"event\",\n        \"created\": 1737456956,\n        \"request\": {\n          \"id\": \"req_vbXfG1vUORKZJ6\",\n          \"idempotency_key\": \"e63d5e07-f753-429c-bd06-c642e23d9ff8\"\n        },\n        \"livemode\": false,\n        \"api_version\": \"2020-08-27\",\n        \"pending_webhooks\": 3\n      }\n    ],\n    \"Get Stripe Customer\": [\n      {\n        \"id\": \"cus_R4OkhTTT1ebzPl\",\n        \"name\": \"Test Usershvili\",\n        \"email\": \"Birds@Intuit.com\",\n        \"phone\": null,\n        \"object\": \"customer\",\n        \"address\": {\n          \"city\": null,\n          \"line1\": null,\n          \"line2\": null,\n          \"state\": null,\n          \"country\": \"GE\",\n          \"postal_code\": null\n        },\n        \"balance\": 0,\n        \"created\": 1729495354,\n        \"currency\": \"usd\",\n        \"discount\": null,\n        \"livemode\": false,\n        \"metadata\": {},\n        \"shipping\": null,\n        \"delinquent\": false,\n        \"tax_exempt\": \"none\",\n        \"test_clock\": null,\n        \"description\": null,\n        \"default_source\": null,\n        \"invoice_prefix\": \"F73B0901\",\n        \"default_currency\": \"usd\",\n        \"invoice_settings\": {\n          \"footer\": null,\n          \"custom_fields\": null,\n          \"rendering_options\": null,\n          \"default_payment_method\": null\n        },\n        \"preferred_locales\": [\n          \"en-GB\"\n        ]\n      }\n    ]\n  },\n  \"connections\": {\n    \"New Payment\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Stripe Customer\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Merge Stripe and QuickBooks Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Merge Payment and QuickBooks Customer\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If Customer Exists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge Stripe and QuickBooks Data\",\n            \"type\": \"main\",\n            \"index\": 2\n          }\n        ],\n        [\n          {\n            \"node\": \"Use Stripe Customer\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"POST Sales Receipt\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"Get Stripe Customer\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"GET Quickbooks Customer\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Use Stripe Customer\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Use Stripe Customer\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create QuickBooks Customer\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"GET Quickbooks Customer\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If Customer Exists\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Merge Stripe and QuickBooks Data\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Create QuickBooks Customer\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge Payment and QuickBooks Customer\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Merge Stripe and QuickBooks Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"POST Sales Receipt\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge Payment and QuickBooks Customer\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"POST Sales Receipt To QuickBooks\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stripe",
      "n8n-nodes-base.stripeTrigger",
      "n8n-nodes-base.if",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.quickbooks",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.httpRequest"
    ],
    "trigger": null
  }
}