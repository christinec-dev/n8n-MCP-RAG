{
  "source": "0655_Code_Postgres_Update_Scheduled.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"a2435d996b378e3a6fdef0468d70285e3aa0fbd0004de817bfc80e80afee4e7b\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"8a4ba8b8-b76e-4572-becd-e7f8fbea2651\",\n      \"name\": \"EXTRACT CAMPAIGN DATA\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        500,\n        960\n      ],\n      \"parameters\": {\n        \"url\": \"=https://server.smartlead.ai/api/v1/campaigns/{{ $json.id }}/leads-export\",\n        \"options\": {\n          \"batching\": {\n            \"batch\": {\n              \"batchSize\": 0\n            }\n          }\n        },\n        \"sendQuery\": true,\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"api_key\",\n              \"value\": \"={{ $json['API KEY'] }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"90011ed6-180d-4170-8932-ac3aa7d0e5df\",\n      \"name\": \"FETCH ALL CAMPAIGNS\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -20,\n        940\n      ],\n      \"parameters\": {\n        \"url\": \"https://server.smartlead.ai/api/v1/campaigns\",\n        \"options\": {\n          \"batching\": {\n            \"batch\": {\n              \"batchSize\": 0\n            }\n          }\n        },\n        \"sendQuery\": true,\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"api_key\",\n              \"value\": \"={{ $json['API KEY'] }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"c41afcf1-9256-47fa-ad99-3e1af880e53d\",\n      \"name\": \"Loop Over Items\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        200,\n        940\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"reset\": \"={{ $node['Loop Over Items'].context[\\\"done\\\"] }}\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"606bfc18-1d70-4d64-ac70-ae6f42bf0dbb\",\n      \"name\": \"UPDATE CAMPAIGN\",\n      \"type\": \"n8n-nodes-base.postgres\",\n      \"position\": [\n        720,\n        1220\n      ],\n      \"parameters\": {\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"ce_campaign\",\n          \"cachedResultName\": \"ce_campaign\"\n        },\n        \"schema\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"outbound_activities\",\n          \"cachedResultName\": \"outbound_activities\"\n        },\n        \"columns\": {\n          \"value\": {\n            \"name\": \"={{ $json.name }}\",\n            \"status\": \"={{ $json.status }}\",\n            \"user_id\": \"={{ $json.user_id }}\",\n            \"client_id\": \"={{ $json.client_id }}\",\n            \"created_at\": \"={{ $json.created_at }}\",\n            \"updated_at\": \"={{ $json.updated_at }}\",\n            \"campaign_id\": \"={{ $json.id }}\",\n            \"track_settings\": \"={{ $json.track_settings }}\",\n            \"unsubscribe_text\": \"={{ $json.unsubscribe_text }}\",\n            \"max_leads_per_day\": \"={{ $json.max_leads_per_day }}\",\n            \"parent_campaign_id\": \"={{ $json.parent_campaign_id }}\",\n            \"send_as_plain_text\": \"={{ $json.send_as_plain_text }}\",\n            \"stop_lead_settings\": \"={{ $json.stop_lead_settings }}\",\n            \"follow_up_percentage\": \"={{ $json.follow_up_percentage }}\",\n            \"min_time_btwn_emails\": \"={{ $json.min_time_btwn_emails }}\",\n            \"scheduler_cron_value\": \"={{ $json.scheduler_cron_value }}\",\n            \"enable_ai_esp_matching\": \"={{ $json.enable_ai_esp_matching }}\",\n            \"psg_last_update_timestamp\": \"={{ $now }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"campaign_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": true,\n              \"displayName\": \"campaign_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"user_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"user_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"created_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"required\": true,\n              \"displayName\": \"created_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"updated_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"required\": true,\n              \"displayName\": \"updated_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"status\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": true,\n              \"displayName\": \"status\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"track_settings\",\n              \"type\": \"array\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"track_settings\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"scheduler_cron_value\",\n              \"type\": \"object\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"scheduler_cron_value\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"min_time_btwn_emails\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"min_time_btwn_emails\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"max_leads_per_day\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"max_leads_per_day\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"stop_lead_settings\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"stop_lead_settings\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"enable_ai_esp_matching\",\n              \"type\": \"boolean\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"enable_ai_esp_matching\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"send_as_plain_text\",\n              \"type\": \"boolean\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"send_as_plain_text\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"follow_up_percentage\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"follow_up_percentage\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"unsubscribe_text\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"unsubscribe_text\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"parent_campaign_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"parent_campaign_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"client_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"client_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"psg_last_update_timestamp\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"psg_last_update_timestamp\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"campaign_id\"\n          ]\n        },\n        \"options\": {\n          \"queryBatching\": \"independently\"\n        },\n        \"operation\": \"upsert\"\n      },\n      \"credentials\": {\n        \"postgres\": {\n          \"id\": \"z7VPpa7mFIGKNewM\",\n          \"name\": \"Postgres Aikido\"\n        }\n      },\n      \"typeVersion\": 2.5\n    },\n    {\n      \"id\": \"b9f61fd6-9327-428e-9e78-4ca0779476ea\",\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1220,\n        980\n      ],\n      \"parameters\": {\n        \"mode\": \"combine\",\n        \"options\": {},\n        \"combineBy\": \"combineByPosition\"\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"b8c1082d-a12f-4e56-af8c-73641b45da67\",\n      \"name\": \"Code\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"notes\": \"// Retrieve the CSV-like data from the 'data' field in the input\\nconst csvData = $json['data']; // Ensure that 'data' is the correct field name\\n\\n// Check if csvData exists and is not empty\\nif (!csvData) {\\n  console.log(\\\"Input data structure:\\\", $json); // Debugging output to inspect input structure\\n  throw new Error('No CSV data provided. Ensure the correct field reference is being used.');\\n}\\n\\n// Split the CSV into rows\\nconst rows = csvData.split('\\\\n');\\n\\n// Extract the headers\\nconst headers = rows[0].replace(/\\\"/g, '').split(',');\\n\\n// Iterate over each data row and map it to an object\\nconst output = rows.slice(1).map(row => {\\n  const values = row.match(/(\\\".*?\\\"|[^\\\",]+)(?=\\\\s*,|\\\\s*$)/g).map(value => {\\n    // Remove surrounding quotes from each value if present\\n    return value.startsWith('\\\"') && value.endsWith('\\\"') ? value.slice(1, -1) : value;\\n  });\\n\\n  const item = {};\\n  headers.forEach((header, index) => {\\n    item[header] = values[index] || null;\\n  });\\n\\n  return { json: item };\\n});\\n\\nreturn output;\",\n      \"position\": [\n        720,\n        960\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Retrieve the CSV-like data from the 'data' field in the input\\nconst csvData = items[0].json.data; // Ensure that 'data' is the correct field name\\n\\n// Check if csvData exists and is not empty\\nif (!csvData) {\\n  console.log(\\\"Input data structure:\\\", ); // Debugging output to inspect input structure\\n  throw new Error('No CSV data provided. Ensure the correct field reference is being used.');\\n}\\n\\nif (typeof csvData !== 'string') {\\n  throw new Error('CSV data is not a string. Please check the input data format.');\\n}\\n\\n// Preprocess the CSV data to handle missing values\\nconst preprocessedCsvData = csvData.replace(/,,/g, ',\\\"\\\",');\\n\\n// Split the CSV into rows\\nconst rows = preprocessedCsvData.split(/\\\\r?\\\\n/); // Adjust to handle different line endings\\n\\n// Define the expected number of columns based on CSV structure\\nconst expectedNumberOfColumns = 22;\\n\\n// Iterate over each data row starting from the second row (index 1) and map it to an object\\nconst output = rows.slice(1).map((row, index) => {\\n  // Split the row into values, accounting for empty columns using regex\\n  const values = row.split(/,(?=(?:(?:[^\\\"]*\\\"){2})*[^\\\"]*$)/).map(value => {\\n    // Remove surrounding quotes from each value if present and trim whitespace\\n    return value.startsWith('\\\"') && value.endsWith('\\\"') ? value.slice(1, -1).trim() : value.trim();\\n  });\\n\\n  // Ensure that the number of values matches the expected number of columns\\n  while (values.length < expectedNumberOfColumns) {\\n    values.push(\\\"\\\"); // Add empty strings for missing values\\n  }\\n\\n  // Check if the number of values matches expected columns\\n  if (values.length !== expectedNumberOfColumns) {\\n    console.warn(`Row ${index + 1} doesn't have the expected number of columns. Skipping this entry.`);\\n    return null; // Skip this row if it doesn't match the expected columns\\n  }\\n\\n  // Create an item object with a fixed structure\\n  const item = {\\n    id: values[0] || null,\\n    campaign_lead_map_id: values[1] || null,\\n    status: values[2] || null,\\n    category: values[3] || null,\\n    is_interested: values[4] === 'true', // Convert to boolean\\n    created_at: values[5] || null,\\n    first_name: values[6] || null,\\n    last_name: values[7] || null,\\n    email: values[8] || null,\\n    phone_number: values[9] || null,\\n    company_name: values[10] || null,\\n    website: values[11] || null,\\n    location: values[12] || null,\\n    custom_fields: values[13] || null,\\n    linkedin_profile: values[14] || null,\\n    company_url: values[15] || null,\\n    is_unsubscribed: values[16] === 'true', // Convert to boolean\\n    unsubscribed_client_id_map: values[17] || null,\\n    last_email_sequence_sent: values[18] || null,\\n    open_count: parseInt(values[19], 10) || 0, // Convert to number\\n    click_count: parseInt(values[20], 10) || 0, // Convert to number\\n    reply_count: parseInt(values[21], 10) || 0  // Convert to number\\n  };\\n\\n  return { json: item };\\n}).filter(item => item !== null); // Remove null entries from output\\n\\n// Return the structured output\\nreturn output;\\n\"\n      },\n      \"typeVersion\": 2,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"f6550deb-0479-475e-b3ba-9507a4ac8911\",\n      \"name\": \"Loop Over Items1\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        180,\n        160\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"reset\": \"={{ $node['Loop Over Items1'].context[\\\"done\\\"] }}\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"a183df85-17a2-4886-adc9-68b5ab5fa8b0\",\n      \"name\": \"HubSpot\",\n      \"type\": \"n8n-nodes-base.hubspot\",\n      \"position\": [\n        420,\n        180\n      ],\n      \"parameters\": {\n        \"operation\": \"getAll\",\n        \"authentication\": \"oAuth2\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"hubspotOAuth2Api\": {\n          \"id\": \"JOrebC0LtzWrkgzz\",\n          \"name\": \"Robaws\"\n        }\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 2.1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"da7e2980-6f82-4867-a460-306095234f5f\",\n      \"name\": \"If\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        640,\n        180\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"e77d0ee2-bb31-483b-98ee-b0acb0b54bb4\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"false\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.companyId.isEmpty() }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"9247f4c5-05dd-48a4-8bf9-c67a8936570c\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        -1340,\n        980\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {}\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"16623c02-5fb6-40cd-835b-2557eddbbf85\",\n      \"name\": \"UPSERT CAMPAIGN ACTIVITY\",\n      \"type\": \"n8n-nodes-base.postgres\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        980,\n        960\n      ],\n      \"parameters\": {\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"ce_campaign_activity\",\n          \"cachedResultName\": \"ce_campaign_activity\"\n        },\n        \"schema\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"outbound_activities\",\n          \"cachedResultName\": \"outbound_activities\"\n        },\n        \"columns\": {\n          \"value\": {\n            \"id\": \"={{ $json.id }}\",\n            \"email\": \"={{ $json.email }}\",\n            \"status\": \"={{ $json.status }}\",\n            \"website\": \"={{ $json.email.extractDomain() }}\",\n            \"category\": \"={{ $json.category }}\",\n            \"location\": \"={{ $json.location }}\",\n            \"last_name\": \"={{ $json.last_name }}\",\n            \"created_at\": \"={{ $json.created_at }}\",\n            \"first_name\": \"={{ $json.first_name }}\",\n            \"open_count\": \"={{ $json.open_count }}\",\n            \"campaign_id\": \"={{ $('Loop Over Items').item.json.id }}\",\n            \"click_count\": \"={{ $json.click_count }}\",\n            \"company_url\": \"={{ $json.company_url }}\",\n            \"reply_count\": \"={{ $json.reply_count }}\",\n            \"company_name\": \"={{ $json.company_name }}\",\n            \"phone_number\": \"={{ $json.phone_number }}\",\n            \"custom_fields\": \"={{ JSON.stringify(JSON.parse($json.custom_fields.replace(/\\\"\\\"/g, '\\\"'))) }}\",\n            \"is_interested\": \"={{ $json.is_interested }}\",\n            \"is_unsubscribed\": \"={{ $json.is_unsubscribed }}\",\n            \"linkedin_profile\": \"={{ $json.linkedin_profile }}\",\n            \"campaign_lead_map_id\": \"={{ $json.campaign_lead_map_id }}\",\n            \"last_email_sequence_sent\": \"={{ $json.last_email_sequence_sent }}\",\n            \"psg_last_update_timestmap\": \"={{ $now }}\",\n            \"unsubscribed_client_id_map\": \"={{ $json.unsubscribed_client_id_map }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": true,\n              \"displayName\": \"id\",\n              \"defaultMatch\": true,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"campaign_lead_map_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"campaign_lead_map_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"status\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"status\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"category\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"category\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"is_interested\",\n              \"type\": \"boolean\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"is_interested\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"created_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"required\": true,\n              \"displayName\": \"created_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"first_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"first_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"last_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"last_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"email\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"email\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"phone_number\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"phone_number\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"company_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"company_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"website\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"website\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"location\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"location\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"custom_fields\",\n              \"type\": \"object\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"custom_fields\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"linkedin_profile\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"linkedin_profile\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"company_url\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"company_url\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"is_unsubscribed\",\n              \"type\": \"boolean\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"is_unsubscribed\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"unsubscribed_client_id_map\",\n              \"type\": \"object\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"unsubscribed_client_id_map\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"last_email_sequence_sent\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"last_email_sequence_sent\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"open_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"open_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"click_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"click_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"reply_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"reply_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"psg_last_update_timestmap\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"psg_last_update_timestmap\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"campaign_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"campaign_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"id\"\n          ]\n        },\n        \"options\": {\n          \"queryBatching\": \"independently\"\n        },\n        \"operation\": \"upsert\"\n      },\n      \"credentials\": {},\n      \"typeVersion\": 2.5\n    },\n    {\n      \"id\": \"be550807-7ec6-45bc-b522-ae958200e90e\",\n      \"name\": \"HUBSPOT TABLE\",\n      \"type\": \"n8n-nodes-base.postgres\",\n      \"position\": [\n        900,\n        160\n      ],\n      \"parameters\": {\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"hubspot\",\n          \"cachedResultName\": \"hubspot\"\n        },\n        \"schema\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"outbound_activities\",\n          \"cachedResultName\": \"outbound_activities\"\n        },\n        \"columns\": {\n          \"value\": {\n            \"campaign_id\": \"={{ $node['Loop Over Items1'].data.campaign_id}}\",\n            \"lifecyclestage\": \"={{ $json.properties.lifecyclestage.value }}\",\n            \"hs_num_open_deals\": \"={{ $json.properties.hs_num_open_deals.value }}\",\n            \"hubspot_company_id\": \"={{ $json.companyId }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"hubspot_company_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": true,\n              \"displayName\": \"hubspot_company_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"campaign_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"campaign_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"lifecyclestage\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"lifecyclestage\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"hs_num_open_deals\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"hs_num_open_deals\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            },\n            {\n              \"id\": \"last_engagement_date\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"last_engagement_date\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": false\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"hubspot_company_id\"\n          ]\n        },\n        \"options\": {\n          \"queryBatching\": \"independently\"\n        },\n        \"operation\": \"upsert\"\n      },\n      \"credentials\": {\n        \"postgres\": {\n          \"id\": \"VtxZTfSI4m2NFeN5\",\n          \"name\": \"Postgres Personal Personal Folder\"\n        }\n      },\n      \"typeVersion\": 2.5\n    },\n    {\n      \"id\": \"328b900e-8c21-4578-b6a4-8c17fbccca26\",\n      \"name\": \"SEARCH\",\n      \"type\": \"n8n-nodes-base.postgres\",\n      \"position\": [\n        -40,\n        160\n      ],\n      \"parameters\": {\n        \"query\": \"SELECT\\n    ca.id,\\n    ca.campaign_id,\\n    ca.email,\\n    MIN(ca.first_name) AS first_name,\\n    MIN(ca.last_name) AS last_name,\\n    SUM(ca.reply_count) AS reply_count,\\n    max(hb_lifecyclestage_check_timestamp) as hb_lifecyclestage_check_timestamp,\\n    CASE\\n        -- Check if there is a comma and handle the extraction first\\n        WHEN MIN(ca.linkedin_profile) LIKE '%,%' \\n            THEN \\n                -- Replace /sales/people/ with /in/ on the extracted part before the comma\\n                REPLACE(LEFT(MIN(ca.linkedin_profile), POSITION(',' IN MIN(ca.linkedin_profile)) - 1), '/sales/people/', '/in/')\\n        ELSE \\n            -- For profiles without a comma, check for the replacement directly\\n            REPLACE(MIN(ca.linkedin_profile), '/sales/people/', '/in/')\\n    END AS linkedin_profile,\\n    MAX(ca.company_url) AS company_profile,\\n    -- Extracting domain from email to create the website column\\n    SUBSTRING(ca.email FROM POSITION('@' IN ca.email) + 1) AS website,\\n    c.created_at,\\n    c.updated_at,\\n    c.status,\\n    c.name\\nFROM\\n    outbound_activities.ce_campaign_activity ca\\nJOIN\\n    outbound_activities.ce_campaign c ON ca.campaign_id = c.campaign_id\\n--left join outbound_activities.hubspot hb on \\n\\nWHERE \\n  hb_lifecyclestage_check_timestamp IS NULL \\n  OR hb_lifecyclestage_check_timestamp < NOW() - INTERVAL '24 hours'\\n\\n  \\nGROUP BY\\n    ca.id,\\n    ca.campaign_id,\\n    ca.email,\\n    c.created_at,\\n    c.updated_at,\\n    c.status,\\n    c.name\\n\\n\\nlimit 5000\",\n        \"options\": {},\n        \"operation\": \"executeQuery\"\n      },\n      \"credentials\": {\n        \"postgres\": {\n          \"id\": \"VtxZTfSI4m2NFeN5\",\n          \"name\": \"Postgres Personal Personal Folder\"\n        }\n      },\n      \"typeVersion\": 2.5\n    },\n    {\n      \"id\": \"c403ef52-894d-476a-aaba-6527c7cb2184\",\n      \"name\": \"Postgres1\",\n      \"type\": \"n8n-nodes-base.postgres\",\n      \"position\": [\n        640,\n        380\n      ],\n      \"parameters\": {\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"ce_campaign_activity\",\n          \"cachedResultName\": \"ce_campaign_activity\"\n        },\n        \"schema\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"outbound_activities\",\n          \"cachedResultName\": \"outbound_activities\"\n        },\n        \"columns\": {\n          \"value\": {\n            \"id\": \"={{ $('Loop Over Items1').item.json.id }}\",\n            \"hb_lifecyclestage_check_timestamp\": \"={{ $now }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": true,\n              \"displayName\": \"id\",\n              \"defaultMatch\": true,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"campaign_lead_map_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"campaign_lead_map_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"status\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"status\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"category\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"category\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"is_interested\",\n              \"type\": \"boolean\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"is_interested\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"created_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": true,\n              \"displayName\": \"created_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"first_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"first_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"last_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"last_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"email\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"email\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"phone_number\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"phone_number\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"company_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"company_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"website\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"website\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"location\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"location\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"custom_fields\",\n              \"type\": \"object\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"custom_fields\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"linkedin_profile\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"linkedin_profile\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"company_url\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"company_url\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"is_unsubscribed\",\n              \"type\": \"boolean\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"is_unsubscribed\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"unsubscribed_client_id_map\",\n              \"type\": \"object\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"unsubscribed_client_id_map\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"last_email_sequence_sent\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"last_email_sequence_sent\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"open_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"open_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"click_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"click_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"reply_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"reply_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"psg_last_update_timestmap\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"psg_last_update_timestmap\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"campaign_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"campaign_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"hb_lifecyclestage_check_timestamp\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"hb_lifecyclestage_check_timestamp\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"id\"\n          ]\n        },\n        \"options\": {},\n        \"operation\": \"update\"\n      },\n      \"credentials\": {\n        \"postgres\": {\n          \"id\": \"VtxZTfSI4m2NFeN5\",\n          \"name\": \"Postgres Personal Personal Folder\"\n        }\n      },\n      \"typeVersion\": 2.5\n    },\n    {\n      \"id\": \"671f168b-a720-42e6-964d-a7f2871d2d6e\",\n      \"name\": \"UPDATE HUBSPOT ACTIVITY TABLE\",\n      \"type\": \"n8n-nodes-base.postgres\",\n      \"position\": [\n        1120,\n        160\n      ],\n      \"parameters\": {\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"ce_campaign_activity\",\n          \"cachedResultName\": \"ce_campaign_activity\"\n        },\n        \"schema\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"outbound_activities\",\n          \"cachedResultName\": \"outbound_activities\"\n        },\n        \"columns\": {\n          \"value\": {\n            \"id\": \"={{ $('Loop Over Items1').item.json.id }}\",\n            \"hb_lifecyclestage_check_timestamp\": \"={{ $now }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": true,\n              \"displayName\": \"id\",\n              \"defaultMatch\": true,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"campaign_lead_map_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"campaign_lead_map_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"status\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"status\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"category\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"category\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"is_interested\",\n              \"type\": \"boolean\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"is_interested\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"created_at\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": true,\n              \"displayName\": \"created_at\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"first_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"first_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"last_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"last_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"email\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"email\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"phone_number\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"phone_number\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"company_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"company_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"website\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"website\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"location\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"location\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"custom_fields\",\n              \"type\": \"object\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"custom_fields\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"linkedin_profile\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"linkedin_profile\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"company_url\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"company_url\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"is_unsubscribed\",\n              \"type\": \"boolean\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"is_unsubscribed\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"unsubscribed_client_id_map\",\n              \"type\": \"object\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"unsubscribed_client_id_map\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"last_email_sequence_sent\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"last_email_sequence_sent\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"open_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"open_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"click_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"click_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"reply_count\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"reply_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"psg_last_update_timestmap\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"psg_last_update_timestmap\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"campaign_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"campaign_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"hb_lifecyclestage_check_timestamp\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"hb_lifecyclestage_check_timestamp\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"id\"\n          ]\n        },\n        \"options\": {},\n        \"operation\": \"update\"\n      },\n      \"credentials\": {\n        \"postgres\": {\n          \"id\": \"VtxZTfSI4m2NFeN5\",\n          \"name\": \"Postgres Personal Personal Folder\"\n        }\n      },\n      \"typeVersion\": 2.5\n    },\n    {\n      \"id\": \"6ebe6482-0f31-465a-8532-abaf3822ad72\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -140,\n        -60\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 1531.405758029468,\n        \"height\": 669.051063941859,\n        \"content\": \"## HUBSPOT LIFECYCLESTAGE (LEAD STATUS)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"31ea75c2-a228-4390-b125-8f2ac0b96a07\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -140,\n        760\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 1831,\n        \"height\": 669,\n        \"content\": \"## SMARTLEAD CAMPAIGN DATA\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8d7e4883-74e2-4758-b2d9-504eb7301cbd\",\n      \"name\": \"SET SMARTLEAD API KEY\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -1040,\n        980\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"7f81531d-f76f-42c7-b536-2b7b70563e12\",\n              \"name\": \"API KEY\",\n              \"type\": \"string\",\n              \"value\": \"<< ADD YOUR API KEY HERE >>\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"1742845b-2ce5-4184-a7b0-6f5606714fcb\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1100,\n        780\n      ],\n      \"parameters\": {\n        \"height\": 400,\n        \"content\": \"## Search for your smartlead API key [here](https://app.smartlead.ai/app/settings/profile)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e10205a7-3859-4a31-85ba-59c5cc0b69f7\",\n      \"name\": \"Postgres\",\n      \"type\": \"n8n-nodes-base.postgres\",\n      \"position\": [\n        -40,\n        1700\n      ],\n      \"parameters\": {\n        \"query\": \"SELECT \\n    h.campaign_id,\\n        c.status,\\n    c.name,\\n    COUNT(DISTINCT h.hubspot_company_id) AS total_companies,\\n    SUM(CASE WHEN h.lifecyclestage = 'lead' AND h.hs_num_open_deals != 0 THEN 1 ELSE 0 END) AS lead_count,\\n    SUM(CASE WHEN h.lifecyclestage = 'marketingqualifiedlead' AND h.hs_num_open_deals != 0 THEN 1 ELSE 0 END) AS marketingqualifiedlead_count,\\n    SUM(CASE WHEN h.lifecyclestage = 'salesqualifiedlead' AND h.hs_num_open_deals != 0 THEN 1 ELSE 0 END) AS salesqualifiedlead_count,\\n    SUM(CASE WHEN h.lifecyclestage = 'opportunity' AND h.hs_num_open_deals != 0 THEN 1 ELSE 0 END) AS opportunity_count,\\n    SUM(CASE WHEN h.lifecyclestage = 'customer' AND h.hs_num_open_deals != 0 THEN 1 ELSE 0 END) AS customer_count,\\n    SUM(CASE WHEN h.lifecyclestage = '140669943' AND h.hs_num_open_deals != 0 THEN 1 ELSE 0 END) AS lifecyclestage_140669943_count,\\n    SUM(CASE WHEN h.lifecyclestage = '140669942' AND h.hs_num_open_deals != 0 THEN 1 ELSE 0 END) AS lifecyclestage_140669942_count\\nFROM \\n    outbound_activities.hubspot h\\nJOIN \\n    outbound_activities.ce_campaign c ON h.campaign_id = c.campaign_id\\nGROUP BY \\n    h.campaign_id, c.status, c.name\",\n        \"options\": {\n          \"queryBatching\": \"independently\"\n        },\n        \"operation\": \"executeQuery\"\n      },\n      \"credentials\": {\n        \"postgres\": {\n          \"id\": \"VtxZTfSI4m2NFeN5\",\n          \"name\": \"Postgres Personal Personal Folder\"\n        }\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 2.5\n    },\n    {\n      \"id\": \"19a80be4-f81f-44f7-8108-a20f6af8e315\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1300,\n        1340\n      ],\n      \"parameters\": {\n        \"width\": 740,\n        \"height\": 400,\n        \"content\": \"## POSTGRES INSTALATION [Guide](https://github.com/wukimidaire/postgres_table_templates)\\n\\n## Follow this step by step guide, focus on the next 3 table creations for this flow:\\n## - ce_campaign_activity\\n## - ce_campaign\\n## - hubspot\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7bc235d2-65c8-41fd-b429-26b2422cbfa8\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -120,\n        1580\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 1060,\n        \"height\": 1313.3157639300548,\n        \"content\": \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n## Campaign Analytics Report Documentation\\n\\nOverview\\n\\nThis report provides a high-level summary of campaign performance, designed to help stakeholders quickly assess the outcomes of marketing or sales campaigns. It includes data on campaign activity, targeted audiences, and progression metrics, allowing for a holistic view of campaign effectiveness.\\n\\n## Key Metrics\\n\\n\\t1\\t**Campaign Identification and Status**\\n\\n        •\\tCampaign ID: A unique identifier assigned to each campaign for tracking purposes.\\n\\t•\\tStatus: Indicates the current state of the campaign:\\n\\t•\\tActive: Campaign is ongoing.\\n\\t•\\tPaused: Campaign is temporarily on hold.\\n\\t•\\tArchived: Campaign has concluded.\\n\\n2       **Targeting and Reach**\\n\\n\\t•\\tTotal Companies: Number of companies targeted within the campaign scope.\\n\\n\\n3\\t**Pipeline Metrics**\\n\\n\\t•\\tLead Count: Total number of leads generated by the campaign.\\n\\t•\\tMarketing Qualified Leads (MQLs): Leads that meet predefined marketing qualification criteria.\\n\\t•\\tSales Qualified Leads (SQLs): Leads that are validated as sales-ready by the team.\\n\\t•\\tOpportunities: Potential deals created from campaign engagement.\\n\\t•\\tCustomers: Number of deals successfully closed, converting leads into customers.\\n\\n\\n4\\t**Lifecycle Stages**\\n\\n\\t•\\tLifecycle Stage Metrics: Counts of entities (e.g., leads, opportunities, or customers) at specific lifecycle stages. These stages represent the journey from lead generation to conversion.\\n\\n\\n\\n## How to Use This Report\\n\\n\\t•\\t**Evaluate Campaign Success**: Compare metrics like total companies, leads, and customers to understand campaign impact.\\n\\t•\\t**Understand Pipeline Health**: Analyze how many entities progress through the funnel (e.g., from MQL to SQL to Opportunity).\\n\\t•\\t**Monitor Campaign Status**: Use the status column to focus on active campaigns or review the outcomes of archived ones.\\n\\t•\\t**Assess Engagement**: Check opportunity and customer counts to gauge how effective the campaign is in driving conversions.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0af663c4-faa9-49ae-a5d3-3bcb6ea7888a\",\n      \"name\": \"Google Sheets\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        180,\n        1700\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"name\": \"={{ $json.name }}\",\n            \"status\": \"={{ $json.status }}\",\n            \"lead_count\": \"={{ $json.lead_count }}\",\n            \"campaign_id\": \"={{ $json.company_id }}\",\n            \"customer_count\": \"={{ $json.customer_count\\n}}\\n\",\n            \"total_companies\": \"={{ $json.total_companies }}\",\n            \"opportunity_count\": \"={{ $json.opportunity_count\\n }}\",\n            \"salesqualifiedlead_count\": \"={{ $json.salesqualifiedlead_count }}\",\n            \"marketingqualifiedlead_count\": \"={{ $json.marketingqualifiedlead_count }}\",\n            \"lifecyclestage_140669942_count\": \"={{ $json.lifecyclestage_140669942_count\\n}}\\n\",\n            \"lifecyclestage_140669943_count\": \"={{ $json.lifecyclestage_140669943_count\\n}}\\n\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"campaign_id\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"campaign_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"status\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"status\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"total_companies\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"total_companies\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"lead_count\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"lead_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"marketingqualifiedlead_count\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"marketingqualifiedlead_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"salesqualifiedlead_count\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"salesqualifiedlead_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"opportunity_count\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"opportunity_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"customer_count\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"customer_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"lifecyclestage_140669943_count\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"lifecyclestage_140669943_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"lifecyclestage_140669942_count\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"lifecyclestage_140669942_count\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"campaign_id\"\n          ]\n        },\n        \"options\": {},\n        \"operation\": \"appendOrUpdate\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1kG5uXCzOJdUTapA6p-IbH3D8sjpGZ5MQm_IhhvPvIGE/edit#gid=0\",\n          \"cachedResultName\": \"Sheet1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1kG5uXCzOJdUTapA6p-IbH3D8sjpGZ5MQm_IhhvPvIGE\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1kG5uXCzOJdUTapA6p-IbH3D8sjpGZ5MQm_IhhvPvIGE/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Smartlead Reporting - TEMPLATE\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"qx3ux5eQ43R4Hmbq\",\n          \"name\": \"Google Sheets account 2\"\n        }\n      },\n      \"typeVersion\": 4.5\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"If\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HUBSPOT TABLE\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Postgres1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Code\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"UPSERT CAMPAIGN ACTIVITY\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"SEARCH\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"HubSpot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Postgres\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Google Sheets\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Postgres1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"HUBSPOT TABLE\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"UPDATE HUBSPOT ACTIVITY TABLE\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items\": {\n      \"main\": [\n        null,\n        [\n          {\n            \"node\": \"EXTRACT CAMPAIGN DATA\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"UPDATE CAMPAIGN\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"UPDATE CAMPAIGN\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items1\": {\n      \"main\": [\n        null,\n        [\n          {\n            \"node\": \"HubSpot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"SET SMARTLEAD API KEY\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"FETCH ALL CAMPAIGNS\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"EXTRACT CAMPAIGN DATA\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Code\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"SET SMARTLEAD API KEY\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"FETCH ALL CAMPAIGNS\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Postgres\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"SEARCH\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"UPSERT CAMPAIGN ACTIVITY\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"UPDATE HUBSPOT ACTIVITY TABLE\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.splitInBatches",
      "n8n-nodes-base.postgres",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.code",
      "n8n-nodes-base.splitInBatches",
      "n8n-nodes-base.hubspot",
      "n8n-nodes-base.if",
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.postgres",
      "n8n-nodes-base.postgres",
      "n8n-nodes-base.postgres",
      "n8n-nodes-base.postgres",
      "n8n-nodes-base.postgres",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.postgres",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.googleSheets"
    ],
    "trigger": "schedule trigger"
  }
}