{
  "source": "0893_Stickynote_Emailreadimap_Create.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"id\": \"9f2dc93f-bae5-4419-8411-d2fff4b31f5e\",\n      \"name\": \"Creates an email engagement\",\n      \"type\": \"n8n-nodes-base.hubspot\",\n      \"position\": [\n        916,\n        -260\n      ],\n      \"parameters\": {\n        \"type\": \"email\",\n        \"metadata\": {\n          \"html\": \"={{ $('When an email is received').item.json.textHtml || $('When an email is received').item.json.textPlain}}\",\n          \"subject\": \"={{ $('When an email is received').item.json.subject }}\",\n          \"toEmail\": [\n            \"={{ $('When an email is received').item.json.to }}\"\n          ],\n          \"fromEmail\": \"={{ $('When an email is received').item.json.from }}\"\n        },\n        \"resource\": \"engagement\",\n        \"authentication\": \"oAuth2\",\n        \"additionalFields\": {\n          \"associations\": {\n            \"contactIds\": \"={{ $json.vid }}\"\n          }\n        }\n      },\n      \"credentials\": {\n        \"hubspotOAuth2Api\": {\n          \"id\": \"JxzF93M0SJ00jDD9\",\n          \"name\": \"HubSpot account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"0a56ec28-afc6-40a9-bf42-4d8742e48eb4\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        -140,\n        -40\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"1IOLtYX7aTspCAN8\",\n          \"name\": \"OpenAI Pollup\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"8e53aeb6-7d84-4739-b482-b8cd844b89ac\",\n      \"name\": \"Search for the contact via email\",\n      \"type\": \"n8n-nodes-base.hubspot\",\n      \"position\": [\n        256,\n        -260\n      ],\n      \"parameters\": {\n        \"operation\": \"search\",\n        \"authentication\": \"oAuth2\",\n        \"filterGroupsUi\": {\n          \"filterGroupsValues\": [\n            {\n              \"filtersUi\": {\n                \"filterValues\": [\n                  {\n                    \"value\": \"={{ $json.output.contact_info.email }}\",\n                    \"propertyName\": \"email|string\"\n                  }\n                ]\n              }\n            }\n          ]\n        },\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"hubspotOAuth2Api\": {\n          \"id\": \"JxzF93M0SJ00jDD9\",\n          \"name\": \"HubSpot account\"\n        }\n      },\n      \"typeVersion\": 2.1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"19e54445-d0cb-40f2-a11f-5e4cb22ad7ec\",\n      \"name\": \"Parse the mail with AI\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        -120,\n        -260\n      ],\n      \"parameters\": {\n        \"text\": \"=Get all important info from this email like first name, last name, email, phone number, name of the company, country, Postal code, city, etc. Return it as a json.  The email content:  {{ $json.textHtml || $json.textPlain}} \\nFrom: {{ $json.from }} \\nSubject: {{ $json.subject }}\\nDate sent:  {{ $json.date }}\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"message\": \"=You are a professional Email parser\"\n            }\n          ]\n        },\n        \"promptType\": \"define\",\n        \"hasOutputParser\": true\n      },\n      \"typeVersion\": 1.6\n    },\n    {\n      \"id\": \"8b257214-0001-46aa-84df-cad844e3130b\",\n      \"name\": \"When an email is received\",\n      \"type\": \"n8n-nodes-base.emailReadImap\",\n      \"position\": [\n        -340,\n        -260\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"forceReconnect\": 3\n        }\n      },\n      \"credentials\": {\n        \"imap\": {\n          \"id\": \"g7C5Z9V9vQUbsLIw\",\n          \"name\": \"IMAP account\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"32820b69-3918-4951-9ddc-45bdbcb60aca\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -440,\n        -400\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 280,\n        \"height\": 300,\n        \"content\": \"## Set receiving email account\\n- Ddefaults to an IMAP account node, but you can put a gmail account or any  email trigger\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"adbed044-08ae-4744-9b0c-09a225860267\",\n      \"name\": \"Set the output Json\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        80,\n        -40\n      ],\n      \"parameters\": {\n        \"jsonSchemaExample\": \"{\\\"contact_info\\\": \\n{\\n\\\"first name\\\": \\n\\\"Thomas\\\",\\n\\\"last name\\\": \\\"Vie\\\",\\n\\\"position\\\": \\n\\\"CTO\\\",\\n\\\"company\\\": \\n\\\"Pollup Data Services\\\",\\n\\\"email\\\": \\n\\\"Thomas@pollup.net\\\",\\n\\\"phone\\\": \\n\\\"+34 673626552\\\",\\n\\\"website\\\": \\n\\\"https://pollup.net\\\",\\n\\\"address\\\": \\n{\\n\\\"street\\\": \\n\\\"Oppelner Str. 32\\\",\\n\\\"postal_code\\\": \\n\\\"10997\\\",\\n\\\"city\\\": \\n\\\"Berlin\\\",\\n\\\"country\\\": \\n\\\"Germany\\\"\\n}}}\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"e58575ee-6ac8-4de1-b4db-8525146efd74\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -140,\n        -400\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 320,\n        \"height\": 300,\n        \"content\": \"## Upgrade the prompt!\\nThis is a very simple prompt but oit does the job. Improve it and send it to me!\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"23465910-0a89-45f7-9bbf-fb17abadc5de\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        200,\n        -400\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 840,\n        \"height\": 400,\n        \"content\": \"## Hubspot integration\\n- Search for the contact in hubspot\\n- If it is present creates an egagement\\n- It it is not, creates it and adds an engagement\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f5573c22-85f3-4eda-ba5a-172567827991\",\n      \"name\": \"contact exists?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        476,\n        -260\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"554c2aa3-dbdb-4955-8510-6b09bc762f63\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"exists\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.id }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"914f2e6b-7a5f-4c9c-bd3b-4bfb2693728d\",\n      \"name\": \"Edit Fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        696,\n        -360\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"75c8fc2d-dc8e-4b6c-a853-1dbd8d72f779\",\n              \"name\": \"vid\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.id }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"4c8fa2d1-e3b4-4323-bdc8-3a4e2bbc706d\",\n      \"name\": \"Creates contact\",\n      \"type\": \"n8n-nodes-base.hubspot\",\n      \"position\": [\n        696,\n        -160\n      ],\n      \"parameters\": {\n        \"email\": \"={{ $('Parse the mail with AI').item.json.output.contact_info.email }}\",\n        \"options\": {},\n        \"authentication\": \"oAuth2\",\n        \"additionalFields\": {\n          \"city\": \"={{ $('Parse the mail with AI').item.json.output.contact_info.address.city }}\",\n          \"country\": \"={{ $('Parse the mail with AI').item.json.output.contact_info.address.country }}\",\n          \"jobTitle\": \"={{ $('Parse the mail with AI').item.json.output.contact_info.position }}\",\n          \"lastName\": \"={{ $('Parse the mail with AI').item.json.output.contact_info['last name'] }}\",\n          \"postalCode\": \"={{ $('Parse the mail with AI').item.json.output.contact_info.address.postal_code }}\",\n          \"websiteUrl\": \"={{ $('Parse the mail with AI').item.json.output.contact_info.website }}\",\n          \"companyName\": \"={{ $('Parse the mail with AI').item.json.output.contact_info.company }}\",\n          \"phoneNumber\": \"={{ $('Parse the mail with AI').item.json.output.contact_info.phone }}\",\n          \"streetAddress\": \"={{ $('Parse the mail with AI').item.json.output.contact_info.address.street }}\"\n        }\n      },\n      \"credentials\": {\n        \"hubspotOAuth2Api\": {\n          \"id\": \"JxzF93M0SJ00jDD9\",\n          \"name\": \"HubSpot account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"5f94ba18-49db-4bc0-9f0a-16a9d05ca6b0\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -440,\n        -620\n      ],\n      \"parameters\": {\n        \"width\": 460,\n        \"height\": 200,\n        \"content\": \"## Contact me\\n- If you need any modification to this workflow\\n- if you need some help with this workflow\\n- Or if you need any workflow in n8n, Make, or Langchain / Langgraph\\n\\nWrite to me: [thomas@pollup.net](mailto:thomas@pollup.net)\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Edit Fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Creates an email engagement\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Creates contact\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Creates an email engagement\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"contact exists?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Creates contact\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Parse the mail with AI\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set the output Json\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Parse the mail with AI\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Parse the mail with AI\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Search for the contact via email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When an email is received\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Parse the mail with AI\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Search for the contact via email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"contact exists?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.hubspot",
      "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "n8n-nodes-base.hubspot",
      "@n8n/n8n-nodes-langchain.chainLlm",
      "n8n-nodes-base.emailReadImap",
      "n8n-nodes-base.stickyNote",
      "@n8n/n8n-nodes-langchain.outputParserStructured",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.if",
      "n8n-nodes-base.set",
      "n8n-nodes-base.hubspot",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}