{
  "source": "0490_Mautic_Gmail_Send_Triggered.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"f0efd559def66ddc761033b0b2eb86ed3edec31121f2c1aa92ed05e63303529a\"\n  },\n  \"name\": \"Unsubscribe Mautic contacts from automated unsubscribe emails\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"55d6a64b-88e2-4162-a93a-b31ad32b94fd\",\n      \"name\": \"Gmail Trigger\",\n      \"type\": \"n8n-nodes-base.gmailTrigger\",\n      \"position\": [\n        140,\n        860\n      ],\n      \"parameters\": {\n        \"filters\": {\n          \"includeSpamTrash\": true\n        },\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"3\",\n          \"name\": \"Gmail account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a697b58c-e0c8-42e0-8211-49caf46ce222\",\n      \"name\": \"Is automated unsubscribe?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        460,\n        1000\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"= {{ $json[\\\"To\\\"] }}\",\n              \"value2\": \"unsubscribe\",\n              \"operation\": \"contains\"\n            },\n            {\n              \"value1\": \"={{ $json[\\\"From\\\"] }}\",\n              \"value2\": \"={{ $node[\\\"Edit Fields\\\"].json[\\\"emailAddress\\\"] }}\",\n              \"operation\": \"notEqual\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"72c76f4b-50da-481a-9c3e-204158f3a016\",\n      \"name\": \"Add to unsubscribed segment\",\n      \"type\": \"n8n-nodes-base.mautic\",\n      \"position\": [\n        1520,\n        720\n      ],\n      \"parameters\": {\n        \"resource\": \"contactSegment\",\n        \"contactId\": \"={{ $json[\\\"id\\\"] }}\",\n        \"segmentId\": 3,\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"mauticOAuth2Api\": {\n          \"id\": \"4\",\n          \"name\": \"Mautic account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"44c85f57-0716-476f-bea5-00efeddf908f\",\n      \"name\": \"Remove newsletter segment\",\n      \"type\": \"n8n-nodes-base.mautic\",\n      \"position\": [\n        1520,\n        920\n      ],\n      \"parameters\": {\n        \"resource\": \"contactSegment\",\n        \"contactId\": \"={{ $json[\\\"id\\\"] }}\",\n        \"operation\": \"remove\",\n        \"segmentId\": 1,\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"mauticOAuth2Api\": {\n          \"id\": \"4\",\n          \"name\": \"Mautic account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b26ddbb9-3209-458b-8e94-2854ed8bf8de\",\n      \"name\": \"Reply Unsubscribe Message\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        1520,\n        1140\n      ],\n      \"parameters\": {\n        \"message\": \"={{$node[\\\"Edit Fields\\\"].json[\\\"unsubscribeMessage\\\"]}}\",\n        \"options\": {},\n        \"messageId\": \"={{ $node[\\\"Gmail Trigger\\\"].json[\\\"id\\\"] }}\",\n        \"operation\": \"reply\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"3\",\n          \"name\": \"Gmail account\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"34fc931b-f692-4383-a75b-76502c11452b\",\n      \"name\": \"Add to Do Not Contact List\",\n      \"type\": \"n8n-nodes-base.mautic\",\n      \"disabled\": true,\n      \"position\": [\n        1520,\n        520\n      ],\n      \"parameters\": {\n        \"contactId\": \"{{ $json[\\\"id\\\"] }}\",\n        \"operation\": \"editDoNotContactList\",\n        \"authentication\": \"oAuth2\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"mauticOAuth2Api\": {\n          \"id\": \"4\",\n          \"name\": \"Mautic account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b5dd2d22-c367-4f30-a1b3-e3a767aec96b\",\n      \"name\": \"Extract Email from 'From' Field\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        640,\n        840\n      ],\n      \"parameters\": {\n        \"mode\": \"runOnceForEachItem\",\n        \"jsCode\": \"var fromField = $input.item.json.From;\\nvar extractedEmail;\\nif (fromField.includes('<') && fromField.includes('>')) {\\n    // From field is wrapped in carets\\n    var regex = /[^< ]+(?=>)/g;\\n    extractedEmail = fromField.match(regex)[0];\\n} else {\\n    // From field is not wrapped in carets\\n    extractedEmail = fromField;\\n}\\nreturn {json: {extractedEmail}}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f11e57b5-7834-4654-8793-42b1aa297730\",\n      \"name\": \"Extract Unique Email Addresses\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        820,\n        1000\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Access the input data using all() method\\nconst inputData = $input.all();\\nconst uniqueEmailsSet = new Set();\\n\\n// Loop through each item, extract the email, and add it to the Set\\ninputData.forEach(item => {\\n    uniqueEmailsSet.add(item.json.extractedEmail);\\n});\\n\\n// Convert the Set to an array of objects in the n8n format\\nconst uniqueEmailsArray = Array.from(uniqueEmailsSet).map(email => {\\n    return { json: { extractedEmail: email } };\\n});\\n\\nreturn uniqueEmailsArray;\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"5e168e07-1a6b-4140-81b9-9d9ffb852f61\",\n      \"name\": \"Get Mautic Contact ID from Email Address\",\n      \"type\": \"n8n-nodes-base.mautic\",\n      \"position\": [\n        1020,\n        840\n      ],\n      \"parameters\": {\n        \"limit\": 1,\n        \"options\": {\n          \"search\": \"=email:{{ $json[\\\"extractedEmail\\\"] }}\",\n          \"rawData\": false\n        },\n        \"operation\": \"getAll\",\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"mauticOAuth2Api\": {\n          \"id\": \"4\",\n          \"name\": \"Mautic account\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"ad1a7b7a-230a-4098-b419-c93e3a6398a1\",\n      \"name\": \"If Contact Exists in Mautic\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1180,\n        1060\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json[\\\"id\\\"] }}\",\n              \"operation\": \"isNotEmpty\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"17b999f9-9c50-488a-b5d2-d98bbd566048\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        200,\n        500\n      ],\n      \"parameters\": {\n        \"content\": \"## Step 1\\nSet your email address and unsubscribe message in the edit fields node\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"11d28571-7335-4e53-a691-973412b6daef\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        140,\n        1020\n      ],\n      \"parameters\": {\n        \"content\": \"## Step 2\\nSet your credentials in the Gmail trigger\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2874fbc3-5735-471c-8c34-70854e0770bd\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        940,\n        660\n      ],\n      \"parameters\": {\n        \"content\": \"## Step 3\\nSet credentials in the mautic nodes\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1e51f13f-3fba-4b5b-8c88-eb792c4c0b40\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1240,\n        460\n      ],\n      \"parameters\": {\n        \"content\": \"## Step 4\\nEdit segments (add or remove) in the mautic nodes, optionally add to do not contact list.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3b5f94df-864b-480c-a6f2-d572345e7d9a\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        580,\n        440\n      ],\n      \"parameters\": {\n        \"width\": 237.7703390037576,\n        \"height\": 194.55974544175768,\n        \"content\": \"## Unsubscribe Mautic contacts from automated unsubscribe emails\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"69496c4b-254d-4a89-8ab1-9fe80cfaea14\",\n      \"name\": \"Edit Fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        300,\n        700\n      ],\n      \"parameters\": {\n        \"fields\": {\n          \"values\": [\n            {\n              \"name\": \"emailAddress\",\n              \"stringValue\": \"hello@example.com\"\n            },\n            {\n              \"name\": \"unsubscribeMessage\",\n              \"stringValue\": \"Your have successfully opted out from our marketing campaigns. Please reply if you believe this is an error.\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 3.2\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"\",\n  \"connections\": {\n    \"Edit Fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is automated unsubscribe?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gmail Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Is automated unsubscribe?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract Email from 'From' Field\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If Contact Exists in Mautic\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add to unsubscribed segment\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Remove newsletter segment\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Reply Unsubscribe Message\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Add to Do Not Contact List\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Reply Unsubscribe Message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract Unique Email Addresses\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Mautic Contact ID from Email Address\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract Email from 'From' Field\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract Unique Email Addresses\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Mautic Contact ID from Email Address\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If Contact Exists in Mautic\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.gmailTrigger",
      "n8n-nodes-base.if",
      "n8n-nodes-base.mautic",
      "n8n-nodes-base.mautic",
      "n8n-nodes-base.gmail",
      "n8n-nodes-base.mautic",
      "n8n-nodes-base.code",
      "n8n-nodes-base.code",
      "n8n-nodes-base.mautic",
      "n8n-nodes-base.if",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set"
    ],
    "trigger": "gmail trigger"
  }
}