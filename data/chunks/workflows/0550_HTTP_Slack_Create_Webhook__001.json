{
  "source": "0550_HTTP_Slack_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"8e95de061dd3893a50b8b4c150c8084a7848fb1df63f53533941b7c91a8ab996\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"6f938c83-45fd-4189-b9ec-c7a6de4beb2d\",\n      \"name\": \"Retrieve deals Ids\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        660,\n        440\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"bad2435b-ec9b-4995-ab39-2dac1c2daa3a\",\n              \"name\": \"deal_id_won\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.query.deal_id_won }}\"\n            },\n            {\n              \"id\": \"2376fad4-c305-4c38-8daa-fd86014ae14b\",\n              \"name\": \"deal_id_created\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.query.deal_id_created.match(/0-3-(\\\\d+)$/)[1] }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"abc534f2-03b4-4f34-8292-bc8011c62c44\",\n      \"name\": \"Get deal won line items\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        920,\n        440\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.hubapi.com/crm/v4/associations/deals/line_items/batch/read\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"inputs\\\": [\\n    {\\n      \\\"id\\\": \\\"{{ $json.deal_id_won }}\\\"\\n    }\\n  ]\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"hubspotAppToken\"\n      },\n      \"credentials\": {\n        \"hubspotAppToken\": {\n          \"id\": \"yIpa7XqurpoIimjq\",\n          \"name\": \"HubSpot App Token account\"\n        },\n        \"hubspotOAuth2Api\": {\n          \"id\": \"2\",\n          \"name\": \"HubSpot account OAuth - Arnaud\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"eb5ae93e-3b52-4a92-9506-5379bbca8e0b\",\n      \"name\": \"Slack\",\n      \"type\": \"n8n-nodes-base.slack\",\n      \"position\": [\n        1740,\n        440\n      ],\n      \"parameters\": {\n        \"text\": \"=:white_check_mark: {{ `<https://arnaud-growth.app.n8n.cloud/workflow/${$workflow.id}|${$workflow.name}> sucessfull on <https://app-eu1.hubspot.com/contacts/3418361/record/0-3/${$('Retrieve deals Ids').item.json[\\\"deal_id_won\\\"]}|Deal won> and <https://app-eu1.hubspot.com/contacts/3418361/record/0-3/${$('Retrieve deals Ids').item.json[\\\"deal_id_created\\\"]}|Deal created>`}}\\n\",\n        \"select\": \"channel\",\n        \"channelId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"C051YHBJ1G8\"\n        },\n        \"otherOptions\": {\n          \"includeLinkToWorkflow\": false\n        }\n      },\n      \"credentials\": {\n        \"slackApi\": {\n          \"id\": \"5\",\n          \"name\": \"Slack account\"\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"d18841d0-a270-4db5-9256-17026985c13b\",\n      \"name\": \"Get batch SKUs from line items\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1100,\n        440\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.hubapi.com/crm/v3/objects/line_items/batch/read\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={{ \\n\\n{\\n  \\\"idProperty\\\": \\\"hs_object_id\\\",\\n  \\\"inputs\\\": $jmespath($json.results,`[].to[].{id: to_string(toObjectId)}`),\\n  \\\"properties\\\": [\\n    \\\"hs_object_id\\\",\\n    \\\"name\\\",\\n    \\\"hs_sku\\\"\\n  ]\\n}\\n\\n}}\",\n        \"sendBody\": true,\n        \"sendQuery\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"archived\",\n              \"value\": \"false\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"hubspotAppToken\"\n      },\n      \"credentials\": {\n        \"hubspotAppToken\": {\n          \"id\": \"yIpa7XqurpoIimjq\",\n          \"name\": \"HubSpot App Token account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"58a9ae81-26d5-47fb-9de7-bf108cb41f8d\",\n      \"name\": \"Get Batch Product IDs by SKUs\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1320,\n        440\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.hubapi.com/crm/v3/objects/products/batch/read\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={{ {\\n  \\\"idProperty\\\": \\\"hs_sku\\\",\\n  \\\"inputs\\\":  $jmespath($json.results,\\\"[].properties.{id:to_string(hs_sku)}\\\") \\n,\\n  \\\"properties\\\": [\\n    \\\"idProperty\\\",\\n    \\\"name\\\",\\n    \\\"hs_object_id\\\",\\n    \\\"recurringbillingfrequency\\\",\\n\\\"hs_price_eur\\\"\\n  ]\\n}\\n\\n}}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"hubspotAppToken\"\n      },\n      \"credentials\": {\n        \"hubspotAppToken\": {\n          \"id\": \"yIpa7XqurpoIimjq\",\n          \"name\": \"HubSpot App Token account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"27b2619a-af84-475a-9bdc-c86462ea57d3\",\n      \"name\": \"Create Batch line items based on productId and associate to deals\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1540,\n        440\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.hubapi.com/crm/v3/objects/line_items/batch/create\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={{ {\\\"inputs\\\":$jmespath($json.results,\\\"[].id\\\")\\n.map(id => ({\\n    \\\"associations\\\": [\\n        {\\n            \\\"types\\\": [\\n                {\\n                    \\\"associationCategory\\\": \\\"HUBSPOT_DEFINED\\\",\\n                    \\\"associationTypeId\\\": 20\\n                }\\n            ],\\n            \\\"to\\\": {\\n                \\\"id\\\": $('Retrieve deals Ids').item.json[\\\"deal_id_created\\\"]\\n            }\\n        }\\n    ],\\n    \\\"properties\\\": {\\n        \\\"hs_product_id\\\": id,\\n        \\\"quantity\\\": \\\"1\\\"\\n    }\\n})) } \\n\\n}}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"hubspotAppToken\"\n      },\n      \"credentials\": {\n        \"hubspotAppToken\": {\n          \"id\": \"yIpa7XqurpoIimjq\",\n          \"name\": \"HubSpot App Token account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"f6776d74-c818-4f2b-b05a-5e6b53c2ad5f\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -280,\n        200\n      ],\n      \"parameters\": {\n        \"width\": 565.8142732633208,\n        \"height\": 838.7224568543345,\n        \"content\": \"# Replicate Line Items on New Deal in HubSpot Workflow\\n\\n## Use Case\\nThis workflow solves the problem of manually copying line items from one deal to another in HubSpot, reducing manual work and minimizing errors.\\n\\n## What this workflow does\\n- **Triggers** upon receiving a webhook with deal IDs.\\n- **Retrieves** the IDs of the won and created deals.\\n- **Fetches** line items associated with the won deal.\\n- **Extracts** product SKUs from the retrieved line items.\\n- **Fetches** product details based on SKUs.\\n- **Creates** new line items for the created deal and associates them.\\n- **Sends** a Slack notification with success details.\\n\\n## Step up steps\\n1. Create a HubSpot Deal Workflow\\n 1.1 Set up your trigger (ex: when deal stage = Won)\\n 1.2 Add step : Create Record (deal)\\n 1.3 Add Step : Send webhook. The webhook should be a Get to your n8n first trigger. Set two query parameter : \\n   - `deal_id_won` as the Record ID of the deal triggering the HubSpot Workflow\\n    - `deal_id_create` as the Record ID of the deal created above. Click Insert Data -> The created object\\n2. Set up your HubSpot App token in HubSpot -> Settings -> Integration -> Private Apps\\n3. Set up your HubSpot Token integration using the predefined model.\\n4. Set up your Slack connection\\n5. Add an error Workflow to monitor errors\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"eefcd96e-c182-4362-bc60-6b5bca42e8a4\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        340,\n        300\n      ],\n      \"parameters\": {\n        \"height\": 393.4378126446013,\n        \"content\": \"**Step 1.**\\nTriggered by HubSpot Workflow\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9fedd8cf-6d97-428e-8391-aedff191ba5d\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        600,\n        300\n      ],\n      \"parameters\": {\n        \"height\": 393.4378126446013,\n        \"content\": \"**Step 2.**\\nSet the Ids of the deal won and the deal created\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b00a8849-0a13-40d3-a714-49f0afc54cea\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        860,\n        300\n      ],\n      \"parameters\": {\n        \"width\": 819.2253746903481,\n        \"height\": 393.4378126446013,\n        \"content\": \"**Step 3.**\\n- Get line items IDs from the deal won\\n- Retrieve the SKUs from those line items\\n- Get product based on SKUs\\n- Create new line items from Product IDs and associate to the new deal\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8dc60064-83a1-488e-b1a5-7be57d734e88\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        420,\n        440\n      ],\n      \"webhookId\": \"833df60e-a78f-4a59-8244-9694f27cf8ae\",\n      \"parameters\": {\n        \"path\": \"833df60e-a78f-4a59-8244-9694f27cf8ae\",\n        \"options\": {}\n      },\n      \"typeVersion\": 2\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve deals Ids\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve deals Ids\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get deal won line items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get deal won line items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get batch SKUs from line items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Batch Product IDs by SKUs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Batch line items based on productId and associate to deals\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get batch SKUs from line items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Batch Product IDs by SKUs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Batch line items based on productId and associate to deals\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Slack\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.set",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.slack",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.webhook"
    ],
    "trigger": null
  }
}