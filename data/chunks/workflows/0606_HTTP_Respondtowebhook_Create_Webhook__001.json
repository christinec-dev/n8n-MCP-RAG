{
  "source": "0606_HTTP_Respondtowebhook_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"04ab549d8bbb435ec33b81e4e29965c46cf6f0f9e7afe631018b5e34c8eead58\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"9fdbfdc1-67f3-4c8b-861c-9e5840b002ec\",\n      \"name\": \"Session\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        780,\n        300\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.fastmail.com/jmap/session\",\n        \"options\": {},\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"BWkbkxgDD4hkRCvs\",\n          \"name\": \"Fastmail Masked E-Mail Addresses\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"215d96fa-6bda-4e8c-884a-eb9a8db0838f\",\n      \"name\": \"create random masked email\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"notes\": \"https://api.fastmail.com/.well-known/jmap\\n\\nhttps://api.fastmail.com/jmap/session\",\n      \"position\": [\n        1280,\n        300\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.fastmail.com/jmap/api/\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"using\\\": [\\n    \\\"urn:ietf:params:jmap:core\\\",\\n    \\\"https://www.fastmail.com/dev/maskedemail\\\"\\n  ],\\n  \\\"methodCalls\\\": [\\n    [\\n      \\\"MaskedEmail/set\\\",\\n      {\\n        \\\"accountId\\\": \\\"{{ $('Session').item.json.primaryAccounts['https://www.fastmail.com/dev/maskedemail'] }}\\\",\\n        \\\"create\\\": {\\n          \\\"maskedEmailId1\\\": {\\n            \\\"description\\\": \\\"{{ $json.description }}\\\",\\n            \\\"state\\\": \\\"{{ $json.state }}\\\"\\n          }\\n        }\\n      },\\n      \\\"c1\\\"\\n    ]\\n  ]\\n}\\n\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"BWkbkxgDD4hkRCvs\",\n          \"name\": \"Fastmail Masked E-Mail Addresses\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"237f6596-f8df-4c21-a2fa-44e935a72d56\",\n      \"name\": \"Respond to Webhook\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        1800,\n        300\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"respondWith\": \"text\",\n        \"responseBody\": \"={{ $json }}\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"6699eb83-a41e-44bc-b332-77e407fb3542\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        460,\n        480\n      ],\n      \"parameters\": {\n        \"width\": 1654.8203324571532,\n        \"height\": 471.75430470511367,\n        \"content\": \"### Template Description\\nThis n8n workflow template allows you to create a masked email address using the Fastmail API, triggered by a webhook. This is especially useful for generating disposable email addresses for privacy-conscious users or for testing purposes.\\n\\n#### Workflow Details:\\n1. **Webhook Trigger**: The workflow is initiated by sending a POST request to a specific webhook. You can include `state` and `description` in your request body to customize the masked email's state and description.\\n2. **Session Retrieval**: The workflow makes an HTTP request to the Fastmail API to retrieve session information. It uses this data to authenticate further requests.\\n3. **Create Masked Email**: Using the retrieved session data, the workflow sends a POST request to Fastmail's JMAP API to create a masked email. It uses the provided state and description from the webhook payload.\\n4. **Prepare Output**: Once the masked email is successfully created, the workflow extracts the email address and attaches the description for further processing.\\n5. **Respond to Webhook**: Finally, the workflow responds to the original POST request with the newly created masked email and its description.\\n\\n#### Requirements:\\n- **Fastmail API Access**: You will need valid API credentials for Fastmail configured with HTTP Header Authentication.\\n- **Authorization Setup**: Optionally set up authorization if your webhook is exposed to the internet to prevent misuse.\\n- **Custom Webhook Request**: Use a tool like `curl` or create a shortcut on macOS/iOS to send the POST request to the webhook with the necessary JSON payload, like so:\\n  \\n  ```bash\\n  curl -X POST -H 'Content-Type: application/json' https://your-n8n-instance/webhook/87f9abd1-2c9b-4d1f-8c7f-2261f4698c3c -d '{\\\"state\\\": \\\"pending\\\", \\\"description\\\": \\\"my mega fancy masked email\\\"}'\\n  ```\\n\\nThis template simplifies the process of integrating masked email functionality into your projects or workflows and can be extended for various use cases.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0c5d6d5a-ad0f-451e-9075-1009c8bf7212\",\n      \"name\": \"get fields for creation\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1000,\n        300\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"870bb03d-c672-49d6-9652-5a0233b16eb2\",\n              \"name\": \"state\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Webhook').item.json.body.state ?? \\\"pending\\\" }}\"\n            },\n            {\n              \"id\": \"ac9b45a0-885f-48b2-b0ec-e38c79080045\",\n              \"name\": \"description\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Webhook').item.json.body.description ?? \\\"Test via N8n\\\" }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"be7ba978-00d7-4fb1-9e1b-e3f83285e6fb\",\n      \"name\": \"prepare output\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1540,\n        300\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"19a09822-7ae0-4884-9192-c6e5bc3393a8\",\n              \"name\": \"email\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.methodResponses[0][1].created.maskedEmailId1.email }}\"\n            },\n            {\n              \"id\": \"ae8a1fe4-3010-4db8-aa88-f6074cae3006\",\n              \"name\": \"desciption\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('get fields for creation').item.json.description }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"dd014889-81eb-4a94-886e-4fe084c504ff\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        540,\n        300\n      ],\n      \"webhookId\": \"87f9abd1-2c9b-4d1f-8c7f-2261f4698c3c\",\n      \"parameters\": {\n        \"path\": \"createMaskedEmail\",\n        \"options\": {},\n        \"httpMethod\": \"POST\",\n        \"responseMode\": \"responseNode\"\n      },\n      \"typeVersion\": 2\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Session\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"get fields for creation\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Session\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"prepare output\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Respond to Webhook\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"get fields for creation\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"create random masked email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"create random masked email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"prepare output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.webhook"
    ],
    "trigger": null
  }
}