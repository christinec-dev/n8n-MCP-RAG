{
  "source": "1856_Telegram_Stickynote_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"fa2TGWrY9rPurC30\",\n  \"meta\": {\n    \"instanceId\": \"fb8bc2e315f7f03c97140b30aa454a27bc7883a19000fa1da6e6b571bf56ad6d\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Agent Access Control Template\",\n  \"tags\": [\n    {\n      \"id\": \"RKga6I6NviNI12bx\",\n      \"name\": \"template\",\n      \"createdAt\": \"2024-09-19T19:09:21.997Z\",\n      \"updatedAt\": \"2024-09-19T19:09:21.997Z\"\n    }\n  ],\n  \"nodes\": [\n    {\n      \"id\": \"77771654-bfb9-4c34-b644-d4d6eeb15d37\",\n      \"name\": \"Simple Memory\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        560,\n        260\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('Telegram Trigger').item.json.message.from.id }}\",\n        \"sessionIdType\": \"customKey\"\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"f1ef483e-4f84-40c7-957d-191a54ffb80e\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        360,\n        260\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o\",\n          \"cachedResultName\": \"gpt-4o\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"X7Jf0zECd3IkQdSw\",\n          \"name\": \"OpenAi (octionicsolutions)\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"c6ba00c9-8ca2-4cf0-9e2c-24ead9eb7c1b\",\n      \"name\": \"Check permissions\",\n      \"type\": \"@n8n/n8n-nodes-langchain.code\",\n      \"position\": [\n        960,\n        260\n      ],\n      \"parameters\": {\n        \"code\": {\n          \"supplyData\": {\n            \"code\": \"const { DynamicTool } = require(\\\"@langchain/core/tools\\\");\\nconst connectedTools = await this.getInputConnectionData('ai_tool', 0);\\nconst allowedTools = $input.item.json.allowed_tools;\\n\\nconst noTool = (tool) => {\\n  return new DynamicTool({\\n    name: tool.getName(),\\n    description: tool.description,\\n    func: async () => {\\n        return \\\"Tell the user 'You are not authorized to use this tool'.\\\";\\n    },\\n  });\\n}\\n\\nreturn connectedTools.map(connectedTool => {\\n  const permissionGranted = allowedTools.includes(connectedTool.getName());\\n  return permissionGranted ? connectedTool : noTool(connectedTool);\\n});\"\n          }\n        },\n        \"inputs\": {\n          \"input\": [\n            {\n              \"type\": \"ai_tool\",\n              \"required\": true\n            }\n          ]\n        },\n        \"outputs\": {\n          \"output\": [\n            {\n              \"type\": \"ai_tool\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"db15e298-b8d0-4096-b606-18bc8d43bb39\",\n      \"name\": \"Telegram Trigger\",\n      \"type\": \"n8n-nodes-base.telegramTrigger\",\n      \"position\": [\n        -240,\n        -120\n      ],\n      \"webhookId\": \"4410accd-63e4-4c38-ad0b-26874f5eb673\",\n      \"parameters\": {\n        \"updates\": [\n          \"message\"\n        ],\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"3paV9xW2WWlusvsq\",\n          \"name\": \"octionictest_bot\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"3df9b9f5-c0a2-4905-95aa-285b492f2ec0\",\n      \"name\": \"Set input\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        420,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"9ea62c8f-984b-4c05-8e40-549d8035c4d3\",\n              \"name\": \"name\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.name }}\"\n            },\n            {\n              \"id\": \"bf74b2c4-f0d1-458a-9044-5cb1b62722e6\",\n              \"name\": \"granted_roles\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.granted_roles || [] }}\"\n            },\n            {\n              \"id\": \"e0f4d3d7-a916-43cb-a13d-e4453b0d1a3b\",\n              \"name\": \"allowed_tools\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.allowed_tools || [] }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"a5af8184-4a17-447e-96d3-809c6bd131f3\",\n      \"name\": \"Get user permissions\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"position\": [\n        -20,\n        -120\n      ],\n      \"parameters\": {\n        \"base\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"app0K2OqeryZWxIt9\",\n          \"cachedResultUrl\": \"https://airtable.com/app0K2OqeryZWxIt9\",\n          \"cachedResultName\": \"Agent Access Control\"\n        },\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"tblRcEGwmycLfDuHt\",\n          \"cachedResultUrl\": \"https://airtable.com/app0K2OqeryZWxIt9/tblRcEGwmycLfDuHt\",\n          \"cachedResultName\": \"Users\"\n        },\n        \"options\": {\n          \"fields\": [\n            \"granted_roles\",\n            \"allowed_tools\",\n            \"name\"\n          ]\n        },\n        \"operation\": \"search\",\n        \"filterByFormula\": \"={username} = '{{ $json.message.from.username }}'\"\n      },\n      \"credentials\": {\n        \"airtableTokenApi\": {\n          \"id\": \"24eNAG2FrCu3ZCtz\",\n          \"name\": \"AAC read only\"\n        }\n      },\n      \"typeVersion\": 2.1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"4abf80e7-9b1f-4ef0-b742-da29e1208b78\",\n      \"name\": \"When Executed by Another Workflow\",\n      \"type\": \"n8n-nodes-base.executeWorkflowTrigger\",\n      \"position\": [\n        0,\n        800\n      ],\n      \"parameters\": {\n        \"workflowInputs\": {\n          \"values\": [\n            {\n              \"name\": \"chatInput\"\n            },\n            {\n              \"name\": \"sessionId\"\n            },\n            {\n              \"name\": \"allowed_tools\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"10129d31-3446-47a0-aacd-3bd584b0bd79\",\n      \"name\": \"Settings\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        220,\n        800\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"93b5d2ac-8c8a-4c61-999f-2727b7ba9514\",\n              \"name\": \"chatInput\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.chatInput }}\"\n            },\n            {\n              \"id\": \"3f65df4c-fae1-4da3-acfd-acf352a3f8d2\",\n              \"name\": \"sessionId\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.sessionId }}\"\n            },\n            {\n              \"id\": \"81020154-c869-4bc8-944a-a9aee900a656\",\n              \"name\": \"allowed_tools\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.allowed_tools }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"c45f4258-8ef6-4bf6-878f-5e86ac577712\",\n      \"name\": \"OpenAI Chat Model1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        340,\n        1060\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"X7Jf0zECd3IkQdSw\",\n          \"name\": \"OpenAi (octionicsolutions)\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"e5cf82bc-c9a8-474e-bbeb-201e3431fa36\",\n      \"name\": \"Simple Memory1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        540,\n        1060\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('Settings').item.json.sessionId }}_weather_check\",\n        \"sessionIdType\": \"customKey\"\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"e9fd93c9-c008-470b-885a-4287950b9c3d\",\n      \"name\": \"Check permissions1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.code\",\n      \"position\": [\n        740,\n        1060\n      ],\n      \"parameters\": {\n        \"code\": {\n          \"supplyData\": {\n            \"code\": \"const { DynamicTool } = require(\\\"@langchain/core/tools\\\");\\nconst connectedTools = await this.getInputConnectionData('ai_tool', 0);\\nconst allowedTools = $input.item.json.allowed_tools;\\n\\nconst noTool = (tool) => {\\n  return new DynamicTool({\\n    name: tool.getName(),\\n    description: tool.description,\\n    func: async () => {\\n        return \\\"Tell the user 'You are not authorized to use this tool'.\\\";\\n    },\\n  });\\n}\\n\\nreturn connectedTools.map(connectedTool => {\\n  const permissionGranted = allowedTools.includes(connectedTool.getName());\\n  return permissionGranted ? connectedTool : noTool(connectedTool);\\n});\"\n          }\n        },\n        \"inputs\": {\n          \"input\": [\n            {\n              \"type\": \"ai_tool\",\n              \"required\": true\n            }\n          ]\n        },\n        \"outputs\": {\n          \"output\": [\n            {\n              \"type\": \"ai_tool\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f791deb0-9ebe-4451-8a1f-3119547dd576\",\n      \"name\": \"list_granted_roles\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolCode\",\n      \"position\": [\n        1000,\n        460\n      ],\n      \"parameters\": {\n        \"name\": \"list_granted_roles\",\n        \"jsCode\": \"// Example: convert the incoming query to uppercase and return it\\nreturn \\\"You are assigned the following roles: \\\" + $input.item.json.granted_roles.join(\\\", \\\");\",\n        \"description\": \"Call this tool to tell the user which roles they have been granted.\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"ab0c6dae-6259-4be1-b0df-e3276cafb938\",\n      \"name\": \"list_allowed_tools\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolCode\",\n      \"position\": [\n        1160,\n        460\n      ],\n      \"parameters\": {\n        \"name\": \"list_allowed_tools\",\n        \"jsCode\": \"return \\\"You have access to the following tools: \\\" + $input.item.json.allowed_tools.join(\\\", \\\");\",\n        \"description\": \"Call this tool to tell the user which tools they have access to.\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"76529936-80ea-4f94-9a06-bae3b6ea0ce3\",\n      \"name\": \"calculator\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolCalculator\",\n      \"position\": [\n        860,\n        460\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fd7f4875-6838-4b53-9167-4a22d4f5f27f\",\n      \"name\": \"Wikipedia\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolWikipedia\",\n      \"position\": [\n        760,\n        260\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0dc5c3e6-b9d2-4a96-9539-dae86dc171a6\",\n      \"name\": \"get_coordinates\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolHttpRequest\",\n      \"position\": [\n        800,\n        1260\n      ],\n      \"parameters\": {\n        \"url\": \"https://geocoding-api.open-meteo.com/v1/search?name={city}&count=1\",\n        \"fields\": \"name,latitude,longitude\",\n        \"dataField\": \"results\",\n        \"fieldsToInclude\": \"selected\",\n        \"toolDescription\": \"Get the GEO position by city name\",\n        \"optimizeResponse\": true,\n        \"placeholderDefinitions\": {\n          \"values\": [\n            {\n              \"name\": \"city\",\n              \"type\": \"string\",\n              \"description\": \"Name of the city\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"e70a2cb2-832b-4741-85d2-c446be168ad4\",\n      \"name\": \"get_weather\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolHttpRequest\",\n      \"position\": [\n        980,\n        1260\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.open-meteo.com/v1/forecast?latitude={latitude}&longitude={longitude}&current_weather=true\",\n        \"toolDescription\": \"Get current weather by GEO data (longitude, latitude)\",\n        \"placeholderDefinitions\": {\n          \"values\": [\n            {\n              \"name\": \"longitude\",\n              \"type\": \"string\",\n              \"description\": \"Longitude of location. Dot as decimal separator.\"\n            },\n            {\n              \"name\": \"latitude\",\n              \"type\": \"string\",\n              \"description\": \"Latitude of location. Dot as decimal separator.\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"66c5568d-d2fe-4938-b577-b005a5c32e37\",\n      \"name\": \"weather_agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolWorkflow\",\n      \"position\": [\n        1360,\n        460\n      ],\n      \"parameters\": {\n        \"name\": \"weather_agent\",\n        \"workflowId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"C1fIIooUO64D56t6\",\n          \"cachedResultName\": \"Agent Access Control with Airtable and Telegram\"\n        },\n        \"workflowInputs\": {\n          \"value\": {\n            \"chatInput\": \"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('chatInput', ``, 'string') }}\",\n            \"sessionId\": \"={{ $('Telegram Trigger').item.json.message.from.id }}\",\n            \"allowed_tools\": \"={{ $input.item.json.allowed_tools }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"sessionId\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"sessionId\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"chatInput\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"chatInput\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"allowed_tools\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"allowed_tools\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"ffcf4df4-f969-4bc1-9393-0e7a4317626a\",\n      \"name\": \"Weather Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        440,\n        800\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"systemMessage\": \"=You are a weather data assistant.\\nYou MUST only use the provided tools to process any user input. Never use general knowledge to answer questions. If you can't use a tool, tell the user why.\"\n        }\n      },\n      \"typeVersion\": 1.8\n    },\n    {\n      \"id\": \"eae759d7-fa4a-4993-bbcf-cc430f2dfa60\",\n      \"name\": \"Unknown user\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        200,\n        -120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"1d042f5b-ef39-4b9e-8d9c-900b39dbe3fb\",\n              \"operator\": {\n                \"type\": \"object\",\n                \"operation\": \"empty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"df377324-d57d-45ab-85c7-88446a07abcd\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -80,\n        -260\n      ],\n      \"parameters\": {\n        \"width\": 220,\n        \"height\": 300,\n        \"content\": \"## Choose Base\\nCopy [this Airtable Template](https://airtable.com/appi5nijuvzQbZLJJ/shr8OkLysG1VtlCiz) into your workspace and select that Base here\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b1ddd130-07fa-47e3-ba24-7b4e85f94b6a\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1280,\n        300\n      ],\n      \"parameters\": {\n        \"height\": 300,\n        \"content\": \"## Choose workflow\\nSelect the current workflow as the workflow that should be called\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7d24fc8e-36e7-4087-88cc-7f1c725ce814\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        900,\n        160\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 380,\n        \"height\": 220,\n        \"content\": \"Uses list of allowed tools gathered from Airtable to check for permissions and replaces denied tools with a fixed instruction to return a message to the user.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"987b3372-1703-4284-a285-d2edfd032422\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        700,\n        160\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 200,\n        \"height\": 220,\n        \"content\": \"Tools can also be connected without a permission check\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"885b0117-bae1-4aac-a91f-e140259b32e2\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        580,\n        -80\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 380,\n        \"height\": 240,\n        \"content\": \"Main agent with the instruction to always use the connected tools instead of general knowledge\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"25f17f39-a777-4386-b14d-1ed7db3c54f4\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        360,\n        -80\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 220,\n        \"height\": 240,\n        \"content\": \"Collects input and formats it using required keys\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a0abbeea-d9c1-4005-b996-d4e8e4fd97d3\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        160,\n        720\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 220,\n        \"height\": 240,\n        \"content\": \"Collects and formats input from parent workflow / agent\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8e25e640-7b6d-4ca7-b3fd-06eac3cebbea\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        680,\n        960\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 380,\n        \"height\": 220,\n        \"content\": \"Uses the same technique as the main agent to check for permissions using the same parameters which were passed to this sub-agent.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1168726e-2a39-40f6-aea6-77c12dc2b37b\",\n      \"name\": \"Sticky Note9\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        380,\n        720\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 380,\n        \"height\": 240,\n        \"content\": \"Sub-agent with specific role to handle weather information. Also having the instruction to strictly only use the connected tools.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e65e1ea3-c773-4e65-8c49-b9f7fe75df28\",\n      \"name\": \"Reply: unknown user\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        420,\n        -240\n      ],\n      \"webhookId\": \"510028ef-060f-4ce7-898e-f1a2a376780c\",\n      \"parameters\": {\n        \"text\": \"=Unknown user '{{ $('Telegram Trigger').item.json.message.from.username }}'. Please contact your supervisor.\",\n        \"chatId\": \"={{ $('Telegram Trigger').item.json.message.chat.id }}\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"3paV9xW2WWlusvsq\",\n          \"name\": \"octionictest_bot\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"aa5937b9-22d2-4719-9d51-00f7d28beb43\",\n      \"name\": \"Reply with results\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1020,\n        0\n      ],\n      \"webhookId\": \"97bc8ca7-d40a-41d6-9cc2-4c9943313fb4\",\n      \"parameters\": {\n        \"text\": \"={{ $json.output }}\",\n        \"chatId\": \"={{ $('Telegram Trigger').item.json.message.chat.id }}\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"3paV9xW2WWlusvsq\",\n          \"name\": \"octionictest_bot\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"623328d8-e9ad-431e-b3ca-df0cdbcb7430\",\n      \"name\": \"Main Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        640,\n        0\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $('Telegram Trigger').item.json.message.text }}\",\n        \"options\": {\n          \"systemMessage\": \"=You are a personal assistant. The name of the current user is \\\"{{ $json.name }}\\\"\\nYou MUST only use the provided tools to process any user input. Never use general knowledge to answer questions. If you can't use a tool, tell the user why.\",\n          \"returnIntermediateSteps\": true\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.8\n    },\n    {\n      \"id\": \"cacefd8b-082c-43a4-9e25-fb497d0d8dd9\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        500,\n        160\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 200,\n        \"height\": 220,\n        \"content\": \"Be aware, that previous responses may still exist after permission changes\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"802ba649-b56e-4e90-a780-a3a1935a7907\",\n      \"name\": \"Sticky Note10\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        480,\n        960\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 200,\n        \"height\": 220,\n        \"content\": \"Uses different session ID (suffix), since every agent needs its own memory\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b82c9149-e583-4c98-a6d8-c92080fd44ba\",\n      \"name\": \"Sticky Note11\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -300,\n        -200\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 220,\n        \"height\": 240,\n        \"content\": \"Listens to messages directly sent to the bot\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b74fcbc1-aa66-440a-9a75-340858bba6c5\",\n      \"name\": \"Sticky Note12\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        140,\n        -200\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 220,\n        \"height\": 240,\n        \"content\": \"Checks if the user was found in Airtable\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"errorWorkflow\": \"gGHnVxFBZDQlm6QE\",\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"08372ec4-0f43-411a-b600-61e8d80da545\",\n  \"connections\": {\n    \"Settings\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Weather Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set input\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Main Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Wikipedia\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Main Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Main Agent\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Reply with results\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"calculator\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Check permissions\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"get_weather\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Check permissions1\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Unknown user\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Reply: unknown user\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Set input\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Simple Memory\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Main Agent\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"weather_agent\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Check permissions\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Simple Memory1\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Weather Agent\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"get_coordinates\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Check permissions1\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Telegram Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get user permissions\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check permissions\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Main Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Main Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check permissions1\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Weather Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model1\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Weather Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"list_allowed_tools\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Check permissions\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"list_granted_roles\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Check permissions\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get user permissions\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Unknown user\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When Executed by Another Workflow\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Settings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "@n8n/n8n-nodes-langchain.code",
      "n8n-nodes-base.telegramTrigger",
      "n8n-nodes-base.set",
      "n8n-nodes-base.airtable",
      "n8n-nodes-base.executeWorkflowTrigger",
      "n8n-nodes-base.set",
      "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "@n8n/n8n-nodes-langchain.code",
      "@n8n/n8n-nodes-langchain.toolCode",
      "@n8n/n8n-nodes-langchain.toolCode",
      "@n8n/n8n-nodes-langchain.toolCalculator",
      "@n8n/n8n-nodes-langchain.toolWikipedia",
      "@n8n/n8n-nodes-langchain.toolHttpRequest",
      "@n8n/n8n-nodes-langchain.toolHttpRequest",
      "@n8n/n8n-nodes-langchain.toolWorkflow",
      "@n8n/n8n-nodes-langchain.agent",
      "n8n-nodes-base.if",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegram",
      "@n8n/n8n-nodes-langchain.agent",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": "telegram trigger"
  }
}