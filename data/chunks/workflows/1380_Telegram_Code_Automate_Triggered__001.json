{
  "source": "1380_Telegram_Code_Automate_Triggered.json",
  "index": 1,
  "content": "{\n  \"id\": \"bV0JTA5NtRZxiD1q\",\n  \"meta\": {\n    \"instanceId\": \"98bf0d6aef1dd8b7a752798121440fb171bf7686b95727fd617f43452393daa3\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Telegram-bot AI Da Nang\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"ae5f9ca6-6bba-4fe8-b955-6c615d8a522f\",\n      \"name\": \"SendTyping\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        -1780,\n        -260\n      ],\n      \"webhookId\": \"26ea953e-93d9-463e-ad90-95ea8ccb449f\",\n      \"parameters\": {\n        \"chatId\": \"={{ $('telegramInput').item.json.message.chat.id }}\",\n        \"operation\": \"sendChatAction\"\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"V3EtQBeqEvnOtl9p\",\n          \"name\": \"Telegram account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"244e7be3-2caa-46f7-8628-d063a3b84c12\",\n      \"name\": \"SetResponse\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"notes\": \"Assemble response etc.\",\n      \"position\": [\n        40,\n        -420\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"fba8dc48-1484-4aae-8922-06fcae398f05\",\n              \"name\": \"responseMessage\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.output }}\"\n            },\n            {\n              \"id\": \"df8243e6-6a24-4bad-8807-63d75c828150\",\n              \"name\": \"\",\n              \"type\": \"string\",\n              \"value\": \"\"\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"192aa194-f131-4ba3-8842-7c88da1a6129\",\n      \"name\": \"Settings\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -1260,\n        -420\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"6714203d-04b3-4a3c-9183-09cddcffdfe8\",\n              \"name\": \"scheduleURL\",\n              \"type\": \"string\",\n              \"value\": \"https://docs.google.com/spreadsheets/d/1BJFS9feEy94_WgIgzWZttBwzjp09siOw1xuUgq4yuI4\"\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"1c52cdf5-da32-4c76-a294-5ec2109dbf39\",\n      \"name\": \"Schedule\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        -980,\n        -420\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1BJFS9feEy94_WgIgzWZttBwzjp09siOw1xuUgq4yuI4/edit#gid=0\",\n          \"cachedResultName\": \"Schedule\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"url\",\n          \"value\": \"={{ $json.scheduleURL }}\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XeXufn5uZvHp3lcX\",\n          \"name\": \"Google Sheets account 2\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"eff88417-4ce6-4809-8693-dc63e00fff20\",\n      \"name\": \"ScheduleToMarkdown\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        -800,\n        -420\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Get all rows from the input (each item has a \\\"json\\\" property)\\nconst rows = items.map(item => item.json);\\n\\n// If no data, return an appropriate message\\nif (rows.length === 0) {\\n return [{ json: { markdown: \\\"No data available.\\\" } }];\\n}\\n\\n// Use the keys from the first row as the header columns\\nconst headers = Object.keys(rows[0]);\\n\\n// Build the markdown table string\\nlet markdown = \\\"\\\";\\n\\n// Create the header row\\nmarkdown += `| ${headers.join(\\\" | \\\")} |\\\\n`;\\n\\n// Create the separator row (using dashes for markdown)\\nmarkdown += `| ${headers.map(() => '---').join(\\\" | \\\")} |\\\\n`;\\n\\n// Add each data row to the table\\nrows.forEach(row => {\\n // Ensure we output something for missing values\\n const rowValues = headers.map(header => row[header] !== undefined ? row[header] : '');\\n markdown += `| ${rowValues.join(\\\" | \\\")} |\\\\n`;\\n});\\n\\nconst result = { 'binary': {}, 'json': {} };\\n\\n// Convert the markdown string to a binary buffer\\nconst binaryData = Buffer.from(markdown, 'utf8');\\n/*\\n// Attach the binary data to the first item under a binary property named 'data'\\nresult.binary = {\\n data: {\\n data: binaryData,\\n mimeType: 'text/markdown',\\n }\\n};\\n*/\\n// Optionally, also return the markdown string in the json property if needed\\nresult.json.markdown = markdown;\\n\\nreturn result;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"04fab70c-493a-4c5d-adfb-0d9e8a5b7382\",\n      \"name\": \"ScheduleBot\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        -480,\n        -420\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $('Settings').first().json.inputMessage }}\",\n        \"options\": {\n          \"systemMessage\": \"=You are a helpful assistant that helps members of a meetup group with scheduling their meetups and answering questions about them.\\n\\nThe current version of the schedule in tabular format is the following:\\n\\n {{ $json.markdown }}\\n\\n\"\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.7\n    },\n    {\n      \"id\": \"be29d3ec-8211-4f23-82f2-83a1aa3aad5b\",\n      \"name\": \"n8nChatSettings\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -1580,\n        -520\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"1ecb3515-c1a2-4d69-adec-5b4d74e32056\",\n              \"name\": \"inputMessage\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.chatInput }}\"\n            },\n            {\n              \"id\": \"424b9697-94cb-4c38-953c-992436832684\",\n              \"name\": \"chatId\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.sessionId }}\"\n            },\n            {\n              \"id\": \"e23988e2-7c3d-4e38-9d5d-0c4b0c94d127\",\n              \"name\": \"mode\",\n              \"type\": \"string\",\n              \"value\": \"n8n\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"b7078c59-b6e6-4002-831f-96e56278ab61\",\n      \"name\": \"telegramChatSettings\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -1580,\n        -260\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"1ecb3515-c1a2-4d69-adec-5b4d74e32056\",\n              \"name\": \"inputMessage\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('telegramInput').item.json.message.text }}\"\n            },\n            {\n              \"id\": \"424b9697-94cb-4c38-953c-992436832684\",\n              \"name\": \"chatId\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('telegramInput').item.json.message.chat.id }}\"\n            },\n            {\n              \"id\": \"e23988e2-7c3d-4e38-9d5d-0c4b0c94d127\",\n              \"name\": \"mode\",\n              \"type\": \"string\",\n              \"value\": \"telegram\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"1ba6ad37-f1e5-440d-bf10-569038c27bce\",\n      \"name\": \"telegramInput\",\n      \"type\": \"n8n-nodes-base.telegramTrigger\",\n      \"position\": [\n        -1960,\n        -260\n      ],\n      \"webhookId\": \"f56e8e22-975e-4f9a-a6f9-253ebc63668d\",\n      \"parameters\": {\n        \"updates\": [\n          \"message\"\n        ],\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"V3EtQBeqEvnOtl9p\",\n          \"name\": \"Telegram account\"\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"56a52e8a-714f-4e7a-8a13-e915e9dc29c4\",\n      \"name\": \"n8nInput\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chatTrigger\",\n      \"position\": [\n        -1960,\n        -520\n      ],\n      \"webhookId\": \"f4ab7d4a-5cdd-425a-bbbb-e3bb94719266\",\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"961f67f0-bd44-4e7f-9f2f-c2f02f3176ce\",\n      \"name\": \"Switch\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        220,\n        -420\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"n8n mode\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $('Settings').first().json.mode }}\",\n                    \"rightValue\": \"n8n\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"telegram mode\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"e7d6a994-48e3-44bb-b662-862d9bf9c53b\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $('Settings').first().json.mode }}\",\n                    \"rightValue\": \"telegram\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"57056425-37ba-417d-9a2d-977a81d378ab\",\n      \"name\": \"telegramResponse\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        500,\n        -280\n      ],\n      \"webhookId\": \"ff71ba7e-affa-4952-90a5-6bb7f37a5598\",\n      \"parameters\": {\n        \"text\": \"={{ $json.responseMessage }}\",\n        \"chatId\": \"={{ $('Settings').first().json.chatId }}\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"V3EtQBeqEvnOtl9p\",\n          \"name\": \"Telegram account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"2962a77f-5727-43be-93fb-b0751b63c6ac\",\n      \"name\": \"n8nResponse\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        500,\n        -520\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0932484f-707b-412b-b9cb-431a8ae64447\",\n      \"name\": \"LLM\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenRouter\",\n      \"position\": [\n        -600,\n        -220\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openRouterApi\": {\n          \"id\": \"bs7tPtvgDTJNGAFJ\",\n          \"name\": \"OpenRouter account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"65948d2c-71b2-4df0-97db-ed216ed7c691\",\n      \"name\": \"Memory\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        -500,\n        -220\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('Settings').first().json.chatId }}\",\n        \"sessionIdType\": \"customKey\"\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"50566274-cf7c-496f-a166-b45eb3114da3\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -2000,\n        -600\n      ],\n      \"parameters\": {\n        \"color\": 2,\n        \"width\": 620,\n        \"height\": 240,\n        \"content\": \"## Chat input triggered inside n8n\\nUsed for testing and debugging\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9dc636fb-cc86-4236-8eb9-952a4ab0ef68\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -2000,\n        -340\n      ],\n      \"parameters\": {\n        \"color\": 2,\n        \"width\": 620,\n        \"height\": 240,\n        \"content\": \"## Chat input triggered by Telegram\\nUsed for live chat within Telegram\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0429d589-3e80-4b26-96a0-01554899a3e7\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        420,\n        -340\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 360,\n        \"height\": 240,\n        \"content\": \"## Chat response to Telegram\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9eeccee0-c6a0-40c6-9b7d-1f672bf0fdb9\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        420,\n        -600\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 360,\n        \"height\": 240,\n        \"content\": \"## Chat response inside n8n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"acb8e550-be94-41b7-904a-641b3b87e928\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -40,\n        -600\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 440,\n        \"height\": 500,\n        \"content\": \"## Prepare response\\nDecide to which chat the response will go.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"42ce6eac-165b-463d-822e-355aff030525\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -620,\n        -600\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 560,\n        \"height\": 500,\n        \"content\": \"## AI Processing\\nChat input \\u2192 Chat output\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"33c45fcc-3aa5-4cd3-b393-e1723560dfeb\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1040,\n        -600\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 400,\n        \"height\": 500,\n        \"content\": \"## Retrieve Data\\nGet schedule from Google Spreadsheet and convert it to a Markdown-Table as context for the LLM\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6e1017e3-bf9d-4056-a64f-c94476bd1f43\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1360,\n        -600\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 300,\n        \"height\": 500,\n        \"content\": \"## Normalize input\\nTransfer the chat data into a unified set of variables\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": true,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"9078c996-e932-40c0-882e-1eb261ca1535\",\n  \"connections\": {\n    \"LLM\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"ScheduleBot\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Memory\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"ScheduleBot\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Switch\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"n8nResponse\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"telegramResponse\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ScheduleToMarkdown\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Settings\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Schedule\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"n8nInput\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"n8nChatSettings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"SendTyping\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"telegramChatSettings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ScheduleBot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"SetResponse\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"SetResponse\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Switch\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"telegramInput\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"SendTyping\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"n8nChatSettings\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Settings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"telegramResponse\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"ScheduleToMarkdown\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ScheduleBot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"telegramChatSettings\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Settings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.code",
      "@n8n/n8n-nodes-langchain.agent",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.telegramTrigger",
      "@n8n/n8n-nodes-langchain.chatTrigger",
      "n8n-nodes-base.switch",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.noOp",
      "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}