{
  "source": "1854_Removeduplicates_Converttofile_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"fGq0vUaD6JoqAbDa\",\n  \"meta\": {\n    \"instanceId\": \"e22925d3ea42bbdc2dfe92a253c7671a357e393fc99ccbe9178245197b7f4017\"\n  },\n  \"name\": \"Query List of Sign-in IPs\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"9d54681d-7f8b-4996-b734-96626c9134dc\",\n      \"name\": \"GET Events - Login Successful\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        -20,\n        180\n      ],\n      \"parameters\": {\n        \"url\": \"=https://us-central1-the-byway-248217.cloudfunctions.net/reportApi/api/v1/reports/events?eventType=login.success&start={{ $json['Last 24 Hours'] }}&timeSort=asc&size=10000&scroll=5s\",\n        \"options\": {},\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"api_key\",\n              \"value\": \"={{ $json.API }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"d789cb1c-0e8f-4389-85da-4a9b02d438d5\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -280,\n        -220\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 480,\n        \"height\": 620,\n        \"content\": \"## Query the SaaS Alerts API\\n**SaaS Alerts API Reference Guide** [Link](https://app.swaggerhub.com/apis/SaaS_Alerts/functions)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"67628c17-6520-45e9-b3af-a066b7759481\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        240,\n        -140\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 680,\n        \"height\": 540,\n        \"content\": \"## Data Processing and Deduplication\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6a64676a-b9f7-4e16-aa5a-cc554902376b\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        940,\n        80\n      ],\n      \"parameters\": {\n        \"width\": 340,\n        \"height\": 340,\n        \"content\": \"## SMTP2Go API\\nAPI Documentation [Link](https://developers.smtp2go.com/docs/send-an-email)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"afefbd9f-5442-478f-b3da-3baaf7803245\",\n      \"name\": \"Send Email Upon Completion (SMTP2Go)\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1040,\n        240\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.smtp2go.com/v3/email/send\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"sender\\\": \\\"support@managedsaasalerts.com\\\",\\n  \\\"to\\\": [\\n    \\\"{{ $('Set Date and Form Variables').first().json.Email }}\\\"\\n  ],\\n  \\\"attachments\\\": [\\n    {\\n      \\\"filename\\\": \\\"testfile.csv\\\",\\n      \\\"fileblob\\\": \\\"{{ $json.data }}\\\",\\n      \\\"mimetype\\\": \\\"application/csv\\\"\\n    }\\n  ],\\n  \\\"subject\\\": \\\"Workflow Complete\\\",\\n  \\\"text_body\\\": \\\"{{ $('Set Date and Form Variables').first().json.Name }}, attached is your IP information.\\\\n\\\\n\\\\n\\\\n\\\"\\n}\\n\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            },\n            {\n              \"name\": \"accept\",\n              \"value\": \"application/json\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"v8R6pwWX9krYGBnw\",\n          \"name\": \"SMTP2Go\"\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"04997dff-1f22-46b2-9c1c-2b6575ca7606\",\n      \"name\": \"Remove Duplicate IPs\",\n      \"type\": \"n8n-nodes-base.removeDuplicates\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        720,\n        20\n      ],\n      \"parameters\": {\n        \"compare\": \"selectedFields\",\n        \"options\": {},\n        \"fieldsToCompare\": \"ip\"\n      },\n      \"typeVersion\": 2,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"bb73047a-3f43-4cf5-bc6e-706f0c76f83c\",\n      \"name\": \"Convert CSV to Base64\",\n      \"type\": \"n8n-nodes-base.moveBinaryData\",\n      \"position\": [\n        640,\n        240\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"encoding\": \"base64\"\n        },\n        \"setAllData\": false\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6172642a-ec22-4fb3-9141-34afd7c7785e\",\n      \"name\": \"Convert to CSV\",\n      \"type\": \"n8n-nodes-base.convertToFile\",\n      \"position\": [\n        400,\n        240\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"headerRow\": true\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"c748b13f-76c9-4552-83b9-53de9a0aa1e1\",\n      \"name\": \"Filter IP Information\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        500,\n        20\n      ],\n      \"parameters\": {\n        \"include\": \"selected\",\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": []\n        },\n        \"includeFields\": \"customer.name, user.fullName,  ip, location.city, location.region, location.country, \",\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"23da49b8-b3c9-421a-a6e1-750762130314\",\n      \"name\": \"Combine all Authentication Events\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        300,\n        20\n      ],\n      \"parameters\": {\n        \"numberInputs\": 3\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"cdb534b1-4f72-4466-8661-b4c72a60f69e\",\n      \"name\": \"GET Events - OAuth Authentication\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        -20,\n        20\n      ],\n      \"parameters\": {\n        \"url\": \"=https://us-central1-the-byway-248217.cloudfunctions.net/reportApi/api/v1/reports/events?eventType=oauth.granted.permission&start={{ $json['Last 24 Hours'] }}&timeSort=asc&size=10000&scroll=5s\",\n        \"options\": {},\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"api_key\",\n              \"value\": \"={{ $json.API }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"26ae2f0a-0349-4168-b6eb-48f94eb75348\",\n      \"name\": \"GET Events - Office365 Shell WCSS\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        -20,\n        -140\n      ],\n      \"parameters\": {\n        \"url\": \"=https://us-central1-the-byway-248217.cloudfunctions.net/reportApi/api/v1/reports/events?eventType=ms.shell.login.success\\n&start={{ $json['Last 24 Hours'] }}&timeSort=asc&size=10000&scroll=5s\",\n        \"options\": {},\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"api_key\",\n              \"value\": \"={{ $json.API }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"aae345d7-3250-4f4e-a464-164f830e8ecf\",\n      \"name\": \"Set Date and Form Variables\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -240,\n        20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"a81fab55-cc84-4e34-96ea-66e3f13304d5\",\n              \"name\": \"Last 24 Hours\",\n              \"type\": \"string\",\n              \"value\": \"={{ new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString() }}\\n\"\n            },\n            {\n              \"id\": \"a6da98ec-6da1-422d-a6dc-3a1d4417c285\",\n              \"name\": \"API\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json['What is your API key?'] }}\"\n            },\n            {\n              \"id\": \"35cb5896-f667-4727-843e-ad2fb3446422\",\n              \"name\": \"Name\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json['What is your name?'] }}\"\n            },\n            {\n              \"id\": \"f630dcbb-1b15-49b4-a287-f940e1eddae8\",\n              \"name\": \"Email\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json['What is your e-mail?'] }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"c8afb2af-4adf-4f90-afdd-31929b5d851d\",\n      \"name\": \"Authentication Request Form\",\n      \"type\": \"n8n-nodes-base.formTrigger\",\n      \"position\": [\n        -540,\n        20\n      ],\n      \"webhookId\": \"63923cfa-a41e-4649-922f-b83e527e8d6b\",\n      \"parameters\": {\n        \"options\": {\n          \"buttonLabel\": \"Process\"\n        },\n        \"formTitle\": \"Request Sign-In CSV\",\n        \"formFields\": {\n          \"values\": [\n            {\n              \"fieldLabel\": \"What is your name?\",\n              \"requiredField\": true\n            },\n            {\n              \"fieldType\": \"email\",\n              \"fieldLabel\": \"What is your e-mail?\",\n              \"requiredField\": true\n            },\n            {\n              \"fieldLabel\": \"What is your API key?\",\n              \"requiredField\": true\n            }\n          ]\n        },\n        \"formDescription\": \"This will email you a list of all Organizations, \\nAccounts, IPs and Locations.\\n\\nThis information is for the last 24 hours.\\n\\nPlease be patient, this can take some time.  \\n\\nYour list will be provided without duplicates.\"\n      },\n      \"typeVersion\": 2.2\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"a2cace5e-a6da-4953-901e-7f762c96ea77\",\n  \"connections\": {\n    \"Convert to CSV\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Convert CSV to Base64\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Remove Duplicate IPs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Convert to CSV\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Convert CSV to Base64\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Email Upon Completion (SMTP2Go)\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filter IP Information\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Remove Duplicate IPs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Authentication Request Form\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Date and Form Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Date and Form Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"GET Events - Login Successful\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"GET Events - OAuth Authentication\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"GET Events - Office365 Shell WCSS\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"GET Events - Login Successful\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Combine all Authentication Events\",\n            \"type\": \"main\",\n            \"index\": 2\n          }\n        ]\n      ]\n    },\n    \"Combine all Authentication Events\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter IP Information\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"GET Events - OAuth Authentication\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Combine all Authentication Events\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"GET Events - Office365 Shell WCSS\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Combine all Authentication Events\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Send Email Upon Completion (SMTP2Go)\": {\n      \"main\": [\n        []\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.removeDuplicates",
      "n8n-nodes-base.moveBinaryData",
      "n8n-nodes-base.convertToFile",
      "n8n-nodes-base.set",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.set",
      "n8n-nodes-base.formTrigger"
    ],
    "trigger": null
  }
}