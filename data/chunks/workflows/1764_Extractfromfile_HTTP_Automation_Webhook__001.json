{
  "source": "1764_Extractfromfile_HTTP_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"XnGZZfT5u0Cw1X3p\",\n  \"meta\": {\n    \"instanceId\": \"3378b0d68c3b7ebfc71b79896d94e1a044dec38e99a1160aed4e9c323910fbe2\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Attachments Gmail to drive and google sheets\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"0404ef0a-9750-495a-8798-98d4b059a083\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -580,\n        -420\n      ],\n      \"parameters\": {\n        \"height\": 440,\n        \"content\": \"## Setup\\n1. Setup your **Gmail** and **Google Drive** credentials\\n2. Setup your **Google Sheets** credentials\\n3. Setup your **Openai** api key\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8751a7f1-aae4-4746-aae7-3d8563845b8c\",\n      \"name\": \"Gmail Trigger1\",\n      \"type\": \"n8n-nodes-base.gmailTrigger\",\n      \"position\": [\n        -640,\n        120\n      ],\n      \"parameters\": {\n        \"simple\": false,\n        \"filters\": {\n          \"readStatus\": \"unread\"\n        },\n        \"options\": {\n          \"downloadAttachments\": true\n        },\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"v8YJP3VfeGtRk5la\",\n          \"name\": \"Gmail account\"\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"40f62192-5acb-4915-aa07-e5a0dfeb7581\",\n      \"name\": \"Setup1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -300,\n        120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"4cca07a2-6a70-4011-a025-65246e652fb9\",\n              \"name\": \"url_to_drive_folder\",\n              \"type\": \"string\",\n              \"value\": \"1fCWCdqrFP3WrjjLc-gJtxMaiaF5lh8Ko\"\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"d928e797-8851-4ab4-9199-cd555a40eae9\",\n      \"name\": \"Upload PDF to Drive1\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"maxTries\": 5,\n      \"position\": [\n        220,\n        0\n      ],\n      \"parameters\": {\n        \"url\": \"https://www.googleapis.com/upload/drive/v3/files\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"sendQuery\": true,\n        \"contentType\": \"binaryData\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"uploadType\",\n              \"value\": \"media\"\n            }\n          ]\n        },\n        \"inputDataFieldName\": \"={{ $binary.attachment_0.mimeType === \\\"application/pdf\\\"\\n     ? \\\"attachment_0\\\"\\n     : \\\"attachment_1\\\" }}\",\n        \"nodeCredentialType\": \"googleDriveOAuth2Api\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"p5I6S4YkJps1zvwz\",\n          \"name\": \"Google Drive account 2\"\n        }\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"22df6933-a0c7-4cce-8114-5332038a14c3\",\n      \"name\": \"Rename file1\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        400,\n        0\n      ],\n      \"parameters\": {\n        \"fileId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $json.id }}\"\n        },\n        \"options\": {},\n        \"operation\": \"update\",\n        \"newUpdatedFileName\": \"={{ $('Setup1').item.json.subject }}_invoice_{{ $now.format('yyyy-MM-dd') }}.pdf\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"p5I6S4YkJps1zvwz\",\n          \"name\": \"Google Drive account 2\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"ce6a6a4c-17ba-4cf7-b07a-97b9d8d80844\",\n      \"name\": \"Move to the correct folder1\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        580,\n        0\n      ],\n      \"parameters\": {\n        \"fileId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $json.id }}\"\n        },\n        \"driveId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"My Drive\",\n          \"cachedResultUrl\": \"https://drive.google.com/drive/my-drive\",\n          \"cachedResultName\": \"My Drive\"\n        },\n        \"folderId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1fCWCdqrFP3WrjjLc-gJtxMaiaF5lh8Ko\",\n          \"cachedResultUrl\": \"\",\n          \"cachedResultName\": \"2025\"\n        },\n        \"operation\": \"move\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"p5I6S4YkJps1zvwz\",\n          \"name\": \"Google Drive account 2\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"e64aac5c-a314-46b6-b7db-fc0d6f450e1f\",\n      \"name\": \"Gmail\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        1240,\n        0\n      ],\n      \"webhookId\": \"556cbee3-8de0-4645-9e91-e7c0c252f2ab\",\n      \"parameters\": {\n        \"messageId\": \"={{ $('Gmail Trigger1').item.json.id }}\",\n        \"operation\": \"markAsRead\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"v8YJP3VfeGtRk5la\",\n          \"name\": \"Gmail account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"ea74cfc1-0305-418d-9f5f-bffcfb3bb2c7\",\n      \"name\": \"Extract from File2\",\n      \"type\": \"n8n-nodes-base.extractFromFile\",\n      \"position\": [\n        1200,\n        -180\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"operation\": \"pdf\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0398d982-78fd-4830-b5cf-271195af80fd\",\n      \"name\": \"Google Drive\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        800,\n        0\n      ],\n      \"parameters\": {\n        \"fileId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $json.id }}\"\n        },\n        \"options\": {},\n        \"operation\": \"download\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"p5I6S4YkJps1zvwz\",\n          \"name\": \"Google Drive account 2\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"3b4a96d4-a6ee-486a-a795-fe410ccc38b2\",\n      \"name\": \"OpenAI Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmOpenAi\",\n      \"position\": [\n        1740,\n        20\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o\",\n          \"cachedResultName\": \"gpt-4o\"\n        },\n        \"options\": {\n          \"temperature\": 0\n        }\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"XJdxgMSXFgwReSsh\",\n          \"name\": \"n8n key\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a7dd0d95-5e79-4bd2-a8a6-2178264d19fc\",\n      \"name\": \"Structured Output Parser\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        1940,\n        40\n      ],\n      \"parameters\": {\n        \"jsonSchema\": \"{\\n  \\\"Invoice date\\\": { \\\"type\\\": \\\"date\\\" },\\n  \\\"Invoice description\\\": { \\\"type\\\": \\\"string\\\" },\\n  \\\"Total price\\\": { \\\"type\\\": \\\"number\\\" },\\n  \\\"Fichero\\\": { \\\"type\\\": \\\"string\\\" }\\n}\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"68d98f4c-e679-48e3-a1a1-529cda4e31a4\",\n      \"name\": \"Append to Reconciliation Sheet\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        2280,\n        -140\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {},\n          \"schema\": [\n            {\n              \"id\": \"Invoice date\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Invoice date\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Invoice Description\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Invoice Description\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Total price\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Total price\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Fichero\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Fichero\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"autoMapInputData\",\n          \"matchingColumns\": [],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {},\n        \"operation\": \"append\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"gid=0\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1gIUnjSWUhsoTOVVd4ZoVjARCGQfGE8s7FWcju3lNajM\",\n          \"cachedResultUrl\": \"\",\n          \"cachedResultName\": \"facturas\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"3IOU2VjBnR4hGohx\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.3\n    },\n    {\n      \"id\": \"80e1c8f4-b593-4c5f-b9e2-f3b7996ee6d4\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1680,\n        -400\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 805.0578351924228,\n        \"height\": 656.5014186128178,\n        \"content\": \"## 3. Use LLMs to Extract Values from Data\\n[Read more about Basic LLM Chain](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.chainllm/)\\n\\nLarge language models are perfect for data extraction tasks as they can work across a range of document layouts without human intervention. The extracted data can then be sent to a variety of datastores such as spreadsheets, accounting systems and/or CRMs.\\n\\n**Tip:** The \\\"Structured Output Parser\\\" ensures the AI output can be\\ninserted to our spreadsheet without additional clean up and/or formatting. \"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3754e10e-a233-4ce0-bc79-bb5c01db9695\",\n      \"name\": \"Map Output\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2080,\n        -140\n      ],\n      \"parameters\": {\n        \"mode\": \"raw\",\n        \"options\": {},\n        \"jsonOutput\": \"={{ $json.output }}\"\n      },\n      \"typeVersion\": 3.3\n    },\n    {\n      \"id\": \"a42ff16f-d0df-4b6d-9a36-849f85d1facc\",\n      \"name\": \"Apply Data Extraction Rules\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        1740,\n        -140\n      ],\n      \"parameters\": {\n        \"text\": \"=Given the following invoice in the <invoice> xml tags, extract the following information as listed below.\\nIf you cannot the information for a specific item, then leave blank and skip to the next. \\n\\n* Invoice date\\n* Invoice Description: {{ $('Rename file1').item.json.name }}\\n* Total price\\n* Fichero: =HYPERLINK(\\\"https://drive.google.com/file/d/{{ $('Move to the correct folder1').item.json.id }}/view\\\", \\\"Ver Documento\\\")\\n\\n\\n<invoice>{{ $json.text }}</invoice>\",\n        \"promptType\": \"define\",\n        \"hasOutputParser\": true\n      },\n      \"typeVersion\": 1.4\n    },\n    {\n      \"id\": \"f6de5d5a-d2dc-4590-8f46-3f250b8fca9f\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1860,\n        0\n      ],\n      \"parameters\": {\n        \"width\": 192.26896179623753,\n        \"height\": 213.73043662572252,\n        \"content\": \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n**Need more attributes?**\\nChange it here!\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"255fe8c1-5bd7-41cc-b1f9-c8956b5ad101\",\n      \"name\": \"Only invoice mails with attachments\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        0,\n        120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 1,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"or\",\n          \"conditions\": [\n            {\n              \"id\": \"229200d1-ec13-4970-ae0e-2c8e17da0bdf\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"contains\"\n              },\n              \"leftValue\": \"={{ $('Gmail Trigger1').item.json.headers['content-type'] }}\",\n              \"rightValue\": \"multipart/mixed\"\n            },\n            {\n              \"id\": \"new-condition\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"isNotEmpty\"\n              },\n              \"leftValue\": \"={{ $json.attachments }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.1\n    }\n  ],\n  \"active\": true,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"eb152808-e993-4e18-9dd8-10f21df57bf1\",\n  \"connections\": {\n    \"Gmail\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"Setup1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Only invoice mails with attachments\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Map Output\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Append to Reconciliation Sheet\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Drive\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract from File2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Apply Data Extraction Rules\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Rename file1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Move to the correct folder1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gmail Trigger1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Setup1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract from File2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Apply Data Extraction Rules\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Upload PDF to Drive1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Rename file1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Structured Output Parser\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Apply Data Extraction Rules\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Apply Data Extraction Rules\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Map Output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Move to the correct folder1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Gmail\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Google Drive\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Only invoice mails with attachments\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload PDF to Drive1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Gmail\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.gmailTrigger",
      "n8n-nodes-base.set",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.gmail",
      "n8n-nodes-base.extractFromFile",
      "n8n-nodes-base.googleDrive",
      "@n8n/n8n-nodes-langchain.lmOpenAi",
      "@n8n/n8n-nodes-langchain.outputParserStructured",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set",
      "@n8n/n8n-nodes-langchain.chainLlm",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.if"
    ],
    "trigger": "gmail trigger1"
  }
}