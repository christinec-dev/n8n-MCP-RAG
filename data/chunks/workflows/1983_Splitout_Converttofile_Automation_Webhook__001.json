{
  "source": "1983_Splitout_Converttofile_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"0GCQ1fO3d5MBdKmi\",\n  \"meta\": {\n    \"instanceId\": \"fddb3e91967f1012c95dd02bf5ad21f279fc44715f47a7a96a33433621caa253\"\n  },\n  \"name\": \"template-demo-chatgpt-image-1-with-drive-and-sheet copy\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"7d78d4e3-cbb3-4f32-82d9-73c9d7f6c892\",\n      \"name\": \"When clicking 'Test workflow'\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"disabled\": true,\n      \"position\": [\n        -480,\n        -245\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b32b61bb-c837-4697-9742-a1bb2854b628\",\n      \"name\": \"HTTP Request\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -260,\n        -120\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.openai.com/v1/images/generations\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"model\",\n              \"value\": \"gpt-image-1\"\n            },\n            {\n              \"name\": \"prompt\",\n              \"value\": \"={{ $json.chatInput }}\"\n            },\n            {\n              \"name\": \"output_format\",\n              \"value\": \"jpeg\"\n            },\n            {\n              \"name\": \"quality\",\n              \"value\": \"low\"\n            },\n            {\n              \"name\": \"output_compression\",\n              \"value\": \"={{parseInt('80')}}\"\n            },\n            {\n              \"name\": \"size\",\n              \"value\": \"1024x1024\"\n            },\n            {\n              \"name\": \"n\",\n              \"value\": \"={{parseInt('1')}}\"\n            },\n            {\n              \"name\": \"moderation\",\n              \"value\": \"low\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"openAiApi\"\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"GgwYNKMKKqKJICYO\",\n          \"name\": \"OpenAi account - Image\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"0ead70d0-9e3b-4f19-afee-b5d4a7b532e9\",\n      \"name\": \"Google Drive\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        860,\n        -20\n      ],\n      \"parameters\": {\n        \"name\": \"=chatgpt_created_by_n8n_{{ $('HTTP Request').item.json.created }}\",\n        \"driveId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"My Drive\"\n        },\n        \"options\": {},\n        \"folderId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1sIbMHDtcOafBVdCq0gTEuGvnT63s8Fdy\",\n          \"cachedResultUrl\": \"https://drive.google.com/drive/folders/1sIbMHDtcOafBVdCq0gTEuGvnT63s8Fdy\",\n          \"cachedResultName\": \"n8n-demo-gpt_image_1\"\n        },\n        \"inputDataFieldName\": \"=data\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"iQdqjdvLVh5ldUIq\",\n          \"name\": \"Personal-Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"a76c4340-9f34-49d1-a831-1ba4515933ee\",\n      \"name\": \"Split Out\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        -40,\n        -120\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"includeBinary\": true\n        },\n        \"fieldToSplitOut\": \"data\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c8090e15-b9b9-4999-89f0-97d45e6176d6\",\n      \"name\": \"Convert to File\",\n      \"type\": \"n8n-nodes-base.convertToFile\",\n      \"position\": [\n        640,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"fileName\": \"={{ $now.format(\\\"yyyyMMddHHmmSSS\\\") }}\"\n        },\n        \"operation\": \"toBinary\",\n        \"sourceProperty\": \"b64_json\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"692a71fb-6fe3-4728-a588-f9283f5ab968\",\n      \"name\": \"Loop Over Items\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        200,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"reset\": false\n        },\n        \"batchSize\": \"=1\"\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"dfa88c15-4d38-4670-9c5a-4e52a9ce9d33\",\n      \"name\": \"Edit Fields-file_name\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        420,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"10e6d39e-c44c-4db4-bf88-806b2f36c09f\",\n              \"name\": \"file_name\",\n              \"type\": \"string\",\n              \"value\": \"={{ $now.format(\\\"yyyyMMddHHmmSSS\\\") }}\"\n            },\n            {\n              \"id\": \"c2610584-aafa-4d90-8977-399e49015c32\",\n              \"name\": \"b64_json\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.b64_json }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"c34c1a91-2601-4750-8134-d31cf377c349\",\n      \"name\": \"Edit Fields1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1080,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"dcfa49d6-a8ed-43a2-9aaa-86751f34e61d\",\n              \"name\": \"id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.id }}\"\n            },\n            {\n              \"id\": \"d2f7f22d-9453-4b61-bd46-fb3e8d5ad4d8\",\n              \"name\": \"webViewLink\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.webViewLink }}\"\n            },\n            {\n              \"id\": \"b8cf5a41-e354-416e-b548-8d1a274873e0\",\n              \"name\": \"thumbnailLink\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.thumbnailLink }}\"\n            },\n            {\n              \"id\": \"76c11a24-087c-4a6c-a5b4-8901e9436786\",\n              \"name\": \"file_name\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Edit Fields-file_name').item.json.file_name }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"6bd8f7dc-1006-4d7f-b3eb-0a3aaa1b9a84\",\n      \"name\": \"Google Sheets\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        1300,\n        -20\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"image\": \"={{ $json.webViewLink }}\",\n            \"prompt\": \"={{ $('When chat message received').item.json.chatInput }}\",\n            \"image_thumb\": \"==IMAGE(\\\"{{ $('Edit Fields1').item.json.thumbnailLink }}\\\")\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"prompt\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"prompt\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"image\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"image\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"image_thumb\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"image_thumb\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {\n          \"cellFormat\": \"USER_ENTERED\"\n        },\n        \"operation\": \"append\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/11K1tui8itMzcSZqHOmzvFnM0G-ihn1uiLUZ_o478j88/edit#gid=0\",\n          \"cachedResultName\": \"工作表1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"11K1tui8itMzcSZqHOmzvFnM0G-ihn1uiLUZ_o478j88\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/11K1tui8itMzcSZqHOmzvFnM0G-ihn1uiLUZ_o478j88/edit?usp=drivesdk\",\n          \"cachedResultName\": \"n8n-chatgpt-image-1-model\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"tufEzuSTEveV3tuA\",\n          \"name\": \"(Personal)Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"8ee28143-d9e7-4d14-929f-c9b6592c366e\",\n      \"name\": \"When chat message received\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chatTrigger\",\n      \"position\": [\n        -480,\n        -45\n      ],\n      \"webhookId\": \"f64b2006-672a-4ad6-8c30-428b76f5a332\",\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"1e687fde-8465-4490-8738-c9832904f2b5\",\n      \"name\": \"Google Sheets1\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        700,\n        -400\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"prompt\": \"={{ $('When chat message received').item.json.chatInput }}\",\n            \"datetime\": \"={{ $('HTTP Request').item.json.created.toDateTime('s').format('yyyy-MM-dd HH:mm:ss') }}\",\n            \"input token\": \"={{ $('HTTP Request').item.json.usage.input_tokens }}\",\n            \"output token\": \"={{ $('HTTP Request').item.json.usage.output_tokens }}\",\n            \"input estimated price\": \"={{    (     ($('HTTP Request').item.json.usage.input_tokens || 0) * 10 / 1000000   ).toFixed(6)  }}\",\n            \"total estimated price\": \"={{ \\n  (\\n    (($('HTTP Request').item.json.usage.input_tokens || 0) * 10 / 1000000) +\\n    (($('HTTP Request').item.json.usage.output_tokens || 0) * 40 / 1000000)\\n  ).toFixed(6)\\n}}\",\n            \"output estimated price\": \"={{    (     ($('HTTP Request').item.json.usage.output_tokens || 0) * 40 / 1000000   ).toFixed(6)  }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"prompt\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"prompt\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"datetime\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"datetime\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"input token\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"input token\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"input estimated price\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"input estimated price\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"output token\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"output token\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"output estimated price\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"output estimated price\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"total estimated price\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"total estimated price\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {},\n        \"operation\": \"append\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": 929800828,\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/11K1tui8itMzcSZqHOmzvFnM0G-ihn1uiLUZ_o478j88/edit#gid=929800828\",\n          \"cachedResultName\": \"usage\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"11K1tui8itMzcSZqHOmzvFnM0G-ihn1uiLUZ_o478j88\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/11K1tui8itMzcSZqHOmzvFnM0G-ihn1uiLUZ_o478j88/edit?usp=drivesdk\",\n          \"cachedResultName\": \"n8n-chatgpt-image-1-model\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"tufEzuSTEveV3tuA\",\n          \"name\": \"(Personal)Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"5e1f6dd3-6c1a-4838-86c7-2a3c0cf05c3d\",\n      \"name\": \"Aggregate\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        480,\n        -400\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"aggregate\": \"aggregateAllItemData\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f14edb71-0778-40dc-9f2d-4cfc72b8a351\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -540,\n        -600\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 340,\n        \"height\": 240,\n        \"content\": \"## Created by darrell_tw_ \\n\\nAn engineer now focus on AI and Automation\\n\\n### contact me with following:\\n[X](https://x.com/darrell_tw_)\\n[Threads](https://www.threads.net/@darrell_tw_)\\n[Instagram](https://www.instagram.com/darrell_tw_/)\\n[Website](https://www.darrelltw.com/)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6bbe2346-287b-491d-bf20-a76d39a6e297\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -540,\n        -340\n      ],\n      \"parameters\": {\n        \"width\": 660,\n        \"height\": 480,\n        \"content\": \"## Use Chat to input prompts for image generation\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8dd6607a-16cf-424d-902a-04c43e68f424\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        160,\n        -200\n      ],\n      \"parameters\": {\n        \"color\": 2,\n        \"width\": 1260,\n        \"height\": 420,\n        \"content\": \"## Process image array data with Loop\\nRegardless of single or multiple images\\nThey will be in the data[] array\\nJust use Loop to process them\\n\\nImages will be uploaded to Drive and saved as a row in the Sheet with links and thumbnails\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f8d0819a-e38a-4f7a-aa79-594ebca465a0\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        400,\n        -480\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 480,\n        \"height\": 260,\n        \"content\": \"## After processing, save Cost to Sheet\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"cf533114-4aa9-4b06-8247-3c06f9dcbc79\",\n  \"connections\": {\n    \"Aggregate\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Google Sheets1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Out\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Google Sheets\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Drive\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"HTTP Request\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Out\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Sheets\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Convert to File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Google Drive\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Aggregate\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Edit Fields-file_name\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields-file_name\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Convert to File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When chat message received\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HTTP Request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking 'Test workflow'\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HTTP Request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.convertToFile",
      "n8n-nodes-base.splitInBatches",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.googleSheets",
      "@n8n/n8n-nodes-langchain.chatTrigger",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.aggregate",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}