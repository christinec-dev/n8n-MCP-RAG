{
  "source": "0559_HTTP_Webhook_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"0000\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"b2015e98-23bf-4bdb-b588-2991ee4d69d5\",\n      \"name\": \"Confluence: Get template content\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1460,\n        660\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $('Set parameters').item.json.confluence_base_url }}/wiki/rest/api/template/{{ $json.template_id }}\",\n        \"options\": {},\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpBasicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"wQWJ3gbaDYd4nNIK\",\n          \"name\": \"Atlassian\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"b5b665d6-f92e-43f1-bfd8-5de4155b73d4\",\n      \"name\": \"Confluence: Create page from template\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1900,\n        660\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $('Set parameters').item.json.confluence_base_url }}/wiki/rest/api/content/\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"type\",\n              \"value\": \"page\"\n            },\n            {\n              \"name\": \"title\",\n              \"value\": \"={{ $now.format(\\\"yyyy-MM-dd-HH-mm\\\") }}-{{ $('Replace placeholders in template body and title').item.json.page_title }}\"\n            },\n            {\n              \"name\": \"space\",\n              \"value\": \"={{ { \\\"key\\\" : $('Set parameters').item.json.target_space_key } }}\"\n            },\n            {\n              \"name\": \"body\",\n              \"value\": \"={{ { \\\"storage\\\" : { \\\"value\\\" : $('Replace placeholders in template body and title').item.json.page_body, \\\"representation\\\" : \\\"storage\\\" } } }}\"\n            },\n            {\n              \"name\": \"ancestors\",\n              \"value\": \"={{ [{\\\"type\\\" : \\\"page\\\", \\\"id\\\" : $('Set parameters').item.json.target_parent_page_id} ] }}\"\n            }\n          ]\n        },\n        \"genericAuthType\": \"httpBasicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"wQWJ3gbaDYd4nNIK\",\n          \"name\": \"Atlassian\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"571a104e-4112-4898-8e63-08dd8809b328\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1000,\n        300\n      ],\n      \"parameters\": {\n        \"color\": 2,\n        \"width\": 610,\n        \"height\": 315,\n        \"content\": \"## Create Atlassian Confluence page from template\\n\\nCreates a new page in Confluence from a space template.\\n\\n### Setup\\nAll parameters you need to change are defined in the _Set parameters_ node\\nFor detailled setup instructions and explanation how it all works --> [ðŸŽ¥ Video](https://www.tella.tv/video/automate-confluence-page-creation-e994)\\n\\n### Credentials\\nAs the password for the basic auth credential, you need to use an API key. \\nDocumentation on those is [here](https://support.atlassian.com/atlassian-account/docs/manage-api-tokens-for-your-atlassian-account/).\\n[Here's](https://id.atlassian.com/manage-profile/security/api-tokens) where you create and manage Atlassian API keys.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"eac6d0bc-0ea5-4e23-977c-8e06b346ea79\",\n      \"name\": \"Set parameters\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1240,\n        660\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"01116d20-ddaf-405a-99ec-81197f71cd4f\",\n              \"name\": \"confluence_base_url\",\n              \"type\": \"string\",\n              \"value\": \"https://your-domain.atlassian.net\"\n            },\n            {\n              \"id\": \"4a5a8737-5694-40ef-99c5-d5aa4fab1220\",\n              \"name\": \"template_id\",\n              \"type\": \"string\",\n              \"value\": \"834764824\"\n            },\n            {\n              \"id\": \"27c1681d-4f44-4b6f-9e6b-6013bfcac6a0\",\n              \"name\": \"target_space_key\",\n              \"type\": \"string\",\n              \"value\": \"~5f5915647187b8006ffffe8e\"\n            },\n            {\n              \"id\": \"5de1868b-ee33-4ef4-aa45-0d951b5ce5ff\",\n              \"name\": \"target_parent_page_id\",\n              \"type\": \"string\",\n              \"value\": \"312344667\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"c28299ef-8ce7-497f-98d8-356a741f461d\",\n      \"name\": \"Replace placeholders in template body and title\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1680,\n        660\n      ],\n      \"parameters\": {\n        \"mode\": \"runOnceForEachItem\",\n        \"jsCode\": \"function replacePlaceholders(template, values) {\\n    // Regular expression to find placeholders in the format $some.place.holder$\\n    const placeholderPattern = /\\\\$(.*?)\\\\$/g;\\n\\n    // Replace function to look up the value from the object\\n    return template.replace(placeholderPattern, (match, p1) => {\\n        // Split the placeholder into parts by dot notation\\n        const keys = p1.split('.');\\n        let value = values;\\n\\n        // Traverse the object based on the dot notation\\n        for (const key of keys) {\\n            if (value && key in value) {\\n                value = value[key];\\n            } else {\\n                // If the key is not found, return the original placeholder\\n                return match;\\n            }\\n        }\\n        // Return the value found in the object\\n        return value;\\n    });\\n}\\n\\nconst templateTitle = $('Confluence: Get template content').item.json.name;\\nconst templateBody = $('Confluence: Get template content').item.json.body.storage.value;\\nconst values = $('Webhook').item.json;\\n\\nconst pageTitle = replacePlaceholders(templateTitle, values); \\nconst pageBody = replacePlaceholders(templateBody, values);\\n\\nreturn { \\\"page_title\\\": pageTitle, \\\"page_body\\\" :  pageBody};\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"42bbd727-e3ea-4e36-be11-1f7def28f134\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        1020,\n        660\n      ],\n      \"webhookId\": \"d291ef27-c27f-42cf-90cf-4dad7dd71a7c\",\n      \"parameters\": {\n        \"path\": \"d291ef27-c27f-42cf-90cf-4dad7dd71a7c\",\n        \"options\": {},\n        \"httpMethod\": \"POST\"\n      },\n      \"typeVersion\": 2\n    }\n  ],\n  \"pinData\": {\n    \"Webhook\": [\n      {\n        \"user\": {\n          \"name\": \"Alice\",\n          \"messages\": {\n            \"count\": 5\n          }\n        }\n      }\n    ]\n  },\n  \"connections\": {\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set parameters\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set parameters\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Confluence: Get template content\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Confluence: Get template content\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Replace placeholders in template body and title\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Replace placeholders in template body and title\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Confluence: Create page from template\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set",
      "n8n-nodes-base.code",
      "n8n-nodes-base.webhook"
    ],
    "trigger": null
  }
}