{
  "source": "1835_Manual_Slack_Automation_Triggered.json",
  "index": 1,
  "content": "{\n  \"id\": \"dDInVHNAfSedBUCb\",\n  \"meta\": {\n    \"instanceId\": \"fddb3e91967f1012c95dd02bf5ad21f279fc44715f47a7a96a33433621caa253\"\n  },\n  \"name\": \"外送記帳\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"09c19ba1-45f2-43af-9985-3508d801c1b7\",\n      \"name\": \"Loop Over Items\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        440,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"18625b1d-f8ff-4e48-8b64-a9d42d24eccc\",\n      \"name\": \"Click to Test Flow\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        40,\n        0\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"649933c4-b16b-46de-9038-7d8c0b3d8e88\",\n      \"name\": \"Get emails from Gmail with certain subject\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        220,\n        0\n      ],\n      \"webhookId\": \"99c4deca-17c7-47ae-a38c-50344938e792\",\n      \"parameters\": {\n        \"simple\": false,\n        \"filters\": {\n          \"q\": \"subject:透過 Uber Eats 系統送出的訂單\"\n        },\n        \"options\": {},\n        \"operation\": \"getAll\",\n        \"returnAll\": true\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"34rX9kxKlJadOY6u\",\n          \"name\": \"Gmail account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"b2118a34-52ad-4464-b7ea-7f3105536fad\",\n      \"name\": \"Receive certain keyword Gmail Trigger\",\n      \"type\": \"n8n-nodes-base.gmailTrigger\",\n      \"position\": [\n        120,\n        -180\n      ],\n      \"parameters\": {\n        \"simple\": false,\n        \"filters\": {\n          \"q\": \"subject:透過 Uber Eats 系統送出的訂單\"\n        },\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyHour\",\n              \"minute\": 30\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"34rX9kxKlJadOY6u\",\n          \"name\": \"Gmail account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"00986543-d01a-4b11-bbaa-60c73a1dae02\",\n      \"name\": \"Extract Price, Shop, Date, TIme\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        620,\n        60\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"c24405f8-267f-4933-a178-1b51145d62bf\",\n              \"name\": \"price\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json[\\\"text\\\"].match(/\\\\$(\\\\d+(\\\\.\\\\d{2})?)/)[1] }}\"\n            },\n            {\n              \"id\": \"968cf7cd-6e28-4328-a829-3fe2cb327643\",\n              \"name\": \"shop\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json[\\\"text\\\"].match(/以下是您在([\\\\u4e00-\\\\u9fa5a-zA-Z0-9\\\\s]+)訂購/)[1] }}\"\n            },\n            {\n              \"id\": \"53642bcb-f3a6-4086-bdc1-2f8d27927462\",\n              \"name\": \"date\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json[\\\"text\\\"].match(/Date: (\\\\d{4}年\\\\d{1,2}月\\\\d{1,2}日)/)[1].replace(\\\"年\\\", \\\".\\\").replace(\\\"月\\\", \\\".\\\").replace(\\\"日\\\", \\\"\\\") }}\"\n            },\n            {\n              \"id\": \"cd227132-971b-4970-8b5d-724463efe036\",\n              \"name\": \"time\",\n              \"type\": \"string\",\n              \"value\": \"={{ \\n  $json[\\\"text\\\"].match(/(上午|下午) (\\\\d{1,2}):(\\\\d{2})/) ? \\n  ($json[\\\"text\\\"].match(/(上午|下午) (\\\\d{1,2}):(\\\\d{2})/)[1] === '下午' && $json[\\\"text\\\"].match(/(上午|下午) (\\\\d{1,2}):(\\\\d{2})/)[2] !== '12' \\n    ? (parseInt($json[\\\"text\\\"].match(/(上午|下午) (\\\\d{1,2}):(\\\\d{2})/)[2]) + 12) + ':' + $json[\\\"text\\\"].match(/(上午|下午) (\\\\d{1,2}):(\\\\d{2})/)[3] \\n    : $json[\\\"text\\\"].match(/(上午|下午) (\\\\d{1,2}):(\\\\d{2})/)[2] + ':' + $json[\\\"text\\\"].match(/(上午|下午) (\\\\d{1,2}):(\\\\d{2})/)[3]\\n  )\\n  : null \\n}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"3d8f97ea-4a0d-4939-898f-8a0ca9415e7d\",\n      \"name\": \"Send to Slack with Block\",\n      \"type\": \"n8n-nodes-base.slack\",\n      \"position\": [\n        800,\n        60\n      ],\n      \"webhookId\": \"0e812732-74d2-4924-8db3-6b9234965937\",\n      \"parameters\": {\n        \"text\": \"=Ubereat 訂餐資訊: \\n商家:  {{ $json.shop }}\\n金額: {{ $json.price }}\\n日期: {{ $json.date }}\\n\\n記帳網址:\\nmoze3://expense?amount={{ $json.price }}&account=信用卡&subcategory=外送&store={{ $json.shop }}&date={{ $json.date }}\",\n        \"select\": \"channel\",\n        \"blocksUi\": \"={\\n\\t\\\"blocks\\\": [\\n\\t\\t{\\n\\t\\t\\t\\\"type\\\": \\\"section\\\",\\n\\t\\t\\t\\\"text\\\": {\\n\\t\\t\\t\\t\\\"type\\\": \\\"mrkdwn\\\",\\n\\t\\t\\t\\t\\\"text\\\": \\\"Ubereat 訂餐資訊:\\\\n\\\\n*商家:* {{ $json.shop }}\\\\n*金額:* {{ $json.price }}\\\\n*日期:* {{ $json.date }}\\\"\\n\\t\\t\\t}\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\t\\\"type\\\": \\\"divider\\\"\\n\\t\\t},\\n\\t\\t{\\n\\t\\t\\t\\\"type\\\": \\\"section\\\",\\n\\t\\t\\t\\\"text\\\": {\\n\\t\\t\\t\\t\\\"type\\\": \\\"mrkdwn\\\",\\n\\t\\t\\t\\t\\\"text\\\": \\\"Moze 記帳請點我\\\"\\n\\t\\t\\t},\\n\\t\\t\\t\\\"accessory\\\": {\\n\\t\\t\\t\\t\\\"type\\\": \\\"button\\\",\\n\\t\\t\\t\\t\\\"text\\\": {\\n\\t\\t\\t\\t\\t\\\"type\\\": \\\"plain_text\\\",\\n\\t\\t\\t\\t\\t\\\"text\\\": \\\"記帳\\\",\\n\\t\\t\\t\\t\\t\\\"emoji\\\": true\\n\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\\"value\\\": \\\"click\\\",\\n\\t\\t\\t\\t\\\"url\\\": \\\"moze3://expense?amount={{ $json.price }}&account=信用卡&subcategory=外送&store={{ $json.shop }}&date={{ $json.date }}&&project=生活開銷&&time={{ $json.time }}\\\",\\n\\t\\t\\t\\t\\\"action_id\\\": \\\"button-action\\\"\\n\\t\\t\\t}\\n\\t\\t}\\n\\t]\\n}\",\n        \"channelId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"C0883CJM1UH\",\n          \"cachedResultName\": \"外送記帳自動化\"\n        },\n        \"messageType\": \"block\",\n        \"otherOptions\": {},\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"slackOAuth2Api\": {\n          \"id\": \"sD1J9ZLyEhcglrRa\",\n          \"name\": \"Slack account\"\n        }\n      },\n      \"typeVersion\": 2.3\n    }\n  ],\n  \"active\": true,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"0840254c-0058-47fe-9b22-7fbb93144788\",\n  \"connections\": {\n    \"Loop Over Items\": {\n      \"main\": [\n        [],\n        [\n          {\n            \"node\": \"Extract Price, Shop, Date, TIme\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Click to Test Flow\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get emails from Gmail with certain subject\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Send to Slack with Block\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract Price, Shop, Date, TIme\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send to Slack with Block\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Receive certain keyword Gmail Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get emails from Gmail with certain subject\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.splitInBatches",
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.gmail",
      "n8n-nodes-base.gmailTrigger",
      "n8n-nodes-base.set",
      "n8n-nodes-base.slack"
    ],
    "trigger": "receive certain keyword gmail trigger"
  }
}