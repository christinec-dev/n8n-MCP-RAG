{
  "source": "1668_GoogleCalendar_Filter_Automation_Triggered.json",
  "index": 1,
  "content": "{\n  \"id\": \"slP122GjD9meGkS6\",\n  \"meta\": {\n    \"instanceId\": \"178ef8a5109fc76c716d40bcadb720c455319f7b7a3fd5a39e4f336a091f524a\"\n  },\n  \"name\": \"Calendar_scheduling\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"bd1dae81-daea-4539-bf1d-38eb9a2bd2f0\",\n      \"name\": \"Gmail Trigger\",\n      \"type\": \"n8n-nodes-base.gmailTrigger\",\n      \"position\": [\n        500,\n        560\n      ],\n      \"parameters\": {\n        \"filters\": {\n          \"readStatus\": \"unread\",\n          \"includeSpamTrash\": false\n        },\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"kLFedNEM8Zwkergv\",\n          \"name\": \"Gmail account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a97c3ab1-6fbc-441e-af11-3c746936013b\",\n      \"name\": \"Chat OpenAI\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        720,\n        740\n      ],\n      \"parameters\": {\n        \"model\": \"gpt-4\",\n        \"options\": {\n          \"temperature\": 0.1\n        }\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"wJtZwsVKW5v6R2Iy\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a1205598-7cd4-4278-ad53-0cfc7c7947ff\",\n      \"name\": \"Workflow Tool\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolWorkflow\",\n      \"position\": [\n        1580,\n        759\n      ],\n      \"parameters\": {\n        \"name\": \"Calendar_Availability\",\n        \"workflowId\": \"={{ $workflow.id }}\",\n        \"description\": \"Call this tool to get my calendar availability as stringified JSON array.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5ba2c2b0-2218-45d2-a417-f86c80643397\",\n      \"name\": \"Chat OpenAI1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1420,\n        759\n      ],\n      \"parameters\": {\n        \"model\": \"gpt-4\",\n        \"options\": {\n          \"temperature\": 0\n        }\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"wJtZwsVKW5v6R2Iy\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"012835ec-c20a-4b84-bed8-67f6aac30698\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        460,\n        460\n      ],\n      \"parameters\": {\n        \"width\": 616.8060552874073,\n        \"height\": 410.24791575252334,\n        \"content\": \"## Check if incoming email is about appointment\\nWe use LLM to check subject and body of the email and determine if it's an appointment request. \"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ceaa4f77-acc8-437e-9d61-16cf344a7748\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1340,\n        460\n      ],\n      \"parameters\": {\n        \"width\": 676.1951194231482,\n        \"height\": 241.70645019745504,\n        \"content\": \"## Get calendar availability and compose a response\\nMake sure to update the Workflow ID if you are running this as 2 workflows\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"499def23-7dec-4131-91fd-326b1b824762\",\n      \"name\": \"Google Calendar\",\n      \"type\": \"n8n-nodes-base.googleCalendar\",\n      \"position\": [\n        680,\n        1120\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"timeMax\": \"={{ $now.plus(1, 'month').toISO() }}\",\n          \"timeMin\": \"={{ $now.minus(1, 'day').toISO() }}\",\n          \"singleEvents\": true\n        },\n        \"calendar\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"your_email@gmail.com\",\n          \"cachedResultName\": \"your_email@gmail.com\"\n        },\n        \"operation\": \"getAll\",\n        \"returnAll\": true\n      },\n      \"credentials\": {\n        \"googleCalendarOAuth2Api\": {\n          \"id\": \"s95HsHIMB7oK0dAH\",\n          \"name\": \"Google Calendar account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0f5f43fa-3386-4682-b620-21db35651d3b\",\n      \"name\": \"Execute Workflow Trigger\",\n      \"type\": \"n8n-nodes-base.executeWorkflowTrigger\",\n      \"position\": [\n        460,\n        1120\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8b2b82b9-c11f-4e7f-ab23-16ea5e395e11\",\n      \"name\": \"Format response\",\n      \"type\": \"n8n-nodes-base.itemLists\",\n      \"position\": [\n        1560,\n        1120\n      ],\n      \"parameters\": {\n        \"include\": \"allFieldsExcept\",\n        \"options\": {},\n        \"aggregate\": \"aggregateAllItemData\",\n        \"operation\": \"concatenateItems\",\n        \"fieldsToExclude\": \"sort\",\n        \"destinationFieldName\": \"response\"\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"ac363d85-5c6e-4a9f-9cfc-ecc15a325b01\",\n      \"name\": \"Stringify Response\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1780,\n        1120\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"response\",\n              \"value\": \"={{ JSON.stringify($json.response) }}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"399c5bc4-c8bd-4d0b-942a-9889447880a9\",\n      \"name\": \"Extract start, end and name\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1100,\n        1120\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"start\",\n              \"value\": \"={{ DateTime.fromISO($json.start.dateTime).toLocaleString(DateTime.DATE_HUGE) }}, {{ DateTime.fromISO($json.start.dateTime).toLocaleString(DateTime.TIME_24_WITH_SHORT_OFFSET) }}\"\n            },\n            {\n              \"name\": \"end\",\n              \"value\": \"={{ DateTime.fromISO($json.end.dateTime).toLocaleString(DateTime.DATE_HUGE) }}, {{ DateTime.fromISO($json.end.dateTime).toLocaleString(DateTime.TIME_24_WITH_SHORT_OFFSET) }}\"\n            },\n            {\n              \"name\": \"name\",\n              \"value\": \"={{ $json.summary }}\"\n            },\n            {\n              \"name\": \"sort\",\n              \"value\": \"={{ $json.start.dateTime }}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"a39b6c7d-fdcc-452d-9ef5-50b038153330\",\n      \"name\": \"Filter only confirmed and with set time\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        880,\n        1120\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.status }}\",\n              \"value2\": \"confirmed\"\n            }\n          ],\n          \"boolean\": [\n            {\n              \"value1\": \"={{ $json.start.dateTime }}\",\n              \"value2\": \"={{ undefined }}\",\n              \"operation\": \"notEqual\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0e0a2be9-cde7-497d-94c5-180128382bb7\",\n      \"name\": \"Is appointment request\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1100,\n        560\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.is_appointment }}\",\n              \"value2\": \"true\"\n            }\n          ],\n          \"boolean\": [\n            {\n              \"value1\": \"={{ $json.is_appointment }}\",\n              \"value2\": true\n            }\n          ]\n        },\n        \"combineOperation\": \"any\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a6e11f63-a56a-4fe0-91c8-0dde2720e905\",\n      \"name\": \"Classify appointment\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        720,\n        560\n      ],\n      \"parameters\": {\n        \"prompt\": \"=Please evaluate the following email to determine if it suggests scheduling a meeting or a call:\\nSubject: {{ encodeURI($json.Subject) }}\\nSnippet: {{ encodeURI($json.snippet) }}\\nIndicate your assessment by responding with \\\"true\\\" if it suggests a meeting or call, or \\\"false\\\" otherwise. Use lowercase for your response.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b6411b14-67f6-4195-a834-60a4dc5e4851\",\n      \"name\": \"Structured Output Parser\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        880,\n        740\n      ],\n      \"parameters\": {\n        \"jsonSchema\": \"{\\n \\\"type\\\": \\\"object\\\",\\n \\\"properties\\\": {\\n \\\"is_appointment\\\": {\\n \\\"type\\\": \\\"boolean\\\"\\n }\\n }\\n}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"96248431-290b-4fb1-94a3-714e7c0008d4\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        640,\n        1058.6115582634225\n      ],\n      \"parameters\": {\n        \"width\": 810.4923211935056,\n        \"height\": 224.60561166142082,\n        \"content\": \"### Get all query google events for the next month and extract relevant data\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"48bc7c0c-0b74-418e-8c5c-6a6faf24722c\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1513,\n        1060\n      ],\n      \"parameters\": {\n        \"width\": 444.4130232558142,\n        \"height\": 220.42397542781927,\n        \"content\": \"### Wrap the result in `response` object and return \"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a68f7b27-1891-46c7-92b2-650cc17f94d6\",\n      \"name\": \"Sort\",\n      \"type\": \"n8n-nodes-base.itemLists\",\n      \"position\": [\n        1320,\n        1120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"operation\": \"sort\",\n        \"sortFieldsUi\": {\n          \"sortField\": [\n            {\n              \"fieldName\": \"sort\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"2b5b5855-6d3f-4405-9f48-5d6c4ee2475b\",\n      \"name\": \"Mark as read\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        1840,\n        739\n      ],\n      \"parameters\": {\n        \"messageId\": \"={{ $('Gmail Trigger').item.json.id }}\",\n        \"operation\": \"markAsRead\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"kLFedNEM8Zwkergv\",\n          \"name\": \"Gmail account\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"accbe2df-367a-4bd3-a383-12ee79062e12\",\n      \"name\": \"Send Reply\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        1840,\n        539\n      ],\n      \"parameters\": {\n        \"message\": \"={{ $json.output }}\",\n        \"options\": {\n          \"replyToSenderOnly\": true\n        },\n        \"messageId\": \"={{ $('Gmail Trigger').item.json.id }}\",\n        \"operation\": \"reply\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"kLFedNEM8Zwkergv\",\n          \"name\": \"Gmail account\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"66d62337-d0c1-4744-b169-8e95c1d1492a\",\n      \"name\": \"Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        1400,\n        539\n      ],\n      \"parameters\": {\n        \"text\": \"=Sender: {{ $('Gmail Trigger').item.json.From }}\\\\nSubject: {{ $('Gmail Trigger').item.json.Subject }}\\\\nEmail Text: {{ $('Gmail Trigger').item.json.snippet }}\",\n        \"options\": {\n          \"systemMessage\": \"=You are an email scheduling assistant. Based on the received email, check my availability and propose an appropriate response. \\nAim to get a specific time, rather than just a day. When checking my availability, make sure that there's enough time in between meetings.\\nIf I'm not available, ALWAYS propose a new time based on my availability. When proposing a new time, always leave 15 minutes buffer from previous meeting.\\nToday date and time is: {{ $now.toISO() }}.\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"0cf0768b-ddc0-42a3-9c84-f93d43c66dc7\",\n  \"connections\": {\n    \"Sort\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Format response\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Agent\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Reply\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Mark as read\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Chat OpenAI\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Classify appointment\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Chat OpenAI1\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gmail Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Classify appointment\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Workflow Tool\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Format response\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Stringify Response\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Calendar\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter only confirmed and with set time\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Classify appointment\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is appointment request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Is appointment request\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Execute Workflow Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Google Calendar\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Structured Output Parser\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Classify appointment\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract start, end and name\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Sort\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filter only confirmed and with set time\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract start, end and name\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.gmailTrigger",
      "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "@n8n/n8n-nodes-langchain.toolWorkflow",
      "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.googleCalendar",
      "n8n-nodes-base.executeWorkflowTrigger",
      "n8n-nodes-base.itemLists",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.filter",
      "n8n-nodes-base.if",
      "@n8n/n8n-nodes-langchain.chainLlm",
      "@n8n/n8n-nodes-langchain.outputParserStructured",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.itemLists",
      "n8n-nodes-base.gmail",
      "n8n-nodes-base.gmail",
      "@n8n/n8n-nodes-langchain.agent"
    ],
    "trigger": "gmail trigger"
  }
}