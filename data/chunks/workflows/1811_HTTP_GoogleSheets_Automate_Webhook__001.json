{
  "source": "1811_HTTP_GoogleSheets_Automate_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"bPxDenPJ5Ixx0txY\",\n  \"meta\": {\n    \"instanceId\": \"42d7f9cf04ccdfd3d3df5ffa87039b320845693c4b4e380cbb8cc2807641f810\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Line_Chatbot_Extract_Text_from_Pay_Slip_with_Gemini\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"83f758b4-a80b-4f27-ac13-ee0958ed97f2\",\n      \"name\": \"Window Buffer Memory\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        200,\n        320\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $json.body.events[0].source.userId }}\",\n        \"sessionIdType\": \"customKey\"\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"c41976eb-4a35-4c59-8167-538c651ad7e5\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -200,\n        520\n      ],\n      \"parameters\": {\n        \"width\": 620,\n        \"height\": 500,\n        \"content\": \"## Extract text from image\\n**Prompt for Gemini**\\nAnalyze image and then return in JSON Response that has the only following value: Status, From, To, Date, Amount\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c3eb2420-a503-4039-874c-df3c2799c561\",\n      \"name\": \"Line: Get Image\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -160,\n        660\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api-data.line.me/v2/bot/message/{{ $json.body.events[0].message.id }}/content \",\n        \"options\": {},\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"uFkmYj5e89iPyHcG\",\n          \"name\": \"Line Automate Task Header Auth account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"e39e5392-b287-4efe-a9a9-1f241e82cd92\",\n      \"name\": \"Message Type\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -620,\n        400\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"e9deec19-c171-4af5-bfb7-f0917ba658c5\",\n              \"name\": \"body.events[0].message.text\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.body.events[0].message.text }}\"\n            },\n            {\n              \"id\": \"ae9ee257-494f-4c65-a39d-4dc3505f2c01\",\n              \"name\": \"body.events[0].message.id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.body.events[0].message.id }}\"\n            },\n            {\n              \"id\": \"5e3dfc31-ed6e-4899-880d-ce73076e0cfd\",\n              \"name\": \"body.events[0].source.userId\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.body.events[0].source.userId }}\"\n            },\n            {\n              \"id\": \"8918e8d3-2a30-40df-b452-c07f340972cf\",\n              \"name\": \"body.events[0].message.type\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.body.events[0].message.type }}\"\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"a166e880-9291-4794-a6be-47f0a86e77e7\",\n      \"name\": \"Message Classification\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        -420,\n        400\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"7f862599-1eb2-4f76-910f-6caae33ea292\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $('Line: Messaging API').item.json.body.events[0].message.type }}\",\n                    \"rightValue\": \"text\"\n                  }\n                ]\n              }\n            },\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"0b661fab-e556-45ee-b845-67aff27fd862\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $('Line: Messaging API').item.json.body.events[0].message.type }}\",\n                    \"rightValue\": \"image\"\n                  }\n                ]\n              }\n            },\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"550e6e18-6b3e-4b08-8344-12bc76a1f736\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $('Line: Messaging API').item.json.body.events[0].message.stickerId }}\",\n                    \"rightValue\": \"=150\"\n                  }\n                ]\n              }\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"d7c29939-dd8e-43e9-89f2-879dc8ea318c\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        0,\n        0\n      ],\n      \"parameters\": {\n        \"width\": 420,\n        \"height\": 460,\n        \"content\": \"## Gemini AI Assistant\\n\\nAI Assistant using Gemini 2.0 Flash Experiment unlocks new possibilities for AI agents - intelligent systems that can use memory, reasoning, and planning to complete tasks for you.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0df36c5d-ec2a-492d-b688-4bad8d81cf38\",\n      \"name\": \"Text Message Processing\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        100,\n        140\n      ],\n      \"parameters\": {\n        \"text\": \"=This is the message from User: {{ $json.body.events[0].message.text }}\",\n        \"agent\": \"conversationalAgent\",\n        \"options\": {},\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.7\n    },\n    {\n      \"id\": \"dfafa5ba-a855-4ebf-a19d-2addb556e791\",\n      \"name\": \"Image Message Processing\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        100,\n        660\n      ],\n      \"parameters\": {\n        \"text\": \"Analyze image and then return in JSON Response that has the only following Value:\\nStatus, From, To, Date, Amount\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"message\": \"You are the image analyzer. You can analyze image and extract the important information from image.\"\n            },\n            {\n              \"type\": \"HumanMessagePromptTemplate\",\n              \"messageType\": \"imageBinary\"\n            }\n          ]\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.5\n    },\n    {\n      \"id\": \"b9a309bf-2c49-40e1-a0e4-9cced43d6e85\",\n      \"name\": \"Line: Response to User\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        580,\n        660\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.line.me/v2/bot/message/reply\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"replyToken\\\":\\\"{{ $('Line: Messaging API').item.json.body.events[0].replyToken }}\\\",\\n  \\\"messages\\\":[\\n    {\\n      \\\"type\\\":\\\"text\\\",\\n      \\\"text\\\": {{ JSON.stringify($json.text.replace(/^```(?:json|markdown)?\\\\n?/, \\\"\\\").replace(/\\\\n?```$/, \\\"\\\")) }}\\n    }\\n  ]\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"uFkmYj5e89iPyHcG\",\n          \"name\": \"Line Automate Task Header Auth account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"ff5561fa-b334-4639-a513-554ee3507ab0\",\n      \"name\": \"Line: Text Response to User\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        580,\n        140\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.line.me/v2/bot/message/reply\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"replyToken\\\":\\\"{{ $('Line: Messaging API').item.json.body.events[0].replyToken }}\\\",\\n  \\\"messages\\\":[\\n    {\\n      \\\"type\\\":\\\"text\\\",\\n      \\\"text\\\": {{ JSON.stringify($json.output) }}\\n    }\\n  ]\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"uFkmYj5e89iPyHcG\",\n          \"name\": \"Line Automate Task Header Auth account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"850f1079-cecf-4680-835f-34af829ee8f5\",\n      \"name\": \"Text from Slip Result\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        1020,\n        660\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"To\": \"={{ JSON.parse($('Image Message Processing').item.json.text.replace(/^```(?:json|markdown)?\\\\n?/, \\\"\\\").replace(/\\\\n?```$/, \\\"\\\")).To }}\",\n            \"Date\": \"={{ JSON.parse($('Image Message Processing').item.json.text.replace(/^```(?:json|markdown)?\\\\n?/, \\\"\\\").replace(/\\\\n?```$/, \\\"\\\")).Date }}\",\n            \"From\": \"={{ JSON.parse($('Image Message Processing').item.json.text.replace(/^```(?:json|markdown)?\\\\n?/, \\\"\\\").replace(/\\\\n?```$/, \\\"\\\")).From}}\",\n            \"Amount\": \"={{ JSON.parse($('Image Message Processing').item.json.text.replace(/^```(?:json|markdown)?\\\\n?/, \\\"\\\").replace(/\\\\n?```$/, \\\"\\\")).Amount }}\",\n            \"Status\": \"={{ JSON.parse($('Image Message Processing').item.json.text.replace(/^```(?:json|markdown)?\\\\n?/, \\\"\\\").replace(/\\\\n?```$/, \\\"\\\")).Status }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"Status\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Status\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"From\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"From\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"To\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"To\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Date\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Date\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Amount\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Amount\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"Status\"\n          ],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {},\n        \"operation\": \"append\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1PUXj_t3G-arnfzNDbY0g9Pr1G4YMGrc68fDs98pV-n4/edit#gid=0\",\n          \"cachedResultName\": \"Sheet1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"url\",\n          \"value\": \"https://docs.google.com/spreadsheets/d/1PUXj_t3G-arnfzNDbY0g9Pr1G4YMGrc68fDs98pV-n4/edit?gid=0#gid=0\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"tENCv7liPQDhRoqL\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"a268daa7-76d9-437b-99e9-bd755eb4d36f\",\n      \"name\": \"Line: Messaging API\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        -820,\n        400\n      ],\n      \"webhookId\": \"4c0de537-2889-47d2-ac44-3a9cda89c9f3\",\n      \"parameters\": {\n        \"path\": \"4c0de537-2889-47d2-ac44-3a9cda89c9f3\",\n        \"options\": {},\n        \"httpMethod\": \"POST\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"b3c4c66a-78d6-4ad5-9a5c-afef6f86e5cc\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        460,\n        0\n      ],\n      \"parameters\": {\n        \"width\": 420,\n        \"height\": 1020,\n        \"content\": \"## Reply to User\\n\\nReply the processing result to the user without coding or OCR processing.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6c76dc81-6c10-4522-9d5f-da4579391281\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        900,\n        520\n      ],\n      \"parameters\": {\n        \"width\": 420,\n        \"height\": 500,\n        \"content\": \"## Insert result to Google Sheet\\nGet all important information from the Pay Slip and insert into Google Sheet in the same format that we have provided in our prompt.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"49bac770-adb1-4ef3-8bf9-c8cf107471ad\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -860,\n        260\n      ],\n      \"parameters\": {\n        \"width\": 620,\n        \"height\": 500,\n        \"content\": \"## Get Line Message from User\\nUser can send message in both text and Pay Slip image then classify the message type in text or image so we could have single workflow for AI Assistant that support anything.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9f034b6f-bb5b-4dc6-941d-b745f15da254\",\n      \"name\": \"Google Gemini for Text\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        60,\n        320\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-2.0-flash-exp\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"Gqc4JMC0dFmMRP7Z\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"15fa3203-9230-4a1d-9e0d-87652cb9d9ab\",\n      \"name\": \"Google Gemini for Image\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        60,\n        880\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-2.0-flash-exp\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"Gqc4JMC0dFmMRP7Z\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": true,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"d14ef869-77c2-49a8-9867-1775d8f0b085\",\n  \"connections\": {\n    \"Message Type\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Message Classification\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Line: Get Image\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Image Message Processing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Line: Messaging API\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Message Type\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Window Buffer Memory\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Text Message Processing\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Gemini for Text\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Text Message Processing\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Line: Response to User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Text from Slip Result\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Message Classification\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Text Message Processing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Line: Get Image\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        []\n      ]\n    },\n    \"Google Gemini for Image\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Image Message Processing\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Text Message Processing\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Line: Text Response to User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Image Message Processing\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Line: Response to User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.set",
      "n8n-nodes-base.switch",
      "n8n-nodes-base.stickyNote",
      "@n8n/n8n-nodes-langchain.agent",
      "@n8n/n8n-nodes-langchain.chainLlm",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "@n8n/n8n-nodes-langchain.lmChatGoogleGemini"
    ],
    "trigger": null
  }
}