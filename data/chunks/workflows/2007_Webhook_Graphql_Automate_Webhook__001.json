{
  "source": "2007_Webhook_Graphql_Automate_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"x2VUvhqV1YTJCIN0\",\n  \"meta\": {\n    \"instanceId\": \"e2c978396c9c745cf0aaa9ed3abe4464dbcef93c5fe2df809b9e14440e628df6\"\n  },\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"094b9011-a53d-4a50-b44d-ad229612bb06\",\n      \"name\": \"No Operation, do nothing\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        560,\n        220\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6d9eee1f-995f-4558-8f97-25636e20022c\",\n      \"name\": \"Save campaign.liquid\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        800,\n        -100\n      ],\n      \"parameters\": {\n        \"url\": \"=https://{{ $('Set values here!').params[\\\"fields\\\"][\\\"values\\\"][0][\\\"stringValue\\\"] }}.myshopify.com/admin/api/2024-01/themes/{{ $('Set values here!').params[\\\"fields\\\"][\\\"values\\\"][1][\\\"stringValue\\\"] }}/assets.json\",\n        \"method\": \"PUT\",\n        \"options\": {},\n        \"jsonBody\": \"={\\\"asset\\\":\\n  {\\n    \\\"key\\\":\\\"snippets/{{ $('Set values here!').params[\\\"fields\\\"][\\\"values\\\"][2][\\\"stringValue\\\"] }}\\\",\\n    \\\"value\\\":\\\"{{ $('Set values here!').params[\\\"fields\\\"][\\\"values\\\"][3][\\\"stringValue\\\"].replace(\\\"IMAGE\\\",$('Check').item.json[\\\"body\\\"][\\\"items\\\"][0][\\\"Campaign Image\\\"][0][\\\"visible_name\\\"]).replace(/\\\\\\\\/g, \\\"\\\\\\\\\\\\\\\\\\\").replace(/\\\"/g, '\\\\\\\\\\\"').replace(/\\\\n/g, \\\"\\\\\\\\n\\\") }}\\\"}}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"Z98cM8akgh1jPtG7\",\n          \"name\": \"Header Auth  Shopify\"\n        },\n        \"shopifyAccessTokenApi\": {\n          \"id\": \"WbxXaLMHozAgY3Rz\",\n          \"name\": \"Shopify Access Token account\"\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"fb3e9410-59ae-4d90-8bb3-1fd95f0e9a43\",\n      \"name\": \"Upload Image\",\n      \"type\": \"n8n-nodes-base.graphql\",\n      \"position\": [\n        560,\n        -100\n      ],\n      \"parameters\": {\n        \"query\": \"mutation fileCreate($files: [FileCreateInput!]!) {\\n  fileCreate(files: $files) {\\n    files {\\n      id\\n    }\\n  }\\n}\",\n        \"endpoint\": \"=https://{{ $('Set values here!').params[\\\"fields\\\"][\\\"values\\\"][0][\\\"stringValue\\\"] }}.myshopify.com/admin/api/2024-01/graphql.json\",\n        \"variables\": \"={\\n  \\\"files\\\": {\\n    \\\"alt\\\": \\\"{{ $json.body.items[0].Name }}\\\",\\n    \\\"contentType\\\": \\\"IMAGE\\\",\\n\\t\\\"filename\\\": \\\"{{ $json.body.items[0]['Campaign Image'][0].visible_name }}\\\",\\n    \\\"originalSource\\\": \\\"{{ $json.body.items[0]['Campaign Image'][0].url }}\\\"\\n  }\\n}\",\n        \"requestFormat\": \"json\",\n        \"authentication\": \"headerAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"Z98cM8akgh1jPtG7\",\n          \"name\": \"Header Auth  Shopify\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"29f970fe-da65-4b6f-bf0b-1cadbd80f51c\",\n      \"name\": \"Set values here!\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        120,\n        60\n      ],\n      \"parameters\": {\n        \"fields\": {\n          \"values\": [\n            {\n              \"name\": \"Shopify Subdomain\",\n              \"stringValue\": \"n8n-mautic-demo\"\n            },\n            {\n              \"name\": \"Theme ID\",\n              \"stringValue\": \"125514514534\"\n            },\n            {\n              \"name\": \"Filename\",\n              \"stringValue\": \"campaign.liquid\"\n            },\n            {\n              \"name\": \"Content\",\n              \"stringValue\": \"<img src=\\\"{{ 'IMAGE' | file_img_url: 'grande'}}\\\">\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"0bd9327d-4bbd-4884-a9a6-21b0c5b4c3d3\",\n      \"name\": \"Call from Baserow\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        -100,\n        60\n      ],\n      \"webhookId\": \"3041fdd6-4cb5-4286-9034-1337dddc3f45\",\n      \"parameters\": {\n        \"path\": \"3041fdd6-4cb5-4286-9034-1337dddc3f45\",\n        \"options\": {},\n        \"httpMethod\": \"POST\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"6c9d35e8-0738-4d15-a0ff-40077e73d797\",\n      \"name\": \"Check\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        320,\n        60\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"21262344-6519-4f32-876b-82722a1fab66\",\n              \"operator\": {\n                \"type\": \"number\",\n                \"operation\": \"gt\"\n              },\n              \"leftValue\": \"={{\\nDateTime.fromISO($json[\\\"body\\\"][\\\"items\\\"][0][\\\"Last modified\\\"])\\n    .diff(DateTime.fromISO($json[\\\"body\\\"][\\\"old_items\\\"][0][\\\"Last modified\\\"]),'minutes')\\n    .toObject()\\n    [\\\"minutes\\\"]\\n}}\",\n              \"rightValue\": 0.1\n            },\n            {\n              \"id\": \"5c0a176c-5ba9-4060-a4d2-b9207cf47092\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.body.items[0].Active }}\",\n              \"rightValue\": \"\"\n            },\n            {\n              \"id\": \"f764adc6-e7a1-4df7-861f-94b90a99f2d4\",\n              \"operator\": {\n                \"type\": \"array\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json[\\\"body\\\"][\\\"items\\\"][0][\\\"Campaign Image\\\"] }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"f6c17549-4192-4f96-ad81-518c52bdcda7\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -540,\n        -40\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 360.408084305475,\n        \"height\": 315.5897364788551,\n        \"content\": \"## Shopify API\\n\\nThis workflow uses GraphQL calls to the Shopify Admin API. In order to get a better understanding for the queries and mutations please check the API Docs.\\n\\n\\n[Shopify GraphQL API docs](https://shopify.dev/docs/api/admin-graphql)\\n\\nTo make it easy to build queries for the GraphQL API easy please check out the [GraphiQL App for the Admin API](https://shopify.dev/docs/apps/tools/graphiql-admin-api) from Shopify\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"22743217-0c89-4fd1-b22d-0e00d6ca6854\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        560,\n        -300\n      ],\n      \"parameters\": {\n        \"width\": 331.1188177339898,\n        \"content\": \"## Shopify \\nThe n8n Shopify node cannot upload images or theme assets so we need to make custom calls to the GraphQL and REST Api \"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ca9561aa-85e8-47ad-8bac-60fc3a94f94e\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        80,\n        -160\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 158.16682590559316,\n        \"content\": \"## Set values \\nPlease edit this node and change the values for your own setup.\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": true,\n  \"pinData\": {\n    \"Call from Baserow\": [\n      {\n        \"json\": {\n          \"body\": {\n            \"items\": [\n              {\n                \"id\": 1,\n                \"Name\": \"Campaigna\",\n                \"order\": \"1.00000000000000000000\",\n                \"Active\": true,\n                \"Last modified\": \"2024-03-01T11:21:58.157987Z\",\n                \"Campaign Image\": [\n                  {\n                    \"url\": \"https://br.m3tam3re.com/media/user_files/O5jM7aSUTYSBPQtxVHktkN4U7wlUoIJd_1af752d7847a230a853df92814639be35035229f2bb857b4ea870b64011cdde0.webp\",\n                    \"name\": \"O5jM7aSUTYSBPQtxVHktkN4U7wlUoIJd_1af752d7847a230a853df92814639be35035229f2bb857b4ea870b64011cdde0.webp\",\n                    \"size\": 107358,\n                    \"is_image\": true,\n                    \"mime_type\": \"\",\n                    \"thumbnails\": {\n                      \"tiny\": {\n                        \"url\": \"https://br.m3tam3re.com/media/thumbnails/tiny/O5jM7aSUTYSBPQtxVHktkN4U7wlUoIJd_1af752d7847a230a853df92814639be35035229f2bb857b4ea870b64011cdde0.webp\",\n                        \"width\": null,\n                        \"height\": 21\n                      },\n                      \"small\": {\n                        \"url\": \"https://br.m3tam3re.com/media/thumbnails/small/O5jM7aSUTYSBPQtxVHktkN4U7wlUoIJd_1af752d7847a230a853df92814639be35035229f2bb857b4ea870b64011cdde0.webp\",\n                        \"width\": 48,\n                        \"height\": 48\n                      },\n                      \"card_cover\": {\n                        \"url\": \"https://br.m3tam3re.com/media/thumbnails/card_cover/O5jM7aSUTYSBPQtxVHktkN4U7wlUoIJd_1af752d7847a230a853df92814639be35035229f2bb857b4ea870b64011cdde0.webp\",\n                        \"width\": 300,\n                        \"height\": 160\n                      }\n                    },\n                    \"image_width\": 1280,\n                    \"uploaded_at\": \"2024-03-01T09:50:41.921452+00:00\",\n                    \"image_height\": 720,\n                    \"visible_name\": \"n8n-portainer.webp\"\n                  }\n                ]\n              }\n            ],\n            \"event_id\": \"dae85cec-94ce-4e6c-8091-fce28bdc4c6c\",\n            \"table_id\": 596,\n            \"old_items\": [\n              {\n                \"id\": 1,\n                \"Name\": \"Campaignas\",\n                \"order\": \"1.00000000000000000000\",\n                \"Active\": true,\n                \"Last modified\": \"2024-03-01T11:21:16.099694Z\",\n                \"Campaign Image\": [\n                  {\n                    \"url\": \"https://br.m3tam3re.com/media/user_files/O5jM7aSUTYSBPQtxVHktkN4U7wlUoIJd_1af752d7847a230a853df92814639be35035229f2bb857b4ea870b64011cdde0.webp\",\n                    \"name\": \"O5jM7aSUTYSBPQtxVHktkN4U7wlUoIJd_1af752d7847a230a853df92814639be35035229f2bb857b4ea870b64011cdde0.webp\",\n                    \"size\": 107358,\n                    \"is_image\": true,\n                    \"mime_type\": \"\",\n                    \"thumbnails\": {\n                      \"tiny\": {\n                        \"url\": \"https://br.m3tam3re.com/media/thumbnails/tiny/O5jM7aSUTYSBPQtxVHktkN4U7wlUoIJd_1af752d7847a230a853df92814639be35035229f2bb857b4ea870b64011cdde0.webp\",\n                        \"width\": null,\n                        \"height\": 21\n                      },\n                      \"small\": {\n                        \"url\": \"https://br.m3tam3re.com/media/thumbnails/small/O5jM7aSUTYSBPQtxVHktkN4U7wlUoIJd_1af752d7847a230a853df92814639be35035229f2bb857b4ea870b64011cdde0.webp\",\n                        \"width\": 48,\n                        \"height\": 48\n                      },\n                      \"card_cover\": {\n                        \"url\": \"https://br.m3tam3re.com/media/thumbnails/card_cover/O5jM7aSUTYSBPQtxVHktkN4U7wlUoIJd_1af752d7847a230a853df92814639be35035229f2bb857b4ea870b64011cdde0.webp\",\n                        \"width\": 300,\n                        \"height\": 160\n                      }\n                    },\n                    \"image_width\": 1280,\n                    \"uploaded_at\": \"2024-03-01T09:50:41.921452+00:00\",\n                    \"image_height\": 720,\n                    \"visible_name\": \"n8n-portainer.webp\"\n                  }\n                ]\n              }\n            ],\n            \"event_type\": \"rows.updated\",\n            \"database_id\": 112,\n            \"workspace_id\": 108\n          },\n          \"query\": {},\n          \"params\": {},\n          \"headers\": {\n            \"host\": \"n8n.m3tam3re.com\",\n            \"accept\": \"*/*\",\n            \"user-agent\": \"python-requests/2.31.0\",\n            \"content-type\": \"application/json\",\n            \"content-length\": \"2617\",\n            \"accept-encoding\": \"gzip, deflate, br\",\n            \"x-baserow-event\": \"rows.updated\",\n            \"x-forwarded-for\": \"202.61.226.110\",\n            \"x-forwarded-host\": \"n8n.m3tam3re.com\",\n            \"x-forwarded-proto\": \"https\",\n            \"x-baserow-delivery\": \"dae85cec-94ce-4e6c-8091-fce28bdc4c6c\"\n          }\n        }\n      }\n    ]\n  },\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"c82b43c0-aa47-4086-b7ae-588ee12e5e24\",\n  \"connections\": {\n    \"Check\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload Image\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"No Operation, do nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Upload Image\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Save campaign.liquid\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set values here!\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Call from Baserow\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set values here!\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.noOp",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.graphql",
      "n8n-nodes-base.set",
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.if",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}