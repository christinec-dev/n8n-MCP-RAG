{
  "source": "1757_Splitout_Code_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"XGFs5jZNCeURd4OT\",\n  \"meta\": {\n    \"instanceId\": \"c5e9c1178f3b42f080c51c81bcfa62e1fbd48abf38103a7a4cd8e15abc64df08\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Publish Image Post to Bluesky\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"afd666fc-8f79-488d-a295-4bfdd6883924\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        35,\n        260\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d31bfe18-5acc-4f72-80d0-d85111dd62cc\",\n      \"name\": \"Create Bluesky Session\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        435,\n        260\n      ],\n      \"parameters\": {\n        \"url\": \"https://bsky.social/xrpc/com.atproto.server.createSession\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={{ $('Define Credentials').item.json.credentials }}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\"\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"514ac077-3c96-41f0-b178-afefe2f9faae\",\n      \"name\": \"Download Images\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1260,\n        260\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $json.url }}\",\n        \"options\": {}\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"67e77e91-3a53-44c3-a474-2cd3b4977cf2\",\n      \"name\": \"Code\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1580,\n        260\n      ],\n      \"parameters\": {\n        \"jsCode\": \"return $input.all().map( item => ({\\n    alt: \\\"-\\\",\\n    image: {\\n      ...item.json.blob\\n    }\\n}));\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"b8540b04-afe8-4455-8fec-fcab5ffff1ae\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        640,\n        102.39520958083813\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 391.0892880786254,\n        \"height\": 335.5179928232044,\n        \"content\": \"## Define Your Post Caption Here\\nYou can set\\n* the text caption of your post (max 300 characters)\\n* image URLs (max of 4 images at 1MB each)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2a6e60ef-4042-4648-85bb-143d226aa736\",\n      \"name\": \"Split Out\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        1100,\n        260\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"photos\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5c3a6c2f-7b60-4448-9d85-4174e9f5f770\",\n      \"name\": \"Post to Bluesky\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1940,\n        260\n      ],\n      \"parameters\": {\n        \"url\": \"https://bsky.social/xrpc/com.atproto.repo.createRecord\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"repo\\\": \\\"{{ $('Create Bluesky Session').item.json.did }}\\\",\\n  \\\"collection\\\": \\\"app.bsky.feed.post\\\",\\n  \\\"record\\\": {\\n      \\\"$type\\\": \\\"app.bsky.feed.post\\\",\\n      \\\"text\\\": \\\"{{ $('Set Caption').item.json['Post Text'].trim()}}\\\",\\n      \\\"createdAt\\\": \\\"{{ $now }}\\\",\\n\\\"embed\\\": {\\n\\\"$type\\\": \\\"app.bsky.embed.images\\\",\\n\\\"images\\\":{{ $('Aggregate').item.json.data.toJsonString() }}\\n}\\n  }\\n}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Authorization\",\n              \"value\": \"=Bearer {{ $('Create Bluesky Session').item.json.accessJwt }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"266ef5cb-18df-45b0-b5c4-59782e571d40\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        180,\n        -2.994011976047659\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 418.7983637184758,\n        \"height\": 440.36620487216396,\n        \"content\": \"## Set Bluesky Credentials\\nYou'll need to set 2 values...\\n1. _Identifier_ \\nThis is your Bluesky username, e.g. \\\"username.bsky.social\\\"\\n2. _App Password_\\nThis is _not_ your sign-in password, but something created in [your Bluesky account](https://bsky.app/settings/app-passwords)\\n\\n\\nA Bluesky session is then opened for image uploading and posting.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3a7fc037-02f6-4091-bcdc-5b22d43269ef\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1063.9520958083824,\n        160\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 814.7806424732389,\n        \"height\": 269.1258097879526,\n        \"content\": \"### Handling image attachments\\nBluesky doesn't attach images directly to the post, they're first individually uploaded [then embedded in the post](https://docs.bsky.app/docs/tutorials/creating-a-post#images-embeds).\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"aa7796b3-9cc7-4219-85af-a9ae3613f891\",\n      \"name\": \"Define Credentials\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        235,\n        260\n      ],\n      \"parameters\": {\n        \"mode\": \"raw\",\n        \"options\": {},\n        \"jsonOutput\": \"{\\\"credentials\\\":\\n  {\\n    \\\"identifier\\\": \\\"username.bsky.social\\\",\\n    \\\"password\\\": \\\"XXXX-YYYY-ZZZZ-XXXX\\\"\\n  }\\n}\"\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"4bcf77ef-b40e-485e-b444-659f77cf9d69\",\n      \"name\": \"Aggregate\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        1740,\n        260\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"aggregate\": \"aggregateAllItemData\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"eb2730e5-cad7-47f0-96d2-f2ae1dee6dd5\",\n      \"name\": \"Set Images\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        880,\n        260\n      ],\n      \"parameters\": {\n        \"mode\": \"raw\",\n        \"options\": {},\n        \"jsonOutput\": \"{  \\\"photos\\\":[\\n    {\\n      \\\"url\\\":\\\"https://picsum.photos/800/600?random=234234\\\"\\n    },\\n    {\\n      \\\"url\\\":\\\"https://picsum.photos/800/600?random=676855\\\"\\n    },\\n    {\\n      \\\"url\\\":\\\"https://picsum.photos/800/600?random=4564\\\"\\n    },\\n    {\\n      \\\"url\\\":\\\"https://picsum.photos/800/600?random=12124\\\"\\n    }\\n  ]}\"\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"0d3a030e-1ac6-420d-a850-d267928f4072\",\n      \"name\": \"Post Image to Bluesky\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1420,\n        260\n      ],\n      \"parameters\": {\n        \"url\": \"https://bsky.social/xrpc/com.atproto.repo.uploadBlob\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"contentType\": \"binaryData\",\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Authorization\",\n              \"value\": \"=Bearer {{ $('Create Bluesky Session').item.json.accessJwt }}\"\n            }\n          ]\n        },\n        \"inputDataFieldName\": \"data\"\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"31124777-ee35-4ceb-b0e7-75f7cef4b481\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        680,\n        -260\n      ],\n      \"parameters\": {\n        \"width\": 880.0000000000002,\n        \"height\": 207.9041916167665,\n        \"content\": \"# Create a new post with images on Bluesky\\nThis workflow will \\n1. retrieve images from URLs you specify\\n2. upload them 1 by 1 as blobs to BlueSky\\n3. let you specify the basic text of a post\\n3. use your Bluesky credentials to post to your feed\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f8e54515-c9ec-474d-aa2b-fe357cbd4775\",\n      \"name\": \"Set Caption\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        688,\n        260\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"6135981d-82d9-47bb-9eb5-ce9a4220f108\",\n              \"name\": \"Caption Text\",\n              \"type\": \"string\",\n              \"value\": \"Here is the amazing content of my post, max of 300 characters!\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"86d8df08-3f73-40a5-9c5b-d2ebda3f3b13\",\n  \"connections\": {\n    \"Code\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Aggregate\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Aggregate\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Post to Bluesky\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Out\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Download Images\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Images\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Out\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Caption\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Images\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Download Images\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Post Image to Bluesky\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Define Credentials\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Bluesky Session\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Post Image to Bluesky\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Code\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Bluesky Session\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Caption\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Define Credentials\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.code",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set",
      "n8n-nodes-base.aggregate",
      "n8n-nodes-base.set",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set"
    ],
    "trigger": null
  }
}