{
  "source": "0286_Zendesk_HubSpot_Create_Scheduled.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"237600ca44303ce91fa31ee72babcdc8493f55ee2c0e8aa2b78b3b4ce6f70bd9\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"dcd5f025-9af9-4e3a-96fc-25a33dcc6c00\",\n      \"name\": \"Ticket Exists\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        900,\n        320\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json[\\\"external_id\\\"] }}\",\n              \"operation\": \"isNotEmpty\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a5e8ec4d-bc80-4153-a677-91be2e7d02b7\",\n      \"name\": \"Get user data of Ticket requester\",\n      \"type\": \"n8n-nodes-base.zendesk\",\n      \"position\": [\n        220,\n        480\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $json[\\\"requester_id\\\"] }}\",\n        \"resource\": \"user\",\n        \"operation\": \"get\"\n      },\n      \"credentials\": {\n        \"zendeskApi\": {\n          \"id\": \"5\",\n          \"name\": \"Zendesk account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6dc07af8-d446-4704-9a08-e65f89772a9b\",\n      \"name\": \"Only keep needed data\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        440,\n        480\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"number\": [\n            {\n              \"name\": \"id\",\n              \"value\": \"={{ $json[\\\"id\\\"] }}\"\n            },\n            {\n              \"name\": \"contactExternalId\",\n              \"value\": \"={{ $json[\\\"external_id\\\"] }}\"\n            }\n          ],\n          \"string\": [\n            {\n              \"name\": \"contactEmail\",\n              \"value\": \"={{ $json[\\\"email\\\"] }}\"\n            },\n            {\n              \"name\": \"contactName\",\n              \"value\": \"={{ $json[\\\"name\\\"] }}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c3ca22e4-ae76-49ee-b117-f6da9d90ec1a\",\n      \"name\": \"Add user data\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        640,\n        320\n      ],\n      \"parameters\": {\n        \"mode\": \"mergeByKey\",\n        \"propertyName1\": \"requester_id\",\n        \"propertyName2\": \"id\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"713b919a-3a39-4466-b9b8-cc3575f02e45\",\n      \"name\": \"Update existing ticket\",\n      \"type\": \"n8n-nodes-base.hubspot\",\n      \"position\": [\n        1280,\n        300\n      ],\n      \"parameters\": {\n        \"resource\": \"ticket\",\n        \"ticketId\": \"={{ $json[\\\"external_id\\\"] }}\",\n        \"operation\": \"update\",\n        \"updateFields\": {\n          \"ticketName\": \"={{ $json[\\\"raw_subject\\\"] }}\",\n          \"description\": \"={{ $json[\\\"description\\\"] }}\"\n        },\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"hubspotOAuth2Api\": {\n          \"id\": \"21\",\n          \"name\": \"HubSpot account\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"continueOnFail\": true\n    },\n    {\n      \"id\": \"1eb40a93-2d36-4b3e-a39d-f19f369adc4e\",\n      \"name\": \"Update Zendesk ticket with External Id\",\n      \"type\": \"n8n-nodes-base.zendesk\",\n      \"position\": [\n        2020,\n        480\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $node[\\\"Contact Exists\\\"].json[\\\"id\\\"] }}\",\n        \"operation\": \"update\",\n        \"updateFields\": {\n          \"externalId\": \"={{ $json[\\\"objectId\\\"] }}\"\n        }\n      },\n      \"credentials\": {\n        \"zendeskApi\": {\n          \"id\": \"5\",\n          \"name\": \"Zendesk account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a11c8809-c22f-40f5-a019-79274eba4d70\",\n      \"name\": \"Get last execution timestamp\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        -260,\n        300\n      ],\n      \"parameters\": {\n        \"functionCode\": \"// Code here will run once per input item.\\n// More info and help: https://docs.n8n.io/nodes/n8n-nodes-base.functionItem\\n// Tip: You can use luxon for dates and $jmespath for querying JSON structures\\n\\n// Add a new field called 'myNewField' to the JSON of the item\\nconst staticData = getWorkflowStaticData('global');\\n\\nif(!staticData.lastExecution){\\n  staticData.lastExecution = new Date().toISOString();\\n}\\n\\nitem.executionTimeStamp = new Date().toISOString();\\nitem.lastExecution = staticData.lastExecution;\\n\\n\\nreturn item;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a62685c9-f786-4e7c-9e2d-cdcb1e0a3aea\",\n      \"name\": \"Get tickets updated after last execution\",\n      \"type\": \"n8n-nodes-base.zendesk\",\n      \"position\": [\n        -40,\n        300\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"query\": \"=updated>{{ $json[\\\"lastExecution\\\"] }}\",\n          \"sortBy\": \"updated_at\",\n          \"sortOrder\": \"desc\"\n        },\n        \"operation\": \"getAll\"\n      },\n      \"credentials\": {\n        \"zendeskApi\": {\n          \"id\": \"5\",\n          \"name\": \"Zendesk account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c1b23aa8-a9f6-4966-b1dc-fe48c203364c\",\n      \"name\": \"Set new last execution timestamp\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        2360,\n        300\n      ],\n      \"parameters\": {\n        \"functionCode\": \"// Code here will run once per input item.\\n// More info and help: https://docs.n8n.io/nodes/n8n-nodes-base.functionItem\\n// Tip: You can use luxon for dates and $jmespath for querying JSON structures\\n\\n// Add a new field called 'myNewField' to the JSON of the item\\nconst staticData = getWorkflowStaticData('global');\\n\\nstaticData.lastExecution = $item(0).$node[\\\"Get last execution timestamp\\\"].executionTimeStamp;\\n\\nreturn item;\"\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"97ae70de-bce8-4861-a256-17002625da58\",\n      \"name\": \"Every 5 minutes\",\n      \"type\": \"n8n-nodes-base.cron\",\n      \"position\": [\n        -460,\n        300\n      ],\n      \"parameters\": {\n        \"triggerTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyX\",\n              \"unit\": \"minutes\",\n              \"value\": 5\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1d2dd552-175c-4405-b304-d4136dd2968b\",\n      \"name\": \"Create new Ticket\",\n      \"type\": \"n8n-nodes-base.hubspot\",\n      \"position\": [\n        1780,\n        480\n      ],\n      \"parameters\": {\n        \"stageId\": \"1\",\n        \"resource\": \"ticket\",\n        \"pipelineId\": \"0\",\n        \"ticketName\": \"={{ $node['Ticket Exists'].json[\\\"raw_subject\\\"] }}\",\n        \"authentication\": \"oAuth2\",\n        \"additionalFields\": {\n          \"description\": \"={{ $node['Ticket Exists'].json[\\\"description\\\"] }}\",\n          \"associatedContactIds\": \"={{ [].concat($node[\\\"Create or update contact\\\"].json[\\\"vid\\\"]) }}\"\n        }\n      },\n      \"credentials\": {\n        \"hubspotOAuth2Api\": {\n          \"id\": \"21\",\n          \"name\": \"HubSpot account\"\n        }\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e2217f74-f1b2-4449-9937-543758a333ea\",\n      \"name\": \"Update External Id in Zendesk for contact\",\n      \"type\": \"n8n-nodes-base.zendesk\",\n      \"position\": [\n        1520,\n        480\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $node[\\\"Ticket Exists\\\"].json[\\\"requester_id\\\"] }}\",\n        \"resource\": \"user\",\n        \"operation\": \"update\",\n        \"updateFields\": {\n          \"external_id\": \"={{ $json[\\\"vid\\\"] }}\"\n        }\n      },\n      \"credentials\": {\n        \"zendeskApi\": {\n          \"id\": \"5\",\n          \"name\": \"Zendesk account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"144a3395-9f61-4aad-99e0-4a689145f93d\",\n      \"name\": \"Create or update contact\",\n      \"type\": \"n8n-nodes-base.hubspot\",\n      \"position\": [\n        1280,\n        480\n      ],\n      \"parameters\": {\n        \"email\": \"={{ $json[\\\"contactEmail\\\"] }}\",\n        \"resource\": \"contact\",\n        \"authentication\": \"oAuth2\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"hubspotOAuth2Api\": {\n          \"id\": \"21\",\n          \"name\": \"HubSpot account\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Add user data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Ticket Exists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Ticket Exists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update existing ticket\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Create or update contact\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Every 5 minutes\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get last execution timestamp\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create new Ticket\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Zendesk ticket with External Id\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Only keep needed data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add user data\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Update existing ticket\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set new last execution timestamp\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create or update contact\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update External Id in Zendesk for contact\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get last execution timestamp\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get tickets updated after last execution\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get user data of Ticket requester\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Only keep needed data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update Zendesk ticket with External Id\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set new last execution timestamp\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get tickets updated after last execution\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get user data of Ticket requester\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Add user data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update External Id in Zendesk for contact\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create new Ticket\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.if",
      "n8n-nodes-base.zendesk",
      "n8n-nodes-base.set",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.hubspot",
      "n8n-nodes-base.zendesk",
      "n8n-nodes-base.functionItem",
      "n8n-nodes-base.zendesk",
      "n8n-nodes-base.functionItem",
      "n8n-nodes-base.cron",
      "n8n-nodes-base.hubspot",
      "n8n-nodes-base.zendesk",
      "n8n-nodes-base.hubspot"
    ],
    "trigger": null
  }
}