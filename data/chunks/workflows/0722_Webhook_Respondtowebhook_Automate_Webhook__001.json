{
  "source": "0722_Webhook_Respondtowebhook_Automate_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"a4bfc93e975ca233ac45ed7c9227d84cf5a2329310525917adaf3312e10d5462\"\n  },\n  \"name\": \"Automate Drive-To-Store Lead Generation System (with coupon) on SuiteCRM\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"53342c2a-f707-4ed0-9054-7928e6832745\",\n      \"name\": \"Token SuiteCRM\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1560,\n        920\n      ],\n      \"parameters\": {\n        \"url\": \"=https://SUITECRMURL/Api/access_token\",\n        \"options\": {},\n        \"requestMethod\": \"POST\",\n        \"bodyParametersUi\": {\n          \"parameter\": [\n            {\n              \"name\": \"grant_type\",\n              \"value\": \"client_credentials\"\n            },\n            {\n              \"name\": \"client_id\",\n              \"value\": \"CLIENTID\"\n            },\n            {\n              \"name\": \"client_secret\",\n              \"value\": \"CLIENTSECRET\"\n            }\n          ]\n        },\n        \"allowUnauthorizedCerts\": true\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"18d04094-1ced-4431-9ba2-b9b33d76c453\",\n      \"name\": \"Create Lead SuiteCRM\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1800,\n        920\n      ],\n      \"parameters\": {\n        \"url\": \"https://SUITECRMURL/Api/V8/module\",\n        \"method\": \"POST\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"responseFormat\": \"json\"\n            }\n          }\n        },\n        \"jsonBody\": \"={\\\"data\\\": \\n  {\\n  \\\"type\\\": \\\"Leads\\\",\\n  \\\"attributes\\\": { \\n  \\\"first_name\\\": \\\"{{ $('Form Fields').item.json.Name }}\\\",\\n  \\\"last_name\\\": \\\"{{ $('Form Fields').item.json.Surname }}\\\",\\n  \\\"email1\\\": \\\"{{ $('Form Fields').item.json.Email }}\\\",\\n  \\\"phone_mobile\\\":\\\"{{ $('Form Fields').item.json.Phone }}\\\",\\n  \\\"coupon_c\\\": \\\"{{ $('Get Coupon').item.json.COUPON }}\\\"\\n  }\\n  }\\n}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Authorization\",\n              \"value\": \"=Bearer {{$node[\\\"Token SuiteCRM\\\"].json[\\\"access_token\\\"]}}\"\n            },\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/vnd.api+json\"\n            }\n          ]\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"59b9c124-f6eb-457d-b3cb-2c831b66db85\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        440,\n        1020\n      ],\n      \"webhookId\": \"4b98315d-782e-47a5-8fea-7d16155c811d\",\n      \"parameters\": {\n        \"path\": \"4b98315d-782e-47a5-8fea-7d16155c811d\",\n        \"options\": {},\n        \"httpMethod\": \"POST\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"75d6f561-754d-4153-8a85-12cb135a555c\",\n      \"name\": \"On form submission\",\n      \"type\": \"n8n-nodes-base.formTrigger\",\n      \"position\": [\n        440,\n        820\n      ],\n      \"webhookId\": \"63d1d84b-c41e-4d3d-961a-0aa2af830ceb\",\n      \"parameters\": {\n        \"options\": {},\n        \"formTitle\": \"Landing\",\n        \"formFields\": {\n          \"values\": [\n            {\n              \"fieldLabel\": \"Name\",\n              \"placeholder\": \"Name\",\n              \"requiredField\": true\n            },\n            {\n              \"fieldLabel\": \"Surname\",\n              \"placeholder\": \"Surname\",\n              \"requiredField\": true\n            },\n            {\n              \"fieldType\": \"email\",\n              \"fieldLabel\": \"Email\",\n              \"placeholder\": \"Email\",\n              \"requiredField\": true\n            },\n            {\n              \"fieldLabel\": \"Phone\",\n              \"placeholder\": \"Phone\",\n              \"requiredField\": true\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"e9eac3a2-0351-4457-ae1d-44d42974ab20\",\n      \"name\": \"Duplicate Lead?\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        880,\n        820\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"filtersUI\": {\n          \"values\": [\n            {\n              \"lookupValue\": \"={{ $json.Email }}\",\n              \"lookupColumn\": \"EMAIL\"\n            }\n          ]\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0\",\n          \"cachedResultName\": \"Foglio1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Coupon\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"JYR6a64Qecd6t8Hb\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"a5ae5f5a-7028-495b-ad27-192561ce88d5\",\n      \"name\": \"Form Fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        680,\n        820\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"661d1475-f964-4a12-bfe7-88bf96851319\",\n              \"name\": \"Name\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.Name }}\"\n            },\n            {\n              \"id\": \"9991645d-c716-47db-80d6-850f3d64c782\",\n              \"name\": \"Surname\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.Surname }}\"\n            },\n            {\n              \"id\": \"c999afa6-2ec7-4f7f-bf3b-088a3597591c\",\n              \"name\": \"Email\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.Email }}\"\n            },\n            {\n              \"id\": \"f3faccdb-2412-4363-a0e3-f13b8f85b242\",\n              \"name\": \"Phone\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.Phone }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"9edb0d07-b4fb-42f8-9555-1d3caf8998c7\",\n      \"name\": \"Get Coupon\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        1340,\n        920\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"returnFirstMatch\": true\n        },\n        \"filtersUI\": {\n          \"values\": [\n            {\n              \"lookupColumn\": \"ID LEAD\"\n            }\n          ]\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0\",\n          \"cachedResultName\": \"Foglio1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Coupon\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"JYR6a64Qecd6t8Hb\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"9469dd95-04ac-4c74-abb3-674fec277f6e\",\n      \"name\": \"Respond OK\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        2300,\n        920\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"responseCode\": 200\n        },\n        \"respondWith\": \"json\",\n        \"responseBody\": \"{\\n  \\\"result\\\": \\\"OK\\\",\\n  \\\"reason\\\": \\\"lead created\\\"\\n}\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"5b81c406-d70b-4a36-b4f4-8941373958b9\",\n      \"name\": \"Respond KO\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        1320,\n        700\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"responseCode\": 200\n        },\n        \"respondWith\": \"json\",\n        \"responseBody\": \"{\\n  \\\"result\\\": \\\"KO\\\",\\n  \\\"reason\\\": \\\"duplicate lead\\\"\\n}\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"5fdf0eca-d1f6-4c9e-8e77-84d8e71bdb0e\",\n      \"name\": \"Is Duplicate?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1080,\n        820\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"9e3a8422-14f1-453e-bfed-4feecff34662\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.EMAIL }}\",\n              \"rightValue\": \"={{ $('Form Fields').item.json.email }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"e9cba682-bf5b-4efa-9d10-4fab5d02610a\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        420,\n        20\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 540,\n        \"height\": 380,\n        \"content\": \"## STEP 1\\n\\nCreate a Google Sheet like this (Fill only the column \\\"COUPON\\\")\\n\\n[![2mXGVwB.md.png](https://iili.io/2mXGVwB.md.png)]\\n\\nThis is the basic Google Sheet used in [this Workflow](https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drive_link):\\n\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1c304620-368d-42bf-b0d2-de3f9d552e51\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        420,\n        440\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 540,\n        \"height\": 260,\n        \"content\": \"## STEP 2 - MAIN FLOW\\n\\nThis workflow is ideal for businesses looking to automate lead generation and management, especially when integrating with CRM systems like SuiteCRM and using Google Sheets for data tracking.\\n\\nIf you use an external form, hook the webbook trigger and the two webhooks \\\"Respond KO\\\" and \\\"Respond OK\\\" to the workflow.\\n\\nIt works with SuiteCRM 7.14.x and 8.x version. Remeber to create a Lead custom fields called 'coupon' on SuiteCRM.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6248c920-02f4-4407-881a-376d2a9dd904\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        660,\n        740\n      ],\n      \"parameters\": {\n        \"width\": 340,\n        \"height\": 240,\n        \"content\": \"Check if the lead has already received the coupon\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0c07d1b7-b12f-4cf7-8d0c-1dd905365534\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1300,\n        860\n      ],\n      \"parameters\": {\n        \"width\": 180,\n        \"height\": 220,\n        \"content\": \"Find the first available unassigned coupon\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"34167626-9041-4cce-baaf-e1ed2efe8378\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1540,\n        700\n      ],\n      \"parameters\": {\n        \"width\": 400,\n        \"height\": 380,\n        \"content\": \"Enter the lead with the relative coupon on Suite CRM. Change SUITECRMURL, CLIENTSECRET and CLIENTID\\n\\nTo create the CLIENTSECRET and CLIEDID go to Admin -> Oauth2 Client and Token -> and click on \\\"New CLient Credentials Client\\\" \\n\\nFor the full tutorial step-by-step [here the official SuiteCRM Docs](https://docs.suitecrm.com/developer/api/developer-setup-guide/json-api/#_generate_private_and_public_key_for_oauth2)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"50f65f6b-8045-4cb1-9e3d-489f27cdb038\",\n      \"name\": \"Update Lead\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        2040,\n        920\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"DATE\": \"={{ $now.format('dd/LL/yyyy HH:mm:ss') }}\",\n            \"NAME\": \"={{ $json.data.attributes.first_name }}\",\n            \"EMAIL\": \"={{ $json.data.attributes.email1 }}\",\n            \"PHONE\": \"={{ $json.data.attributes.phone_mobile }}\",\n            \"COUPON\": \"={{ $('Get Coupon').item.json.COUPON }}\",\n            \"ID LEAD\": \"={{ $json.data.id }}\",\n            \"SURNAME\": \"={{ $json.data.attributes.last_name }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"NAME\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"NAME\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"SURNAME\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"SURNAME\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"EMAIL\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"EMAIL\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"PHONE\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"PHONE\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"COUPON\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"COUPON\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"DATE\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"DATE\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"ID LEAD\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"ID LEAD\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"row_number\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": true,\n              \"required\": false,\n              \"displayName\": \"row_number\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"COUPON\"\n          ],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {},\n        \"operation\": \"update\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0\",\n          \"cachedResultName\": \"Foglio1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Coupon\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"JYR6a64Qecd6t8Hb\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"\",\n  \"connections\": {\n    \"Get Coupon\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Token SuiteCRM\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Form Fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Duplicate Lead?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Is Duplicate?\": {\n      \"main\": [\n        [],\n        [\n          {\n            \"node\": \"Get Coupon\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Token SuiteCRM\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Lead SuiteCRM\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Duplicate Lead?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is Duplicate?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"On form submission\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Form Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Lead SuiteCRM\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Lead\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.formTrigger",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.set",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.if",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.googleSheets"
    ],
    "trigger": null
  }
}