{
  "source": "1145_Wait_Splitout_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"7i2RqqCYaKHUt4n3\",\n  \"meta\": {\n    \"instanceId\": \"fb924c73af8f703905bc09c9ee8076f48c17b596ed05b18c0ff86915ef8a7c4a\"\n  },\n  \"name\": \"Google Site Index - sitemap.xml example\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"4da50fbf-7707-42ea-badc-6748c4ee30db\",\n      \"name\": \"When clicking \\\"Test workflow\\\"\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -927,\n        472\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9e5bd6c8-a056-462b-b746-60d86bfbe398\",\n      \"name\": \"Split Out\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        480,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"urlset.url\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0d4acf98-31c5-4a0d-bb29-c1d045c0705c\",\n      \"name\": \"Check status\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        1540,\n        400\n      ],\n      \"parameters\": {\n        \"url\": \"=https://indexing.googleapis.com/v3/urlNotifications/metadata?url={{ encodeURIComponent($json.loc) }}\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"fullResponse\": true\n            }\n          }\n        },\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"googleOAuth2Api\"\n      },\n      \"credentials\": {\n        \"googleOAuth2Api\": {\n          \"id\": \"K8Cz9Dy3TR68udv2\",\n          \"name\": \"Google account\"\n        }\n      },\n      \"retryOnFail\": false,\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"eee0eba6-3aa3-4841-9d48-8407db1212e2\",\n      \"name\": \"Loop Over Items\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        1340,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"47745d33-8358-45a8-a67d-60f9f0574bae\",\n      \"name\": \"Wait\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        2080,\n        400\n      ],\n      \"webhookId\": \"44364241-e54b-4b44-aaa1-0d8121a7f497\",\n      \"parameters\": {\n        \"unit\": \"seconds\",\n        \"amount\": \"={{ Math.min(1.5,0.3+3*Math.random()).toFixed(2) }}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9f1bf72e-8ecd-4239-b96f-b77be4c86b18\",\n      \"name\": \"URL Updated\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1840,\n        400\n      ],\n      \"parameters\": {\n        \"url\": \"=https://indexing.googleapis.com/v3/urlNotifications:publish\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"url\",\n              \"value\": \"={{ $('Loop Over Items').item.json.loc }}\"\n            },\n            {\n              \"name\": \"type\",\n              \"value\": \"URL_UPDATED\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"googleOAuth2Api\"\n      },\n      \"credentials\": {\n        \"googleOAuth2Api\": {\n          \"id\": \"K8Cz9Dy3TR68udv2\",\n          \"name\": \"Google account\"\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"629eaf34-ef3c-4e9c-9537-69a03310dd9c\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        -927,\n        272\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {\n              \"triggerAtHour\": 2,\n              \"triggerAtMinute\": 5\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"2f95065c-fdc9-4773-87b0-37007ae4f9a5\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -87,\n        192\n      ],\n      \"parameters\": {\n        \"width\": 851.3475816949383,\n        \"height\": 340.39627039627067,\n        \"content\": \"## Collect list of URLs\\n\\nThis part extracts all pages from all sitemaps and sorts by the last modified date `lastmod` (from newest to oldest)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"33798da1-4fd3-43dc-9ff4-753bae798535\",\n      \"name\": \"is new?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1700,\n        280\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"looseTypeValidation\": true\n        },\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"loose\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"c8566fc4-57cf-4272-841e-014bb354a37d\",\n              \"operator\": {\n                \"type\": \"dateTime\",\n                \"operation\": \"after\"\n              },\n              \"leftValue\": \"={{ $('Loop Over Items').item.json.lastmod }}\",\n              \"rightValue\": \"={{ $json.body.latestUpdate.notifyTime }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"b5d538ec-d7bc-40ac-9b9e-e5ead9378387\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1500,\n        121.07782938758908\n      ],\n      \"parameters\": {\n        \"width\": 504.2424242424241,\n        \"height\": 431.1089918072487,\n        \"content\": \"## Check URL metadata and update, if:\\n* Google returns error (404 error means that this URL was not previously added)\\n* Date of article update is after the date of last request to re-index\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2cc0b088-b09f-4dc2-8027-9e0ff442576b\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -640,\n        196.4335593220339\n      ],\n      \"parameters\": {\n        \"width\": 515.8058994999984,\n        \"height\": 335.72259887005646,\n        \"content\": \"## Get sitemap.xml\\nVarious CMS systems often have multiple sitemaps for different content (posts, tags, pages etc). Need to fetch all sitemaps first and then extract all pages from all sitemaps.\\n### Remember to update the real sitemap URL!\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d8dc3b65-0d47-49a7-9042-33dbc5a2e245\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -662.5490981963931,\n        120.2098305084748\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 1458.468937875752,\n        \"height\": 453.3292476478371,\n        \"content\": \"## Feel free to adapt this part depending on your website CMS\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a763f582-500c-4cc8-b780-672ebc3d0845\",\n      \"name\": \"Get content-specific sitemaps\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        -260,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"sitemapindex.sitemap\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e7aa9728-eb9b-454d-a710-561d76841d7a\",\n      \"name\": \"Convert sitemap to JSON\",\n      \"type\": \"n8n-nodes-base.xml\",\n      \"position\": [\n        -440,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"496366d7-0d4e-401c-a375-8ca8882e8a32\",\n      \"name\": \"Force urlset.url to array\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        320,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"8d16114b-1d1a-4522-a550-6c799a44538a\",\n              \"name\": \"=urlset.url\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.urlset.url[0] ? $json.urlset.url : [$json.urlset.url] }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.3\n    },\n    {\n      \"id\": \"3a8e00a6-2fa4-4903-943d-890e0078181e\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        820,\n        120\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 459.2224448897797,\n        \"height\": 451.39712985292624,\n        \"content\": \"## Update the `lastmod` and `loc` fields\\nThese are pre-defined fields according to [the XML schema for the Sitemap protocol](https://www.sitemaps.org/protocol.html).\\n\\nIf your CMS system has different field names, please rename them here:\\n* the last modified field `lastmod`\\n* URL of the page in `loc` field\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9d841026-ede6-4396-a67b-e1787ffe9a17\",\n      \"name\": \"Assign mandatiry sitemap fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1000,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"bb0e1337-6fda-4a22-9963-d0b1271fc2a6\",\n              \"name\": \"lastmod\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.lastmod }}\"\n            },\n            {\n              \"id\": \"e7517c23-f989-4d75-9078-d82c75e51c65\",\n              \"name\": \"loc\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.loc }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.3\n    },\n    {\n      \"id\": \"99787654-f554-4650-afc0-c4fa65392c2b\",\n      \"name\": \"convert page data to JSON\",\n      \"type\": \"n8n-nodes-base.xml\",\n      \"position\": [\n        120,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"explicitArray\": false\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f5cc1725-955c-4eb2-a66f-93153ebf35d1\",\n      \"name\": \"Get sitemap.xml\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -620,\n        360\n      ],\n      \"parameters\": {\n        \"url\": \"https://wordpress.org/sitemap.xml\",\n        \"options\": {}\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"789076f0-4aa1-469b-afac-af717c0b03c3\",\n      \"name\": \"Get content of each sitemap\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -60,\n        360\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $json.loc }}\",\n        \"options\": {\n          \"batching\": {\n            \"batch\": {\n              \"batchSize\": 1,\n              \"batchInterval\": 150\n            }\n          }\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"b0bdc6d6-1306-4c0c-bec2-7e59d587db69\",\n      \"name\": \"Sort\",\n      \"type\": \"n8n-nodes-base.sort\",\n      \"position\": [\n        640,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"sortFieldsUi\": {\n          \"sortField\": [\n            {\n              \"order\": \"descending\",\n              \"fieldName\": \"lastmod\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"callerPolicy\": \"workflowsFromSameOwner\",\n    \"errorWorkflow\": \"6\",\n    \"executionOrder\": \"v1\",\n    \"saveManualExecutions\": true,\n    \"saveDataSuccessExecution\": \"all\"\n  },\n  \"versionId\": \"5c21ebb6-67df-4bde-9aea-6cc9a7621fc0\",\n  \"connections\": {\n    \"Sort\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Assign mandatiry sitemap fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Wait\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"is new?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"URL Updated\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Wait\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Out\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Sort\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"URL Updated\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Wait\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check status\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"is new?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"URL Updated\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get sitemap.xml\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Convert sitemap to JSON\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items\": {\n      \"main\": [\n        [],\n        [\n          {\n            \"node\": \"Check status\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get sitemap.xml\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Convert sitemap to JSON\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get content-specific sitemaps\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Force urlset.url to array\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Out\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"convert page data to JSON\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Force urlset.url to array\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get content of each sitemap\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"convert page data to JSON\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get content-specific sitemaps\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get content of each sitemap\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking \\\"Test workflow\\\"\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get sitemap.xml\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Assign mandatiry sitemap fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.splitInBatches",
      "n8n-nodes-base.wait",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.if",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.xml",
      "n8n-nodes-base.set",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set",
      "n8n-nodes-base.xml",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.sort"
    ],
    "trigger": "schedule trigger"
  }
}