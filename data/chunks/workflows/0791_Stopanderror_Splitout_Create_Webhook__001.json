{
  "source": "0791_Stopanderror_Splitout_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"4a8c4d3ed2f4423694f8ac022d1c321551900c7ab47e0c03549acecec1ab4a89\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"a5292068-5ace-4372-9869-46100ae81b8f\",\n      \"name\": \"Get video details\",\n      \"type\": \"n8n-nodes-base.youTube\",\n      \"notes\": \"Make a call to the YouTube API so that we have the thumbnail for the email and the duration to filter out shorts.\",\n      \"position\": [\n        1000,\n        -60\n      ],\n      \"parameters\": {\n        \"part\": [\n          \"contentDetails\",\n          \"snippet\",\n          \"id\"\n        ],\n        \"options\": {},\n        \"videoId\": \"={{ $json.id.replace(\\\"yt:video:\\\", \\\"\\\") }}\",\n        \"resource\": \"video\",\n        \"operation\": \"get\"\n      },\n      \"credentials\": {\n        \"youTubeOAuth2Api\": {\n          \"id\": \"5lD8Hahvq4r7Og0F\",\n          \"name\": \"YouTube account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b9eb34aa-90c4-492a-a33e-37a32812fa32\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        -840,\n        -160\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {\n              \"field\": \"hours\",\n              \"hoursInterval\": 1,\n              \"triggerAtMinute\": 47\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"8f0dbe74-53e5-4b14-86f6-eb0f502c8471\",\n      \"name\": \"Filter out shorts\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"notes\": \"Sometime, some live broadcasts that are then posted as regular videos do not have a duration. That is why we check if `duration` is present in `contentDetails`.\",\n      \"position\": [\n        1180,\n        -60\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 1,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"or\",\n          \"conditions\": [\n            {\n              \"id\": \"5342ecc0-d764-4bef-8161-d1f571fcb931\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notExists\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.contentDetails.duration }}\",\n              \"rightValue\": \"\\\"duration\\\"\"\n            },\n            {\n              \"id\": \"b82e3373-a28b-49bd-afa0-4f48cafe2bfe\",\n              \"operator\": {\n                \"type\": \"number\",\n                \"operation\": \"gt\"\n              },\n              \"leftValue\": \"={{ Duration.fromISO($json.contentDetails.duration).as('seconds') }}\",\n              \"rightValue\": 61\n            }\n          ]\n        }\n      },\n      \"notesInFlow\": false,\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"14d54ed0-f5c0-4992-af56-0af2d8973963\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -900,\n        -340\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 220,\n        \"height\": 460,\n        \"content\": \"### Default frequency: every hour\\nChanging it here is enough if you want to check for new videos at a higher or lower frequency. You don't have to edit anything else.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c4acbb10-1f57-4934-a324-f26d0532767c\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -660,\n        -340\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 880,\n        \"height\": 460,\n        \"content\": \"### Get my subscriptions from the YouTube Data v3 API\\nYou can expect to use 1 quota per 50 subscriptions per run, which is well within the 10 000/req a day allowed by default.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4ae2d2f3-53b5-4431-90d8-06e41a6950e2\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        480,\n        -160\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 440,\n        \"height\": 280,\n        \"content\": \"### Get the 15 latest videos of each channel with RSS\\nUsing the YouTube API instead would cost too many quotas to make it viable.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"48894d79-7e59-49fc-beb5-445fb5ca2ff6\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        940,\n        -160\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 400,\n        \"height\": 280,\n        \"content\": \"### Call YouTube's API for more data\\nWe need the thumbnails for the email and the duration to filter out shorts.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e3da3f97-138c-481e-a763-9a3c9e402928\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1360,\n        -160\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 260,\n        \"height\": 280,\n        \"content\": \"### Configure your email here\\nTo go to the video from the email, simply click on the thumbnail.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0d092c3d-b2e1-4468-a044-c6cf0f37672b\",\n      \"name\": \"Get latest 15 videos of each channel\",\n      \"type\": \"n8n-nodes-base.rssFeedRead\",\n      \"notes\": \"YouTube provides an RSS feed for each channel with the 15 latest videos.\\nWe use this instead of the YouTube Data v3 API, as search requests cost a lot of \\\"quota points\\\" and would easily put us over the daily limit with just one workflow run.\",\n      \"position\": [\n        540,\n        -60\n      ],\n      \"parameters\": {\n        \"url\": \"=https://www.youtube.com/feeds/videos.xml?channel_id={{ $json.snippet.resourceId.channelId }}\",\n        \"options\": {}\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"34823384-d8a5-415a-87ff-203d65aa9a75\",\n      \"name\": \"Get my subscriptions\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"notes\": \"Get subscriptions from YouTube Data v3 API\",\n      \"position\": [\n        -600,\n        -160\n      ],\n      \"parameters\": {\n        \"url\": \"https://www.googleapis.com/youtube/v3/subscriptions\",\n        \"options\": {\n          \"pagination\": {\n            \"pagination\": {\n              \"parameters\": {\n                \"parameters\": [\n                  {\n                    \"name\": \"pageToken\",\n                    \"value\": \"={{ $response.body.nextPageToken }}\"\n                  }\n                ]\n              },\n              \"completeExpression\": \"={{ !('nextPageToken' in $response.body) }}\",\n              \"paginationCompleteWhen\": \"other\"\n            }\n          }\n        },\n        \"sendQuery\": true,\n        \"authentication\": \"predefinedCredentialType\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"mine\",\n              \"value\": \"true\"\n            },\n            {\n              \"name\": \"part\",\n              \"value\": \"snippet,contentDetails\"\n            },\n            {\n              \"name\": \"maxResults\",\n              \"value\": \"50\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"youTubeOAuth2Api\"\n      },\n      \"credentials\": {\n        \"youTubeOAuth2Api\": {\n          \"id\": \"5lD8Hahvq4r7Og0F\",\n          \"name\": \"YouTube account\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"534e38f3-ac40-4194-8821-5926ee581605\",\n      \"name\": \"Check for errors\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -400,\n        -160\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"5972ff90-aa5a-470c-aa96-87138eb60565\",\n              \"operator\": {\n                \"type\": \"object\",\n                \"operation\": \"exists\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.error }}\",\n              \"rightValue\": \"error\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"2d872c0f-30b9-4ffc-aba0-6644bf05d7bb\",\n      \"name\": \"Only keep channels with unwatched videos\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"notes\": \"It's not a perfect indicator for new videos but helps reduce the amount of channels to process.\",\n      \"position\": [\n        40,\n        -60\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"4734ee8c-1655-47be-bd45-a9527aee2833\",\n              \"operator\": {\n                \"type\": \"number\",\n                \"operation\": \"gt\"\n              },\n              \"leftValue\": \"={{ $json.contentDetails.newItemCount }}\",\n              \"rightValue\": 0\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"c7bd97ec-47c1-40b4-955d-bf89d3cde330\",\n      \"name\": \"Keep only videos published since last run\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"notes\": \"We dynamically figure out the last run's execution time through the settings of the \\\"Schedule Trigger\\\" node.\",\n      \"position\": [\n        740,\n        -60\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"65d905a2-c89e-41f3-a2cf-0d1a76c48d8e\",\n              \"operator\": {\n                \"type\": \"dateTime\",\n                \"operation\": \"after\"\n              },\n              \"leftValue\": \"={{ $json.pubDate.toDateTime() }}\",\n              \"rightValue\": \"={{ \\n  $('Schedule Trigger').item.json.timestamp.toDateTime().minus(\\n    $('Schedule Trigger').params.rule.interval[0].hoursInterval,\\n    $('Schedule Trigger').params.rule.interval[0].field\\n  ).toISO()\\n}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"72341b1f-a391-4210-b3ca-4e74ae1f2e1b\",\n      \"name\": \"Send an email for each new video\",\n      \"type\": \"n8n-nodes-base.emailSend\",\n      \"notes\": \"The expression in the HTML for the thumbnail simply selects the last element of the thumbnails array so that we get the best possible resolution thumbnail available.\",\n      \"position\": [\n        1440,\n        -60\n      ],\n      \"webhookId\": \"44bf0e95-98e5-4b5b-a7c5-c802379ab3b0\",\n      \"parameters\": {\n        \"html\": \"=<h1 style=\\\"text-align: center;\\\">{{ $json.snippet.title }}</h1>\\n<a href=\\\"https://www.youtube.com/watch?v={{ $json.id }}\\\">\\n  <img src=\\\"{{ $json.snippet.thumbnails[Object.keys($json.snippet.thumbnails)[Object.keys($json.snippet.thumbnails).length - 1]].url }}\\\" alt=\\\"Watch on YouTube\\\" style=\\\"width:100%; height:auto; max-width:640px; display:block; margin: 10px auto;\\\">\\n</a>\",\n        \"options\": {\n          \"appendAttribution\": false\n        },\n        \"subject\": \"={{ $json.snippet.channelTitle }}\",\n        \"toEmail\": \"My Name <to@email.com>\",\n        \"fromEmail\": \"YouTube <from@email.com>\"\n      },\n      \"credentials\": {\n        \"smtp\": {\n          \"id\": \"ThrKm6bLUg1owKn1\",\n          \"name\": \"SMTP account\"\n        }\n      },\n      \"notesInFlow\": false,\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"b82cfbd5-71e3-418f-9b6d-6d0ec007733a\",\n      \"name\": \"If the HTTP request failed, throw the error\",\n      \"type\": \"n8n-nodes-base.stopAndError\",\n      \"position\": [\n        -180,\n        -260\n      ],\n      \"parameters\": {\n        \"errorMessage\": \"=Status code: {{ $json.error.code }}\\nMessage: {{ $json.error.message }}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e89eca92-896f-46b5-8a4b-149d51682faa\",\n      \"name\": \"Split out subscriptions to process individually\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        -180,\n        -60\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"items\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0e00fda6-1489-4c1a-8205-22e620a554c5\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        240,\n        -240\n      ],\n      \"parameters\": {\n        \"width\": 220,\n        \"height\": 360,\n        \"content\": \"## Manually filter out channels\\nTo find the channel ID of a channel, click on the description → Share channel → Copy channel ID\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"bcc2e57c-23b2-42b7-81ab-cdd88b70b8a3\",\n      \"name\": \"Filter out channels\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"notes\": \"Optional step\",\n      \"position\": [\n        300,\n        -60\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"b27b14a9-c86c-4ebd-8a0f-4e7db722796e\",\n              \"operator\": {\n                \"type\": \"array\",\n                \"operation\": \"notContains\",\n                \"rightType\": \"any\"\n              },\n              \"leftValue\": \"={{[\\n  \\\"exampleChannelId1\\\",\\n  \\\"exampleChannelId2\\\"\\n]}}\",\n              \"rightValue\": \"={{ $json.snippet.resourceId.channelId }}\"\n            }\n          ]\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 2.2\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Check for errors\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If the HTTP request failed, throw the error\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Split out subscriptions to process individually\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get my subscriptions\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filter out shorts\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send an email for each new video\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        []\n      ]\n    },\n    \"Get video details\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter out shorts\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filter out channels\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get latest 15 videos of each channel\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get my subscriptions\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check for errors\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Send an email for each new video\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"Get latest 15 videos of each channel\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Keep only videos published since last run\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Only keep channels with unwatched videos\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter out channels\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Keep only videos published since last run\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get video details\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split out subscriptions to process individually\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Only keep channels with unwatched videos\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.youTube",
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.if",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.rssFeedRead",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.if",
      "n8n-nodes-base.filter",
      "n8n-nodes-base.filter",
      "n8n-nodes-base.emailSend",
      "n8n-nodes-base.stopAndError",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.filter"
    ],
    "trigger": "schedule trigger"
  }
}