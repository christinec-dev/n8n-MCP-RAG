{
  "source": "0543_Manual_N8N_Export_Triggered.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"26ba763460b97c249b82942b23b6384876dfeb9327513332e743c5f6219c2b8e\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"382dddd4-da50-49fa-90a2-f7d6d160afdf\",\n      \"name\": \"When clicking \\\"Test workflow\\\"\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        920,\n        280\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"efa8f415-62f7-43b3-a76a-a2eabf779cb8\",\n      \"name\": \"Map Workflows & Credentials\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1360,\n        280\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"0fd19a68-c561-4cc2-94d6-39848977e6d2\",\n              \"name\": \"workflow_id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.id }}\"\n            },\n            {\n              \"id\": \"a81f9e6f-9c78-4c3d-9b79-e820f8c5ba29\",\n              \"name\": \"workflow_name\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.name }}\"\n            },\n            {\n              \"id\": \"58ab0f2f-7598-48de-bea1-f3373c5731fe\",\n              \"name\": \"credentials\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.nodes.map(node => node.credentials).compact().reduce((acc,cred) => { const keys = Object.keys(cred); const items = keys.map(key => ({ type: key,  ...cred[key] })); acc.push(...items); return acc; }, []) }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.3\n    },\n    {\n      \"id\": \"9e9b4f9c-12b7-47ba-8cf4-a9818902a538\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1084,\n        252\n      ],\n      \"parameters\": {\n        \"width\": 216,\n        \"height\": 299.56273929030715,\n        \"content\": \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### ðŸš¨Required\\nYou'll need an n8n API key. Note: available workflows will be scoped to your key.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cf04eff5-12b2-42fb-9089-2d0c992af1b8\",\n      \"name\": \"Save to Database\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1540,\n        280\n      ],\n      \"parameters\": {\n        \"language\": \"python\",\n        \"pythonCode\": \"import json\\nimport sqlite3\\ncon = sqlite3.connect(\\\"n8n_workflow_credentials.db\\\")\\n\\ncur = con.cursor()\\ncur.execute(\\\"CREATE TABLE IF NOT EXISTS n8n_workflow_credentials (workflow_id TEXT PRIMARY KEY, workflow_name TEXT, credentials TEXT);\\\")\\n\\nfor item in _input.all():\\n  cur.execute('INSERT OR REPLACE INTO n8n_workflow_credentials VALUES(?,?,?)', (\\n    item.json.workflow_id,\\n    item.json.workflow_name,\\n    json.dumps(item.json.credentials.to_py())\\n  ))\\n\\ncon.commit()\\ncon.close()\\n\\nreturn [{ \\\"affected_rows\\\": len(_input.all()) }]\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"7e32cf83-0498-4666-8677-7fd32eec779c\",\n      \"name\": \"Chat Trigger\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chatTrigger\",\n      \"position\": [\n        1880,\n        280\n      ],\n      \"webhookId\": \"993ce267-a1e5-4657-a38c-08f86715063d\",\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8c37f2ae-192b-4f98-a6fa-5aabf870e9e0\",\n      \"name\": \"Query Workflow Credentials Database\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolCode\",\n      \"position\": [\n        2320,\n        440\n      ],\n      \"parameters\": {\n        \"name\": \"query_workflow_credentials_database\",\n        \"language\": \"python\",\n        \"pythonCode\": \"import json\\nimport sqlite3\\ncon = sqlite3.connect(\\\"n8n_workflow_credentials.db\\\")\\n\\ncur = con.cursor()\\nres = cur.execute(query);\\n\\noutput = json.dumps(res.fetchall())\\n\\ncon.close()\\nreturn output;\",\n        \"description\": \"Call this tool to query the workflow credentials database. The database is already set. The available tables are as follows:\\n* n8n_workflow_credentials (workflow_id TEXT PRIMARY KEY, workflow_name TEXT, credentials TEXT);\\n   * n8n_workflow_credentials.credentials are stored as json string and the app name may be obscured. Prefer querying using the %LIKE% operation for best results.\\n\\nPass a SQL SELECT query to this tool for the available tables.\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"60b2ab16-dc7c-4cb8-a58f-696f721b8d6f\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        2060,\n        440\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"adf576c1-ddb0-4fef-980c-5b485a3204f2\",\n      \"name\": \"Window Buffer Memory\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryBufferWindow\",\n      \"position\": [\n        2180,\n        440\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"4335b038-3e9f-4173-986d-cabdb87cc0b4\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        860,\n        100\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 930.8402221561373,\n        \"height\": 488.8805508857059,\n        \"content\": \"## Step 1. Store Workflows Credential Mappings to Database\\n\\nWe'll achieve this by querying n8n's built-in API to query all workflows, extract the credentials list from the nodes within and then store them in a SQLite database. Don't worry, the actual credential data won't be exposed! For the database, we'll abuse the fact that the code node is able to create Sqlite databases - however, this is created in memory and will be wiped if the n8n instance is restarted.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c1f557ee-1176-4f3e-8431-d162f1a59990\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1820,\n        100\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 688.6507290693205,\n        \"height\": 527.3794193342486,\n        \"content\": \"## Step 2. Use Agent as Search Interface\\n\\nInstead of building a form interface like a regular person, we'll just use an AI tools agent who is given aaccess to perform queries on our database. You can ask it things like \\\"which workflows are using slack + airtable + googlesheets?\\\"\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9bdc3fa9-d4a0-4040-bb32-6c76aaca3ad9\",\n      \"name\": \"Workflow Credentials Helper Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        2080,\n        280\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"systemMessage\": \"=You help find information on n8n workflow credentials. When user mentions an app, assume they mean the workflow credential for the app.\\n* Only if the user requests to provide a link to the workflow, replace $workflow_id with the workflow id in the following url schema: {{ window.location.protocol + '//' + window.location.host }}/workflow/$workflow_id\"\n        }\n      },\n      \"typeVersion\": 1.6\n    },\n    {\n      \"id\": \"ff39f504-9953-47c9-81eb-3146dfd6c8c5\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        420,\n        100\n      ],\n      \"parameters\": {\n        \"width\": 415.13049730628427,\n        \"height\": 347.7398931123371,\n        \"content\": \"## Try It Out!\\n\\n### This workflow let's you query workflow credentials using an AI SQL agent. Example use-case could be:\\n* \\\"Which workflows are using Slack and Google Calendar?\\\"\\n* \\\"Which workflows have AI in their name but are not using openAI?\\\"\\n\\n### Run the Steps separately!\\n* Step 1 populates a local database\\n* Step 2 engages with the chatbot\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3db2116c-abde-4856-bd1e-a15e0275477f\",\n      \"name\": \"n8n\",\n      \"type\": \"n8n-nodes-base.n8n\",\n      \"position\": [\n        1140,\n        280\n      ],\n      \"parameters\": {\n        \"filters\": {},\n        \"requestOptions\": {}\n      },\n      \"credentials\": {\n        \"n8nApi\": {\n          \"id\": \"5vELmsVPmK4Bkqkg\",\n          \"name\": \"n8n account\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"n8n\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Map Workflows & Credentials\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Chat Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Workflow Credentials Helper Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Workflow Credentials Helper Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Window Buffer Memory\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Workflow Credentials Helper Agent\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Map Workflows & Credentials\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Save to Database\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking \\\"Test workflow\\\"\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"n8n\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Query Workflow Credentials Database\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"Workflow Credentials Helper Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.set",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.code",
      "@n8n/n8n-nodes-langchain.chatTrigger",
      "@n8n/n8n-nodes-langchain.toolCode",
      "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "@n8n/n8n-nodes-langchain.agent",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.n8n"
    ],
    "trigger": "chat trigger"
  }
}