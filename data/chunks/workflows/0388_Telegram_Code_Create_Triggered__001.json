{
  "source": "0388_Telegram_Code_Create_Triggered.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"ac9d33c4ed758aeca18fdf8990bc14f18826f99beb38fb06a023fa013ee39a0b\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"9cfeb58b-140f-4941-8442-4e33c671e325\",\n      \"name\": \"No Operation, do nothing\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        440,\n        840\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c4e7c596-4f2a-48e0-a932-ad40157c6282\",\n      \"name\": \"Get interest name\",\n      \"type\": \"n8n-nodes-base.telegramTrigger\",\n      \"position\": [\n        100,\n        660\n      ],\n      \"webhookId\": \"3c85f114-6321-4e6d-9b5e-726e1493ee4e\",\n      \"parameters\": {\n        \"updates\": [\n          \"message\"\n        ],\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"JR5rQqmm6CGac5CF\",\n          \"name\": \"Sender Token\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"69d432d1-4ab1-4059-af5c-ba589dfe16bc\",\n      \"name\": \"Check message contents\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        280,\n        660\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"={{ $json.message.chat.id }}\",\n              \"value2\": -1001805495093,\n              \"operation\": \"equal\"\n            }\n          ],\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.message.text }}\",\n              \"value2\": \"#interest\",\n              \"operation\": \"startsWith\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"345274b6-2d56-4d54-937a-dd9153fd1fdc\",\n      \"name\": \"Extract message\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        460,\n        460\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let inputData = items[0].json; // get the input data\\nlet message = inputData.message; // replace 'message' with the correct field name\\n\\nlet messageContent = '';\\n\\nif (message && message.text) {\\n  messageContent = message.text;\\n}\\n\\nreturn [\\n  {\\n    json: {\\n      messageContent: messageContent\\n    }\\n  }\\n];\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"cd808029-1a46-4fad-9065-c726960fb427\",\n      \"name\": \"Split Message\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        660,\n        460\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let inputData = items[0].json; // get the input data\\nlet variableContent = String(inputData.messageContent || ''); // replace 'variable' with the correct field name, convert to string and assign empty string if undefined\\n\\nlet regex = /#(\\\\w+)\\\\b(.*)/; // regex to match hashtag word and rest of the content\\nlet matches = regex.exec(variableContent);\\n\\nlet extractedContent = '';\\nlet remainingContent = '';\\n\\nif (matches !== null) {\\n  extractedContent = matches[1];\\n  remainingContent = matches[2].trim();\\n} else {\\n  remainingContent = variableContent.trim();\\n}\\n\\nreturn [\\n  {\\n    json: {\\n      extractedContent: extractedContent,\\n      remainingContent: remainingContent    }\\n  }\\n];\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"6f541faf-7756-415e-8391-5470166b8a01\",\n      \"name\": \"Connect to Graph API\",\n      \"type\": \"n8n-nodes-base.facebookGraphApi\",\n      \"position\": [\n        840,\n        460\n      ],\n      \"parameters\": {\n        \"edge\": \"=\",\n        \"node\": \"=search?type=adinterest&q={{ $json.remainingContent }}\\n&limit=1000000&locale=en_US \",\n        \"options\": {},\n        \"graphApiVersion\": \"v17.0\"\n      },\n      \"credentials\": {\n        \"facebookGraphApi\": {\n          \"id\": \"AEVlPxPoTe92kkJS\",\n          \"name\": \"Facebook Graph account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"394a34ce-f56d-4a79-8fbb-f37681cbee76\",\n      \"name\": \"Split Interests into a Table\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1020,\n        460\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let inputData = items[0].json; // get the input data\\nlet outputData = [];\\n\\nfor(let key in inputData) {\\n    if(inputData.hasOwnProperty(key)) {\\n        let itemKey = key;\\n        let itemValue = inputData[key];\\n        \\n        for(let subKey in itemValue) {\\n            if(itemValue.hasOwnProperty(subKey)) {\\n                let formattedItem = {\\n                    'Item': itemKey,\\n                    'SubItem': subKey,\\n                    'Value': itemValue[subKey]\\n                };\\n                \\n                outputData.push({json: formattedItem});\\n            }\\n        }\\n    }\\n}\\n\\nreturn outputData;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"1d3f66a4-322f-4398-b887-52ccd2f2f5fe\",\n      \"name\": \"Get variables\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1200,\n        460\n      ],\n      \"parameters\": {\n        \"jsCode\": \"let outputData = items.map(item => {\\n    let data = item.json.Value;\\n    \\n    return {\\n        json: {\\n            'name': data.name,\\n            'audience_size_lower_bound': data.audience_size_lower_bound,\\n            'audience_size_upper_bound': data.audience_size_upper_bound,\\n            'path': data.path,\\n            'description': data.description,\\n            'topic': data.topic\\n        }\\n    };\\n});\\n\\nreturn outputData;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"082ddf0f-29ef-424a-a2a2-4bf9e260657f\",\n      \"name\": \"Create a Spreadsheet\",\n      \"type\": \"n8n-nodes-base.spreadsheetFile\",\n      \"position\": [\n        1380,\n        460\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"operation\": \"toFile\",\n        \"fileFormat\": \"csv\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"44e4f97a-cd86-4b60-b761-49dc46f7e36b\",\n      \"name\": \"Send the Spreadsheet file\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1560,\n        460\n      ],\n      \"parameters\": {\n        \"chatId\": \"-1001805495093\",\n        \"operation\": \"sendDocument\",\n        \"binaryData\": true,\n        \"additionalFields\": {\n          \"fileName\": \"report.csv\"\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"JR5rQqmm6CGac5CF\",\n          \"name\": \"Sender Token\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"22bc6129-7d10-46fd-98e2-0f3fc7a93344\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        800,\n        340\n      ],\n      \"parameters\": {\n        \"width\": 948.6687115198118,\n        \"height\": 296.5325040542755,\n        \"content\": \"## Facebook API\\n\\nTo get the API Key you need to follow these steps:\\nhttps://developers.facebook.com/docs/commerce-platform/setup/api-setup/\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Get variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create a Spreadsheet\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Message\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Connect to Graph API\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract message\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get interest name\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check message contents\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Connect to Graph API\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Interests into a Table\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create a Spreadsheet\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send the Spreadsheet file\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check message contents\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"No Operation, do nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Interests into a Table\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.noOp",
      "n8n-nodes-base.telegramTrigger",
      "n8n-nodes-base.if",
      "n8n-nodes-base.code",
      "n8n-nodes-base.code",
      "n8n-nodes-base.facebookGraphApi",
      "n8n-nodes-base.code",
      "n8n-nodes-base.code",
      "n8n-nodes-base.spreadsheetFile",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}