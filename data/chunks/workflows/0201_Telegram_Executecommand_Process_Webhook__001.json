{
  "source": "0201_Telegram_Executecommand_Process_Webhook.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"name\": \"Switch\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"notes\": \"check bot commands\",\n      \"position\": [\n        460,\n        480\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"rules\": [\n            {\n              \"value2\": \"/start\"\n            },\n            {\n              \"output\": 1,\n              \"value2\": \"/getweather\"\n            }\n          ]\n        },\n        \"value1\": \"={{$json[\\\"message\\\"][\\\"text\\\"]}}\",\n        \"dataType\": \"string\",\n        \"fallbackOutput\": 3\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"msg_greet\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1820,\n        300\n      ],\n      \"parameters\": {\n        \"text\": \"=Nice to meet you, {{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"from\\\"][\\\"first_name\\\"]}}.\\nI am n8n-powered bot, I can send you a weather data for several European capitals. The data is an image generated in ggplot2 package of R programming language.\\nType /getweather to begin.\",\n        \"chatId\": \"={{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"chat\\\"][\\\"id\\\"]}}\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"17\",\n          \"name\": \"n8n R test bot\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"msg_wrongcommand\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1820,\n        1160\n      ],\n      \"parameters\": {\n        \"text\": \"=Sorry, {{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"from\\\"][\\\"first_name\\\"]}}, your command was not recognized.\\n/getweather - show image with the weather info.\",\n        \"chatId\": \"={{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"chat\\\"][\\\"id\\\"]}}\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"17\",\n          \"name\": \"n8n R test bot\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Telegram Trigger\",\n      \"type\": \"n8n-nodes-base.telegramTrigger\",\n      \"position\": [\n        300,\n        480\n      ],\n      \"webhookId\": \"2512ec1e-bcff-4dfb-9ef3-208aaecc5634\",\n      \"parameters\": {\n        \"updates\": [\n          \"message\"\n        ],\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"17\",\n          \"name\": \"n8n R test bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"msg_getweather\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        2020,\n        820\n      ],\n      \"parameters\": {\n        \"chatId\": \"={{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"chat\\\"][\\\"id\\\"]}}\",\n        \"operation\": \"sendPhoto\",\n        \"binaryData\": true,\n        \"additionalFields\": {\n          \"caption\": \"=Here's your image, {{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"from\\\"][\\\"first_name\\\"]}}.\"\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"17\",\n          \"name\": \"n8n R test bot\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"City List\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        1040,\n        640\n      ],\n      \"parameters\": {\n        \"functionCode\": \"return [{Cityid: 2643743, Cityname:\\\"London\\\",    Country: \\\"GB\\\"},\\r\\n        {Cityid: 2950159, Cityname:\\\"Berlin\\\",    Country: \\\"DE\\\"},\\r\\n        {Cityid: 3117735, Cityname:\\\"Madrid\\\",    Country: \\\"ES\\\"},\\r\\n        {Cityid: 3169070, Cityname:\\\"Rome\\\",      Country: \\\"IT\\\"},\\r\\n        {Cityid: 683506,  Cityname:\\\"Bucharest\\\", Country: \\\"RO\\\"},\\r\\n        {Cityid: 2968815, Cityname:\\\"Paris\\\",     Country: \\\"FR\\\"},\\r\\n        {Cityid: 2761369, Cityname:\\\"Vienna\\\",    Country: \\\"AT\\\"},\\r\\n        {Cityid: 756135,  Cityname:\\\"Warsaw\\\",    Country: \\\"PL\\\"},\\r\\n        {Cityid: 3054638, Cityname:\\\"Budapest\\\",  Country: \\\"HU\\\"},\\r\\n        {Cityid: 792680,  Cityname:\\\"Belgrade\\\",  Country: \\\"RS\\\"}];\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Convert API response\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        860,\n        840\n      ],\n      \"parameters\": {\n        \"functionCode\": \"// this data is stored as a CSV file and then processed in the R script. Please check the R code here:\\n// https://gist.github.com/ed-parsadanyan/0561cd12d545e642fcef17dcb0872b00\\nvar data = [];\\n\\nfor (item of items) {\\n  data.push({CityName: item.json.name+', '+item.json.sys.country,\\n             TempCur : item.json.main.temp,\\n             TempMin : item.json.main.temp_min,\\n             TempMax : item.json.main.temp_max\\n  });\\n}\\n\\nreturn data;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Get weather data\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1220,\n        640\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.openweathermap.org/data/2.5/weather?id={{$json[\\\"Cityid\\\"]}}&units=metric&appid=6d3fff582a101700576faf74734f9535\",\n        \"options\": {}\n      },\n      \"typeVersion\": 1,\n      \"continueOnFail\": true\n    },\n    {\n      \"name\": \"Spreadsheet File\",\n      \"type\": \"n8n-nodes-base.spreadsheetFile\",\n      \"position\": [\n        1040,\n        840\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"fileName\": \"={{$node[\\\"Filename\\\"].json[\\\"filename\\\"]}}.{{$parameter[\\\"fileFormat\\\"]}}\"\n        },\n        \"operation\": \"toFile\",\n        \"fileFormat\": \"csv\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Write csv\",\n      \"type\": \"n8n-nodes-base.writeBinaryFile\",\n      \"position\": [\n        1220,\n        840\n      ],\n      \"parameters\": {\n        \"fileName\": \"={{$node[\\\"Filename\\\"].json[\\\"foldername\\\"]}}{{$binary.data.fileName}}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Filename\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        860,\n        640\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"filename\",\n              \"value\": \"=request_from{{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"from\\\"][\\\"id\\\"]}}_{{DateTime.now().toISO({ format: 'basic' }).split('.')[0]}}\"\n            },\n            {\n              \"name\": \"foldername\",\n              \"value\": \"/home/node/.n8n/weather-bot/\"\n            },\n            {\n              \"name\": \"imgname\",\n              \"value\": \"=request_from{{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"from\\\"][\\\"id\\\"]}}\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"msg_errorAPI\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1820,\n        640\n      ],\n      \"parameters\": {\n        \"text\": \"=Sorry, {{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"from\\\"][\\\"first_name\\\"]}}, an error occurred while fetching weather data. Please try again later.\",\n        \"chatId\": \"={{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"chat\\\"][\\\"id\\\"]}}\",\n        \"additionalFields\": {\n          \"parse_mode\": \"Markdown\"\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"17\",\n          \"name\": \"n8n R test bot\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Any errors API?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1580,\n        640\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{$json[\\\"error\\\"][\\\"name\\\"]}}\",\n              \"value2\": \"Error\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"msg_errorR\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1820,\n        1000\n      ],\n      \"parameters\": {\n        \"text\": \"=Sorry, {{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"from\\\"][\\\"first_name\\\"]}}, an error occurred while creating an image. Please try again later.\",\n        \"chatId\": \"={{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"chat\\\"][\\\"id\\\"]}}\",\n        \"additionalFields\": {\n          \"parse_mode\": \"Markdown\"\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"17\",\n          \"name\": \"n8n R test bot\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Read Binary File\",\n      \"type\": \"n8n-nodes-base.readBinaryFile\",\n      \"position\": [\n        1820,\n        820\n      ],\n      \"parameters\": {\n        \"filePath\": \"={{$node[\\\"Filename\\\"].json[\\\"foldername\\\"]}}{{$node[\\\"Filename\\\"].json[\\\"imgname\\\"]}}.png\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"R successful?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1580,\n        840\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"={{$json[\\\"exitCode\\\"]}}\",\n              \"operation\": \"equal\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        680,\n        1160\n      ],\n      \"parameters\": {\n        \"mode\": \"passThrough\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Merge1\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        680,\n        300\n      ],\n      \"parameters\": {\n        \"mode\": \"passThrough\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"msg_pleasewait\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1820,\n        460\n      ],\n      \"parameters\": {\n        \"text\": \"=Please wait while your request is being processed...\",\n        \"chatId\": \"={{$node[\\\"Telegram Trigger\\\"].json[\\\"message\\\"][\\\"chat\\\"][\\\"id\\\"]}}\",\n        \"additionalFields\": {\n          \"parse_mode\": \"Markdown\"\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"17\",\n          \"name\": \"n8n R test bot\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Merge2\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        680,\n        640\n      ],\n      \"parameters\": {\n        \"mode\": \"wait\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Run R script\",\n      \"type\": \"n8n-nodes-base.executeCommand\",\n      \"position\": [\n        1400,\n        840\n      ],\n      \"parameters\": {\n        \"command\": \"=Rscript --vanilla '{{$node[\\\"Filename\\\"].json[\\\"foldername\\\"]}}dumbbell_plot.R' '{{$node[\\\"Filename\\\"].json[\\\"foldername\\\"]}}{{$node[\\\"Filename\\\"].json[\\\"filename\\\"]}}.csv' '{{$node[\\\"Filename\\\"].json[\\\"foldername\\\"]}}{{$node[\\\"Filename\\\"].json[\\\"imgname\\\"]}}.png' >& {{$node[\\\"Filename\\\"].json[\\\"foldername\\\"]}}{{$node[\\\"Filename\\\"].json[\\\"filename\\\"]}}.log\"\n      },\n      \"typeVersion\": 1,\n      \"continueOnFail\": true\n    }\n  ],\n  \"connections\": {\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"msg_wrongcommand\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"msg_greet\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filename\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Switch\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"msg_pleasewait\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Merge2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        null,\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filename\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"City List\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"City List\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get weather data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Write csv\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Run R script\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Run R script\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"R successful?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"R successful?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Read Binary File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"msg_errorR\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"msg_pleasewait\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge2\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Any errors API?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"msg_errorAPI\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Convert API response\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get weather data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Any errors API?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Read Binary File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"msg_getweather\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Spreadsheet File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Write csv\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Telegram Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Switch\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Convert API response\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Spreadsheet File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.switch",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegramTrigger",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.function",
      "n8n-nodes-base.function",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.spreadsheetFile",
      "n8n-nodes-base.writeBinaryFile",
      "n8n-nodes-base.set",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.if",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.readBinaryFile",
      "n8n-nodes-base.if",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.executeCommand"
    ],
    "trigger": "telegram trigger"
  }
}