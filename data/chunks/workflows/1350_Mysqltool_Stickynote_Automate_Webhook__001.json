{
  "source": "1350_Mysqltool_Stickynote_Automate_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"BMI5WkmyU8nZqfII\",\n  \"meta\": {\n    \"instanceId\": \"e03b0f22ca12c92061d789d5980a9bc31d9d7e7dd7513ac93c09ac5a0d147623\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"modelo do chatbot\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"c6e454af-70a1-4c65-8450-8159f7fc738b\",\n      \"name\": \"If\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        160,\n        560\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 1,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"7ea831a4-0e20-4725-a6f5-3dc2f41f1cf4\",\n              \"operator\": {\n                \"type\": \"object\",\n                \"operation\": \"exists\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.leadData }}\",\n              \"rightValue\": \"\"\n            },\n            {\n              \"id\": \"ccb46339-4e43-42e6-aa45-d5a0cbd62214\",\n              \"operator\": {\n                \"name\": \"filter.operator.equals\",\n                \"type\": \"string\",\n                \"operation\": \"equals\"\n              },\n              \"leftValue\": \"\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"2221736f-ef99-4ac8-8a81-51af6d4e7dcd\",\n      \"name\": \"Edit Fields1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        440,\n        960\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"19a16867-b574-4b99-82f1-a86752b7fe9f\",\n              \"name\": \"chatInput\",\n              \"type\": \"string\",\n              \"value\": \"=\\\"Hello, just so you can get to know me, with no intention of a response, please save this information in your memory. My name is {{ $json.leadData.name }}. I am {{ $json.leadData.age }} years old and currently live in {{ $json.leadData.city }}, {{ $json.leadData.state }}. My profession is {{ $json.leadData.profession }}, and my education level is {{ $json.leadData.educationLevel }}.\\nIf Iâ€™m part of an adhesion group and have an entity, it would be {{ $json.leadData.entity }}.\\n\\nI am using a {{ $json.leadData.deviceType }} device to access this through the {{ $json.leadData.channel }} channel. At the moment, I am looking for a health insurance plan of type {{ $json.leadData.quotationType }}.\\\"\"\n            },\n            {\n              \"id\": \"0df8d578-8332-4cde-9044-489de16ab390\",\n              \"name\": \"session_id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.session_id }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"6aa1b3a4-0e6a-4312-9d9f-f67c4bf8f443\",\n      \"name\": \"Edit Fields2\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        920,\n        960\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"19a16867-b574-4b99-82f1-a86752b7fe9f\",\n              \"name\": \"chatInput\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Chat Trigger').item.json.chatInput}}\"\n            },\n            {\n              \"id\": \"0df8d578-8332-4cde-9044-489de16ab390\",\n              \"name\": \"session_id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Chat Trigger').item.json.session_id }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"6afe6158-7a8b-4a83-a778-6fd28e2a11af\",\n      \"name\": \"OpenAI\",\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"position\": [\n        600,\n        960\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"resource\": \"assistant\",\n        \"assistantId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"asst_numdCoMZPQ6GwfiJg5drg9hr\",\n          \"cachedResultName\": \"Chat IA - Testes - Dezembro - APIS\"\n        }\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"FW1FWHcMcwemQ1kZ\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.4\n    },\n    {\n      \"id\": \"4b961f1d-7da2-4a0b-98e3-7ec35ee14335\",\n      \"name\": \"Chat Trigger\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chatTrigger\",\n      \"position\": [\n        -20,\n        560\n      ],\n      \"webhookId\": \"1f83e8ac-d465-454a-8327-cef7f0149cb1\",\n      \"parameters\": {\n        \"public\": true,\n        \"options\": {},\n        \"initialMessages\": \"OlÃ¡ ðŸ‘‹\\nSou Jovelino, o serviÃ§o de IA do Joov, me mande sua pergunta e responderei em seguida! :)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"dccdb07f-97db-4a5a-9b09-02a5de65246e\",\n      \"name\": \"Postgres Chat Memory\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryPostgresChat\",\n      \"position\": [\n        640,\n        720\n      ],\n      \"parameters\": {\n        \"tableName\": \"aimessages\",\n        \"sessionKey\": \"={{ $('Chat Trigger').item.json.session_id }}{{ $json.sessionId }}\",\n        \"sessionIdType\": \"customKey\",\n        \"contextWindowLength\": 30\n      },\n      \"credentials\": {\n        \"postgres\": {\n          \"id\": \"M1cYa0bOSX1nfczy\",\n          \"name\": \"Postgres account\"\n        }\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"553dd27b-ab06-4605-99e0-8f15735cfff3\",\n      \"name\": \"Postgres Chat Memory1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryPostgresChat\",\n      \"position\": [\n        760,\n        1160\n      ],\n      \"parameters\": {\n        \"tableName\": \"aimessages\",\n        \"sessionKey\": \"={{ $('Chat Trigger').item.json.session_id }}{{ $json.sessionId }}\",\n        \"sessionIdType\": \"customKey\",\n        \"contextWindowLength\": 1\n      },\n      \"credentials\": {\n        \"postgres\": {\n          \"id\": \"M1cYa0bOSX1nfczy\",\n          \"name\": \"Postgres account\"\n        }\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"0103fb97-c691-4bd3-b26d-85aaa9774594\",\n      \"name\": \"Products in Daatabase\",\n      \"type\": \"n8n-nodes-base.mySqlTool\",\n      \"position\": [\n        1460,\n        600\n      ],\n      \"parameters\": {\n        \"query\": \"SELECT * \\nFROM Products p \\nWHERE \\n  cityQuery = '{{ $fromAI(\\\"cityQuery\\\") }}' AND \\n  state = '{{ $fromAI(\\\"state\\\") }}' AND \\n  modality = 'PME' AND \\n  removed = 0 AND \\n  ({{ $fromAI(\\\"holderCount\\\") || 1 }} + {{ $fromAI(\\\"dependentsCount\\\") || 0 }}) BETWEEN p.minLifeAmount AND p.maxLifeAmount AND\\n  (CASE\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 0 AND 18 THEN priceAtAge0To18\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 19 AND 23 THEN priceAtAge19To23\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 24 AND 28 THEN priceAtAge24To28\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 29 AND 33 THEN priceAtAge29To33\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 34 AND 38 THEN priceAtAge34To38\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 39 AND 43 THEN priceAtAge39To43\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 44 AND 48 THEN priceAtAge44To48\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 49 AND 53 THEN priceAtAge49To53\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 54 AND 58 THEN priceAtAge54To58\\n      ELSE priceAtAge59To199\\n  END) IS NOT NULL\\nORDER BY \\n  (CASE\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 0 AND 18 THEN priceAtAge0To18\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 19 AND 23 THEN priceAtAge19To23\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 24 AND 28 THEN priceAtAge24To28\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 29 AND 33 THEN priceAtAge29To33\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 34 AND 38 THEN priceAtAge34To38\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 39 AND 43 THEN priceAtAge39To43\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 44 AND 48 THEN priceAtAge44To48\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 49 AND 53 THEN priceAtAge49To53\\n      WHEN {{ $fromAI(\\\"holderAge\\\") }} BETWEEN 54 AND 58 THEN priceAtAge54To58\\n      ELSE priceAtAge59To199\\n  END) ASC, \\n  createdAt DESC\\nLIMIT 3;\\n\",\n        \"options\": {\n          \"detailedOutput\": true\n        },\n        \"operation\": \"executeQuery\",\n        \"descriptionType\": \"manual\",\n        \"toolDescription\": \"//  Search for the X product bla bla bla\"\n      },\n      \"credentials\": {\n        \"mySql\": {\n          \"id\": \"lkGJt8aNB0azyaGy\",\n          \"name\": \"MySQL account 2\"\n        }\n      },\n      \"typeVersion\": 2.4\n    },\n    {\n      \"id\": \"0cdfd89f-eb9e-4b6c-90d1-1cf8d6ed96bb\",\n      \"name\": \"Knowledge Base\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolHttpRequest\",\n      \"position\": [\n        1340,\n        600\n      ],\n      \"parameters\": {\n        \"url\": \"https://quotation.joov.com.br/widget/info?modalidade={modalidade}&estado=SP&cidade={city}&operadora={operadora}\",\n        \"toolDescription\": \"Here you will find the knowlegde base of my shop and bla bla bla Use this when they ask for price, whatever i want.\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"393f792a-4eff-4b33-aac0-025fc622a4b3\",\n      \"name\": \"External API\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolHttpRequest\",\n      \"position\": [\n        1200,\n        600\n      ],\n      \"parameters\": {\n        \"url\": \"https://integracao-sed-alb-323570099.us-east-1.elb.amazonaws.com/findByNameAndBirthDate\",\n        \"method\": \"POST\",\n        \"jsonBody\": \"={\\n    \\\"name\\\": \\\"{{json.name}}\\\",\\n    \\\"birthdate\\\": \\\"{{json.birthdate }}\\\"\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"toolDescription\": \"Pegue o nome completo em camel case, exemplo: Fernanda Melo, e a data de nacimento nesse formato: 1990-03-28\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"7ce7a5e7-6238-4479-a26f-bdcde1784188\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1160,\n        414\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 436.73182569600795,\n        \"height\": 367.7413881276459,\n        \"content\": \"TOOLS\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"df6737ca-c588-48fc-9761-2a5307841298\",\n      \"name\": \"OpenAI2\",\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"position\": [\n        460,\n        460\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $json.chatInput }}\",\n        \"prompt\": \"define\",\n        \"options\": {},\n        \"resource\": \"assistant\",\n        \"assistantId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"asst_x2qfc7EuoPv7XGOL84ClEZ3L\",\n          \"cachedResultName\": \"PINE\"\n        }\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"FW1FWHcMcwemQ1kZ\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.4\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"d1dc3988-6677-47c9-b91a-6875c7b6151d\",\n  \"connections\": {\n    \"If\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"OpenAI2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Chat Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"OpenAI\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"OpenAI2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"External API\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"OpenAI2\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Knowledge Base\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"OpenAI2\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Postgres Chat Memory\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"OpenAI2\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Postgres Chat Memory1\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"OpenAI\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Products in Daatabase\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"OpenAI2\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.if",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "@n8n/n8n-nodes-langchain.openAi",
      "@n8n/n8n-nodes-langchain.chatTrigger",
      "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "n8n-nodes-base.mySqlTool",
      "@n8n/n8n-nodes-langchain.toolHttpRequest",
      "@n8n/n8n-nodes-langchain.toolHttpRequest",
      "n8n-nodes-base.stickyNote",
      "@n8n/n8n-nodes-langchain.openAi"
    ],
    "trigger": "chat trigger"
  }
}