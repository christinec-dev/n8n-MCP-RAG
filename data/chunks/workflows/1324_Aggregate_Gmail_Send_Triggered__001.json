{
  "source": "1324_Aggregate_Gmail_Send_Triggered.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"id\": \"8141ffad-df2a-403b-a869-799c036f9733\",\n      \"name\": \"Gmail trigger\",\n      \"type\": \"n8n-nodes-base.gmailTrigger\",\n      \"position\": [\n        -600,\n        580\n      ],\n      \"parameters\": {\n        \"simple\": false,\n        \"filters\": {},\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"uBcIMfsTtKjexw7I\",\n          \"name\": \"Gmail (workfloowstutorial@gmail.com)\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6d9aa398-e2de-4fd0-b939-2a12d0c9fe14\",\n      \"name\": \"Get message content\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        -340,\n        580\n      ],\n      \"parameters\": {\n        \"simple\": false,\n        \"options\": {},\n        \"messageId\": \"={{ $json.id }}\",\n        \"operation\": \"get\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"uBcIMfsTtKjexw7I\",\n          \"name\": \"Gmail (workfloowstutorial@gmail.com)\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"cd86bc09-8c7f-4c85-9cb3-6dbd42420672\",\n      \"name\": \"Set label values\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        300,\n        580\n      ],\n      \"parameters\": {\n        \"fields\": {\n          \"values\": [\n            {\n              \"name\": \"labels\",\n              \"type\": \"arrayValue\",\n              \"arrayValue\": \"={{ $json.labels }}\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"329435a6-51d1-416e-9aa9-5fe9a8dce74f\",\n      \"name\": \"Get all labels\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        580,\n        460\n      ],\n      \"parameters\": {\n        \"resource\": \"label\",\n        \"returnAll\": true\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"uBcIMfsTtKjexw7I\",\n          \"name\": \"Gmail (workfloowstutorial@gmail.com)\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"7ae2dd15-472d-4a4b-b036-f80ebd7e3c28\",\n      \"name\": \"Split out assigned labels\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        580,\n        700\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"labels\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"744c7afa-75b1-4b3b-8ccb-e2106c01f387\",\n      \"name\": \"Merge corresponding labels\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        860,\n        580\n      ],\n      \"parameters\": {\n        \"mode\": \"combine\",\n        \"options\": {},\n        \"mergeByFields\": {\n          \"values\": [\n            {\n              \"field1\": \"name\",\n              \"field2\": \"labels\"\n            }\n          ]\n        },\n        \"outputDataFrom\": \"input1\"\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"e47424dc-f43e-41a9-b1e5-ab3e08cbf395\",\n      \"name\": \"Aggregate label IDs\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        1120,\n        580\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldsToAggregate\": {\n          \"fieldToAggregate\": [\n            {\n              \"renameField\": true,\n              \"outputFieldName\": \"label_ids\",\n              \"fieldToAggregate\": \"id\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"22ba8297-8efc-463e-8ae0-385fd94a205f\",\n      \"name\": \"Add labels to message\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        1340,\n        580\n      ],\n      \"parameters\": {\n        \"labelIds\": \"={{ $json.label_ids }}\",\n        \"messageId\": \"={{ $('Gmail trigger').item.json[\\\"id\\\"] }}\",\n        \"operation\": \"addLabels\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"uBcIMfsTtKjexw7I\",\n          \"name\": \"Gmail (workfloowstutorial@gmail.com)\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"7ebb1aad-00ad-43fa-9e07-e5f324864a74\",\n      \"name\": \"Assign labels for message\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        -80,\n        580\n      ],\n      \"parameters\": {\n        \"prompt\": \"={{ $json.text }}\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"message\": \"Your task is to categorize the message according to the following labels.\\n\\nPartnership - email about sponsored content, cooperation etc.\\nInquiry - email about products, services.\\nNotification - email that doesn't require response. \\n\\nOne email can have more than one label. Return only label names in JSON format, nothing else. Do not make things up. \"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.3\n    },\n    {\n      \"id\": \"2f82db6a-422c-4697-a629-cc782d88209d\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1100,\n        400\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 420.4803040774015,\n        \"height\": 240.57943708322733,\n        \"content\": \"## Add AI labels to Gmail messages\\nWith this workflow you can automatically set labels for your Gmail message according to its content. \\n\\nIn this workflow available are 3 labels: \\\"Partnership\\\", \\\"Inquiry\\\" and \\\"Notification\\\". Feel free to adjust labels according to your needs. \\n\\n**Please remember to set label names both in your Gmail account and workflow.**\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4a10fb2b-aebb-4735-bbdb-7f07f1136d95\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1100,\n        660\n      ],\n      \"parameters\": {\n        \"width\": 421.0932411886662,\n        \"height\": 257.42916378714597,\n        \"content\": \"## \\u26a0\\ufe0f Note\\n\\n1. Complete video guide for this workflow is available [on my YouTube](https://youtu.be/a8Dhj3Zh9vQ). \\n2. Remember to add your credentials and configure nodes (covered in the video guide).\\n3. If you like this workflow, please subscribe to [my YouTube channel](https://www.youtube.com/@workfloows) and/or [my newsletter](https://workfloows.com/).\\n\\n**Thank you for your support!**\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"76e62351-d502-4377-9df2-fe92df00fe03\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -660,\n        400\n      ],\n      \"parameters\": {\n        \"width\": 238.4602598584674,\n        \"height\": 348.5873725349161,\n        \"content\": \"### Gmail Trigger\\nReceive data from Gmail about new incoming message. \\n\\n\\u26a0\\ufe0f Set polling interval according to your needs.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c10702db-211f-4638-bcf0-fbbe18251cb7\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        60,\n        780\n      ],\n      \"parameters\": {\n        \"width\": 241.53974014153226,\n        \"height\": 319.3323098457962,\n        \"content\": \"###\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### JSON schema\\nEdit JSON schema and label names according to your needs.\\n\\n\\u26a0\\ufe0f **Label names in system prompt and JSON schema should be the same.**\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cb6e3573-3d4d-4313-a97e-86a017438399\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        800,\n        420\n      ],\n      \"parameters\": {\n        \"width\": 226.14233872620645,\n        \"height\": 347.0476323933831,\n        \"content\": \"### Merge labels\\nCombine labels retrieved from Gmail account and assigned by AI together.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8cfb4341-98e6-4944-b26c-15e39184f468\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1060,\n        420\n      ],\n      \"parameters\": {\n        \"width\": 452.48413953150185,\n        \"height\": 347.0476323933831,\n        \"content\": \"### Aggregarte labels and add to message\\nCreate array of label IDs and add to the desired email message in Gmail.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"bb9766e8-0b72-47f8-9a8e-0b291609e814\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -400,\n        400\n      ],\n      \"parameters\": {\n        \"width\": 238.4602598584674,\n        \"height\": 348.5873725349161,\n        \"content\": \"### Get message content\\nBased on Gmail message ID retrieve body content of the email and pass it to AI chain.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"48630cbd-8336-4577-928e-37341f09ef9b\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -140,\n        400\n      ],\n      \"parameters\": {\n        \"width\": 378.57661273793565,\n        \"height\": 348.5873725349161,\n        \"content\": \"### Assign labels\\nLet the AI decide which labels suit the best content of the message.\\n\\n\\u26a0\\ufe0f **Remember to edit system prompt** - modify label names and instructions according to your needs.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"60a9d75e-1564-4b1d-b3f2-acc2e3bf2411\",\n      \"name\": \"JSON Parser\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        140,\n        800\n      ],\n      \"parameters\": {\n        \"jsonSchema\": \"{\\n \\\"type\\\": \\\"object\\\",\\n \\\"properties\\\": {\\n \\\"labels\\\": {\\n \\\"type\\\": \\\"array\\\",\\n \\\"items\\\": {\\n \\\"type\\\": \\\"string\\\",\\n \\\"enum\\\": [\\\"Inquiry\\\", \\\"Partnership\\\", \\\"Notification\\\"]\\n }\\n }\\n },\\n \\\"required\\\": [\\\"labels\\\"]\\n}\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2bdf3fed-8a7f-411a-bad4-266bfea5cede\",\n      \"name\": \"OpenAI Chat\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        -120,\n        800\n      ],\n      \"parameters\": {\n        \"model\": \"gpt-4-turbo-preview\",\n        \"options\": {\n          \"temperature\": 0,\n          \"responseFormat\": \"json_object\"\n        }\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"jazew1WAaSRrjcHp\",\n          \"name\": \"OpenAI (workfloows@gmail.com)\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"connections\": {\n    \"JSON Parser\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Assign labels for message\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Assign labels for message\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gmail trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get message content\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get all labels\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge corresponding labels\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set label values\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get all labels\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Split out assigned labels\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Aggregate label IDs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add labels to message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get message content\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Assign labels for message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Assign labels for message\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set label values\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split out assigned labels\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge corresponding labels\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Merge corresponding labels\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Aggregate label IDs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.gmailTrigger",
      "n8n-nodes-base.gmail",
      "n8n-nodes-base.set",
      "n8n-nodes-base.gmail",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.aggregate",
      "n8n-nodes-base.gmail",
      "@n8n/n8n-nodes-langchain.chainLlm",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "@n8n/n8n-nodes-langchain.outputParserStructured",
      "@n8n/n8n-nodes-langchain.lmChatOpenAi"
    ],
    "trigger": "gmail trigger"
  }
}