{
  "source": "0903_Wait_Redis_Automate_Triggered.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"d1b9b74c805fea7fca1b903ee192d1d4090b516d3c254da86beb2f13b7c2ed2e\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"be902a85-fc31-442c-b308-a2350ec5aabb\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -760,\n        440\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d229b686-9de4-4633-9dba-3e1fe71eedf1\",\n      \"name\": \"No Operation, do nothing1\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        1820,\n        800\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f583bc97-8da8-488e-ab04-5167dc7a7701\",\n      \"name\": \"Information Extractor\",\n      \"type\": \"@n8n/n8n-nodes-langchain.informationExtractor\",\n      \"position\": [\n        2420,\n        540\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $json.buffer.reverse().toJsonString() }}\",\n        \"options\": {\n          \"systemPromptTemplate\": \"Eres un experto extrayendo información, tu objetivo es recolectar todos los mensajes. Procura no dejar duplicados. como resultado debes retornar un solo párrafo con todo los mensajes.\"\n        },\n        \"schemaType\": \"fromJson\",\n        \"jsonSchemaExample\": \"{\\n\\t\\\"message\\\": \\\"all consolidated messages\\\"\\n}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5b719416-4886-4d38-9d00-30b6237db168\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        2440,\n        760\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4.1-nano\",\n          \"cachedResultName\": \"gpt-4.1-nano\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"IogsrRzOBSmZJS5C\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"3d149fc0-caa7-4361-9bf9-33b6252b39eb\",\n      \"name\": \"get wait seconds\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        -260,\n        500\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Function: Compute waitSeconds\\nconst wordCount = $json.message.split(' ').filter(w=>w).length;\\nreturn [{ json: { \\n  context_id: $json.context_id,\\n  message: $json.message,\\n  waitSeconds: wordCount < 5 ? 45 : 30 \\n}}];\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"cc670735-d126-465f-b0a3-3a4c5e390fd7\",\n      \"name\": \"Set last_seen\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        280,\n        380\n      ],\n      \"parameters\": {\n        \"key\": \"=last_seen:{{ $json.context_id}}\",\n        \"ttl\": \"={{ $json.waitSeconds + 60 }}\",\n        \"value\": \"={{$now.toMillis()}}\",\n        \"expire\": true,\n        \"keyType\": \"string\",\n        \"operation\": \"set\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zJtRI38KhsyVjUvP\",\n          \"name\": \"Redis account\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"20d97d1d-70d4-4c3c-aa12-b1aa31795240\",\n      \"name\": \"Get waiting_reply\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        180,\n        780\n      ],\n      \"parameters\": {\n        \"key\": \"=waiting_reply:{{$json.context_id}}\",\n        \"options\": {},\n        \"operation\": \"get\",\n        \"propertyName\": \"waiting_reply\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zJtRI38KhsyVjUvP\",\n          \"name\": \"Redis account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7a2fc681-692f-4f72-9fab-f3ada4bda54b\",\n      \"name\": \"Mod input\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        340,\n        800\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"7ff99444-753d-4ef7-865c-7115761526b8\",\n              \"name\": \"waiting_reply\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.waiting_reply }}\"\n            },\n            {\n              \"id\": \"58ad6981-c35a-4dd6-b1cd-7c446b85e738\",\n              \"name\": \"context_id\",\n              \"type\": \"string\",\n              \"value\": \"={{$('When Executed by Another Workflow').item.json.context_id  }}\"\n            },\n            {\n              \"id\": \"bd0535a2-be03-436b-8a2e-222c3e26fd04\",\n              \"name\": \"message\",\n              \"type\": \"string\",\n              \"value\": \"={{$('When Executed by Another Workflow').item.json.message }}\"\n            },\n            {\n              \"id\": \"2f583f32-f231-4407-b773-c08b38d464f0\",\n              \"name\": \"waitSeconds\",\n              \"type\": \"number\",\n              \"value\": \"={{ $('get wait seconds').item.json.waitSeconds }}\"\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"84213bef-32be-4cd9-8387-cd76aff5cb38\",\n      \"name\": \"waiting_reply?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        540,\n        800\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"8136ea21-d798-41fd-81ed-5c0e7fda73c5\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.waiting_reply != null}}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"a8472217-aa83-4247-9d7d-3a471e24478a\",\n      \"name\": \"When chat message received\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chatTrigger\",\n      \"position\": [\n        -740,\n        640\n      ],\n      \"webhookId\": \"85115343-bb86-4bb8-b7a8-c4efded80b3f\",\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"ba4c81ba-92e2-4bef-a9e2-6f8d4c0aa722\",\n      \"name\": \"Set waiting_reply\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        840,\n        720\n      ],\n      \"parameters\": {\n        \"key\": \"=waiting_reply:{{ $json.context_id }}\",\n        \"ttl\": \"={{ $json.waitSeconds }}\",\n        \"value\": \"true\",\n        \"expire\": true,\n        \"operation\": \"set\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zJtRI38KhsyVjUvP\",\n          \"name\": \"Redis account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0ce783b6-b76b-4a5d-96ae-11708b7532ba\",\n      \"name\": \"Get buffer\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        1820,\n        600\n      ],\n      \"parameters\": {\n        \"key\": \"=buffer_in:{{ $('get wait seconds').item.json.context_id }}\",\n        \"options\": {},\n        \"operation\": \"get\",\n        \"propertyName\": \"buffer\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zJtRI38KhsyVjUvP\",\n          \"name\": \"Redis account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"21864061-1d1f-4528-a03f-1237e9c69a31\",\n      \"name\": \"Delete buffer_in\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        2940,\n        680\n      ],\n      \"parameters\": {\n        \"key\": \"=buffer_in:{{$json.context_id}}\",\n        \"operation\": \"delete\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zJtRI38KhsyVjUvP\",\n          \"name\": \"Redis account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8828aa7b-6153-4677-84a8-3ef2f884792c\",\n      \"name\": \"Delete waiting_reply\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        2940,\n        840\n      ],\n      \"parameters\": {\n        \"key\": \"=waiting_reply:{{$json.context_id}}\",\n        \"operation\": \"delete\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zJtRI38KhsyVjUvP\",\n          \"name\": \"Redis account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fc369067-7213-4d8c-b515-c34c4db997e4\",\n      \"name\": \"WaitSeconds\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        1020,\n        720\n      ],\n      \"webhookId\": \"c218d471-2f0f-4bd7-87d1-5431ac602211\",\n      \"parameters\": {\n        \"amount\": \"={{ $json.waitSeconds }} \"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"2daa2ab9-756a-4fdb-8573-b4570c58d6e5\",\n      \"name\": \"Buffer messages\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        -40,\n        440\n      ],\n      \"parameters\": {\n        \"list\": \"=buffer_in:{{$json.context_id}}\",\n        \"operation\": \"push\",\n        \"messageData\": \"={\\\"text\\\": \\\"{{ $json.message }}\\\", \\\"timestamp\\\": \\\"{{$now}}\\\"}\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zJtRI38KhsyVjUvP\",\n          \"name\": \"Redis account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4d5bc5f0-11ce-4f7f-b44b-0514a5ab5671\",\n      \"name\": \"Set buffer_count increment\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        280,\n        560\n      ],\n      \"parameters\": {\n        \"key\": \"=buffer_count:{{$json.context_id}}\",\n        \"expire\": \"={{$json.waitSeconds + 60}}\",\n        \"operation\": \"incr\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zJtRI38KhsyVjUvP\",\n          \"name\": \"Redis account\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"dcaee1a8-ea32-4a9d-b32f-f0418644027c\",\n      \"name\": \"Get last_seen\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        1220,\n        720\n      ],\n      \"parameters\": {\n        \"key\": \"=last_seen:{{$json.context_id}}\",\n        \"options\": {},\n        \"operation\": \"get\",\n        \"propertyName\": \"last_seen\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zJtRI38KhsyVjUvP\",\n          \"name\": \"Redis account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"908c4a4c-1c60-4e90-827a-064a0b4d6bfd\",\n      \"name\": \"Get buffer_count\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        1400,\n        720\n      ],\n      \"parameters\": {\n        \"key\": \"=buffer_count:{{ $('Mod input').item.json.context_id }}\",\n        \"options\": {},\n        \"operation\": \"get\",\n        \"propertyName\": \"count\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zJtRI38KhsyVjUvP\",\n          \"name\": \"Redis account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1ceb472b-3944-4d74-994b-867ade006e4e\",\n      \"name\": \"Map ouput\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        3140,\n        380\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"e8d80ab4-74a2-4c30-8500-8dddc5802eec\",\n              \"name\": \"message\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.output.message }}\"\n            },\n            {\n              \"id\": \"7e7fcee4-14b3-4393-b516-b07a53c018b3\",\n              \"name\": \"context_id\",\n              \"type\": \"string\",\n              \"value\": \"={{$('get wait seconds').item.json.context_id }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"0be7e5eb-1972-4a95-b5bf-4e564fc4ef7c\",\n      \"name\": \"Check Inactivity + Count\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1580,\n        720\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"loose\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"0f294c51-0629-4ae1-a009-68c2f5fd30b5\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{$json.count != null && Number($json.count) >= 1}}\",\n              \"rightValue\": \"\"\n            },\n            {\n              \"id\": \"1626238d-fb00-4ce8-89df-a40a4f29f52a\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{$('Get last_seen').item.json.last_seen != null}}\",\n              \"rightValue\": \"\"\n            },\n            {\n              \"id\": \"df819099-1f6e-4bee-a017-32b729c836a3\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{($now.toMillis() - $('Get last_seen').item.json.last_seen) >= $('Mod input').item.json.waitSeconds * 1000}}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        },\n        \"looseTypeValidation\": true\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"0c3bd62b-8cf6-4b34-8010-ebe819db9667\",\n      \"name\": \"Delete waiting_reply1\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        2940,\n        1000\n      ],\n      \"parameters\": {\n        \"key\": \"=buffer_count:{{$json.context_id}}\",\n        \"operation\": \"delete\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zJtRI38KhsyVjUvP\",\n          \"name\": \"Redis account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"bbf45966-833b-4f5f-ae11-0578614eb156\",\n      \"name\": \"No Operation, do nothing2\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        720,\n        540\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5683eebf-ba51-4a6b-a803-de6acf1b1ea8\",\n      \"name\": \"Wait\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        2080,\n        880\n      ],\n      \"webhookId\": \"b8e2e214-f82b-49c2-96e2-91e093137857\",\n      \"parameters\": {\n        \"amount\": \"={{ Math.max(0, Math.ceil(( $('Mod input').item.json.waitSeconds * 1000 - ($now.toMillis() - $('Get last_seen').item.json.last_seen)) / 1000)) }}\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"c0478f60-944e-4c85-bb9c-9abe0d4238c0\",\n      \"name\": \"When Executed by Another Workflow\",\n      \"type\": \"n8n-nodes-base.executeWorkflowTrigger\",\n      \"position\": [\n        -480,\n        720\n      ],\n      \"parameters\": {\n        \"workflowInputs\": {\n          \"values\": [\n            {\n              \"name\": \"context_id\"\n            },\n            {\n              \"name\": \"message\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"91a650b7-ddd4-4dbf-a300-523f72f0bdb5\",\n      \"name\": \"Mock input data\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -500,\n        500\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"0543fdb7-4a22-4530-bdb7-ae7064732fae\",\n              \"name\": \"context_id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.sessionId1 || '1lap075ha12' }}\"\n            },\n            {\n              \"id\": \"bead5646-a689-4deb-8f4b-b22aa97b51ca\",\n              \"name\": \"message\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.chatInput || 'Chat 2'}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"cb450e32-7e19-469c-9a5c-3d9da5bf1dfa\",\n      \"name\": \"No Operation, do nothing3\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        3320,\n        840\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b463e405-3355-48a2-a043-42941d7025c3\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2880,\n        660\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 700,\n        \"height\": 780,\n        \"content\": \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### 🧹 Buffer Cleanup\\n\\nAfter consolidation and reply:\\n\\n* **DELETE** keys:\\n\\n  * `buffer_in:{{context_id}}`\\n  * `buffer_count:{{context_id}}`\\n  * `waiting_reply:{{context_id}}`\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1b5397f8-aa7e-4b2b-afb9-5da97d99e049\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -80,\n        60\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 920,\n        \"height\": 940,\n        \"content\": \"### 📥 Input Buffer\\n\\n1. **Save incoming message**\\n\\n   * Push the new message into Redis list `buffer_in:{{context_id}}`.\\n2. **Update metadata**\\n\\n   * Set `last_seen:{{context_id}}` to the current timestamp (with a TTL of `waitSeconds + 60`).\\n   * INCR the counter key `buffer_count:{{context_id}}` (also expiring after `waitSeconds + 60`).\\n3. **Check “waiting” flag**\\n\\n   * GET `waiting_reply:{{context_id}}`.\\n   * If it’s null (no batch in flight), SET it to `true` with TTL `waitSeconds` to block concurrent triggers.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"edc07500-ccad-4e72-adc1-1a63a3a06609\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1180,\n        340\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1200,\n        \"height\": 820,\n        \"content\": \"### ⏳ Inactivity & Threshold Check\\n\\n1. **Fetch state**\\n\\n   * GET `last_seen:{{context_id}}` (when the last message arrived)\\n   * GET `buffer_count:{{context_id}}` (how many messages are queued)\\n2. **Evaluate trigger**\\n\\n   * **Inactivity:** `(now – last_seen) ≥ waitSeconds * 1000`\\n   * **Or threshold:** `buffer_count ≥ 1` (or your desired batch size)\\n3. **Branch**\\n\\n   * **True:** proceed to “Get buffer” and consolidate.\\n   * **False:** exit (noOp) and let the waiting‐node/flag mechanism retry later.\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {\n    \"When Executed by Another Workflow\": [\n      {\n        \"message\": \"Mensaje del usuario despues de pasar por el workflow de n8n:\\nTexto: ¡Hola! Quiero más información.;\\nImagen: ;\\nAudio: ;\",\n        \"context_id\": \"573058148988@s.whatsapp.net\"\n      }\n    ]\n  },\n  \"connections\": {\n    \"Wait\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check Inactivity + Count\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Map ouput\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"Mod input\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"waiting_reply?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get buffer\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Information Extractor\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"WaitSeconds\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get last_seen\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get last_seen\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get buffer_count\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set last_seen\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"No Operation, do nothing2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"waiting_reply?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"No Operation, do nothing2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Set waiting_reply\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Buffer messages\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set buffer_count increment\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Set last_seen\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Get waiting_reply\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Mock input data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"get wait seconds\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Delete buffer_in\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"No Operation, do nothing3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get buffer_count\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check Inactivity + Count\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"get wait seconds\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Buffer messages\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get waiting_reply\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Mod input\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Information Extractor\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set waiting_reply\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"WaitSeconds\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Delete waiting_reply\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"No Operation, do nothing3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Delete waiting_reply1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"No Operation, do nothing3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Information Extractor\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Map ouput\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Delete buffer_in\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Delete waiting_reply\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Delete waiting_reply1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check Inactivity + Count\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get buffer\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"No Operation, do nothing1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"No Operation, do nothing1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Wait\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set buffer_count increment\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"No Operation, do nothing2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When chat message received\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Mock input data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When Executed by Another Workflow\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"get wait seconds\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Mock input data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.noOp",
      "@n8n/n8n-nodes-langchain.informationExtractor",
      "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "n8n-nodes-base.code",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.set",
      "n8n-nodes-base.if",
      "@n8n/n8n-nodes-langchain.chatTrigger",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.wait",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.set",
      "n8n-nodes-base.if",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.noOp",
      "n8n-nodes-base.wait",
      "n8n-nodes-base.executeWorkflowTrigger",
      "n8n-nodes-base.set",
      "n8n-nodes-base.noOp",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}