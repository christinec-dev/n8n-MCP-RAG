{
  "source": "1623_Stopanderror_Code_Import_Triggered.json",
  "index": 1,
  "content": "{\n  \"id\": \"QyMyf3zraY0wxXDf\",\n  \"meta\": {\n    \"instanceId\": \"ba3fa76a571c35110ef5f67e5099c9a5c1768ef125c2f3b804ba20de75248c0b\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Load Prompts from Github Repo and auto populate n8n expressions\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"34781446-b06e-41eb-83b8-b96bda1a5595\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -80,\n        0\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c53b7243-7c82-47e0-a5ee-bd82bc51c386\",\n      \"name\": \"GitHub\",\n      \"type\": \"n8n-nodes-base.github\",\n      \"position\": [\n        600,\n        0\n      ],\n      \"parameters\": {\n        \"owner\": {\n          \"__rl\": true,\n          \"mode\": \"name\",\n          \"value\": \"={{ $json.Account }}\"\n        },\n        \"filePath\": \"={{ $json.path }}{{ $json.prompt }}\",\n        \"resource\": \"file\",\n        \"operation\": \"get\",\n        \"repository\": {\n          \"__rl\": true,\n          \"mode\": \"name\",\n          \"value\": \"={{ $json.repo }}\"\n        },\n        \"additionalParameters\": {}\n      },\n      \"credentials\": {\n        \"githubApi\": {\n          \"id\": \"ostHZNoe8GSsbaQM\",\n          \"name\": \"The GitHub account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9976b199-b744-47a7-9d75-4b831274c01b\",\n      \"name\": \"Extract from File\",\n      \"type\": \"n8n-nodes-base.extractFromFile\",\n      \"position\": [\n        840,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"operation\": \"text\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"26aa4e6a-c487-4cdf-91d5-df660cf826a6\",\n      \"name\": \"setVars\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        180,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"150618c5-09b1-4f8b-a7b4-984662bf3381\",\n              \"name\": \"Account\",\n              \"type\": \"string\",\n              \"value\": \"TPGLLC-US\"\n            },\n            {\n              \"id\": \"22e8a3b0-bd53-485c-b971-7f1dd0686f0e\",\n              \"name\": \"repo\",\n              \"type\": \"string\",\n              \"value\": \"PeresPrompts\"\n            },\n            {\n              \"id\": \"ab94d0a1-ef3a-4fe9-9076-6882c6fda0ac\",\n              \"name\": \"path\",\n              \"type\": \"string\",\n              \"value\": \"SEO/\"\n            },\n            {\n              \"id\": \"66f122eb-1cbd-4769-aac8-3f05cdb6c116\",\n              \"name\": \"prompt\",\n              \"type\": \"string\",\n              \"value\": \"keyword_research.md\"\n            },\n            {\n              \"id\": \"03fe26a3-04e6-439c-abcb-d438fc5203c0\",\n              \"name\": \"company\",\n              \"type\": \"string\",\n              \"value\": \"South Nassau Physical Therapy\"\n            },\n            {\n              \"id\": \"c133d216-a457-4872-a060-0ba4d94549af\",\n              \"name\": \"product\",\n              \"type\": \"string\",\n              \"value\": \"Manual Therapy\"\n            },\n            {\n              \"id\": \"584864dd-2518-45e2-b501-02828757fc3a\",\n              \"name\": \"features\",\n              \"type\": \"string\",\n              \"value\": \"pain relief\"\n            },\n            {\n              \"id\": \"0c4594cc-302a-4215-bdad-12cf54f57967\",\n              \"name\": \"sector\",\n              \"type\": \"string\",\n              \"value\": \"physical therapy\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"9d92f581-8cd9-448c-aa1d-023a96c1ddda\",\n      \"name\": \"replace variables\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1900,\n        -20\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Fetch the prompt text\\nconst prompt = $('SetPrompt').first().json.data;  // Ensure the prompt contains placeholders like {{ some.node.value }}\\n\\n// Example variables object\\nconst variables = {\\n  company: $('setVars').first().json.company,\\n  features: \\\"Awesome Software\\\",\\n  keyword: \\\"2025-02-07\\\"\\n};\\n\\n// Function to replace placeholders dynamically\\nconst replaceVariables = (text, vars) => {\\n  return text.replace(/{{(.*?)}}/g, (match, key) => {\\n    const trimmedKey = key.trim();\\n    \\n    // Extract last part after the last dot\\n    const finalKey = trimmedKey.split('.').pop();\\n\\n    // Replace if key exists, otherwise leave placeholder unchanged\\n    return vars.hasOwnProperty(finalKey) ? vars[finalKey] : match;\\n  });\\n};\\n\\n// Replace and return result\\nreturn [{\\n  prompt: replaceVariables(prompt, variables)\\n}];\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"6c6c4fde-6ee5-47a8-894d-44d1afcedc2a\",\n      \"name\": \"If\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1560,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"2717a7e5-095a-42bf-8b5b-8050c3389ec5\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.success }}\",\n              \"rightValue\": \"={{ $('Check All Prompt Vars Present').item.json.keys()}}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"3b7712b8-5152-4f60-9401-03c89c39e227\",\n      \"name\": \"Check All Prompt Vars Present\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1280,\n        0\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Get prompt text\\nconst prompt = $json.data;\\n\\n// Extract variables inside {{ }} dynamically\\nconst matches = [...prompt.matchAll(/{{(.*?)}}/g)];\\nconst uniqueVars = [...new Set(matches.map(match => match[1].trim().split('.').pop()))];\\n\\n// Get variables from the Set Node\\nconst setNodeVariables = $node[\\\"setVars\\\"].json || {};\\n\\n// Log extracted variables and Set Node keys\\nconsole.log(\\\"Extracted Variables:\\\", uniqueVars);\\nconsole.log(\\\"Set Node Keys:\\\", Object.keys(setNodeVariables));\\n\\n// Check if all required variables are present in the Set Node\\nconst missingKeys = uniqueVars.filter(varName => !setNodeVariables.hasOwnProperty(varName));\\n\\nconsole.log(\\\"Missing Keys:\\\", missingKeys);\\n\\n// Return false if any required variable is missing, otherwise return true\\nreturn [{\\n  success: missingKeys.length === 0,\\n  missingKeys: missingKeys\\n}];\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"32618e10-3285-4c16-9e78-058dde329337\",\n      \"name\": \"SetPrompt\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1060,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"335b450d-542a-4714-83d8-ccc237188fc5\",\n              \"name\": \"data\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.data }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"4d8b34ca-50dd-4f37-b4f7-542291461662\",\n      \"name\": \"Stop and Error\",\n      \"type\": \"n8n-nodes-base.stopAndError\",\n      \"position\": [\n        1900,\n        200\n      ],\n      \"parameters\": {\n        \"errorMessage\": \"=Missing Prompt Variables : {{ $('Check All Prompt Vars Present').item.json.missingKeys }}\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a78c1e17-9152-4241-bcdf-c0d723da543b\",\n      \"name\": \"Set Completed Prompt\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2220,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"57a9625b-adea-4ee7-a72a-2be8db15f3d4\",\n              \"name\": \"Prompt\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.prompt }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"51447c90-a222-4172-a49b-86ec43332559\",\n      \"name\": \"AI Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        2440,\n        -20\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $json.Prompt }}\",\n        \"options\": {},\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.7\n    },\n    {\n      \"id\": \"f15b6af1-7af2-4515-be8f-960211118dce\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        60,\n        -120\n      ],\n      \"parameters\": {\n        \"width\": 340,\n        \"height\": 260,\n        \"content\": \"# Set The variables in your prompt here\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"163db6cc-5b06-4ae6-ac97-5890b37cdb18\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        520,\n        -120\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"content\": \"## The repo is currently public for you to test with\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"83ff6a86-a759-42a9-ace4-e20d57b906db\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1780,\n        -200\n      ],\n      \"parameters\": {\n        \"width\": 360,\n        \"height\": 260,\n        \"content\": \"## Replaces the values in the prompt with the variables in the \\n# 'setVars' Node\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7dd61153-84ac-4b59-b449-333825476c33\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2000,\n        180\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"content\": \"## If you're missing variables they will be listed here\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1f070dc3-3d25-41d8-b534-912ba7c8b2b0\",\n      \"name\": \"Prompt Output\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2800,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"01a30683-c348-4712-a3b1-739fc4a17718\",\n              \"name\": \"promptResponse\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.output }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"2d12a6e2-7976-41b0-8cb2-01466b28269d\",\n      \"name\": \"Ollama Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOllama\",\n      \"position\": [\n        2480,\n        200\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"ollamaApi\": {\n          \"id\": \"ERfZ8mAfQ1b0aoxZ\",\n          \"name\": \"Ollama account\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"4327a337-59e7-4b5b-98e8-93c6be550972\",\n  \"connections\": {\n    \"If\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"replace variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Stop and Error\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"GitHub\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract from File\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"setVars\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"GitHub\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"AI Agent\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Prompt Output\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"SetPrompt\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check All Prompt Vars Present\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract from File\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"SetPrompt\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Ollama Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"replace variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Completed Prompt\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Completed Prompt\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check All Prompt Vars Present\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"setVars\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.github",
      "n8n-nodes-base.extractFromFile",
      "n8n-nodes-base.set",
      "n8n-nodes-base.code",
      "n8n-nodes-base.if",
      "n8n-nodes-base.code",
      "n8n-nodes-base.set",
      "n8n-nodes-base.stopAndError",
      "n8n-nodes-base.set",
      "@n8n/n8n-nodes-langchain.agent",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set",
      "@n8n/n8n-nodes-langchain.lmChatOllama"
    ],
    "trigger": null
  }
}