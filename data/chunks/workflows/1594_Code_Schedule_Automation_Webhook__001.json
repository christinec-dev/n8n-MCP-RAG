{
  "source": "1594_Code_Schedule_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"PRQhetYFkuhxntVH\",\n  \"meta\": {\n    \"instanceId\": \"558d88703fb65b2d0e44613bc35916258b0f0bf983c5d4730c00c424b77ca36a\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Matomo Analytics Report\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"fd35d612-09a6-4dd3-836b-53d03b75f344\",\n      \"name\": \"When clicking â€˜Test workflowâ€™\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        120,\n        360\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c8169606-3abd-4dd3-bd35-fdc0296fc0e1\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        120,\n        160\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {\n              \"field\": \"weeks\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"760a87e3-ed8f-4b1e-a46b-4ceb635020d4\",\n      \"name\": \"Get data from Matomo\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        380,\n        260\n      ],\n      \"parameters\": {\n        \"url\": \"https://shrewd-lyrebird.pikapod.net/index.php\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"contentType\": \"multipart-form-data\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"module\",\n              \"value\": \"API\"\n            },\n            {\n              \"name\": \"method\",\n              \"value\": \"Live.getLastVisitsDetails\"\n            },\n            {\n              \"name\": \"idSite\",\n              \"value\": \"3\"\n            },\n            {\n              \"name\": \"period\",\n              \"value\": \"range\"\n            },\n            {\n              \"name\": \"date\",\n              \"value\": \"last30\"\n            },\n            {\n              \"name\": \"format\",\n              \"value\": \"JSON\"\n            },\n            {\n              \"name\": \"segment\",\n              \"value\": \"visitCount>3\"\n            },\n            {\n              \"name\": \"filter_limit\",\n              \"value\": \"100\"\n            },\n            {\n              \"name\": \"showColumns\",\n              \"value\": \"actionDetails,visitIp,visitorId,visitCount\"\n            },\n            {\n              \"name\": \"token_auth\",\n              \"value\": \"{insert your auth token}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"f9e9a099-3131-4320-8a86-b9add4e43096\",\n      \"name\": \"Parse data from Matomo\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        580,\n        260\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Get input data\\nconst items = $input.all();\\n\\n// Format the visitor data into a clear prompt\\nconst visitorData = items.map(item => {\\n  const visit = item.json;\\n  \\n  const visitorActions = visit.actionDetails.map(action => \\n    `  - Page ${action.pageviewPosition}: ${action.pageTitle}\\\\n    URL: ${action.url}\\\\n    Time Spent: ${action.timeSpentPretty}`\\n  ).join('\\\\n');\\n\\n  return `- Visitor (ID: ${visit.visitorId}):\\\\n  Visit Count: ${visit.visitCount}\\\\n${visitorActions}`;\\n}).join('\\\\n\\\\n');\\n\\n// Create the prompt\\nconst prompt = `Please analyze this visitor data:\\\\n\\\\n${visitorData}\\\\n\\\\nPlease provide insights on:\\\\n1. Common visitor paths\\\\n2. Popular pages\\\\n3. User engagement patterns\\\\n4. Recommendations for improvement`;\\n\\n// Return formatted for LLaMA\\nreturn [{\\n  json: {\\n    messages: [\\n      {\\n        role: \\\"user\\\",\\n        content: prompt\\n      }\\n    ]\\n  }\\n}];\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"387832ee-8397-43f8-bf62-846e4a7a20d0\",\n      \"name\": \"Send data to A.I. for analysis\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        760,\n        260\n      ],\n      \"parameters\": {\n        \"url\": \"https://openrouter.ai/api/v1/chat/completions\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"model\\\": \\\"meta-llama/llama-3.1-70b-instruct:free\\\",\\n  \\\"messages\\\": [\\n    {\\n      \\\"role\\\": \\\"user\\\",\\n      \\\"content\\\": \\\"You are an SEO expert. This is data of visitors who have visited my site more then 3 times and the pages they have visited. Can you give me insights into this data:{{ encodeURIComponent($json.messages[0].content)}}\\\" \\n    }\\n  ]\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"WY7UkF14ksPKq3S8\",\n          \"name\": \"Header Auth account 2\"\n        }\n      },\n      \"typeVersion\": 4.2,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"7ee29949-550e-4f3a-8420-49ca2608bbeb\",\n      \"name\": \"Store results in Baserow\",\n      \"type\": \"n8n-nodes-base.baserow\",\n      \"position\": [\n        1060,\n        260\n      ],\n      \"parameters\": {\n        \"tableId\": 643,\n        \"fieldsUi\": {\n          \"fieldValues\": [\n            {\n              \"fieldId\": 6261,\n              \"fieldValue\": \"={{ DateTime.now().toFormat('yyyy-MM-dd') }}\"\n            },\n            {\n              \"fieldId\": 6262,\n              \"fieldValue\": \"={{ $json.choices[0].message.content }}\"\n            },\n            {\n              \"fieldId\": 6263,\n              \"fieldValue\": \"Your blog name\"\n            }\n          ]\n        },\n        \"operation\": \"create\",\n        \"databaseId\": 121\n      },\n      \"credentials\": {\n        \"baserowApi\": {\n          \"id\": \"8w0zXhycIfCAgja3\",\n          \"name\": \"Baserow account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"684ca1c9-97c3-4464-8ce6-aa6019db0c04\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        80,\n        -360\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 615,\n        \"height\": 289,\n        \"content\": \"## Send Matomo analytics to A.I. and save results to baserow\\n\\nThis workflow will check for visitors who have visited more than 3 times. It will take this week's data and compare it to last week's data and give SEO suggestions.\\n\\n[Watch youtube tutorial here](https://www.youtube.com/watch?v=hGzdhXyU-o8)\\n\\n[Get my SEO A.I. agent system here](https://2828633406999.gumroad.com/l/rumjahn)\\n\\n[ðŸ’¡ You can read more about this workflow here](https://rumjahn.com/how-to-create-an-a-i-agent-to-analyze-matomo-analytics-using-n8n-for-free/)\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"29723224-416e-46b4-a498-90888eb9a41b\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        320,\n        -20\n      ],\n      \"parameters\": {\n        \"width\": 224.51612903225822,\n        \"height\": 461.4193548387107,\n        \"content\": \"## Get Matomo Data\\n \\n1. Enter your Matomo API key at the bottom\\n2. Navigate to Administration > Personal > Security > Auth tokens within your Matomo dashboard. Click on Create new token and provide a purpose for reference.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c694c855-c37a-4717-befd-d7a216f99e2d\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        700,\n        -20\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 225.99936321742769,\n        \"height\": 508.95792207792226,\n        \"content\": \"## Send data to A.I.\\n\\nFill in your Openrouter A.I. credentials. Use Header Auth.\\n- Username: Authorization\\n- Password: Bearer {insert your API key}\\n\\nRemember to add a space after bearer. Also, feel free to modify the prompt to A.1.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fdd12783-0456-4fc7-8030-555f058f2fd2\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        960,\n        -20\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 331.32883116883124,\n        \"height\": 474.88,\n        \"content\": \"## Send data to Baserow\\n\\nCreate a table first with the following columns:\\n- Date\\n- Note\\n- Blog\\n\\nEnter the name of your website under \\\"Blog\\\" field.\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"21a1d486-5bb8-40b9-9032-6ab22d8baebc\",\n  \"connections\": {\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get data from Matomo\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get data from Matomo\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Parse data from Matomo\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Parse data from Matomo\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send data to A.I. for analysis\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Send data to A.I. for analysis\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Store results in Baserow\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking â€˜Test workflowâ€™\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get data from Matomo\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.code",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.baserow",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": "schedule trigger"
  }
}