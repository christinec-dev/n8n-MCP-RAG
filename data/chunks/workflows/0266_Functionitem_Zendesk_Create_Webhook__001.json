{
  "source": "0266_Functionitem_Zendesk_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"237600ca44303ce91fa31ee72babcdc8493f55ee2c0e8aa2b78b3b4ce6f70bd9\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"9d40c0b9-498f-421c-b731-3a387402b69a\",\n      \"name\": \"Get last execution timestamp\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        380,\n        360\n      ],\n      \"parameters\": {\n        \"functionCode\": \"// Code here will run once per input item.\\n// More info and help: https://docs.n8n.io/nodes/n8n-nodes-base.functionItem\\n// Tip: You can use luxon for dates and $jmespath for querying JSON structures\\n\\n// Add a new field called 'myNewField' to the JSON of the item\\nconst staticData = getWorkflowStaticData('global');\\n\\nif(!staticData.lastExecution){\\n  staticData.lastExecution = new Date().getTime();\\n}\\n\\nitem.executionTimeStamp = new Date().getTime();\\nitem.lastExecution = staticData.lastExecution;\\n\\n\\nreturn item;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ddb12f68-1f6b-41fb-bfd4-038697ce4d75\",\n      \"name\": \"Set new last execution timestamp\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        3280,\n        380\n      ],\n      \"parameters\": {\n        \"functionCode\": \"// Code here will run once per input item.\\n// More info and help: https://docs.n8n.io/nodes/n8n-nodes-base.functionItem\\n// Tip: You can use luxon for dates and $jmespath for querying JSON structures\\n\\n// Add a new field called 'myNewField' to the JSON of the item\\nconst staticData = getWorkflowStaticData('global');\\n\\nstaticData.lastExecution = $item(0).$node[\\\"Get last execution timestamp\\\"].executionTimeStamp;\\n\\nreturn item;\"\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"42888df0-1f7e-4990-87b3-3226a474110e\",\n      \"name\": \"Get tickets created after last execution\",\n      \"type\": \"n8n-nodes-base.zendesk\",\n      \"position\": [\n        620,\n        360\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"query\": \"=created>{{ $json[\\\"lastExecution\\\"] }}\",\n          \"sortBy\": \"updated_at\",\n          \"sortOrder\": \"desc\"\n        },\n        \"operation\": \"getAll\"\n      },\n      \"credentials\": {\n        \"zendeskApi\": {\n          \"id\": \"5\",\n          \"name\": \"Zendesk account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2f0f71f6-3d4c-4895-9313-7f47e3b2ed86\",\n      \"name\": \"Get requester information\",\n      \"type\": \"n8n-nodes-base.zendesk\",\n      \"position\": [\n        840,\n        460\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $json[\\\"requester_id\\\"] }}\",\n        \"resource\": \"user\",\n        \"operation\": \"get\"\n      },\n      \"credentials\": {\n        \"zendeskApi\": {\n          \"id\": \"5\",\n          \"name\": \"Zendesk account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"284fd54b-bd7b-4fbb-8a14-0c4fa62a3200\",\n      \"name\": \"Keep only needed requester information\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1060,\n        460\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"number\": [\n            {\n              \"name\": \"requester_id\",\n              \"value\": \"={{ $json[\\\"id\\\"] }}\"\n            }\n          ],\n          \"string\": [\n            {\n              \"name\": \"requester_email\",\n              \"value\": \"={{ $json[\\\"email\\\"] }}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"17c3b860-60cb-4885-b503-9086b461bde0\",\n      \"name\": \"Keep only requester owner email\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2000,\n        480\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"requester_pipedrive_email\",\n              \"value\": \"={{ $node[\\\"Search requester in pipedrive\\\"].json[\\\"primary_email\\\"] }}\"\n            },\n            {\n              \"name\": \"requester_pipedrive_owner_email\",\n              \"value\": \"={{ $json[\\\"data\\\"].email }}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a4ccf1d7-5d9f-4c4e-a5b9-c54ed77c5c44\",\n      \"name\": \"Every 5 minutes\",\n      \"type\": \"n8n-nodes-base.cron\",\n      \"position\": [\n        160,\n        360\n      ],\n      \"parameters\": {\n        \"triggerTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyX\",\n              \"unit\": \"minutes\",\n              \"value\": 5\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"99fb51d8-0d93-4db9-868d-757046d1bdc2\",\n      \"name\": \"Add requester information to ticket data\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1280,\n        380\n      ],\n      \"parameters\": {\n        \"mode\": \"mergeByKey\",\n        \"propertyName1\": \"requester_id\",\n        \"propertyName2\": \"requester_id\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a4c7acd0-b2b6-48bb-b7b7-d2826ddb1f9d\",\n      \"name\": \"Search requester in pipedrive\",\n      \"type\": \"n8n-nodes-base.pipedrive\",\n      \"position\": [\n        1560,\n        480\n      ],\n      \"parameters\": {\n        \"term\": \"={{ $json[\\\"requester_email\\\"] }}\",\n        \"resource\": \"person\",\n        \"operation\": \"search\",\n        \"additionalFields\": {\n          \"fields\": \"email\"\n        }\n      },\n      \"credentials\": {\n        \"pipedriveApi\": {\n          \"id\": \"1\",\n          \"name\": \"Pipedrive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7a8a3bf3-9f57-40ad-a31f-45522264f101\",\n      \"name\": \"Get owner information of Pipedrive contact\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1780,\n        480\n      ],\n      \"parameters\": {\n        \"url\": \"=https://n8n.pipedrive.com/api/v1/users/{{$json[\\\"owner\\\"][\\\"id\\\"]}}\",\n        \"options\": {},\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"pipedriveApi\"\n      },\n      \"credentials\": {\n        \"pipedriveApi\": {\n          \"id\": \"1\",\n          \"name\": \"Pipedrive account\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"64a7fc0c-ddb4-4d84-86a6-3e9bd361ce46\",\n      \"name\": \"Get agents and admins\",\n      \"type\": \"n8n-nodes-base.zendesk\",\n      \"position\": [\n        1780,\n        700\n      ],\n      \"parameters\": {\n        \"filters\": {\n          \"role\": [\n            \"agent\",\n            \"admin\"\n          ]\n        },\n        \"resource\": \"user\",\n        \"operation\": \"getAll\",\n        \"returnAll\": true\n      },\n      \"credentials\": {\n        \"zendeskApi\": {\n          \"id\": \"5\",\n          \"name\": \"Zendesk account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0117d5f8-e9b2-46c9-9777-7ae82e002cc2\",\n      \"name\": \"Keep only email and Id\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2000,\n        700\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"agent_email\",\n              \"value\": \"={{ $json[\\\"email\\\"] }}\"\n            },\n            {\n              \"name\": \"agent_id\",\n              \"value\": \"={{ $json[\\\"id\\\"] }}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"eaa7b072-0499-4b3a-96af-433d3afc12f9\",\n      \"name\": \"Add Pipedrive agent data to pipedrive contact information\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        2280,\n        500\n      ],\n      \"parameters\": {\n        \"mode\": \"mergeByKey\",\n        \"propertyName1\": \"requester_pipedrive_owner_email\",\n        \"propertyName2\": \"agent_email\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b9619e3d-c951-47ae-bbb5-db50e7ae5abe\",\n      \"name\": \"Add contact owner to ticket data\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        2540,\n        400\n      ],\n      \"parameters\": {\n        \"mode\": \"mergeByKey\",\n        \"propertyName1\": \"requester_email\",\n        \"propertyName2\": \"requester_pipedrive_email\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"14f88f5f-2bab-42f2-bea7-a7566e6d45b1\",\n      \"name\": \"Contact exists in Pipedrive\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        2760,\n        400\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json[\\\"agent_id\\\"] }}\",\n              \"operation\": \"isNotEmpty\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"38da1ccc-3d23-41cd-84b3-6fc249aedca5\",\n      \"name\": \"Change assignee to Pipedrive contact owner\",\n      \"type\": \"n8n-nodes-base.zendesk\",\n      \"position\": [\n        3020,\n        380\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $json[\\\"id\\\"] }}\",\n        \"operation\": \"update\",\n        \"updateFields\": {\n          \"assigneeEmail\": \"={{$json[\\\"requester_pipedrive_owner_email\\\"]}}\"\n        }\n      },\n      \"credentials\": {\n        \"zendeskApi\": {\n          \"id\": \"5\",\n          \"name\": \"Zendesk account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4295e0e2-88e8-4f93-8432-47fff452cfc5\",\n      \"name\": \"Add a note requester not found\",\n      \"type\": \"n8n-nodes-base.zendesk\",\n      \"position\": [\n        3020,\n        580\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $json[\\\"id\\\"] }}\",\n        \"operation\": \"update\",\n        \"updateFields\": {\n          \"internalNote\": \"Requester not found in Pipedrive\"\n        }\n      },\n      \"credentials\": {\n        \"zendeskApi\": {\n          \"id\": \"5\",\n          \"name\": \"Zendesk account\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Every 5 minutes\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get last execution timestamp\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get agents and admins\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Keep only email and Id\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Keep only email and Id\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add Pipedrive agent data to pipedrive contact information\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Get requester information\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Keep only needed requester information\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Contact exists in Pipedrive\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Change assignee to Pipedrive contact owner\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Add a note requester not found\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get last execution timestamp\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get tickets created after last execution\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Search requester in pipedrive\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get owner information of Pipedrive contact\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Add a note requester not found\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set new last execution timestamp\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Keep only requester owner email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add Pipedrive agent data to pipedrive contact information\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Add contact owner to ticket data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Contact exists in Pipedrive\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Keep only needed requester information\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add requester information to ticket data\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Add requester information to ticket data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Search requester in pipedrive\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Add contact owner to ticket data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get tickets created after last execution\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add requester information to ticket data\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Get requester information\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Change assignee to Pipedrive contact owner\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set new last execution timestamp\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get owner information of Pipedrive contact\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Keep only requester owner email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Add Pipedrive agent data to pipedrive contact information\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add contact owner to ticket data\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.functionItem",
      "n8n-nodes-base.functionItem",
      "n8n-nodes-base.zendesk",
      "n8n-nodes-base.zendesk",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.cron",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.pipedrive",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.zendesk",
      "n8n-nodes-base.set",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.if",
      "n8n-nodes-base.zendesk",
      "n8n-nodes-base.zendesk"
    ],
    "trigger": null
  }
}