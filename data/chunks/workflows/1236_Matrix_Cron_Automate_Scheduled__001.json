{
  "source": "1236_Matrix_Cron_Automate_Scheduled.json",
  "index": 1,
  "content": "{\n  \"id\": \"9\",\n  \"name\": \"Coffee Bot (Matrix)\",\n  \"nodes\": [\n    {\n      \"name\": \"Greetings\",\n      \"type\": \"n8n-nodes-base.matrix\",\n      \"position\": [\n        670,\n        240\n      ],\n      \"parameters\": {\n        \"text\": \"üëã Happy Monday Groups for this week's virtual coffee are:\",\n        \"roomId\": \"Enter your Room ID\"\n      },\n      \"credentials\": {\n        \"matrixApi\": \"Matrix Creds\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Employees in coffee chat channel\",\n      \"type\": \"n8n-nodes-base.matrix\",\n      \"position\": [\n        880,\n        240\n      ],\n      \"parameters\": {\n        \"roomId\": \"Enter your Room ID\",\n        \"filters\": {\n          \"membership\": \"\"\n        },\n        \"resource\": \"roomMember\"\n      },\n      \"credentials\": {\n        \"matrixApi\": \"Enter Your Matrix Credentials\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Weekly trigger on monday1\",\n      \"type\": \"n8n-nodes-base.cron\",\n      \"position\": [\n        480,\n        240\n      ],\n      \"parameters\": {\n        \"triggerTimes\": {\n          \"item\": [\n            {\n              \"hour\": 10,\n              \"mode\": \"everyWeek\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Divide into groups\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"notes\": \"This still needs to be reconfigured to grab the information from the second Matrix node. Have an issue with the \",\n      \"position\": [\n        1090,\n        240\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const ideal_group_size = 3;\\nlet groups = [];\\nlet data_as_array = [];\\nlet newItems = [];\\n\\n// Take all the users and add them to an array\\nfor (let j = 0; j < items.length; j++) {\\n  data_as_array.push({username: items[j].json.user_id});\\n}\\n\\n// Fisher-Yates (aka Knuth) Shuffle\\nfunction shuffle(array) {\\n  var currentIndex = array.length, temporaryValue, randomIndex;\\n\\n  // While there remain elements to shuffle...\\n  while (0 !== currentIndex) {\\n\\n    // Pick a remaining element...\\n    randomIndex = Math.floor(Math.random() * currentIndex);\\n    currentIndex -= 1;\\n\\n    // And swap it with the current element.\\n    temporaryValue = array[currentIndex];\\n    array[currentIndex] = array[randomIndex];\\n    array[randomIndex] = temporaryValue;\\n  }\\n\\n  return array;\\n}\\n\\n// Randomize the sequence of names in the array\\ndata_as_array = shuffle(data_as_array);\\n\\n// Create groups of ideal group size (3)\\nfor (let i = 0; i < data_as_array.length; i += ideal_group_size) {\\n  groups.push(data_as_array.slice(i, i + ideal_group_size));\\n}\\n\\n// Make sure that no group has just one person. If it does, take\\n// one from previous group and add it to that group \\nfor (let k = 0; k < groups.length; k++) {\\n  if (groups[k].length === 1) {\\n    groups[k].push(groups[k-1].shift());\\n  }\\n}\\n\\nfor (let l = 0; l < groups.length; l++) {\\n    newItems.push({json: {groupsUsername: groups[l].map(a=> a.username)}})\\n}\\n\\nreturn newItems;\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Announce groups\",\n      \"type\": \"n8n-nodes-base.matrix\",\n      \"position\": [\n        1290,\n        240\n      ],\n      \"parameters\": {\n        \"text\": \"=‚òÄÔ∏è {{$node[\\\"Divide into groups\\\"].json[\\\"groupsUsername\\\"].join(', ')}}\",\n        \"roomId\": \"!hobuowPzLuKnojiyfV:matrix.org\"\n      },\n      \"credentials\": {\n        \"matrixApi\": \"Matrix Creds\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": true,\n  \"settings\": {},\n  \"connections\": {\n    \"Greetings\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Employees in coffee chat channel\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Divide into groups\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Announce groups\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Weekly trigger on monday1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Greetings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Employees in coffee chat channel\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Divide into groups\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.matrix",
      "n8n-nodes-base.matrix",
      "n8n-nodes-base.cron",
      "n8n-nodes-base.function",
      "n8n-nodes-base.matrix"
    ],
    "trigger": "weekly trigger on monday1"
  }
}