{
  "source": "0818_GoogleSheets_Respondtowebhook_Import_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"f4f5d195bb2162a0972f737368404b18be694648d365d6c6771d7b4909d28167\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"9a8d7d07-a1b3-4bca-8e77-10da3a2abc45\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        -160,\n        0\n      ],\n      \"webhookId\": \"7f35a3a8-54c3-49d7-879d-6c3429f0e5da\",\n      \"parameters\": {\n        \"path\": \"retell-dynamic-variables\",\n        \"options\": {\n          \"ipWhitelist\": \"100.20.5.228\"\n        },\n        \"httpMethod\": \"POST\",\n        \"responseMode\": \"responseNode\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"79e77d72-6e13-428c-ad10-58e6930e2d90\",\n      \"name\": \"Respond to Webhook\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        440,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"respondWith\": \"json\",\n        \"responseBody\": \"={\\n  \\\"call_inbound\\\": {\\n    \\\"dynamic_variables\\\": {\\n        \\\"first_name\\\": \\\"{{ $json['First Name'] }}\\\",\\n        \\\"last_name\\\": \\\"{{ $json['Last name'] }}\\\",\\n        \\\"email\\\": \\\"{{ $json['E-Mail'] }}\\\",\\n        \\\"variable_1\\\": \\\"{{ $json['User Variable 1'] }}\\\",\\n        \\\"variable_2\\\": \\\"{{ $json['User Variable 2']}}\\\"\\n    },\\n    \\\"metadata\\\": {\\n    }\\n  }\\n}\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"10919781-9750-417f-bba6-293bf99dbc3e\",\n      \"name\": \"Get user in DB by Phone Number\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        140,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"filtersUI\": {\n          \"values\": [\n            {\n              \"lookupValue\": \"={{ $json.body.call_inbound.from_number }}\",\n              \"lookupColumn\": \"Phone Number\"\n            }\n          ]\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1TYgk8PK5w2l8Q5NtepdyLvgtuHXBHcODy-2hXOPP6AU/edit#gid=0\",\n          \"cachedResultName\": \"Users\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1TYgk8PK5w2l8Q5NtepdyLvgtuHXBHcODy-2hXOPP6AU\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1TYgk8PK5w2l8Q5NtepdyLvgtuHXBHcODy-2hXOPP6AU/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Retell sample UserDB\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"ufBkeygvc1l17m5N\",\n          \"name\": \"Baptiste AS - Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"de9a2ff5-690e-4e1e-ab5c-5a8825986871\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -880,\n        -440\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 601,\n        \"height\": 1105,\n        \"content\": \"## Handle Retell's Inbound call webhooks\\n\\n## Overview\\n- This workflow provides Retell agent builders with a simple way to populate [dynamic variables](https://docs.retellai.com/build/dynamic-variables) using n8n.\\n- The workflow fetches user information from a Google Sheet based on the phone number and sends it back to Retell.\\n- It is based on Retell's [Inbound Webhook Call](https://docs.retellai.com/features/inbound-call-webhook).\\n- Retell is a service that lets you create Voice Agents that handle voice calls simply, based on a prompt or using a conversational flow builder.\\n\\n## Prerequisites\\n- Have a [Retell AI Account](https://www.retellai.com/)\\n- [Create a Retell agent](https://docs.retellai.com/get-started/quick-start)\\n- [Purchase a phone number](https://docs.retellai.com/deploy/purchase-number) and associate it with your agent\\n- Create a Google Sheets - for example, [make a copy of this one](https://docs.google.com/spreadsheets/d/1TYgk8PK5w2l8Q5NtepdyLvgtuHXBHcODy-2hXOPP6AU/edit?usp=sharing).\\n- Your Google Sheet must have at least one column with the phone number. The remaining columns will be used to populate your Retell agent’s dynamic variables.\\n- All fields are returned as strings to Retell (variables are replaced as text)\\n\\n## How it works\\n- The webhook call is received from Retell. We filter the call using their whitelisted IP address.\\n- It extracts data from the webhook call and uses it to retrieve the user from Google Sheets.\\n- It formats the data in the response to match Retell's expected format.\\n- Retell uses this data to replace [dynamic variables](https://docs.retellai.com/build/dynamic-variables#dynamic-variables) in the prompts.\\n\\n\\n## How to use it\\nSee the description for screenshots!\\n- Set the webhook name (keep it as POST).\\n- Copy the Webhook URL (e.g., `https://your-instance.app.n8n.cloud/webhook/retell-dynamic-variables`) and paste it into Retell's interface. Navigate to \\\"Phone Numbers\\\", click on the phone number, and enable \\\"Add an inbound webhook\\\".\\n- In your prompt (e.g., \\\"welcome message\\\"), use the variable with this syntax: `{{variable_name}}` (see [Retell's documentation](https://docs.retellai.com/build/dynamic-variables)).\\n- These variables will be dynamically replaced by the data in your Google Sheet.\\n\\n\\n## Notes\\n- In Google Sheets, the phone number must start with `'+'`.\\n- Phone numbers must be formatted like the example: with the `+`, extension, and no spaces.\\n- You can use any database—just replace Google Sheets with your own, making sure to keep the phone number formatting consistent.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"55b087bf-d51f-4660-94c7-3742915ff79b\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -220,\n        -120\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 220,\n        \"height\": 300,\n        \"content\": \"Change the path if needed\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"bd6a7c81-5125-4f46-a1ba-86029d3a0eda\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        80,\n        -120\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 220,\n        \"height\": 300,\n        \"content\": \"Replace with your own Google Sheets, including the dynamic variables of your Retell Agent\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7105c832-ffbe-4d36-90ec-b8c868388c4e\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        380,\n        -120\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 220,\n        \"height\": 300,\n        \"content\": \"Adapt the response to match your Retell dynamic variables\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get user in DB by Phone Number\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get user in DB by Phone Number\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Respond to Webhook\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}