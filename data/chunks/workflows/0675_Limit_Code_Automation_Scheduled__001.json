{
  "source": "0675_Limit_Code_Automation_Scheduled.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"id\": \"fc128eed-1666-46b8-8feb-e6ddf05e85d1\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        380,\n        240\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {\n              \"field\": \"hours\",\n              \"hoursInterval\": 2\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"830708eb-197b-4bf7-95da-893d78329ab2\",\n      \"name\": \"Strava\",\n      \"type\": \"n8n-nodes-base.strava\",\n      \"position\": [\n        380,\n        480\n      ],\n      \"parameters\": {\n        \"limit\": 10,\n        \"operation\": \"getAll\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"de776ebf-3ad5-4c4c-b0c8-7bc74cba5446\",\n      \"name\": \"Code\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        380,\n        740\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Obtén los items del nodo \\\"Strava\\\"\\nconst stravaItems = $('strava_last').all();\\n\\n// Obtén los items del nodo \\\"ultimas_id\\\"\\nconst ultimasGuardadasItems = $('saved_last').all();\\n\\n// Extrae las referencias guardadas en un Set, asegurando el formato como cadena\\nconst referenciasGuardadas = new Set(\\n    ultimasGuardadasItems.map(item => String(item.json.id))\\n);\\n\\n// Filtra los items de \\\"Strava\\\" cuyos IDs no estén en las referencias guardadas\\nconst filteredItems = stravaItems.filter(item => {\\n    // Convertir el ID actual de Strava a cadena para comparar correctamente\\n    return !referenciasGuardadas.has(String(item.json.id));\\n});\\n\\n// Depuración: imprime las referencias y los resultados\\nconsole.log('Referencias guardadas:', [...referenciasGuardadas]);\\nconsole.log('Items filtrados:', filteredItems);\\n\\n// Devuelve los items filtrados\\nreturn filteredItems;\\n\\n\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"c8a93e6e-67fc-4f6d-bcde-83d3a885c622\",\n      \"name\": \"Google Sheets\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        900,\n        740\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"Kms\": \"={{ $json.distancia }}\",\n            \"Ref\": \"={{ $json.id }}\",\n            \"Fecha\": \"={{ $json.fecha }}\",\n            \"Track\": \"=http://www.strava.com/activities/{{ $json.id }}\",\n            \"Tiempo\": \"={{ $json.tiempo }}\",\n            \"Desnivel\": \"={{ $json.elevacion }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"Fecha\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Fecha\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Kms\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Kms\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Tiempo\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Tiempo\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Ref\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"Ref\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Track\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Track\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Bicicleta\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Bicicleta\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Terreno\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Terreno\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Desnivel\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"Desnivel\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": []\n        },\n        \"options\": {},\n        \"operation\": \"append\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": 419561402,\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/159k8cDL8hZooz-dsHE6ueWf68mBkHhxVCKnWm-lYLqs/edit#gid=419561402\",\n          \"cachedResultName\": \"n8n\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"159k8cDL8hZooz-dsHE6ueWf68mBkHhxVCKnWm-lYLqs\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/159k8cDL8hZooz-dsHE6ueWf68mBkHhxVCKnWm-lYLqs/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Sherlo_Bike\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"tyg7FJlIITkSazyi\",\n          \"name\": \"Nik's Google\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"0ce07d54-97af-4e88-9d27-452191a0b3ba\",\n      \"name\": \"strava_last\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1420,\n        480\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"423ae4b8-287c-4dc1-b32b-d1b6f1f45efa\",\n              \"name\": \"id\",\n              \"type\": \"number\",\n              \"value\": \"={{ $json.id }}\"\n            },\n            {\n              \"id\": \"595802d2-17d0-40be-9e43-d655ffbf4ce0\",\n              \"name\": \"fecha\",\n              \"type\": \"string\",\n              \"value\": \"={{ DateTime.fromISO($json.start_date_local).toFormat('d/M/yyyy') }}\"\n            },\n            {\n              \"id\": \"4b39d783-19f2-4a7e-b0e6-dbe2b98f1ae0\",\n              \"name\": \"distancia\",\n              \"type\": \"number\",\n              \"value\": \"={{ Math.round($json.distance / 100) / 10 }}\"\n            },\n            {\n              \"id\": \"2f321dc0-435f-4b4d-866c-091ff9eaf9df\",\n              \"name\": \"elevacion\",\n              \"type\": \"number\",\n              \"value\": \"={{ Math.round($json.total_elevation_gain) }}\"\n            },\n            {\n              \"id\": \"ba1bb089-5ae7-4e42-ac65-07323c4e1842\",\n              \"name\": \"tiempo\",\n              \"type\": \"string\",\n              \"value\": \"={{ `${Math.floor($json.moving_time / 3600)}:${Math.floor(($json.moving_time % 3600) / 60).toString().padStart(2, '0')}:${($json.moving_time % 60).toString().padStart(2, '0')}` }}\\n\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"490f7be9-73c9-4431-8b83-fcdbbcc283eb\",\n      \"name\": \"Remove Duplicates\",\n      \"type\": \"n8n-nodes-base.removeDuplicates\",\n      \"position\": [\n        900,\n        480\n      ],\n      \"parameters\": {\n        \"compare\": \"selectedFields\",\n        \"options\": {},\n        \"fieldsToCompare\": \"id\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"2d1c4dc5-2baa-4c89-a312-4b40381d4e5d\",\n      \"name\": \"activities\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        660,\n        240\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": 419561402,\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/159k8cDL8hZooz-dsHE6ueWf68mBkHhxVCKnWm-lYLqs/edit#gid=419561402\",\n          \"cachedResultName\": \"n8n\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"159k8cDL8hZooz-dsHE6ueWf68mBkHhxVCKnWm-lYLqs\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/159k8cDL8hZooz-dsHE6ueWf68mBkHhxVCKnWm-lYLqs/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Sherlo_Bike\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"tyg7FJlIITkSazyi\",\n          \"name\": \"Nik's Google\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"2c7b7939-4ca1-4868-92bf-5fd7384a1103\",\n      \"name\": \"sort_saved\",\n      \"type\": \"n8n-nodes-base.sort\",\n      \"position\": [\n        900,\n        240\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"sortFieldsUi\": {\n          \"sortField\": [\n            {\n              \"fieldName\": \"Ref\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4e1d9064-6dda-4a01-af48-f278792f8b6b\",\n      \"name\": \"last_saved\",\n      \"type\": \"n8n-nodes-base.limit\",\n      \"position\": [\n        1160,\n        240\n      ],\n      \"parameters\": {\n        \"keep\": \"lastItems\",\n        \"maxItems\": 10\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6eb2053a-1101-477b-86e9-113813be2d92\",\n      \"name\": \"saved_last\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1420,\n        240\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"50097932-ab91-4af7-9412-925fab1982f0\",\n              \"name\": \"id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.Ref }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"afd986f1-0c49-4a69-b948-aefcbff1010f\",\n      \"name\": \"sort_strava\",\n      \"type\": \"n8n-nodes-base.sort\",\n      \"position\": [\n        660,\n        480\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"sortFieldsUi\": {\n          \"sortField\": [\n            {\n              \"fieldName\": \"id\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"16094d29-f35b-492c-9d93-3145dab30cd3\",\n      \"name\": \"last_strava\",\n      \"type\": \"n8n-nodes-base.limit\",\n      \"position\": [\n        1160,\n        480\n      ],\n      \"parameters\": {\n        \"keep\": \"lastItems\",\n        \"maxItems\": 10\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9986360b-fcd3-42f4-ad13-aea69f6d1a80\",\n      \"name\": \"sort_results\",\n      \"type\": \"n8n-nodes-base.sort\",\n      \"position\": [\n        660,\n        740\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"sortFieldsUi\": {\n          \"sortField\": [\n            {\n              \"fieldName\": \"id\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Code\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"sort_results\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Strava\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"sort_strava\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"activities\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"sort_saved\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"last_saved\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"saved_last\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"saved_last\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Strava\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"sort_saved\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"last_saved\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"last_strava\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"strava_last\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"sort_strava\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Remove Duplicates\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"strava_last\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Code\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"sort_results\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Google Sheets\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"activities\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Remove Duplicates\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"last_strava\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.strava",
      "n8n-nodes-base.code",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.set",
      "n8n-nodes-base.removeDuplicates",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.sort",
      "n8n-nodes-base.limit",
      "n8n-nodes-base.set",
      "n8n-nodes-base.sort",
      "n8n-nodes-base.limit",
      "n8n-nodes-base.sort"
    ],
    "trigger": "schedule trigger"
  }
}