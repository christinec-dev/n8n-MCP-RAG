{
  "source": "0142_Notion_Webhook_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"name\": \"Get Team Members\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        1030,\n        150\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const newItems = [];\\n\\nfor (const item of items[0].json.body.teamMembers) {\\n  const newItem = { json: item }\\n  newItems.push(newItem);\\n}\\n\\nreturn newItems;\\n\"\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1250,\n        460\n      ],\n      \"parameters\": {\n        \"mode\": \"multiplex\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Query Current Semester\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        700,\n        20\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"sort\": {\n            \"sortValue\": [\n              {\n                \"key\": \"created_time\",\n                \"direction\": \"descending\",\n                \"timestamp\": true\n              }\n            ]\n          },\n          \"filter\": {\n            \"singleCondition\": {\n              \"key\": \"Is Current?|checkbox\",\n              \"condition\": \"equals\",\n              \"checkboxValue\": true\n            }\n          }\n        },\n        \"resource\": \"databasePage\",\n        \"operation\": \"getAll\",\n        \"returnAll\": true,\n        \"databaseId\": \"2003319a-bc73-423a-9378-01999b4884fb\"\n      },\n      \"credentials\": {\n        \"notionApi\": \"Oasis Hub Production\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Select Semester ID and Projects Count\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1030,\n        330\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"number\": [\n            {\n              \"name\": \"projectsCount\",\n              \"value\": \"={{$json[\\\"Projects\\\"].length}}\"\n            }\n          ],\n          \"string\": [\n            {\n              \"name\": \"semesterID\",\n              \"value\": \"={{$json[\\\"id\\\"]}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Use Default Name if Not Specified\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1470,\n        460\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"projectName\",\n              \"value\": \"={{ $json[\\\"projectName\\\"] == \\\"\\\" ? \\\"Project Group \\\" + ($json[\\\"projectsCount\\\"] + 1) : $json[\\\"projectName\\\"] }}\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Select Project Showcase ID\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1890,\n        460\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"projectID\",\n              \"value\": \"={{$json[\\\"id\\\"]}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Get Project Name & Idea\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        820,\n        480\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"projectName\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"projectName\\\"]}}\"\n            },\n            {\n              \"name\": \"projectIdea\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"projectIdea\\\"]}}\"\n            }\n          ],\n          \"boolean\": []\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Create Project\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        1690,\n        460\n      ],\n      \"parameters\": {\n        \"blockUi\": {\n          \"blockValues\": []\n        },\n        \"resource\": \"databasePage\",\n        \"databaseId\": \"f9c8a070-d398-482b-a7a4-5e42c7982e6a\",\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Name|title\",\n              \"title\": \"={{$json[\\\"projectName\\\"]}}\"\n            },\n            {\n              \"key\": \"Semesters|relation\",\n              \"relationValue\": [\n                \"={{$json[\\\"semesterID\\\"]}}\"\n              ]\n            },\n            {\n              \"key\": \"Project Idea|rich_text\",\n              \"textContent\": \"={{$json[\\\"projectIdea\\\"]}}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": \"Oasis Hub Production\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"If user exists\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1690,\n        170\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [],\n          \"boolean\": [\n            {\n              \"value1\": \"={{Object.keys($json).includes(\\\"id\\\") }}\",\n              \"value2\": true\n            }\n          ]\n        }\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"name\": \"Create User\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        1890,\n        270\n      ],\n      \"parameters\": {\n        \"resource\": \"databasePage\",\n        \"databaseId\": \"27a30c5b-c418-4200-8f48-d7fb7b043fbe\",\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Name|title\",\n              \"title\": \"={{$json[\\\"name\\\"]}}\"\n            },\n            {\n              \"key\": \"Email|email\",\n              \"emailValue\": \"={{$json[\\\"email\\\"]}}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": \"Oasis Hub Production\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Query for User\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        1250,\n        260\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"filter\": {\n            \"singleCondition\": {\n              \"key\": \"Email|email\",\n              \"condition\": \"equals\",\n              \"emailValue\": \"={{$json[\\\"email\\\"]}}\"\n            }\n          }\n        },\n        \"resource\": \"databasePage\",\n        \"operation\": \"getAll\",\n        \"returnAll\": true,\n        \"databaseId\": \"27a30c5b-c418-4200-8f48-d7fb7b043fbe\"\n      },\n      \"credentials\": {\n        \"notionApi\": \"Oasis Hub Production\"\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"name\": \"Merge1\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1460,\n        170\n      ],\n      \"parameters\": {\n        \"mode\": \"mergeByKey\",\n        \"propertyName1\": \"email\",\n        \"propertyName2\": \"Email\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Merge2\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        2750,\n        -160\n      ],\n      \"parameters\": {\n        \"mode\": \"multiplex\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Update Semester for User\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        3240,\n        -160\n      ],\n      \"parameters\": {\n        \"pageId\": \"={{$json[\\\"id\\\"]}}\",\n        \"resource\": \"databasePage\",\n        \"operation\": \"update\",\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Semesters|relation\",\n              \"relationValue\": [\n                \"={{$json[\\\"allSemesterIDs\\\"].join(',')}}\"\n              ]\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": \"Oasis Hub Production\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Query User\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        2460,\n        170\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"filter\": {\n            \"singleCondition\": {\n              \"key\": \"Email|email\",\n              \"condition\": \"equals\",\n              \"emailValue\": \"={{$json[\\\"email\\\"]}}\"\n            }\n          }\n        },\n        \"resource\": \"databasePage\",\n        \"operation\": \"getAll\",\n        \"returnAll\": true,\n        \"databaseId\": \"27a30c5b-c418-4200-8f48-d7fb7b043fbe\"\n      },\n      \"credentials\": {\n        \"notionApi\": \"Oasis Hub Production\"\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"name\": \"Select Semester ID\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1020,\n        -180\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"semesterID\",\n              \"value\": \"={{$json[\\\"id\\\"]}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Update Project Relation\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        3240,\n        440\n      ],\n      \"parameters\": {\n        \"pageId\": \"={{$json[\\\"id\\\"]}}\",\n        \"resource\": \"databasePage\",\n        \"operation\": \"update\",\n        \"propertiesUi\": {\n          \"propertyValues\": [\n            {\n              \"key\": \"Project|relation\",\n              \"relationValue\": [\n                \"={{$json[\\\"allProjectIDs\\\"].join(\\\",\\\")}}\"\n              ]\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"notionApi\": \"Oasis Hub Production\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Merge3\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        2750,\n        440\n      ],\n      \"parameters\": {\n        \"mode\": \"multiplex\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Concatenate SemesterIDs\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        3010,\n        -160\n      ],\n      \"parameters\": {\n        \"functionCode\": \"for (item of items) {\\n  // Get the current semester ID\\n  const currentSemesterID = item.json[\\\"semesterID\\\"]\\n  let allSemesterIDs = [currentSemesterID];\\n\\n  // Add semesters that the user is already associated with\\n  if (item.json[\\\"Semesters\\\"]?.length > 0) {\\n    allSemesterIDs = allSemesterIDs.concat(item.json[\\\"Semesters\\\"].filter(semesterID => semesterID !== currentSemesterID));\\n  }\\n\\n  // Set allSemesterIDs which is used to update the relation\\n  item.json[\\\"allSemesterIDs\\\"] = allSemesterIDs\\n}\\n\\nreturn items;\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Concatenate ProjectIDs\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        3000,\n        440\n      ],\n      \"parameters\": {\n        \"functionCode\": \"for (item of items) {\\n  // Get the project id for the new project\\n  const newProjectID = item.json[\\\"projectID\\\"]\\n  let allProjectIDs = [newProjectID];\\n\\n  // Add projects that the user already has\\n  if (item.json[\\\"Project\\\"]?.length > 0) {\\n    allWorkspaceIDs = allWorkspaceIDs.concat(item.json[\\\"Project\\\"].filter(projectID => projectID !== newProjectID));\\n  }\\n\\n  // Set allProjectIDs which is used to update the relation\\n  item.json[\\\"allProjectIDs\\\"] = allProjectIDs\\n}\\n\\nreturn items;\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Merge4\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        2240,\n        170\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set Email\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2060,\n        270\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"email\",\n              \"value\": \"={{$json[\\\"Email\\\"]}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Team Creation\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"notes\": \"Example Input Data:\\n{\\\"projectIdea\\\":\\\"A hub for all things Oasis\\\",\\\"projectName\\\":\\\"Oasis Hub\\\",\\\"teamMembers\\\":[{\\\"name\\\":\\\"Will Stenzel\\\",\\\"email\\\":\\\"stenzel.w@northeastern.edu\\\"},{\\\"name\\\":\\\"Jane Doe\\\",\\\"email\\\":\\\"doe.j@northeastern.edu\\\"}]}\",\n      \"position\": [\n        460,\n        150\n      ],\n      \"webhookId\": \"6f000a46-9bbf-4e1c-8e11-b64d9b8c8fb7\",\n      \"parameters\": {\n        \"path\": \"team-create\",\n        \"options\": {\n          \"responseData\": \"\"\n        },\n        \"httpMethod\": \"POST\",\n        \"authentication\": \"basicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": \"Oasis Basic Auth Creds\"\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Use Default Name if Not Specified\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If user exists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Concatenate SemesterIDs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge3\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Concatenate ProjectIDs\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge4\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Query User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Email\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge4\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Query User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge2\",\n            \"type\": \"main\",\n            \"index\": 1\n          },\n          {\n            \"node\": \"Merge3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Team Creation\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Project Name & Idea\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Get Team Members\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Query Current Semester\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Project\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Select Project Showcase ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If user exists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge4\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Create User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Query for User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge1\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Get Team Members\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Query for User\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Merge1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Select Semester ID\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Concatenate ProjectIDs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Project Relation\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Query Current Semester\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Select Semester ID and Projects Count\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Select Semester ID\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Concatenate SemesterIDs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Semester for User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Project Name & Idea\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Select Project Showcase ID\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge3\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Use Default Name if Not Specified\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Project\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Select Semester ID and Projects Count\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.function",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.if",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.set",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.function",
      "n8n-nodes-base.function",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.set",
      "n8n-nodes-base.webhook"
    ],
    "trigger": null
  }
}