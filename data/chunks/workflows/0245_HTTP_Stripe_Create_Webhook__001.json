{
  "source": "0245_HTTP_Stripe_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"237600ca44303ce91fa31ee72babcdc8493f55ee2c0e8aa2b78b3b4ce6f70bd9\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"acf47a04-1f3f-448a-b571-a94c84004c45\",\n      \"name\": \"Current won time Not Equal to Previous\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        140,\n        260\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json[\\\"current\\\"].won_time}}\",\n              \"value2\": \"={{ $json[\\\"previous\\\"].won_time}}\",\n              \"operation\": \"notEqual\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"452a0208-be12-4aac-8c1a-9101ab79f8fb\",\n      \"name\": \"On deal updated\",\n      \"type\": \"n8n-nodes-base.pipedriveTrigger\",\n      \"position\": [\n        -80,\n        260\n      ],\n      \"webhookId\": \"af0f5626-e92f-4e29-bdc8-8e13c9c9cf99\",\n      \"parameters\": {\n        \"action\": \"updated\",\n        \"object\": \"deal\"\n      },\n      \"credentials\": {\n        \"pipedriveApi\": {\n          \"id\": \"1\",\n          \"name\": \"Pipedrive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"202b9a47-2f00-43ec-bbab-ba82f94e4174\",\n      \"name\": \"Get organisation details\",\n      \"type\": \"n8n-nodes-base.pipedrive\",\n      \"position\": [\n        380,\n        240\n      ],\n      \"parameters\": {\n        \"resource\": \"organization\",\n        \"operation\": \"get\",\n        \"organizationId\": \"={{ $json[\\\"current\\\"].org_id }}\",\n        \"resolveProperties\": true\n      },\n      \"credentials\": {\n        \"pipedriveApi\": {\n          \"id\": \"1\",\n          \"name\": \"Pipedrive account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b88e18a3-1514-424f-ba96-c8bb94c14cb3\",\n      \"name\": \"Search customer\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        600,\n        100\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.stripe.com/v1/customers/search\",\n        \"options\": {},\n        \"authentication\": \"predefinedCredentialType\",\n        \"queryParametersUi\": {\n          \"parameter\": [\n            {\n              \"name\": \"query\",\n              \"value\": \"=name:'{{ $json[\\\"Name\\\"] }}'\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"stripeApi\"\n      },\n      \"credentials\": {\n        \"stripeApi\": {\n          \"id\": \"3\",\n          \"name\": \"Stripe account\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"b4a4491e-8d69-41b6-83a4-128f228108e3\",\n      \"name\": \"Customer does not exist\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        860,\n        100\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ JSON.stringify($json[\\\"data\\\"]) }}\",\n              \"value2\": \"[]\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6aeaa043-ce4b-4665-a1eb-9fe66d86202f\",\n      \"name\": \"Continue with organisation data\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        1120,\n        220\n      ],\n      \"parameters\": {\n        \"mode\": \"passThrough\",\n        \"output\": \"input2\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"21bc3b5a-72eb-4015-957a-7facfce371e0\",\n      \"name\": \"Create customer\",\n      \"type\": \"n8n-nodes-base.stripe\",\n      \"position\": [\n        1360,\n        220\n      ],\n      \"parameters\": {\n        \"name\": \"={{ $json[\\\"Name\\\"] }}\",\n        \"resource\": \"customer\",\n        \"operation\": \"create\",\n        \"additionalFields\": {\n          \"address\": {\n            \"details\": {\n              \"city\": \"={{ $json[\\\"City/town/village/locality\\\"] }}\",\n              \"line1\": \"={{ $json[\\\"Street/road name\\\"] }} {{ $json[\\\"House number\\\"] }}\",\n              \"state\": \"={{ $json[\\\"State/county\\\"] }}\",\n              \"country\": \"={{ $json[\\\"Country\\\"] }}\",\n              \"postal_code\": \"={{ $json[\\\"ZIP/Postal code\\\"] }}\"\n            }\n          }\n        }\n      },\n      \"credentials\": {\n        \"stripeApi\": {\n          \"id\": \"3\",\n          \"name\": \"Stripe account\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"On deal updated\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Current won time Not Equal to Previous\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Search customer\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Customer does not exist\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Customer does not exist\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Continue with organisation data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get organisation details\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Search customer\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Continue with organisation data\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Continue with organisation data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create customer\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Current won time Not Equal to Previous\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get organisation details\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.if",
      "n8n-nodes-base.pipedriveTrigger",
      "n8n-nodes-base.pipedrive",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.if",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.stripe"
    ],
    "trigger": null
  }
}