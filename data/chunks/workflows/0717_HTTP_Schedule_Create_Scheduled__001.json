{
  "source": "0717_HTTP_Schedule_Create_Scheduled.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"b9a807c3-5847-477a-a242-2fdf5b15ba7e\",\n      \"name\": \"API to Check existing merge request\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -840,\n        -20\n      ],\n      \"parameters\": {\n        \"url\": \"=https://gitlab.com/<projectid>/merge_requests\",\n        \"options\": {\n          \"allowUnauthorizedCerts\": false\n        },\n        \"sendQuery\": true,\n        \"sendHeaders\": true,\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"state\",\n              \"value\": \"opened\"\n            },\n            {\n              \"name\": \"source_branch\",\n              \"value\": \"=sourceBranchName\"\n            }\n          ]\n        },\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"PRIVATE-TOKEN\",\n              \"value\": \"=gitlabToken\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"42270a5a-d696-44f3-b2f5-16b2ddb3488c\",\n      \"name\": \"Is Exists\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -660,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"d895b8cc-5679-442f-a1bf-d8375174a24b\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $node[\\\"API to Check existing merge request\\\"].data.isEmpty() }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"d380c943-0525-4976-9e70-c90de1177f0c\",\n      \"name\": \"Create New Merge Request\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -440,\n        -200\n      ],\n      \"parameters\": {\n        \"url\": \"=https://gitlab.com/<projectid>/merge_requests\",\n        \"method\": \"POST\",\n        \"options\": {\n          \"allowUnauthorizedCerts\": false\n        },\n        \"sendBody\": true,\n        \"contentType\": \"form-urlencoded\",\n        \"sendHeaders\": true,\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"source_branch\",\n              \"value\": \"=sourceBranchName\"\n            },\n            {\n              \"name\": \"target_branch\",\n              \"value\": \"=targetBranchName\"\n            },\n            {\n              \"name\": \"title\",\n              \"value\": \"=mergeTitle\"\n            }\n          ]\n        },\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"PRIVATE-TOKEN\",\n              \"value\": \"=gitlabToken\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"600a0ed5-cb68-4479-8aee-55b55f0d8630\",\n      \"name\": \"Loop Over Items\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        -440,\n        160\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"555643cb-761c-41ec-b983-8e0194851a8d\",\n      \"name\": \"API to CLOSE existing Merge Request\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -220,\n        180\n      ],\n      \"parameters\": {\n        \"url\": \"=https://gitlab.com/<projectid>/merge_requests/<merge_iid>\",\n        \"method\": \"PUT\",\n        \"options\": {\n          \"allowUnauthorizedCerts\": false\n        },\n        \"sendBody\": true,\n        \"contentType\": \"form-urlencoded\",\n        \"sendHeaders\": true,\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"state_event\",\n              \"value\": \"close\"\n            }\n          ]\n        },\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"PRIVATE-TOKEN\",\n              \"value\": \"=gitlabToken\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"0c94b06a-80e3-4e50-8bac-2bd4015f085e\",\n      \"name\": \"Add Custom Notes To Merge Request\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -220,\n        -200\n      ],\n      \"parameters\": {\n        \"url\": \"=https://gitlab.com/<projectid>/merge_requests/<merge_iid>/notes\",\n        \"method\": \"POST\",\n        \"options\": {\n          \"allowUnauthorizedCerts\": false\n        },\n        \"sendBody\": true,\n        \"contentType\": \"form-urlencoded\",\n        \"sendHeaders\": true,\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"body\",\n              \"value\": \"=<mergeComments>\"\n            }\n          ]\n        },\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"PRIVATE-TOKEN\",\n              \"value\": \"=gitlabToken\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"8e849f4f-2a52-46ba-9e0a-17126a8d966c\",\n      \"name\": \"30 secs wait to approve merge request and pipeline to finish1\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        140,\n        -200\n      ],\n      \"webhookId\": \"ac7bb2de-2c6f-479a-8807-13a29d8eaf5e\",\n      \"parameters\": {\n        \"amount\": 30\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"05cca829-b2df-4c1e-9441-56349acc4a0d\",\n      \"name\": \"Merge When Pipeline Succeeds\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        720,\n        -200\n      ],\n      \"parameters\": {\n        \"url\": \"=https://gitlab.com/<projectid>/merge_requests/<merge_iid>/merge\",\n        \"method\": \"PUT\",\n        \"options\": {\n          \"allowUnauthorizedCerts\": false\n        },\n        \"jsonBody\": \"={\\n\\\"merge_when_pipeline_succeeds\\\": {{ $('setValueForMerge').item.json.merge_when_pipeline_succeeds }},\\n  \\\"should_remove_source_branch\\\": {{ $('setValueForMerge').item.json.should_remove_source_branch }}\\n}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"PRIVATE-TOKEN\",\n              \"value\": \"=gitlabToken\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"e3ce9cdc-5484-4b4b-8701-6b9089a1f76d\",\n      \"name\": \"setValueForMerge\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        460,\n        -200\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"a22922c7-0c69-4ac1-bd15-4d289fa57737\",\n              \"name\": \"merge_when_pipeline_succeeds\",\n              \"type\": \"boolean\",\n              \"value\": false\n            },\n            {\n              \"id\": \"17580668-84d9-4ad6-b93b-e7b6c9c0f8ea\",\n              \"name\": \"should_remove_source_branch\",\n              \"type\": \"boolean\",\n              \"value\": true\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"0d49ec98-4806-492e-a6c2-a298ed8bb11a\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        -1160,\n        -20\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {}\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Is Exists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create New Merge Request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"API to Check existing merge request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"API to CLOSE existing Merge Request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"API to Check existing merge request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"setValueForMerge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge When Pipeline Succeeds\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create New Merge Request\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add Custom Notes To Merge Request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Add Custom Notes To Merge Request\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"30 secs wait to approve merge request and pipeline to finish1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"API to CLOSE existing Merge Request\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"API to Check existing merge request\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is Exists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"30 secs wait to approve merge request and pipeline to finish1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"setValueForMerge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.if",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.splitInBatches",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.wait",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.set",
      "n8n-nodes-base.scheduleTrigger"
    ],
    "trigger": "schedule trigger"
  }
}