{
  "source": "0099_Webhook_Airtable_Automate_Webhook.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"name\": \"Airtable\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"position\": [\n        1650,\n        300\n      ],\n      \"parameters\": {\n        \"table\": \"Pokemon\",\n        \"operation\": \"list\",\n        \"additionalOptions\": {}\n      },\n      \"credentials\": {\n        \"airtableApi\": \"Airtable Credentials @n8n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Redis\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        600,\n        600\n      ],\n      \"parameters\": {\n        \"key\": \"={{$json[\\\"apiKey\\\"]}}\",\n        \"ttl\": 3600,\n        \"expire\": true,\n        \"operation\": \"incr\"\n      },\n      \"credentials\": {\n        \"redis\": \"Redis Cloud Credentials\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Redis1\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        1200,\n        450\n      ],\n      \"parameters\": {\n        \"key\": \"={{$json[\\\"apiKey\\\"]}}\",\n        \"operation\": \"incr\"\n      },\n      \"credentials\": {\n        \"redis\": \"Redis Cloud Credentials\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1600,\n        550\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"message\",\n              \"value\": \"You exceeded your limit\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Webhook1\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        200,\n        600\n      ],\n      \"webhookId\": \"a3167ed7-98d2-422c-bfe2-e3ba599d19f1\",\n      \"parameters\": {\n        \"path\": \"a3167ed7-98d2-422c-bfe2-e3ba599d19f1\",\n        \"options\": {},\n        \"responseMode\": \"lastNode\",\n        \"authentication\": \"headerAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": \"Credential Example\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Function\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        1900,\n        300\n      ],\n      \"parameters\": {\n        \"functionCode\": \" const limit = `Limit consumed: `+ $node['Redis1'].json[$node[\\\"Set2\\\"].json[\\\"apiKey\\\"]];\\n return [\\n  {\\n    json: {\\n      message:limit,\\n      body: items.map(item => {\\n        const name= item.json.fields.name\\n        const url= item.json.fields.url\\n        return {name,url}\\n      })\\n    }\\n  }\\n]\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        400,\n        600\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"apiKey\",\n              \"value\": \"={{$json[\\\"headers\\\"][\\\"x-api-key\\\"] +'-'+ new Date().getHours() +'-'+ new Date().getMinutes()}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set2\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1000,\n        450\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"apiKey\",\n              \"value\": \"={{$node['Webhook1'].json[\\\"headers\\\"][\\\"x-api-key\\\"] +'-'+ new Date().getHours()}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set3\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1000,\n        700\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"message\",\n              \"value\": \"You exceeded your limit\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Per hour\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1400,\n        450\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"={{$json[$node[\\\"Set2\\\"].json[\\\"apiKey\\\"]]}}\",\n              \"value2\": 60\n            }\n          ],\n          \"string\": []\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Per minute\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        800,\n        600\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"={{$json[$node[\\\"Set\\\"].json[\\\"apiKey\\\"]]}}\",\n              \"value2\": 10,\n              \"operation\": \"smallerEqual\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Set\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Redis\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Redis1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Redis\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Per minute\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Redis1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Per hour\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Airtable\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Function\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Per hour\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Airtable\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Set1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Per minute\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Set3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.airtable",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.set",
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.function",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.if",
      "n8n-nodes-base.if"
    ],
    "trigger": null
  }
}