{
  "source": "1504_Stopanderror_Code_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"IYgbtNpyB4E6Jbxo\",\n  \"meta\": {\n    \"instanceId\": \"35ae520798f87e479496aa54e1a1f89ffdf43eee77986511d08258a12b1edc98\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"2. Refresh Pipedrive tokens\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"2b66edcd-c71a-4dac-971f-deb1b09ef85b\",\n      \"name\": \"Stop and Error\",\n      \"type\": \"n8n-nodes-base.stopAndError\",\n      \"position\": [\n        1460,\n        -80\n      ],\n      \"parameters\": {\n        \"errorMessage\": \"Token refresh failed\"\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"b48d6760-766e-4b39-be35-89de7dc3ab5e\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        60,\n        -300\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 872,\n        \"height\": 97,\n        \"content\": \"## Step 2:\\nCreate a workflow to refresh your access token when the access token requires a refresh.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6119eef3-9ffa-45a1-b238-412738e7529e\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        280,\n        -80\n      ],\n      \"parameters\": {\n        \"height\": 211,\n        \"content\": \"\\n\\n\\n\\n\\n\\n\\n\\nPost unique data to identify your row in Database and be able to fetch the existing access and refresh token\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2d76be21-95e1-4747-b761-126b133e8264\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        980,\n        -220\n      ],\n      \"parameters\": {\n        \"content\": \"## Get token from pipedrive\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9a44eb63-9d31-4b24-9171-1f9a828a5c52\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        100,\n        -740\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 995,\n        \"height\": 82,\n        \"content\": \"## Step 1:\\nSave Refresh token and Access token to DB when authenticated by user and installed.  \"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f3247e6a-7c1c-4479-9f83-f3bc4146f254\",\n      \"name\": \"Insert\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        1600,\n        -660\n      ],\n      \"parameters\": {\n        \"tableId\": \"App_tok\",\n        \"fieldsUi\": {\n          \"fieldValues\": [\n            {\n              \"fieldId\": \"ref_token\",\n              \"fieldValue\": \"={{ $node[\\\"Generate Refresh Token from authcode\\\"].json[\\\"body\\\"][\\\"refresh_token\\\"] }}\"\n            },\n            {\n              \"fieldId\": \"acc_token\",\n              \"fieldValue\": \"={{ $node[\\\"Generate Refresh Token from authcode\\\"].json[\\\"body\\\"][\\\"access_token\\\"] }}\"\n            },\n            {\n              \"fieldId\": \"Platform\",\n              \"fieldValue\": \"Pipedrive\"\n            },\n            {\n              \"fieldId\": \"created_at\",\n              \"fieldValue\": \"={{$now.toUTC().toString()}}\"\n            },\n            {\n              \"fieldId\": \"updated_at\",\n              \"fieldValue\": \"={{$now.toUTC().toString()}}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"tlmP1CXY3ExzjJDs\",\n          \"name\": \"Supabase Automation\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f7ad45d0-7055-45f4-9971-031ffebfdbda\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        500,\n        -640\n      ],\n      \"parameters\": {\n        \"content\": \"You can also use SET NODE + tobase64 function as done in step 2\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e14e2dac-e84b-475f-a01b-14bb723eedc8\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        100,\n        200\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 1644,\n        \"height\": 80,\n        \"content\": \"## Step 3:\\nMake an actual API call. In this example, we are using search person API. Please refer to Pipedrive API documentation for your specific use case. \"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b450c928-e0e4-4f49-829e-03b61828d4d9\",\n      \"name\": \"Get Pipedrive Token\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        600,\n        660\n      ],\n      \"parameters\": {\n        \"filters\": {\n          \"conditions\": [\n            {\n              \"keyName\": \"Platform\",\n              \"keyValue\": \"Pipedrive\"\n            },\n            {\n              \"keyName\": \"AppId\",\n              \"keyValue\": \"57db0bab2932f657\"\n            }\n          ]\n        },\n        \"tableId\": \"App_tok\",\n        \"operation\": \"get\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"tlmP1CXY3ExzjJDs\",\n          \"name\": \"Supabase Automation\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f92a957a-d0ef-4037-8657-74e7fe74fe6d\",\n      \"name\": \"Get contact from Pipedrive\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        900,\n        660\n      ],\n      \"parameters\": {\n        \"url\": \"=https://priyajain-sandbox.pipedrive.com/api/v2/persons/search?fields=email&term={{ $node[\\\"Receive request\\\"].json[\\\"body\\\"][\\\"person\\\"][\\\"email\\\"] }}\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"fullResponse\": true\n            }\n          }\n        },\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Accept\",\n              \"value\": \"application/json\"\n            },\n            {\n              \"name\": \"Authorization\",\n              \"value\": \"=Bearer {{ $node[\\\"Get Pipedrive Token\\\"].json[\\\"acc_token\\\"] }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4,\n      \"continueOnFail\": true,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"bff21156-3da0-4cf3-b3de-c24d8abe7577\",\n      \"name\": \"Access Token Invalid\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1160,\n        700\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"boolean\": [\n            {\n              \"value1\": \"={{ $json[\\\"error\\\"][\\\"message\\\"].includes(\\\"Invalid token: access token is invalid\\\") }}\",\n              \"value2\": \"={{ true }}\"\n            }\n          ]\n        },\n        \"combineOperation\": \"any\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9fd832b1-2af9-48c2-9d57-86a9f34bdd78\",\n      \"name\": \"Success\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        1440,\n        720\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"responseCode\": 200\n        },\n        \"respondWith\": \"json\",\n        \"responseBody\": \"={{ $node[\\\"Get contact from Pipedrive\\\"].json[\\\"body\\\"][\\\"data\\\"][\\\"items\\\"][\\\"0\\\"][\\\"item\\\"][\\\"name\\\"] }}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"daf33b32-ff7b-4d7e-8fd0-d54dfaddf405\",\n      \"name\": \"Refresh Access Token\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1360,\n        320\n      ],\n      \"parameters\": {\n        \"url\": \"http://localhost:5678/webhook/937a8843-a28a-400a-b473-bdc598366fa0\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"{\\n\\n  \\\"appId\\\":\\\"57db0bab2932f657\\\"\\n\\n}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpBasicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"E2RYFiR9PotuglZv\",\n          \"name\": \"PJ demo\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"6759a890-6c2a-4bb1-aae9-9b8723b9e143\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        580,\n        420\n      ],\n      \"parameters\": {\n        \"width\": 668,\n        \"content\": \"## Loop back to fecth the  refreshed Access Token\\n### Note:\\nYou can add further conditions and use Switch  statemen tinstead of IF to validate API response based on your use case.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d975ce9f-2ef2-46b1-9d30-4f6e06e19b7e\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        120,\n        -960\n      ],\n      \"parameters\": {\n        \"width\": 1413,\n        \"content\": \"## 1. This workflow helps you create your own Oauth 2.0 token refresh system. It helps you have better control of your oauth 2.0 auth process.\\n## 2. I am using Pipedrive API here. However, you can re-use this for other similar applications. \"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"40d59a94-563d-459c-91d0-4206c2a19704\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        180,\n        580\n      ],\n      \"parameters\": {\n        \"height\": 248,\n        \"content\": \"A 3rd partyapplication posting the request to the webhook\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"03945766-570c-47db-82c6-2c973e45106d\",\n      \"name\": \"convert clientId and secret to base64\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        560,\n        -560\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Loop over input items and add a new field called 'myNewField' to the JSON of each one\\nconst client_id = \\\"57db0bab2932f657\\\";\\nconst client_secret = \\\"edfaba095e9e7ddefe2e960ce2e98345230a016d\\\";\\n\\n// Combine client_id and client_secret with a colon\\nconst combinedString = client_id+\\\":\\\"+client_secret;\\n\\n// Encode the combined string in Base64\\nconst encodedString = Buffer.from(combinedString).toString('base64');\\n\\n// Create the Authorization header value\\nconst authorizationHeader = `Basic ${encodedString}`;\\n\\nreturn {\\\"authheader\\\":authorizationHeader};\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"8ca6eb93-6994-4536-b61e-d884c8515929\",\n      \"name\": \"Generate Refresh Token from authcode\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"maxTries\": 2,\n      \"position\": [\n        820,\n        -560\n      ],\n      \"parameters\": {\n        \"url\": \"https://oauth.pipedrive.com/oauth/token\",\n        \"method\": \"POST\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"fullResponse\": true\n            }\n          }\n        },\n        \"sendBody\": true,\n        \"contentType\": \"form-urlencoded\",\n        \"sendHeaders\": true,\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"grant_type\",\n              \"value\": \"authorization_code\"\n            },\n            {\n              \"name\": \"code\",\n              \"value\": \"={{$node[\\\"catch Auth code\\\"].json[\\\"query\\\"][\\\"code\\\"]}}\"\n            },\n            {\n              \"name\": \"redirect_uri\",\n              \"value\": \"={{ $node[\\\"catch Auth code\\\"].json[\\\"webhookUrl\\\"] }}\"\n            }\n          ]\n        },\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Authorization\",\n              \"value\": \"={{$node[\\\"convert clientId and secret to base64\\\"].json[\\\"authheader\\\"]}}\"\n            }\n          ]\n        }\n      },\n      \"retryOnFail\": false,\n      \"typeVersion\": 4,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"9c1b22e1-fd50-4c70-91cf-f4ea8cc7d3ac\",\n      \"name\": \"Look for the related record in Supabase\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        1060,\n        -540\n      ],\n      \"parameters\": {\n        \"filters\": {\n          \"conditions\": [\n            {\n              \"keyName\": \"Platform\",\n              \"keyValue\": \"Pipedrive\"\n            }\n          ]\n        },\n        \"tableId\": \"App_tok\",\n        \"operation\": \"get\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"tlmP1CXY3ExzjJDs\",\n          \"name\": \"Supabase Automation\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"53602a58-d47a-4133-b9ec-4ea421a75eea\",\n      \"name\": \"IF rec not found\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1260,\n        -540\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"={{ $json.values().length }}\",\n              \"operation\": \"equal\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"38e5d91c-1bea-4f7a-8336-98748005d02e\",\n      \"name\": \"Update tokns in the record\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        1600,\n        -460\n      ],\n      \"parameters\": {\n        \"filters\": {\n          \"conditions\": [\n            {\n              \"keyName\": \"Platform\",\n              \"keyValue\": \"Pipedrive\",\n              \"condition\": \"eq\"\n            }\n          ]\n        },\n        \"tableId\": \"App_tok\",\n        \"fieldsUi\": {\n          \"fieldValues\": [\n            {\n              \"fieldId\": \"acc_token\",\n              \"fieldValue\": \"={{ $node[\\\"Generate Refresh Token from authcode\\\"].json[\\\"body\\\"][\\\"access_token\\\"] }}\"\n            },\n            {\n              \"fieldId\": \"ref_token\",\n              \"fieldValue\": \"={{ $node[\\\"Generate Refresh Token from authcode\\\"].json[\\\"body\\\"][\\\"refresh_token\\\"] }}\"\n            },\n            {\n              \"fieldId\": \"updated_at\",\n              \"fieldValue\": \"={{$now.toUTC().toString()}}\"\n            }\n          ]\n        },\n        \"matchType\": \"allFilters\",\n        \"operation\": \"update\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"tlmP1CXY3ExzjJDs\",\n          \"name\": \"Supabase Automation\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"43a2613d-7793-48c9-8934-57d9b713f5fe\",\n      \"name\": \"Supabase- look for the record\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        600,\n        -140\n      ],\n      \"parameters\": {\n        \"filters\": {\n          \"conditions\": [\n            {\n              \"keyName\": \"Platform\",\n              \"keyValue\": \"Pipedrive\"\n            },\n            {\n              \"keyName\": \"AppId\",\n              \"keyValue\": \"={{ $node[\\\"Webhook\\\"].json[\\\"body\\\"][\\\"appId\\\"] }}\"\n            }\n          ]\n        },\n        \"tableId\": \"App_tok\",\n        \"operation\": \"get\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"tlmP1CXY3ExzjJDs\",\n          \"name\": \"Supabase Automation\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"366bd343-419c-4a77-b2ce-e6124a6cc291\",\n      \"name\": \"combine client id and secret\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        840,\n        -140\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"4330b857-6184-4ad8-82dc-a8b806ab8077\",\n              \"name\": \"authheader\",\n              \"type\": \"string\",\n              \"value\": \"57db0bab2932f657:edfaba095e9e7ddefe2e960ce2e98345230a016d\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.3\n    },\n    {\n      \"id\": \"156acb8f-3a23-40ec-b011-9db8bfa6d98b\",\n      \"name\": \"Get Pipedrive acess token\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1060,\n        -140\n      ],\n      \"parameters\": {\n        \"url\": \"https://oauth.pipedrive.com/oauth/token\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"contentType\": \"form-urlencoded\",\n        \"sendHeaders\": true,\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"grant_type\",\n              \"value\": \"refresh_token\"\n            },\n            {\n              \"name\": \"refresh_token\",\n              \"value\": \"={{ $node[\\\"Supabase- look for the record\\\"].json[\\\"ref_token\\\"] }}\"\n            }\n          ]\n        },\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Authorization\",\n              \"value\": \"=Basic {{ $json[\\\"authheader\\\"].base64Encode() }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"3e20309e-6d50-444c-b9e1-cf6d6982e546\",\n      \"name\": \"IF success\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1240,\n        -140\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ Object.keys($input.first().json)[0]}}\",\n              \"value2\": \"access_token\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1e991aa7-9888-404d-8f80-bb6ce0a3b777\",\n      \"name\": \"Update thr row with new access token\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"position\": [\n        1420,\n        -280\n      ],\n      \"parameters\": {\n        \"filters\": {\n          \"conditions\": [\n            {\n              \"keyName\": \"Platform\",\n              \"keyValue\": \"Pipedrive\",\n              \"condition\": \"eq\"\n            }\n          ]\n        },\n        \"tableId\": \"App_tok\",\n        \"fieldsUi\": {\n          \"fieldValues\": [\n            {\n              \"fieldId\": \"acc_token\",\n              \"fieldValue\": \"={{ $node[\\\"Get Pipedrive acess token\\\"].json[\\\"access_token\\\"] }}\"\n            },\n            {\n              \"fieldId\": \"ref_token\",\n              \"fieldValue\": \"={{ $node[\\\"Get Pipedrive acess token\\\"].json[\\\"refresh_token\\\"] }}\"\n            }\n          ]\n        },\n        \"matchType\": \"allFilters\",\n        \"operation\": \"update\"\n      },\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"tlmP1CXY3ExzjJDs\",\n          \"name\": \"Supabase Automation\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"d0989bad-9176-44a2-86ce-db07a5e8a34c\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        340,\n        -140\n      ],\n      \"webhookId\": \"937a8843-a28a-400a-b473-bdc598366fa0\",\n      \"parameters\": {\n        \"path\": \"937a8843-a28a-400a-b473-bdc598366fa0\",\n        \"options\": {},\n        \"httpMethod\": \"POST\",\n        \"responseMode\": \"lastNode\",\n        \"authentication\": \"basicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"E2RYFiR9PotuglZv\",\n          \"name\": \"PJ demo\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"108a2ea1-de2a-4df3-9d9f-0ce1b27a52e9\",\n      \"name\": \"Receive request\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        280,\n        680\n      ],\n      \"webhookId\": \"47704458-bfa6-4d95-adf1-97fc78e35d8a\",\n      \"parameters\": {\n        \"path\": \"47704458-bfa6-4d95-adf1-97fc78e35d8a\",\n        \"options\": {},\n        \"httpMethod\": \"POST\",\n        \"responseMode\": \"responseNode\",\n        \"authentication\": \"basicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"E2RYFiR9PotuglZv\",\n          \"name\": \"PJ demo\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f983cfd1-52db-4839-88af-6386ec7c7256\",\n      \"name\": \"catch Auth code\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        300,\n        -560\n      ],\n      \"webhookId\": \"aae545fb-a69d-4e20-91ce-65f105d0ea2f\",\n      \"parameters\": {\n        \"path\": \"aae545fb-a69d-4e20-91ce-65f105d0ea2f\",\n        \"options\": {}\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {\n    \"Receive request\": [\n      {\n        \"json\": {\n          \"body\": {\n            \"person\": {\n              \"email\": \"priya+solar@psw.com\"\n            }\n          },\n          \"query\": {},\n          \"params\": {},\n          \"headers\": {\n            \"host\": \"http://localhost:5678\",\n            \"accept\": \"*/*\",\n            \"user-agent\": \"PostmanRuntime/7.39.0\",\n            \"content-type\": \"application/json\",\n            \"authorization\": \"Basic xxxxxxx==\",\n            \"cache-control\": \"no-cache\",\n            \"postman-token\": \"41b79257-xxxx-xxxx-xxxx-9e004cae4e9e\",\n            \"content-length\": \"52\",\n            \"accept-encoding\": \"gzip, deflate, br\",\n            \"x-forwarded-for\": \"54.86.50.139\",\n            \"x-forwarded-host\": \"localhost:5678\",\n            \"x-forwarded-proto\": \"https\"\n          },\n          \"webhookUrl\": \"http://localhost:5678/webhook-test/47704458-bfa6-4d95-adf1-97fc78e35d8a\",\n          \"executionMode\": \"test\"\n        }\n      }\n    ]\n  },\n  \"settings\": {\n    \"callerPolicy\": \"workflowsFromSameOwner\",\n    \"executionOrder\": \"v1\",\n    \"saveManualExecutions\": true\n  },\n  \"versionId\": \"54499ed8-4677-400a-9e03-d0d84f8a97b5\",\n  \"connections\": {\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Supabase- look for the record\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF success\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update thr row with new access token\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Stop and Error\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Receive request\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Pipedrive Token\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"catch Auth code\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"convert clientId and secret to base64\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF rec not found\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Insert\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Update tokns in the record\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Pipedrive Token\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get contact from Pipedrive\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Access Token Invalid\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Refresh Access Token\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Success\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Refresh Access Token\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Pipedrive Token\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Pipedrive acess token\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF success\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get contact from Pipedrive\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Access Token Invalid\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"combine client id and secret\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Pipedrive acess token\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Supabase- look for the record\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"combine client id and secret\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Generate Refresh Token from authcode\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Look for the related record in Supabase\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"convert clientId and secret to base64\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Generate Refresh Token from authcode\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Look for the related record in Supabase\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF rec not found\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.stopAndError",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.supabase",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.supabase",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.if",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.code",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.supabase",
      "n8n-nodes-base.if",
      "n8n-nodes-base.supabase",
      "n8n-nodes-base.supabase",
      "n8n-nodes-base.set",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.if",
      "n8n-nodes-base.supabase",
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.webhook"
    ],
    "trigger": null
  }
}