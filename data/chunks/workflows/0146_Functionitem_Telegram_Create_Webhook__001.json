{
  "source": "0146_Functionitem_Telegram_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        310,\n        300\n      ],\n      \"webhookId\": \"6be952e8-e30f-4dd7-90b3-bc202ae9f174\",\n      \"parameters\": {\n        \"path\": \"6be952e8-e30f-4dd7-90b3-bc202ae9f174\",\n        \"options\": {\n          \"rawBody\": true\n        },\n        \"httpMethod\": \"POST\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"SearchTorrent\",\n      \"type\": \"n8n-nodes-base.functionItem\",\n      \"position\": [\n        530,\n        300\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const TorrentSearchApi = require('torrent-search-api');\\n\\nTorrentSearchApi.enableProvider('KickassTorrents');\\nTorrentSearchApi.enableProvider('Rarbg');\\n\\nitem.title = $node[\\\"Webhook\\\"].json[\\\"body\\\"].title.trim();\\n\\nconst torrents = await TorrentSearchApi.search(item.title, 'All', 5);\\n\\nitem.torrents = torrents;\\nitem.found = true;\\n\\nif(!torrents.length)\\n  item.found = false;\\n  \\nconsole.log('Done!');\\n\\nreturn item;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Start download\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        960,\n        280\n      ],\n      \"parameters\": {\n        \"url\": \"http://localhost:9091/transmission/rpc\",\n        \"options\": {},\n        \"requestMethod\": \"POST\",\n        \"authentication\": \"basicAuth\",\n        \"jsonParameters\": true,\n        \"bodyParametersJson\": \"={\\\"method\\\":\\\"torrent-add\\\",\\\"arguments\\\":{\\\"paused\\\":false,\\\"download-dir\\\":\\\"/media/FILM/TORRENT\\\",\\\"filename\\\":\\\"{{$node[\\\"SearchTorrent\\\"].json[\\\"torrents\\\"][0][\\\"magnet\\\"]}}\\\"}}\",\n        \"headerParametersJson\": \"{\\\"X-Transmission-Session-Id\\\":\\\"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx\\\"}\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": \"Transmission-basic-auth\"\n      },\n      \"typeVersion\": 1,\n      \"continueOnFail\": true\n    },\n    {\n      \"name\": \"IF\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        740,\n        300\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"boolean\": [\n            {\n              \"value1\": \"={{$json[\\\"found\\\"]}}\",\n              \"value2\": true\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Torrent not found\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        960,\n        470\n      ],\n      \"parameters\": {\n        \"text\": \"=Film {{$node[\\\"Webhook\\\"].json[\\\"body\\\"].title}} non trovato.\",\n        \"chatId\": \"00000000\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": \"your_bot_credential\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Telegram1\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1500,\n        490\n      ],\n      \"parameters\": {\n        \"text\": \"=Scarico {{$node[\\\"Webhook\\\"].json[\\\"body\\\"].title}}!\\nTitolo: {{$node[\\\"SearchTorrent\\\"].json[\\\"torrents\\\"][0][\\\"title\\\"]}}\",\n        \"chatId\": \"0000000\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": \"your_bot_credential\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"IF2\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1150,\n        280\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"=\\\"{{$json[\\\"error\\\"][\\\"statusCode\\\"]}}\\\"\",\n              \"value2\": \"=\\\"409\\\"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Start download new token\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1340,\n        260\n      ],\n      \"parameters\": {\n        \"url\": \"http://localhost:9091/transmission/rpc\",\n        \"options\": {},\n        \"requestMethod\": \"POST\",\n        \"authentication\": \"basicAuth\",\n        \"jsonParameters\": true,\n        \"bodyParametersJson\": \"={\\\"method\\\":\\\"torrent-add\\\",\\\"arguments\\\":{\\\"paused\\\":false,\\\"download-dir\\\":\\\"/media/FILM/TORRENT\\\",\\\"filename\\\":\\\"{{$node[\\\"SearchTorrent\\\"].json[\\\"torrents\\\"][0][\\\"magnet\\\"]}}\\\"}}\",\n        \"headerParametersJson\": \"={\\\"X-Transmission-Session-Id\\\":\\\"{{$node[\\\"Start download\\\"].json[\\\"error\\\"][\\\"response\\\"][\\\"headers\\\"][\\\"x-transmission-session-id\\\"]}}\\\"}\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": \"Transmission-basic-auth\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"IF\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Start download\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Torrent not found\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Start download new token\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Telegram1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"SearchTorrent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"SearchTorrent\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Start download\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Start download new token\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Telegram1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.functionItem",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.if",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.if",
      "n8n-nodes-base.httpRequest"
    ],
    "trigger": null
  }
}