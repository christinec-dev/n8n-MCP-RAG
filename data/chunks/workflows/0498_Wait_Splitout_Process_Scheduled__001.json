{
  "source": "0498_Wait_Splitout_Process_Scheduled.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"a2435d996b378e3a6fdef0468d70285e3aa0fbd0004de817bfc80e80afee4e7b\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"5fa5ccd8-81be-45a2-ac00-7ef28148c0c7\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        700,\n        460\n      ],\n      \"parameters\": {\n        \"width\": 1767.817629414989,\n        \"height\": 470.03830555074103,\n        \"content\": \"## DROPCONTACT 250 BATCH ASYNCHRONOUSLY \\n## 1500/HOUR REQUESTS\\n**Double click** to edit me. [Guide](https://docs.n8n.io/workflows/sticky-notes/)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9c6826a3-ec94-4ff4-92a6-0ff7fa22349e\",\n      \"name\": \"Aggregate\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        1000,\n        620\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldsToAggregate\": {\n          \"fieldToAggregate\": [\n            {\n              \"fieldToAggregate\": \"first_name\"\n            },\n            {\n              \"fieldToAggregate\": \"last_name\"\n            },\n            {\n              \"fieldToAggregate\": \"domain\"\n            },\n            {\n              \"fieldToAggregate\": \"phantom_linkedin\"\n            },\n            {\n              \"fieldToAggregate\": \"full_name\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c0d5b884-de58-42f3-bc50-0c7e6ca5e576\",\n      \"name\": \"PROFILES QUERY\",\n      \"type\": \"n8n-nodes-base.postgres\",\n      \"position\": [\n        560,\n        600\n      ],\n      \"parameters\": {\n        \"query\": \"select first_name, last_name, domain, full_name\\nfrom accounts a \\nleft join profiles p on a.company_id = p.company_id \\nwhere title = 'Bestuurder' and p.email is null and a.domain != ''\\nand domain NOT IN ('gmail.com', 'hotmail.com', 'hotmail.be', 'hotmail%','outlook.com','telenet.be', 'live.be', 'skynet.be','SKYNET%', 'yahoo.com' , 'yahoo%', 'msn%', 'hotmail', 'belgacom%') and dropcontact_found is null \\nlimit 1000\\n\",\n        \"options\": {},\n        \"operation\": \"executeQuery\"\n      },\n      \"credentials\": {\n        \"postgres\": {\n          \"id\": \"pYryZTyzA44MBOiN\",\n          \"name\": \"Postgres account\"\n        }\n      },\n      \"typeVersion\": 2.3\n    },\n    {\n      \"id\": \"ddf11e8d-f1db-406c-9c2a-ab5a510fee47\",\n      \"name\": \"BULK DROPCONTACT REQUESTS\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueRegularOutput\",\n      \"maxTries\": 3,\n      \"position\": [\n        1360,\n        620\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.dropcontact.io/batch\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={{ $json.toJsonString()}}\\n\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"X-Access-Token\",\n              \"value\": \"apiKey\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"dropcontactApi\"\n      },\n      \"credentials\": {\n        \"dropcontactApi\": {\n          \"id\": \"kUzEc345AiEZDjK7\",\n          \"name\": \"Dropcontact Willow account\"\n        }\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 4.2,\n      \"waitBetweenTries\": 600\n    },\n    {\n      \"id\": \"606e2898-eb44-46c2-9576-8e3cc1bd2578\",\n      \"name\": \"Loop Over Items2\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        780,\n        600\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"batchSize\": 250\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"ace20caa-3c9b-432a-a572-6bad48181347\",\n      \"name\": \"Split Out\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        1940,\n        600\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"data\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2c581721-a399-4d48-98a1-cee82246c4f4\",\n      \"name\": \"Postgres\",\n      \"type\": \"n8n-nodes-base.postgres\",\n      \"onError\": \"continueErrorOutput\",\n      \"maxTries\": 2,\n      \"position\": [\n        2100,\n        600\n      ],\n      \"parameters\": {\n        \"table\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"profiles\",\n          \"cachedResultName\": \"profiles\"\n        },\n        \"schema\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"public\"\n        },\n        \"columns\": {\n          \"value\": {\n            \"email\": \"={{ $json.email[0].email }}\",\n            \"phone\": \"={{ $json.phone }}\",\n            \"full_name\": \"={{ $json.custom_fields.full_name }}\",\n            \"dropcontact_found\": \"={{ true }}\",\n            \"email_qualification\": \"={{ $json.email[0].qualification }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"company_id\",\n              \"type\": \"number\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"company_id\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"create_date\",\n              \"type\": \"dateTime\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"create_date\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"phone\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"phone\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"first_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"first_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"last_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"last_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"title\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"title\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"start_date_raw\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"start_date_raw\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"full_name\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"full_name\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"seniority\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"seniority\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"email\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"email\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"email_qualification\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"email_qualification\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"dropcontact_found\",\n              \"type\": \"boolean\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"dropcontact_found\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"full_name\"\n          ]\n        },\n        \"options\": {\n          \"replaceEmptyStrings\": true\n        },\n        \"operation\": \"update\"\n      },\n      \"credentials\": {\n        \"postgres\": {\n          \"id\": \"pYryZTyzA44MBOiN\",\n          \"name\": \"Postgres account\"\n        }\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 2.3,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"7e94c87d-3f83-4fd1-877d-3463dce3cdd1\",\n      \"name\": \"BULK DROPCONTACT DOWNLOAD\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        1740,\n        620\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.dropcontact.io/batch/{{ $json.request_id }}\",\n        \"options\": {},\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"dropcontactApi\"\n      },\n      \"credentials\": {\n        \"dropcontactApi\": {\n          \"id\": \"kUzEc345AiEZDjK7\",\n          \"name\": \"Dropcontact Willow account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"17aab456-72dc-482d-b5e3-b3dfb3a3b3f7\",\n      \"name\": \"Wait2\",\n      \"type\": \"n8n-nodes-base.wait\",\n      \"position\": [\n        1540,\n        620\n      ],\n      \"webhookId\": \"de669d58-95c5-480e-9acc-17c396859fcf\",\n      \"parameters\": {\n        \"amount\": 600\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"148cec0c-985b-4c82-8835-fff8eacf6e38\",\n      \"name\": \"DATA TRANSFORMATION\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1180,\n        620\n      ],\n      \"parameters\": {\n        \"mode\": \"runOnceForEachItem\",\n        \"language\": \"python\",\n        \"pythonCode\": \"import json\\n\\n## Load & access the existing JSON data\\nfor item in _input.all():\\n  data = item.json \\n\\n  # Define the output data structure\\n  output_data = {\\\"data\\\": [], \\\"siren\\\": True}\\n\\n  # Unpack data from the single element list\\n  first_names = data[\\\"first_name\\\"]\\n  last_names = data[\\\"last_name\\\"]\\n  domain = data[\\\"domain\\\"]\\n  full_name = data[\\\"full_name\\\"]\\n\\n    # Combine data into a list of dictionaries\\n  transformed_data = []\\n  for i, (first_name, last_name, domain_name, full_name_value) in enumerate(zip(first_names, last_names, domain, full_name)):\\n    transformed_data.append({\\n      \\\"first_name\\\": first_name,\\n      \\\"last_name\\\": last_name,\\n      \\\"website\\\": domain_name,\\n      \\\"custom_fields\\\": {\\n        \\\"full_name\\\": full_name_value}\\n    })\\n\\n  output_data[\\\"data\\\"] = transformed_data\\n\\n  return output_data \\n\\n\"\n      },\n      \"typeVersion\": 2,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"b233abfe-cfae-474a-b86d-29e56e1f3ac7\",\n      \"name\": \"Slack\",\n      \"type\": \"n8n-nodes-base.slack\",\n      \"position\": [\n        1740,\n        820\n      ],\n      \"parameters\": {\n        \"text\": \"Dropcontact Credits issue: url \",\n        \"user\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"\"\n        },\n        \"select\": \"user\",\n        \"otherOptions\": {}\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"d4e90677-89c9-418b-b618-f751b797d395\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        380,\n        600\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {}\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Wait2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"BULK DROPCONTACT DOWNLOAD\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Postgres\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Aggregate\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"DATA TRANSFORMATION\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Out\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Postgres\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"PROFILES QUERY\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items2\": {\n      \"main\": [\n        null,\n        [\n          {\n            \"node\": \"Aggregate\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"PROFILES QUERY\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"DATA TRANSFORMATION\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"BULK DROPCONTACT REQUESTS\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"BULK DROPCONTACT DOWNLOAD\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Out\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Slack\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"BULK DROPCONTACT REQUESTS\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Wait2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.aggregate",
      "n8n-nodes-base.postgres",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.splitInBatches",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.postgres",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.wait",
      "n8n-nodes-base.code",
      "n8n-nodes-base.slack",
      "n8n-nodes-base.scheduleTrigger"
    ],
    "trigger": "schedule trigger"
  }
}