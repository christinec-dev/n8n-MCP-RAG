{
  "source": "0651_Code_Schedule_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"id\": \"396bb28b-e40d-4bea-aa80-4abd04db045a\",\n      \"name\": \"Friday 8pm\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        100,\n        120\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {\n              \"field\": \"weeks\",\n              \"triggerAtDay\": [\n                5\n              ],\n              \"triggerAtHour\": 20\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"993f0d31-5639-4cea-b2f8-d1a41ecdeb83\",\n      \"name\": \"Create Meal Plan\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1080,\n        120\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $('Config').first().json.mealieBaseUrl }}/api/households/mealplans\",\n        \"method\": \"POST\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"responseFormat\": \"json\"\n            }\n          }\n        },\n        \"jsonBody\": \"={{ $json }}\",\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"oVwF1hVdy3Srvi9P\",\n          \"name\": \"Mealie Header Auth\"\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"ad53512d-7246-49f4-a86b-f258b7c1c47e\",\n      \"name\": \"When clicking \\\"Test workflow\\\"\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        100,\n        320\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c0d1d7e0-9411-4e6a-871a-0374b8a9f5db\",\n      \"name\": \"Get Recipes\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        640,\n        120\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $json.mealieBaseUrl }}/api/recipes\",\n        \"options\": {},\n        \"sendQuery\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"perPage\",\n              \"value\": \"100\"\n            },\n            {\n              \"name\": \"categories\",\n              \"value\": \"={{ $json.mealieCategoryId }}\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"oVwF1hVdy3Srvi9P\",\n          \"name\": \"Mealie Header Auth\"\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"2f9757fc-77f5-4bda-ae2e-7088ea5c114d\",\n      \"name\": \"Config\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        380,\n        120\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"cd2665dd-b505-41e4-936d-cfa2de7bd09b\",\n              \"name\": \"numberOfRecipes\",\n              \"type\": \"number\",\n              \"value\": 5\n            },\n            {\n              \"id\": \"e09da5c5-3f0d-4cd3-909d-e3df2888abde\",\n              \"name\": \"offsetPlanDays\",\n              \"type\": \"number\",\n              \"value\": 3\n            },\n            {\n              \"id\": \"80e95139-83df-45ae-99a0-fc50d3e9475f\",\n              \"name\": \"mealieCategoryId\",\n              \"type\": \"string\",\n              \"value\": \"6ec172b7-a87d-4877-8fe3-34cecc20f2c5\"\n            },\n            {\n              \"id\": \"f511e874-c373-4648-9e49-120367474d6d\",\n              \"name\": \"mealieBaseUrl\",\n              \"type\": \"string\",\n              \"value\": \"http://192.168.1.5:9925\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"fed805ea-0580-444d-8312-a68b25e91bbd\",\n      \"name\": \"Generate Random Items\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        860,\n        120\n      ],\n      \"parameters\": {\n        \"jsCode\": \"const numberOfRecipes = $('Config').first().json.numberOfRecipes;\\nconst offsetPlanDays = $('Config').first().json.offsetPlanDays;\\nconst items = $input.first().json.items;\\n\\nlet planFirstDate = new Date();\\nplanFirstDate.setDate(planFirstDate.getDate() + offsetPlanDays);\\n\\nconst recipeList = [];\\nconst randomNums = [];\\nlet currentItem = 0;\\n\\nwhile (recipeList.length < numberOfRecipes) {\\n  const randomNum = Math.floor(Math.random() * Math.floor(items.length));\\n\\n  if (!randomNums.includes(randomNum)) {\\n    const thisRecipe = items[randomNum];\\n\\n    const newDate = new Date(planFirstDate);\\n    newDate.setDate(planFirstDate.getDate() + currentItem);\\n  \\n    const planDate = [\\n      newDate.getFullYear(),\\n      ('0' + (newDate.getMonth() + 1)).slice(-2),\\n      ('0' + newDate.getDate()).slice(-2)\\n    ].join('-');\\n  \\n    const planDay = {\\n      \\\"date\\\": planDate,\\n      \\\"entryType\\\": \\\"dinner\\\",\\n      \\\"recipeId\\\": thisRecipe.id,\\n      \\\"name\\\": thisRecipe.name\\n    };\\n\\n    currentItem++;\\n    recipeList.push(planDay);\\n    randomNums.push(randomNum);\\n  }\\n}\\n\\nreturn recipeList;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"f440ce9d-cc27-4982-a0bd-b0ce2e5217d9\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        40,\n        -60\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"height\": 340,\n        \"content\": \"## Trigger\\nSet the trigger to run when you like\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2bac2f08-2969-4f47-9fce-0e7de416cd09\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        280,\n        -60\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 300,\n        \"height\": 340,\n        \"content\": \"## Update this Config\\nSet the base Url of your Mealie instance\\nSet number of recipes to generate and number of days to offset the plan (0 will start today).\\nGrab a category id from Mealie (or leave blank for all categories)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a2850e39-c25f-4210-8f9e-a657c0c63bf5\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        40,\n        -280\n      ],\n      \"parameters\": {\n        \"width\": 540,\n        \"height\": 220,\n        \"content\": \"## Get started\\n* Set up a credential for your Mealie API token\\n* Apply the credential to the 2 Http request nodes\\n* Set schedule trigger and desired config\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"20d7301c-8946-45c3-8f5f-fbe2fc80cf37\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        580,\n        -60\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 660,\n        \"height\": 340,\n        \"content\": \"## Workflow logic\\n* Get all recipes from Mealie (within category if supplied)\\n* Randomly pick out the number set in the config\\n* Create dinner meal plans for the upcoming days\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Config\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Recipes\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Friday 8pm\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Config\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Recipes\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Generate Random Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Generate Random Items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Meal Plan\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking \\\"Test workflow\\\"\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Config\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.set",
      "n8n-nodes-base.code",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}