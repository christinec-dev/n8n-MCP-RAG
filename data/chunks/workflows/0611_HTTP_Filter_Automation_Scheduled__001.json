{
  "source": "0611_HTTP_Filter_Automation_Scheduled.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"38d37c49298b42c645e6a7693766d7c3522b24e54454034f955422b5d7af611c\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"b6582c37-00c3-467c-95cb-fc6eb7ccd27d\",\n      \"name\": \"Filter\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        1080,\n        420\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"={{ $json.meta.total }}\",\n              \"value2\": 4,\n              \"operation\": \"largerEqual\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"54b0f895-7e56-40eb-bc6c-f657457d004a\",\n      \"name\": \"List Snapshots for a Droplet\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        840,\n        420\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.digitalocean.com/v2/droplets/{{ $json.droplets[0].id }}/snapshots \",\n        \"options\": {},\n        \"authentication\": \"headerAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"1kwUrzy4cJXZx48R\",\n          \"name\": \"Digital Ocean Account (darryn@optimus01.co.za)\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"7c47438f-db04-41f7-aed6-a460d0a6889b\",\n      \"name\": \"List All Droplets\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"notes\": \"f3bc462f9219860aafe79747ee369e2f79ccd7f9b096dfe66b55d946871e8942\",\n      \"position\": [\n        600,\n        420\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.digitalocean.com/v2/droplets\",\n        \"options\": {},\n        \"authentication\": \"headerAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"1kwUrzy4cJXZx48R\",\n          \"name\": \"Digital Ocean Account (darryn@optimus01.co.za)\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e751f6a4-0fdc-4be5-84f0-fecba100da09\",\n      \"name\": \"Delete a Snapshot\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"notes\": \"f3bc462f9219860aafe79747ee369e2f79ccd7f9b096dfe66b55d946871e8942\",\n      \"position\": [\n        1320,\n        420\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.digitalocean.com/v2/snapshots/{{ $json.snapshots[0].id }}\",\n        \"options\": {},\n        \"requestMethod\": \"DELETE\",\n        \"authentication\": \"headerAuth\"\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"1kwUrzy4cJXZx48R\",\n          \"name\": \"Digital Ocean Account (darryn@optimus01.co.za)\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d4cc4a72-f909-4c10-bada-e5c731e46c5e\",\n      \"name\": \"Droplet Actions snapshot (n8n.optimus01.co.za)\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"notes\": \"f3bc462f9219860aafe79747ee369e2f79ccd7f9b096dfe66b55d946871e8942\",\n      \"position\": [\n        1560,\n        420\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.digitalocean.com/v2/droplets/{{ $('List All Droplets').item.json.droplets[0].id }}/actions \",\n        \"options\": {},\n        \"requestMethod\": \"POST\",\n        \"authentication\": \"headerAuth\",\n        \"bodyParametersUi\": {\n          \"parameter\": [\n            {\n              \"name\": \"type\",\n              \"value\": \"snapshot\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"1kwUrzy4cJXZx48R\",\n          \"name\": \"Digital Ocean Account (darryn@optimus01.co.za)\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4f3be74a-add7-4a2c-99df-d5d47f17efee\",\n      \"name\": \"Runs every 48hrs\",\n      \"type\": \"n8n-nodes-base.cron\",\n      \"position\": [\n        360,\n        420\n      ],\n      \"parameters\": {\n        \"triggerTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyX\",\n              \"value\": 48\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"518a7b8c-adf6-448e-9f4a-5acc0f31523d\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        300,\n        180\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 232.0445295774649,\n        \"height\": 411.1655661971828,\n        \"content\": \"## Trigger workflow every 48 hours\\n\\nThis node triggers the workflow to run every 48 hours. You can adjust the frequency if needed to suit your snapshot management requirements.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"70fe9177-e770-4f19-8fbc-3782167dda55\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        540,\n        180\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 232.0445295774649,\n        \"height\": 411.1655661971829,\n        \"content\": \"## Get all droplets from DigitalOcean\\nFetches a list of all the droplets in your DigitalOcean account. This is the first step in managing snapshots for each droplet.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"04d74698-0198-45c8-8a79-183fd5f19820\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        780,\n        180\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 232.0445295774649,\n        \"height\": 412.3020619718309,\n        \"content\": \"## Retrieve snapshots for a droplet\\nRetrieves all the snapshots associated with a specific droplet. This ensures that we know how many snapshots currently exist for each droplet.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4a971e9a-dfdf-4932-8280-3991a83c2a72\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1020,\n        180\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 232.0445295774649,\n        \"height\": 411.1655661971828,\n        \"content\": \"## Check if there are more than 4 snapshots\\nChecks if the number of snapshots for a droplet is equal to or greater than 4. If true, it proceeds to delete the oldest snapshot.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"bb9a553a-a8fc-4b72-b0e0-704ebaf8b806\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1260,\n        180\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 232.0445295774649,\n        \"height\": 411.1655661971829,\n        \"content\": \"## Delete the oldest snapshot\\nDeletes the oldest snapshot from the droplet if the number of snapshots exceeds the limit (4 in this case), based on the filter's condition.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1811812f-db56-494a-8ffa-d64cc6f5037c\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1500,\n        180\n      ],\n      \"parameters\": {\n        \"color\": 5,\n        \"width\": 232.0445295774649,\n        \"height\": 411.1655661971829,\n        \"content\": \"## Create a new snapshot\\nCreates a new snapshot for the droplet after cleaning up the old snapshots. Ensures that backups are always up to date.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cb2bd85e-578b-4888-9625-ffed7249082c\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -545,\n        200\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 366.75796434038665,\n        \"height\": 381.1643518785302,\n        \"content\": \"### What this workflow does\\n1. **`Runs every 48 hours`**: The workflow is triggered by a cron node that runs every 48 hours, ensuring timely snapshot management.\\n2. **`List all droplets`**: The workflow retrieves all droplets in the DigitalOcean account.\\n3. **`Retrieve snapshots`**: For each droplet, the workflow retrieves a list of existing snapshots.\\n4. **`Filter snapshots`**: If the number of snapshots exceeds 4, the workflow filters for snapshots that need to be deleted.\\n5. **`Delete snapshots`**: Excess snapshots are automatically deleted based on the filter criteria.\\n6. **`Create new snapshot`**: After cleaning up, the workflow creates a new snapshot for each droplet, ensuring that backups are always up-to-date.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7fbb406b-9343-4d3c-9876-80cb3b7bd51e\",\n      \"name\": \"Sticky Note11\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -165,\n        240\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 396.6384066163515,\n        \"height\": 282.5799404564392,\n        \"content\": \"### Get More Templates Like This ðŸ‘‡\\n[![Video Thumbnail](https://onlinethinking.io/wp-content/uploads/2024/10/Lets-Automate-It-Community.png)](http://onlinethinking.io/community)\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8afb93b2-e547-4f3b-be25-5ab85a3f477d\",\n      \"name\": \"Sticky Note14\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -545,\n        600\n      ],\n      \"parameters\": {\n        \"width\": 777.0408639013781,\n        \"height\": 201.45195676871373,\n        \"content\": \"## Setup\\n1. **`DigitalOcean API Key`**: Youâ€™ll need to configure the HTTP Request nodes with your DigitalOcean API key. This key is required for authenticating requests to list droplets, retrieve snapshots, delete snapshots, and create new ones.\\n2. **`Snapshot Threshold`**: By default, the workflow is set to keep no more than 4 snapshots per droplet. This can be adjusted by modifying the filter node conditions.\\n3. **`Set Execution Frequency`**: The cron node is set to run every 48 hours, but you can adjust the timing to suit your needs.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"325a4b9c-9bd4-4f29-8595-98f0579d15c1\",\n      \"name\": \"Sticky Note9\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -560,\n        60\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 809.515353297114,\n        \"height\": 944.3745310796205,\n        \"content\": \"## Automate Droplet Snapshot Management on DigitalOcean\\nBuilt for the [Let's Automate It Community](http://onlinethinking.io/community) by [Optimus Agency](https://optimus01.co.za/)\\n\\nThis workflow automates the management of DigitalOcean Droplet snapshots by keeping the number of snapshots under a defined limit, deleting the oldest ones, and ensuring new snapshots are created at regular intervals.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9540cfa4-4b72-40c2-b1d1-5bf3f9bd7884\",\n      \"name\": \"Sticky Note15\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -545,\n        820\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 777.0408639013781,\n        \"height\": 168.5111194243667,\n        \"content\": \"## How to customize this workflow\\n- **`Adjust Snapshot Limit`**: Change the value in the filter node if you want to keep more or fewer snapshots.\\n- **`Modify Run Frequency`**: The workflow runs every 48 hours by default. You can change the frequency in the cron node to run more or less often.\\n- **`Enhance with Notifications`**: You can add a notification node (e.g., Slack or email) to alert you when snapshots are deleted or created.\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Filter\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Delete a Snapshot\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Runs every 48hrs\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"List All Droplets\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Delete a Snapshot\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Droplet Actions snapshot (n8n.optimus01.co.za)\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"List All Droplets\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"List Snapshots for a Droplet\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"List Snapshots for a Droplet\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.filter",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.cron",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}