{
  "source": "1986_Stickynote_Jira_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"uD31xU0VYjogxWoY\",\n  \"meta\": {\n    \"instanceId\": \"03e9d14e9196363fe7191ce21dc0bb17387a6e755dcc9acc4f5904752919dca8\"\n  },\n  \"name\": \"Create_Unique_Jira_tickets_from_Splunk_alerts\",\n  \"tags\": [\n    {\n      \"id\": \"GCHVocImoXoEVnzP\",\n      \"name\": \"ðŸ› ï¸ In progress\",\n      \"createdAt\": \"2023-10-31T02:17:21.618Z\",\n      \"updatedAt\": \"2023-10-31T02:17:21.618Z\"\n    },\n    {\n      \"id\": \"QPJKatvLSxxtrE8U\",\n      \"name\": \"Secops\",\n      \"createdAt\": \"2023-10-31T02:15:11.396Z\",\n      \"updatedAt\": \"2023-10-31T02:15:11.396Z\"\n    }\n  ],\n  \"nodes\": [\n    {\n      \"id\": \"3f9fa220-1966-4478-b7db-c39056564c9d\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        -640,\n        320\n      ],\n      \"webhookId\": \"f2a52578-2fef-40a6-a7ff-e03f6b751a02\",\n      \"parameters\": {\n        \"path\": \"f2a52578-2fef-40a6-a7ff-e03f6b751a02\",\n        \"options\": {},\n        \"httpMethod\": \"POST\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"375ac47e-7975-45cb-b7c1-cef1c7fca701\",\n      \"name\": \"Add Ticket Comment\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        240,\n        520\n      ],\n      \"parameters\": {\n        \"comment\": \"=Timestamp: {{ $('Set Host Name').item.json.body.timestamp }}\\nDescription: {{ $('Set Host Name').item.json.body.description }}\",\n        \"options\": {},\n        \"issueKey\": \"={{ $json.key }}\",\n        \"resource\": \"issueComment\"\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"OYvpDV2Q42eY6iyA\",\n          \"name\": \"Alex Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a5dea875-6adf-4d18-aeb9-5fe31a0ebfae\",\n      \"name\": \"Search Ticket\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        -200,\n        320\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"jql\": \"=splunkhostname ~ \\\"{{ $json['splunk-host-name'] }}\\\" \"\n        },\n        \"operation\": \"getAll\"\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"OYvpDV2Q42eY6iyA\",\n          \"name\": \"Alex Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"3dac410e-1e37-463d-9aba-bc6abf3889f7\",\n      \"name\": \"Set Host Name\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -420,\n        320\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"splunk-host-name\",\n              \"value\": \"={{ $json.body.inputs.A.key['host.name'].replace(/[^a-zA-Z0-9 ]/g, '') }}\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"465ec3b0-dd16-482e-b4b6-f8ed91fbb11b\",\n      \"name\": \"IF Ticket Not Exists\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        20,\n        320\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{ $json.key }}\",\n              \"operation\": \"isEmpty\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1315b76b-39fc-4fd3-9a45-a91e5e873874\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1120,\n        -26.960531840248223\n      ],\n      \"parameters\": {\n        \"width\": 643.8620281403546,\n        \"height\": 537.944771288002,\n        \"content\": \"![VirusTotal](https://i.imgur.com/spMd6AQ.png)\\n## Webhook Node \\nTo setup your webhook integration for Splunk, first ensure that splunk is setup to send alerts to a webhook by visiting the [Setup Guide here](https://docs.splunk.com/observability/en/admin/notif-services/webhook.html). You will copy the n8n webhook url opening the webhook node below. \\n- **Form Access URLs**:\\n  - **Execute Mode**: `https://n8n.domain.com/webhook/test/webhookpath` - Use this to execute the workflow interactively within the n8n canvas. Hit the 'Execute Workflow' button to see real-time execution results. We have pinned data in the webhook node to make testing easier. \\n  - **Silent Mode**: `https://n8n.domain.com/webhook/webhookpath` - Use this for background execution without canvas updates. Results will be logged silently and can be reviewed in the 'Executions' tab.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"636425b9-a11f-4891-aa00-2f3c42956c01\",\n      \"name\": \"Create Ticket\",\n      \"type\": \"n8n-nodes-base.jira\",\n      \"position\": [\n        240,\n        160\n      ],\n      \"parameters\": {\n        \"project\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10001\",\n          \"cachedResultName\": \"Service Desk\"\n        },\n        \"summary\": \"=Splunk Alert for host {{ $('Set Host Name').item.json.body.inputs.A.key[\\\"host.name\\\"] }}:  {{ $('Set Host Name').item.json.body.description }}\",\n        \"issueType\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"10004\",\n          \"cachedResultName\": \"[System] Incident\"\n        },\n        \"additionalFields\": {\n          \"description\": \"={{ $('Set Host Name').item.json.body.description }}\\n\\n{{ $('Set Host Name').item.json.body.messageBody }}\",\n          \"customFieldsUi\": {\n            \"customFieldsValues\": [\n              {\n                \"fieldId\": {\n                  \"__rl\": true,\n                  \"mode\": \"id\",\n                  \"value\": \"customfield_10063\"\n                },\n                \"fieldValue\": \"={{ $('Webhook').item.json[\\\"body\\\"][\\\"inputs\\\"][\\\"A\\\"][\\\"key\\\"][\\\"host.name\\\"].replace(/[^a-zA-Z0-9 ]/g, '') }}\"\n              }\n            ]\n          }\n        }\n      },\n      \"credentials\": {\n        \"jiraSoftwareCloudApi\": {\n          \"id\": \"OYvpDV2Q42eY6iyA\",\n          \"name\": \"Alex Jira Cloud\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"47af8bdb-e0da-4923-8f0a-05deb86ac1b3\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -460,\n        98.72468966845895\n      ],\n      \"parameters\": {\n        \"width\": 401.99970102055784,\n        \"height\": 413.43480804607805,\n        \"content\": \"![VirusTotal](https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Jira_%28Software%29_logo.svg/320px-Jira_%28Software%29_logo.svg.png)\\n## Normalize Hostname \\nTo ensure no special characters are passed into jira and create issues, this set node removes special characters from the `splunk-host-name` and uses that to search and create tickets. This host name is saved as a custom field. \"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c0bf09e6-ca08-4db6-aff0-a6528a8fb03b\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        180,\n        -21.934709587377256\n      ],\n      \"parameters\": {\n        \"width\": 401.99970102055784,\n        \"height\": 348.38243930996134,\n        \"content\": \"![VirusTotal](https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Jira_%28Software%29_logo.svg/320px-Jira_%28Software%29_logo.svg.png)\\n## Create a new ticket\\nThis creates a new ticket in your Prjoect and issue type. Ensure to update these values to ensure it works correctly. \"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a175e343-83ed-4442-94df-7e7027b8c687\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        180,\n        340\n      ],\n      \"parameters\": {\n        \"width\": 401.99970102055784,\n        \"height\": 341.08777742613927,\n        \"content\": \"![VirusTotal](https://upload.wikimedia.org/wikipedia/commons/thumb/8/82/Jira_%28Software%29_logo.svg/320px-Jira_%28Software%29_logo.svg.png)\\n## Add Ticket Comment\\nThis adds the alert as a comment in the existing ticket, to ensure the data is not duplicated. \"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"09143b8c-a4ce-4791-8937-3333d24b6e01\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -40,\n        100.50445897107033\n      ],\n      \"parameters\": {\n        \"width\": 193.6032856277124,\n        \"height\": 415.27445353029793,\n        \"content\": \"## Check if ticket found\\nThis checks `$json.key` to see if the value was found, and route accordingly.\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {\n    \"Webhook\": [\n      {\n        \"json\": {\n          \"body\": {\n            \"tip\": null,\n            \"rule\": \"n8n-test\",\n            \"inputs\": {\n              \"A\": {\n                \"key\": {\n                  \"os.type\": \"linux\",\n                  \"host.name\": \"n8n-enterprise-demo\",\n                  \"sf_metric\": \"cpu.utilization\"\n                },\n                \"value\": \"0.1670342357065173\",\n                \"fragment\": \"data('cpu.utilization').publish(label='A')\"\n              },\n              \"_S2\": {\n                \"value\": \"0.2\",\n                \"fragment\": \"threshold(0.2)\"\n              }\n            },\n            \"status\": \"ok\",\n            \"detector\": \"n8n-test\",\n            \"imageUrl\": \"https://static.eu0.signalfx.com/signed/eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJjb20uc2lnbmFsZnguYXBwIiwiZXhwIjoxNjk0NjE0NjI2LCJpSWQiOiJGNVZBcTEwQUVBQSIsIm9JZCI6IkY1V0JKZ2lBSUFBIiwiYlQiOiJlbmQifQ.udzyF5-HqKyV_EMRmT51EtgECK9g-wanl8nx_MH0i9Q/async\",\n            \"severity\": \"Critical\",\n            \"eventType\": \"F5Vx1EuAAKc__F5V-TcTAEJ8__n8n-test\",\n            \"sf_schema\": 2,\n            \"timestamp\": \"2023-09-06T14:17:00Z\",\n            \"detectorId\": \"F5V-TcTAEJ8\",\n            \"incidentId\": \"F5VAq10AEAA\",\n            \"runbookUrl\": null,\n            \"description\": \"The value of cpu.utilization is above 0.2.\",\n            \"detectorUrl\": \"https://app.eu0.signalfx.com/#/detector/F5V-TcTAEJ8/edit?incidentId=F5VAq10AEAA&is=ok\",\n            \"messageBody\": \"Rule \\\"n8n-test\\\" in detector \\\"n8n-test\\\" cleared at Wed, 6 Sep 2023 14:17:00 GMT.\\n\\nCurrent signal value for n8n.test: 0.1670342357065173\\n\\nSignal details:\\n{sf_metric=cpu.utilization, host.name=n8n-enterprise-demo, os.type=linux}\",\n            \"messageTitle\": \"Back to normal: n8n-test (n8n-test)\",\n            \"statusExtended\": \"ok\",\n            \"detectOnCondition\": \"when(A > threshold(0.2))\",\n            \"originatingMetric\": \"cpu.utilization\",\n            \"triggeredWhileMuted\": false\n          },\n          \"query\": {},\n          \"params\": {},\n          \"headers\": {\n            \"host\": \"internal.users.n8n.cloud\",\n            \"x-real-ip\": \"10.255.0.2\",\n            \"user-agent\": \"Apache-HttpClient/4.5.14 (Java/1.8.0_372)\",\n            \"content-type\": \"application/json; charset=utf-8\",\n            \"content-length\": \"1366\",\n            \"accept-encoding\": \"gzip,deflate\",\n            \"x-forwarded-for\": \"10.255.0.2\",\n            \"x-forwarded-host\": \"internal.users.n8n.cloud\",\n            \"x-forwarded-port\": \"443\",\n            \"x-forwarded-proto\": \"https\",\n            \"x-forwarded-server\": \"e591fa1c2d01\"\n          }\n        }\n      }\n    ]\n  },\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"3985cac2-7f23-4d27-b826-0edfb0544b58\",\n  \"connections\": {\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Host Name\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Search Ticket\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF Ticket Not Exists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Host Name\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Search Ticket\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF Ticket Not Exists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Ticket\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Add Ticket Comment\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.jira",
      "n8n-nodes-base.jira",
      "n8n-nodes-base.set",
      "n8n-nodes-base.if",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.jira",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}