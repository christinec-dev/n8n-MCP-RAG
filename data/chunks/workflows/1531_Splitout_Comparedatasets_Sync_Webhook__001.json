{
  "source": "1531_Splitout_Comparedatasets_Sync_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"KKCfXEpBjjhp1LC8\",\n  \"meta\": {\n    \"instanceId\": \"494d0146a0f47676ad70a44a32086b466621f62da855e3eaf0ee51dee1f76753\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Entra User to Zammad User Sync\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"0007443e-b0d4-4f98-a613-3ec7c2842aa3\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -2140,\n        140\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2b285a4f-7e39-411b-88b9-cb55c5cf62e3\",\n      \"name\": \"Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1700,\n        380\n      ],\n      \"parameters\": {\n        \"width\": 1635.910561370123,\n        \"height\": 329.7269624573379,\n        \"content\": \"## Select Entra Users in a named Entra Group that should be synced to Zammad\\n\\n\\n\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"929e529e-a4a3-4663-b9dc-e2300a860fed\",\n      \"name\": \"Get Groups from Entra\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -1660,\n        480\n      ],\n      \"parameters\": {\n        \"url\": \"https://graph.microsoft.com/v1.0/groups\",\n        \"options\": {},\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"microsoftOAuth2Api\"\n      },\n      \"credentials\": {\n        \"microsoftOAuth2Api\": {\n          \"id\": \"U2E5p3lreqSi8v1N\",\n          \"name\": \"ms365test.zammad.org\"\n        },\n        \"microsoftGraphSecurityOAuth2Api\": {\n          \"id\": \"b09tqOxzkl0P8UQD\",\n          \"name\": \"ms365test.zammad.org\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"3390b2ed-6070-429c-bc1a-f0ab324117c7\",\n      \"name\": \"Remove outer Array\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        -1400,\n        480\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"value\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b0e9531a-7fc0-4de0-8ec5-4be476b18a26\",\n      \"name\": \"Select Entra Zammad default Group\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"notes\": \"Please enter the Entra group name of users to be synchronized.\",\n      \"position\": [\n        -1120,\n        480\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"2dbb2484-2424-4095-a5a2-76ab4e3aaae8\",\n              \"operator\": {\n                \"name\": \"filter.operator.equals\",\n                \"type\": \"string\",\n                \"operation\": \"equals\"\n              },\n              \"leftValue\": \"={{ $json.displayName }}\",\n              \"rightValue\": \"ENTRA\"\n            }\n          ]\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"1be2a745-aea3-46ec-ab84-be2e39358b95\",\n      \"name\": \"Remove outer Array from Entra User\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        -700,\n        460\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"value\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3b1fc962-7546-4bad-b637-e018649a0652\",\n      \"name\": \"Zammad Univeral User Object\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -240,\n        440\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"number\": [\n            {\n              \"name\": \"entra_key\",\n              \"value\": \"={{ $json.id }}\"\n            }\n          ],\n          \"string\": [\n            {\n              \"name\": \"email\",\n              \"value\": \"={{ $json.userPrincipalName }}\"\n            },\n            {\n              \"name\": \"lastname\",\n              \"value\": \"={{ $json.surname }}\"\n            },\n            {\n              \"name\": \"firstname\",\n              \"value\": \"={{ $json.givenName }}\"\n            },\n            {\n              \"name\": \"mobile\",\n              \"value\": \"={{ $json.mobilePhone }}\"\n            },\n            {\n              \"name\": \"phone\",\n              \"value\": \"={{ $json.businessPhones[0] }}\"\n            },\n            {},\n            {}\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9e36e6a9-cf56-4548-a1af-b1e33dbc61dd\",\n      \"name\": \"Get Zammad Users\",\n      \"type\": \"n8n-nodes-base.zammad\",\n      \"position\": [\n        -1020,\n        140\n      ],\n      \"parameters\": {\n        \"filters\": {},\n        \"operation\": \"getAll\",\n        \"returnAll\": true\n      },\n      \"credentials\": {\n        \"zammadTokenAuthApi\": {\n          \"id\": \"fj5GuzcJuNLQeMxz\",\n          \"name\": \"Zammad Token Auth account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c9a342b1-b5f2-4d31-9737-15f145dc7318\",\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        240,\n        140\n      ],\n      \"parameters\": {\n        \"mode\": \"combine\",\n        \"options\": {},\n        \"fieldsToMatchString\": \"email\"\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"a04ebfea-e5fe-4903-841a-8ef29d75ff1a\",\n      \"name\": \"Get Members of the default group\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -880,\n        460\n      ],\n      \"parameters\": {\n        \"url\": \"=https://graph.microsoft.com/v1.0/groups/{{ $json.id }}/members \",\n        \"options\": {},\n        \"authentication\": \"predefinedCredentialType\",\n        \"nodeCredentialType\": \"microsoftOAuth2Api\"\n      },\n      \"credentials\": {\n        \"microsoftOAuth2Api\": {\n          \"id\": \"U2E5p3lreqSi8v1N\",\n          \"name\": \"ms365test.zammad.org\"\n        },\n        \"microsoftGraphSecurityOAuth2Api\": {\n          \"id\": \"b09tqOxzkl0P8UQD\",\n          \"name\": \"ms365test.zammad.org\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"2e68992e-3080-41fd-9aae-c44dc60dc3b0\",\n      \"name\": \"Find new Zammad Users\",\n      \"type\": \"n8n-nodes-base.compareDatasets\",\n      \"position\": [\n        240,\n        460\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"mergeByFields\": {\n          \"values\": [\n            {\n              \"field1\": \"email\",\n              \"field2\": \"email\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.3\n    },\n    {\n      \"id\": \"86dc2c72-d54a-40a9-a64b-fc0bde9a2387\",\n      \"name\": \"Update Zammad User\",\n      \"type\": \"n8n-nodes-base.zammad\",\n      \"position\": [\n        560,\n        140\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $json.id }}\",\n        \"operation\": \"update\",\n        \"updateFields\": {\n          \"phone\": \"={{ $json.phone }}\",\n          \"mobile\": \"={{ $json.mobile }}\",\n          \"lastname\": \"={{ $json.lastname }}\",\n          \"firstname\": \"={{ $json.firstname }}\",\n          \"customFieldsUi\": {\n            \"customFieldPairs\": [\n              {\n                \"name\": \"entra_key\",\n                \"value\": \"={{ $json.entra_key }}\"\n              },\n              {\n                \"name\": \"entra_object_type\",\n                \"value\": \"user\"\n              }\n            ]\n          }\n        }\n      },\n      \"credentials\": {\n        \"zammadTokenAuthApi\": {\n          \"id\": \"fj5GuzcJuNLQeMxz\",\n          \"name\": \"Zammad Token Auth account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"bc883c6d-ec53-4854-824a-bd76b28077d2\",\n      \"name\": \"Create Zammad User\",\n      \"type\": \"n8n-nodes-base.zammad\",\n      \"position\": [\n        580,\n        540\n      ],\n      \"parameters\": {\n        \"lastname\": \"={{ $json.lastname }}\",\n        \"firstname\": \"={{ $json.firstname }}\",\n        \"additionalFields\": {\n          \"email\": \"={{ $json.email }}\",\n          \"phone\": \"={{ $json.phone }}\",\n          \"mobile\": \"={{ $json.mobile }}\",\n          \"customFieldsUi\": {\n            \"customFieldPairs\": [\n              {\n                \"name\": \"entra_key\",\n                \"value\": \"={{ $json.entra_key }}\"\n              },\n              {\n                \"name\": \"entra_object_type\",\n                \"value\": \"user\"\n              }\n            ]\n          }\n        }\n      },\n      \"credentials\": {\n        \"zammadTokenAuthApi\": {\n          \"id\": \"fj5GuzcJuNLQeMxz\",\n          \"name\": \"Zammad Token Auth account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3b57e278-e755-407c-b261-7fe76ce82bb5\",\n      \"name\": \"Deactivate Zammad User\",\n      \"type\": \"n8n-nodes-base.zammad\",\n      \"position\": [\n        600,\n        840\n      ],\n      \"parameters\": {\n        \"id\": \"={{ $json.id }}\",\n        \"operation\": \"update\",\n        \"updateFields\": {\n          \"phone\": \"={{ $json.phone }}\",\n          \"active\": false,\n          \"mobile\": \"={{ $json.mobile }}\",\n          \"lastname\": \"={{ $json.lastname }}\",\n          \"firstname\": \"={{ $json.firstname }}\",\n          \"customFieldsUi\": {\n            \"customFieldPairs\": [\n              {\n                \"name\": \"entra_key\",\n                \"value\": \"={{ $json.entra_key }}\"\n              }\n            ]\n          }\n        }\n      },\n      \"credentials\": {\n        \"zammadTokenAuthApi\": {\n          \"id\": \"fj5GuzcJuNLQeMxz\",\n          \"name\": \"Zammad Token Auth account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cdaf8b51-9b4c-4ad0-b8f0-c6921849ed4c\",\n      \"name\": \"Find removed Users\",\n      \"type\": \"n8n-nodes-base.compareDatasets\",\n      \"position\": [\n        240,\n        880\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"resolve\": \"preferInput1\",\n        \"mergeByFields\": {\n          \"values\": [\n            {\n              \"field1\": \"entra_key\",\n              \"field2\": \"entra_key\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.3\n    },\n    {\n      \"id\": \"9b37b75e-d694-441e-b5a5-8abeccbf4ed7\",\n      \"name\": \"If\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -500,\n        460\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"15da9b4f-46fa-4e9b-bd33-40ae79b88cd5\",\n              \"operator\": {\n                \"type\": \"object\",\n                \"operation\": \"exists\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"13ac19a6-6689-4e75-86d4-02ec1c0c64cd\",\n      \"name\": \"Select only active Users and entra_obect_type=\\\"user\\\"\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -220,\n        140\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"1c9ca19d-18e3-470e-84cd-593794613c59\",\n              \"operator\": {\n                \"name\": \"filter.operator.equals\",\n                \"type\": \"string\",\n                \"operation\": \"equals\"\n              },\n              \"leftValue\": \"={{ $json.entra_object_type }}\",\n              \"rightValue\": \"user\"\n            },\n            {\n              \"id\": \"9187eea8-48ec-4488-9bc9-45235ff88114\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"true\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.active }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"b726c830-9d26-4289-8f66-485850762df7\",\n  \"connections\": {\n    \"If\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Zammad Univeral User Object\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Zammad User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Zammad Users\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Select only active Users and entra_obect_type=\\\"user\\\"\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Find removed Users\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Deactivate Zammad User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [],\n        []\n      ]\n    },\n    \"Remove outer Array\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Select Entra Zammad default Group\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Find new Zammad Users\": {\n      \"main\": [\n        [],\n        [],\n        [],\n        [\n          {\n            \"node\": \"Create Zammad User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Groups from Entra\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Remove outer Array\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Zammad Univeral User Object\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          },\n          {\n            \"node\": \"Find new Zammad Users\",\n            \"type\": \"main\",\n            \"index\": 1\n          },\n          {\n            \"node\": \"Find removed Users\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Get Members of the default group\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Remove outer Array from Entra User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Select Entra Zammad default Group\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Members of the default group\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Zammad Users\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Get Groups from Entra\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Remove outer Array from Entra User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Select only active Users and entra_obect_type=\\\"user\\\"\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Find new Zammad Users\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Find removed Users\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.if",
      "n8n-nodes-base.splitOut",
      "n8n-nodes-base.set",
      "n8n-nodes-base.zammad",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.compareDatasets",
      "n8n-nodes-base.zammad",
      "n8n-nodes-base.zammad",
      "n8n-nodes-base.zammad",
      "n8n-nodes-base.compareDatasets",
      "n8n-nodes-base.if",
      "n8n-nodes-base.if"
    ],
    "trigger": null
  }
}