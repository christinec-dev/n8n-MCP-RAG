{
  "source": "0837_GoogleSheets_Gmail_Create_Triggered.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"5e2cdd86a9e1ca2fc82cc63db38d1710d5d6a5c6fe352258a6f7112815bcd512\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"13188ea7-7e66-4955-89d0-82ba4dc08dc9\",\n      \"name\": \"Search For Folder\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        -2420,\n        500\n      ],\n      \"parameters\": {\n        \"filter\": {\n          \"folderId\": {\n            \"__rl\": true,\n            \"mode\": \"id\",\n            \"value\": \"={{ $json.id }}\"\n          }\n        },\n        \"options\": {},\n        \"resource\": \"fileFolder\",\n        \"queryString\": \"={{$json.folderName}}\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"VypmUgEf64twpmiZ\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"ed2ababb-7022-43e1-b638-0132c08ef701\",\n      \"name\": \"Create Month Folder\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        -2060,\n        680\n      ],\n      \"parameters\": {\n        \"name\": \"={{ $('YYYY/MM').first().json.folderName }}\",\n        \"driveId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"My Drive\"\n        },\n        \"options\": {},\n        \"folderId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('YYYY/MM').item.json.id }}\"\n        },\n        \"resource\": \"folder\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"VypmUgEf64twpmiZ\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"f5f2365d-0977-48b1-bd2e-29b7707839d9\",\n      \"name\": \"Check If Folder Exists\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -2240,\n        500\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"09b62415-cb8f-478e-b6d3-aa463fe70c81\",\n              \"operator\": {\n                \"type\": \"object\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"c27b0a9d-8ee2-4eae-963c-14256ffae0b8\",\n      \"name\": \"Gmail Trigger\",\n      \"type\": \"n8n-nodes-base.gmailTrigger\",\n      \"position\": [\n        -4400,\n        780\n      ],\n      \"parameters\": {\n        \"simple\": false,\n        \"filters\": {\n          \"labelIds\": [\n            \"Label_2\"\n          ]\n        },\n        \"options\": {},\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyX\",\n              \"unit\": \"minutes\",\n              \"value\": 15\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"HI2iZSvhvC5XOdpp\",\n          \"name\": \"Gmail account 2\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"3eac8c53-1b20-4511-9f2a-f5e838ca0fa0\",\n      \"name\": \"Gmail\",\n      \"type\": \"n8n-nodes-base.gmail\",\n      \"position\": [\n        -1720,\n        460\n      ],\n      \"webhookId\": \"e62ae049-d968-4e6a-a62d-06963c8e592f\",\n      \"parameters\": {\n        \"simple\": false,\n        \"options\": {\n          \"downloadAttachments\": true\n        },\n        \"messageId\": \"={{ $('Gmail Trigger').item.json.id }}\",\n        \"operation\": \"get\"\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"HI2iZSvhvC5XOdpp\",\n          \"name\": \"Gmail account 2\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"bfae9bb5-6915-4968-8b5e-e72dd46bda55\",\n      \"name\": \"Split Up Binary Data1\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        -1560,\n        460\n      ],\n      \"parameters\": {\n        \"functionCode\": \"let results = [];\\n\\nfor (item of items) {\\n    for (key of Object.keys(item.binary)) {\\n        results.push({\\n            json: {\\n                fileName: item.binary[key].fileName\\n            },\\n            binary: {\\n                data: item.binary[key],\\n            }\\n        });\\n    }\\n}\\n\\nreturn results;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"baf55ab9-511f-4404-a2cc-b1c848f6f5c5\",\n      \"name\": \"Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1800,\n        280\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 920,\n        \"height\": 660,\n        \"content\": \"## Upload attachments to Drive\\nIncoming files are split up into individual items, each with a single binary data object under the `data` key.\\nFiles names are prefixed with the current timestamp\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5d706d3a-db17-4f5f-9eac-ba91c470dbdd\",\n      \"name\": \"YYYY/MM\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -2600,\n        500\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"143b3b94-a8d7-46b6-8ea8-2e70c082f5b1\",\n              \"name\": \"=folderName\",\n              \"type\": \"string\",\n              \"value\": \"={{\\n  new Date($('Gmail Trigger').item.json.date).getUTCFullYear() \\n  + '/' + \\n  String(new Date($('Gmail Trigger').item.json.date).getUTCMonth() + 1).padStart(2, '0')\\n}}\\n\"\n            }\n          ]\n        },\n        \"includeOtherFields\": true\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"b20a3833-f648-454d-999b-d799727e18e8\",\n      \"name\": \"Loop Over Items\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"position\": [\n        -1320,\n        460\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"bb8c0d21-de74-4abf-bf6c-5eef3f301513\",\n      \"name\": \"Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -2680,\n        280\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 820,\n        \"height\": 660,\n        \"content\": \"# Checks if YYYY/MM Folder exists\\n## If the directory doesn't exist it is created\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"40971ca3-91d3-4651-8137-e973dbd2dbbd\",\n      \"name\": \"Company Folder Exists\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        -3180,\n        500\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"09b62415-cb8f-478e-b6d3-aa463fe70c81\",\n              \"operator\": {\n                \"type\": \"object\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"086ff643-ca10-46ec-92b5-8a014fd3bf3f\",\n      \"name\": \"Create Company Folder\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        -2920,\n        620\n      ],\n      \"parameters\": {\n        \"name\": \"={{ $('Lookup in Sheets').item.json.company }}\",\n        \"driveId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"My Drive\"\n        },\n        \"options\": {},\n        \"folderId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"18ry0AUtrpp3re6u3zQvvs0BQUGFmBKN9\",\n          \"cachedResultUrl\": \"https://drive.google.com/drive/folders/18ry0AUtrpp3re6u3zQvvs0BQUGFmBKN9\",\n          \"cachedResultName\": \"Invoices\"\n        },\n        \"resource\": \"folder\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"VypmUgEf64twpmiZ\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"7792afb7-61d9-402f-814b-f4625cd012bc\",\n      \"name\": \"Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -3500,\n        120\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 760,\n        \"height\": 820,\n        \"content\": \"# Checks if a folder with the company of the email exists\\n## If it doesn't the directory is created\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1f61ea45-49e6-4018-91ad-2144c1bbc19a\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -4120,\n        280\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 560,\n        \"height\": 660,\n        \"content\": \"# 2. Google Sheets Whitelist Config\\n\\n## To filter contacts against a whitelist:\\n### 1. Make a copy of [this spreadsheet](https://docs.google.com/spreadsheets/d/1tTz9BflstxVL18YG11Ny1eiDj3FcjvtZ619b_bHx8h4/edit?usp=sharing)\\n**OR** create a Google Sheet with two columns:\\n| **email**     | **company**      |\\n\\n\\n### 2. Add whitelisted emails and their company as rows in the sheet and configure this node **Document** and **Sheet** to point to it.\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f7009cc2-8194-40c9-98e9-edc4a29c5ce8\",\n      \"name\": \"Lookup in Sheets\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        -3900,\n        780\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"filtersUI\": {\n          \"values\": [\n            {\n              \"lookupValue\": \"={{ $('Gmail Trigger').item.json.from.value[0].address }}\",\n              \"lookupColumn\": \"email\"\n            }\n          ]\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1gZE7EbLJqfMzQlPoCgE0eeqee_F1Lh9eIwhHsVmYKdw/edit#gid=0\",\n          \"cachedResultName\": \"Sheet1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1gZE7EbLJqfMzQlPoCgE0eeqee_F1Lh9eIwhHsVmYKdw\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1gZE7EbLJqfMzQlPoCgE0eeqee_F1Lh9eIwhHsVmYKdw/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Contacts Whitelist\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"63dUs6P8a2b5ed5J\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"932afe12-3341-4f77-88ab-0b558e0d6ee2\",\n      \"name\": \"Search Company Folder1\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        -3440,\n        500\n      ],\n      \"parameters\": {\n        \"filter\": {\n          \"whatToSearch\": \"folders\"\n        },\n        \"options\": {},\n        \"resource\": \"fileFolder\",\n        \"queryString\": \"={{ $('Lookup in Sheets').item.json.company }}\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"VypmUgEf64twpmiZ\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"b9e66cf4-365a-4d11-bff9-48bf28be9e96\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -4740,\n        280\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 560,\n        \"height\": 660,\n        \"content\": \"# 1. Trigger Settings and Filters\\n\\n## Configure the interval to check for new emails and apply filters to process only some emails\\n\\n**For example**: To create a filter that applies a label to emails **with attachments** containing the words \\\"invoice\\\" or \\\"receipt,\\\" follow these steps:\\n\\n1. Open your Gmail and click on the burger menu button next to the search bar to open the search options.\\n2. In the `Has the words` field type in 'invoice receipt'\\n3. Check the `Has attachment` checkbox\\n4. Click on the \\\"Create filter with this search\\\" option at the bottom of the search window.\\n5. In the filter options, select the \\\"Apply the label\\\" option and choose or create a label for these emails.\\n6. Click \\\"Create filter\\\" to save your new filter.\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2a932450-d0e9-44b4-adfb-2254b8e6e547\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -3000,\n        220\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"height\": 540,\n        \"content\": \"# 3. Configure storage location\\n## Set where to store files from the `parent folder` dropdown\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"247e4ed7-ebff-4392-adf2-4a63e80e04f4\",\n      \"name\": \"Upload To Folder\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        -1100,\n        480\n      ],\n      \"parameters\": {\n        \"name\": \"={{ Date.now();}}-{{ $('Loop Over Items').item.binary.data.fileName }} \",\n        \"driveId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"My Drive\",\n          \"cachedResultUrl\": \"https://drive.google.com/drive/my-drive\",\n          \"cachedResultName\": \"My Drive\"\n        },\n        \"options\": {\n          \"ocrLanguage\": \"en\",\n          \"propertiesUi\": {\n            \"propertyValues\": [\n              {\n                \"key\": \"sender\",\n                \"value\": \"={{ $('Gmail').item.json.from.value[0].address }}\"\n              },\n              {\n                \"key\": \"time_received\",\n                \"value\": \"={{ $('Gmail').item.json.date }}\"\n              }\n            ]\n          }\n        },\n        \"folderId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Search For Folder').first().json.id || $('Create Month Folder').item.json.id }}\"\n        },\n        \"inputDataFieldName\": \"=data\"\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"VypmUgEf64twpmiZ\",\n          \"name\": \"Google Drive account\"\n        }\n      },\n      \"typeVersion\": 3\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Gmail\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Up Binary Data1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"YYYY/MM\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Search For Folder\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Gmail Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Lookup in Sheets\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items\": {\n      \"main\": [\n        [],\n        [\n          {\n            \"node\": \"Upload To Folder\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Lookup in Sheets\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Search Company Folder1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Upload To Folder\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Search For Folder\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check If Folder Exists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Month Folder\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Gmail\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Company Folder Exists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"YYYY/MM\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Create Company Folder\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Company Folder\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"YYYY/MM\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Up Binary Data1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check If Folder Exists\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Gmail\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Create Month Folder\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Search Company Folder1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Company Folder Exists\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.if",
      "n8n-nodes-base.gmailTrigger",
      "n8n-nodes-base.gmail",
      "n8n-nodes-base.function",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set",
      "n8n-nodes-base.splitInBatches",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.if",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.googleDrive"
    ],
    "trigger": "gmail trigger"
  }
}