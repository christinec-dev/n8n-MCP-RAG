{
  "source": "0396_Datetime_Schedule_Automation_Scheduled.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"257476b1ef58bf3cb6a46e65fac7ee34a53a5e1a8492d5c6e4da5f87c9b82833\",\n    \"templateId\": \"2075\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"e3df7c90-fd1e-4e56-b4b8-ee2095720077\",\n      \"name\": \"Schedule Trigger\",\n      \"type\": \"n8n-nodes-base.scheduleTrigger\",\n      \"position\": [\n        380,\n        240\n      ],\n      \"parameters\": {\n        \"rule\": {\n          \"interval\": [\n            {}\n          ]\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"fd37f3cc-b42c-43db-ba4c-8f760d620050\",\n      \"name\": \"PURGE DAYS\",\n      \"type\": \"n8n-nodes-base.dateTime\",\n      \"position\": [\n        920,\n        460\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"duration\": 30,\n        \"magnitude\": \"={{ $now }}\",\n        \"operation\": \"subtractFromDate\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"88d38a16-3dad-466f-adab-5c5ac846a65e\",\n      \"name\": \"DELETE OLD BACKUPS\",\n      \"type\": \"n8n-nodes-base.dropbox\",\n      \"position\": [\n        1520,\n        460\n      ],\n      \"parameters\": {\n        \"path\": \"={{ $json.pathDisplay }}\",\n        \"operation\": \"delete\",\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"dropboxOAuth2Api\": {\n          \"id\": \"28\",\n          \"name\": \"Dropbox account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ff2b37de-8bc8-446a-8369-9bc52a54addd\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        820,\n        -20\n      ],\n      \"parameters\": {\n        \"width\": 932.4394074276975,\n        \"height\": 223.80675203725258,\n        \"content\": \"MOVE CURRENT BACKUPS TO OLD FOLDER\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"732eeb83-f552-4c4a-b0dc-e7e25e7a74cb\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        820,\n        220\n      ],\n      \"parameters\": {\n        \"width\": 931.4765002625034,\n        \"height\": 185.32013969732247,\n        \"content\": \"BACKUP ALL CURRENT WORKFLOWS\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fb8e941b-343a-47c0-9806-10f13a0e1c2d\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        817.111278504417,\n        420\n      ],\n      \"parameters\": {\n        \"width\": 932.4394074276973,\n        \"height\": 203.55064027939466,\n        \"content\": \"PURGE BACKUPS OLDER THEN 30 DAYS\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cbf0c9a8-f188-499f-ba9b-68ea6bfdb38b\",\n      \"name\": \"GET WORKFLOWS\",\n      \"type\": \"n8n-nodes-base.n8n\",\n      \"position\": [\n        1100,\n        260\n      ],\n      \"parameters\": {\n        \"filters\": {}\n      },\n      \"credentials\": {\n        \"n8nApi\": {\n          \"id\": \"9zn8iY4B9oVtPrcc\",\n          \"name\": \"n8n account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"43436e4f-83e8-422c-8726-6257976dd9ab\",\n      \"name\": \"MAKE JSON FILES\",\n      \"type\": \"n8n-nodes-base.moveBinaryData\",\n      \"position\": [\n        1300,\n        260\n      ],\n      \"parameters\": {\n        \"mode\": \"jsonToBinary\",\n        \"options\": {\n          \"fileName\": \"={{ $json.name }}\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4a3df15e-3679-415a-bcfc-51b19961b08b\",\n      \"name\": \"UPLOAD WORKFLOWS\",\n      \"type\": \"n8n-nodes-base.dropbox\",\n      \"position\": [\n        1520,\n        260\n      ],\n      \"parameters\": {\n        \"path\": \"={{ $('DESTINATION FOLDER').last().json.folder }}{{ $('GET WORKFLOWS').item.json.name }}.json\",\n        \"binaryData\": true,\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"dropboxOAuth2Api\": {\n          \"id\": \"28\",\n          \"name\": \"Dropbox account\"\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1350580e-a6b8-4d18-b2f3-322f3dbefd0b\",\n      \"name\": \"DESTINATION FOLDER\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        580,\n        240\n      ],\n      \"parameters\": {\n        \"fields\": {\n          \"values\": [\n            {\n              \"name\": \"folder\",\n              \"stringValue\": \"/n8n_backups/\"\n            }\n          ]\n        },\n        \"include\": \"none\",\n        \"options\": {}\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"920c837e-f328-47bc-ac01-da4584640e01\",\n      \"name\": \"WAIT FOR MOVE TO FINISH\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        900,\n        260\n      ],\n      \"parameters\": {\n        \"mode\": \"chooseBranch\",\n        \"output\": \"input2\"\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"8798f472-5a7f-442b-880e-3bffe3597d0b\",\n      \"name\": \"GET CURRENT BACKUPS\",\n      \"type\": \"n8n-nodes-base.dropbox\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        1100,\n        40\n      ],\n      \"parameters\": {\n        \"path\": \"={{ $('DESTINATION FOLDER').last().json.folder }}\",\n        \"limit\": 250,\n        \"filters\": {},\n        \"resource\": \"folder\",\n        \"operation\": \"list\",\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"dropboxOAuth2Api\": {\n          \"id\": \"28\",\n          \"name\": \"Dropbox account\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"b524ac5f-08bf-4c87-9c53-8e9150068690\",\n      \"name\": \"IGNORE FOLDERS\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        1300,\n        40\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"a13e9fd6-ef31-4e23-bde6-955ffab5849b\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEquals\"\n              },\n              \"leftValue\": \"={{ $json.type }}\",\n              \"rightValue\": \"folder\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"7ca4c3d3-93dc-4da0-a4d0-c9282d0e7689\",\n      \"name\": \"MOVE INTO OLD FOLDER\",\n      \"type\": \"n8n-nodes-base.dropbox\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        1520,\n        40\n      ],\n      \"parameters\": {\n        \"path\": \"={{ $json.pathDisplay }}\",\n        \"toPath\": \"={{ $('DESTINATION FOLDER').last().json.folder }}old/{{ $json.name }}_{{ $('GET CURRENT DATE').last().json.formattedDate }}.json\",\n        \"operation\": \"move\",\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"dropboxOAuth2Api\": {\n          \"id\": \"28\",\n          \"name\": \"Dropbox account\"\n        }\n      },\n      \"executeOnce\": false,\n      \"notesInFlow\": true,\n      \"retryOnFail\": false,\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"60505840-821b-43e1-8aa0-6478955c5f3a\",\n      \"name\": \"LIST OLD BACKUPS\",\n      \"type\": \"n8n-nodes-base.dropbox\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        1100,\n        460\n      ],\n      \"parameters\": {\n        \"path\": \"={{ $('DESTINATION FOLDER').last().json.folder }}old\",\n        \"limit\": 500,\n        \"filters\": {},\n        \"resource\": \"folder\",\n        \"operation\": \"list\",\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"dropboxOAuth2Api\": {\n          \"id\": \"28\",\n          \"name\": \"Dropbox account\"\n        }\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"ffab6a02-a9f9-4a91-b4f1-dbc157d079e7\",\n      \"name\": \"CHECK DATES\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1300,\n        460\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"e0aa83a7-a65b-4008-9010-bf4f14c0c398\",\n              \"operator\": {\n                \"type\": \"dateTime\",\n                \"operation\": \"before\"\n              },\n              \"leftValue\": \"={{ $json.lastModifiedServer }}\",\n              \"rightValue\": \"={{ $('PURGE DAYS').item.json.newDate }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"6bb40592-b599-4511-9e29-fdb1d374053f\",\n      \"name\": \"GET CURRENT DATE\",\n      \"type\": \"n8n-nodes-base.dateTime\",\n      \"position\": [\n        900,\n        40\n      ],\n      \"parameters\": {\n        \"date\": \"={{ $now }}\",\n        \"format\": \"=yyyy-MM-dd_HHmm\",\n        \"options\": {},\n        \"operation\": \"formatDate\"\n      },\n      \"typeVersion\": 2\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"PURGE DAYS\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"LIST OLD BACKUPS\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"CHECK DATES\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"DELETE OLD BACKUPS\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"GET WORKFLOWS\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"MAKE JSON FILES\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IGNORE FOLDERS\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"MOVE INTO OLD FOLDER\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"MAKE JSON FILES\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"UPLOAD WORKFLOWS\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"GET CURRENT DATE\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"GET CURRENT BACKUPS\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"LIST OLD BACKUPS\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"CHECK DATES\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Schedule Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"DESTINATION FOLDER\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"DESTINATION FOLDER\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"GET CURRENT DATE\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"WAIT FOR MOVE TO FINISH\",\n            \"type\": \"main\",\n            \"index\": 1\n          },\n          {\n            \"node\": \"PURGE DAYS\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"GET CURRENT BACKUPS\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IGNORE FOLDERS\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"MOVE INTO OLD FOLDER\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"WAIT FOR MOVE TO FINISH\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"WAIT FOR MOVE TO FINISH\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"GET WORKFLOWS\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.scheduleTrigger",
      "n8n-nodes-base.dateTime",
      "n8n-nodes-base.dropbox",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.n8n",
      "n8n-nodes-base.moveBinaryData",
      "n8n-nodes-base.dropbox",
      "n8n-nodes-base.set",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.dropbox",
      "n8n-nodes-base.filter",
      "n8n-nodes-base.dropbox",
      "n8n-nodes-base.dropbox",
      "n8n-nodes-base.if",
      "n8n-nodes-base.dateTime"
    ],
    "trigger": "schedule trigger"
  }
}