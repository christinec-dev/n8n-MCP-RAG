{
  "source": "1414_Filter_Summarize_Automation_Triggered.json",
  "index": 1,
  "content": "{\n  \"id\": \"DvP6IHWymTIVg8Up\",\n  \"meta\": {\n    \"instanceId\": \"b9faf72fe0d7c3be94b3ebff0778790b50b135c336412d28fd4fca2cbbf8d1f5\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Store Notion's Pages as Vector Documents into Supabase with OpenAI\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"495609cd-4ca0-426d-8413-69e771398188\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        480,\n        400\n      ],\n      \"parameters\": {\n        \"width\": 637.1327972412109,\n        \"height\": 1113.7434387207031,\n        \"content\": \"## Store Notion's Pages as Vector Documents into Supabase\\n\\n**This workflow assumes you have a Supabase project with a table that has a vector column. If you don't have it, follow the instructions here:** [Supabase Vector Columns Guide](https://supabase.com/docs/guides/ai/vector-columns)\\n\\n## Workflow Description\\n\\nThis workflow automates the process of storing Notion pages as vector documents in a Supabase database with a vector column. The steps are as follows:\\n\\n1. **Notion Page Added Trigger**:\\n   - Monitors a specified Notion database for newly added pages. You can create a specific Notion database where you copy the pages you want to store in Supabase.\\n   - Node: `Page Added in Notion Database`\\n\\n2. **Retrieve Page Content**:\\n   - Fetches all block content from the newly added Notion page.\\n   - Node: `Get Blocks Content`\\n\\n3. **Filter Non-Text Content**:\\n   - Excludes blocks of type \\\"image\\\" and \\\"video\\\" to focus on textual content.\\n   - Node: `Filter - Exclude Media Content`\\n\\n4. **Summarize Content**:\\n   - Concatenates the Notion blocks content to create a single text for embedding.\\n   - Node: `Summarize - Concatenate Notion's blocks content`\\n\\n5. **Store in Supabase**:\\n   - Stores the processed documents and their embeddings into a Supabase table with a vector column.\\n   - Node: `Store Documents in Supabase`\\n\\n6. **Generate Embeddings**:\\n   - Utilizes OpenAI's API to generate embeddings for the textual content.\\n   - Node: `Generate Text Embeddings`\\n\\n\\n7. **Create Metadata and Load Content**:\\n   - Loads the block content and creates associated metadata, such as page ID and block ID.\\n   - Node: `Load Block Content & Create Metadata`\\n\\n8. **Split Content into Chunks**:\\n   - Divides the text into smaller chunks for easier processing and embedding generation.\\n   - Node: `Token Splitter`\\n\\n\\n\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3f3e65dc-2b26-407c-87e5-52ba3b315fed\",\n      \"name\": \"Embeddings OpenAI\",\n      \"type\": \"@n8n/n8n-nodes-langchain.embeddingsOpenAi\",\n      \"position\": [\n        2200,\n        760\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6d2579b8-376f-44c3-82e8-9dc608efd98b\",\n      \"name\": \"Token Splitter\",\n      \"type\": \"@n8n/n8n-nodes-langchain.textSplitterTokenSplitter\",\n      \"position\": [\n        2340,\n        960\n      ],\n      \"parameters\": {\n        \"chunkSize\": 256,\n        \"chunkOverlap\": 30\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"79b3c147-08ca-4db4-9116-958a868cbfd9\",\n      \"name\": \"Notion - Page Added Trigger\",\n      \"type\": \"n8n-nodes-base.notionTrigger\",\n      \"position\": [\n        1180,\n        520\n      ],\n      \"parameters\": {\n        \"simple\": false,\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        },\n        \"databaseId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"\",\n          \"cachedResultUrl\": \"\",\n          \"cachedResultName\": \"\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e4a6f524-e3f5-4d02-949a-8523f2d21965\",\n      \"name\": \"Notion - Retrieve Page Content\",\n      \"type\": \"n8n-nodes-base.notion\",\n      \"position\": [\n        1400,\n        520\n      ],\n      \"parameters\": {\n        \"blockId\": {\n          \"__rl\": true,\n          \"mode\": \"url\",\n          \"value\": \"={{ $json.url }}\"\n        },\n        \"resource\": \"block\",\n        \"operation\": \"getAll\",\n        \"returnAll\": true\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"bfebc173-8d4b-4f8f-a625-4622949dd545\",\n      \"name\": \"Filter Non-Text Content\",\n      \"type\": \"n8n-nodes-base.filter\",\n      \"position\": [\n        1620,\n        520\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"e5b605e5-6d05-4bca-8f19-a859e474620f\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEquals\"\n              },\n              \"leftValue\": \"={{ $json.type }}\",\n              \"rightValue\": \"image\"\n            },\n            {\n              \"id\": \"c7415859-5ffd-4c78-b497-91a3d6303b6f\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEquals\"\n              },\n              \"leftValue\": \"={{ $json.type }}\",\n              \"rightValue\": \"video\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"b04939f9-355a-430b-a069-b11800066313\",\n      \"name\": \"Summarize - Concatenate Notion's blocks content\",\n      \"type\": \"n8n-nodes-base.summarize\",\n      \"position\": [\n        1920,\n        520\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"outputFormat\": \"separateItems\"\n        },\n        \"fieldsToSummarize\": {\n          \"values\": [\n            {\n              \"field\": \"content\",\n              \"separateBy\": \"\\n\",\n              \"aggregation\": \"concatenate\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0e64dbb5-20c1-4b90-b818-a1726aaf5112\",\n      \"name\": \"Create metadata and load content\",\n      \"type\": \"@n8n/n8n-nodes-langchain.documentDefaultDataLoader\",\n      \"position\": [\n        2320,\n        760\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"metadata\": {\n            \"metadataValues\": [\n              {\n                \"name\": \"pageId\",\n                \"value\": \"={{ $('Notion - Page Added Trigger').item.json.id }}\"\n              },\n              {\n                \"name\": \"createdTime\",\n                \"value\": \"={{ $('Notion - Page Added Trigger').item.json.created_time }}\"\n              },\n              {\n                \"name\": \"pageTitle\",\n                \"value\": \"={{ $('Notion - Page Added Trigger').item.json.properties.Page.title[0].text.content }}\"\n              }\n            ]\n          }\n        },\n        \"jsonData\": \"={{ $('Summarize - Concatenate Notion's blocks content').item.json.concatenated_content }}\",\n        \"jsonMode\": \"expressionData\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"187aba6f-eaed-4427-8d40-b9da025fb37d\",\n      \"name\": \"Supabase Vector Store\",\n      \"type\": \"@n8n/n8n-nodes-langchain.vectorStoreSupabase\",\n      \"position\": [\n        2200,\n        520\n      ],\n      \"parameters\": {\n        \"mode\": \"insert\",\n        \"options\": {},\n        \"tableName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"\",\n          \"cachedResultName\": \"\"\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"77f6b6f7-d699-4a7e-b3e7-fe8a60bde7ba\",\n  \"connections\": {\n    \"Token Splitter\": {\n      \"ai_textSplitter\": [\n        [\n          {\n            \"node\": \"Create metadata and load content\",\n            \"type\": \"ai_textSplitter\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Embeddings OpenAI\": {\n      \"ai_embedding\": [\n        [\n          {\n            \"node\": \"Supabase Vector Store\",\n            \"type\": \"ai_embedding\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filter Non-Text Content\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Summarize - Concatenate Notion's blocks content\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Notion - Page Added Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Notion - Retrieve Page Content\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Notion - Retrieve Page Content\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filter Non-Text Content\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create metadata and load content\": {\n      \"ai_document\": [\n        [\n          {\n            \"node\": \"Supabase Vector Store\",\n            \"type\": \"ai_document\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Summarize - Concatenate Notion's blocks content\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Supabase Vector Store\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.stickyNote",
      "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "@n8n/n8n-nodes-langchain.textSplitterTokenSplitter",
      "n8n-nodes-base.notionTrigger",
      "n8n-nodes-base.notion",
      "n8n-nodes-base.filter",
      "n8n-nodes-base.summarize",
      "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "@n8n/n8n-nodes-langchain.vectorStoreSupabase"
    ],
    "trigger": "notion - page added trigger"
  }
}