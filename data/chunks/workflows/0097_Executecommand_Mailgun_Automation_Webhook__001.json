{
  "source": "0097_Executecommand_Mailgun_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"name\": \"Steam + CF Report\",\n  \"nodes\": [\n    {\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        110,\n        200\n      ],\n      \"parameters\": {\n        \"path\": \"steam\",\n        \"responseData\": \"allEntries\",\n        \"responseMode\": \"lastNode\",\n        \"authentication\": \"basicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": \"credentials\"\n      },\n      \"retryOnFail\": false,\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Add bind-tools\",\n      \"type\": \"n8n-nodes-base.executeCommand\",\n      \"color\": \"#FF8000\",\n      \"notes\": \"Install bind-tools\",\n      \"position\": [\n        480,\n        180\n      ],\n      \"parameters\": {\n        \"command\": \"=which dig || apk add bind-tools\"\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 1,\n      \"continueOnFail\": true,\n      \"waitBetweenTries\": 1000\n    },\n    {\n      \"name\": \"dig check CF\",\n      \"type\": \"n8n-nodes-base.executeCommand\",\n      \"color\": \"#FF8000\",\n      \"notes\": \"Install bind-tools\",\n      \"position\": [\n        1300,\n        -50\n      ],\n      \"parameters\": {\n        \"command\": \"=dig NS  {{$node[\\\"Webhook\\\"].data[\\\"query\\\"][\\\"q\\\"]}} +short | grep cloudflare.com.$ | wc -l\"\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 1,\n      \"continueOnFail\": true,\n      \"waitBetweenTries\": 1000\n    },\n    {\n      \"name\": \"IF\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1550,\n        -50\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"= {{$node[\\\"dig check CF\\\"].data[\\\"stdout\\\"]}}\",\n              \"operation\": \"larger\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Mail CloudFlare\",\n      \"type\": \"n8n-nodes-base.mailgun\",\n      \"position\": [\n        1830,\n        160\n      ],\n      \"parameters\": {\n        \"text\": \"=Hello,\\n\\nI am emailing you to let you know about a Steam phishing website on your network: {{$node[\\\"Webhook\\\"].data[\\\"query\\\"][\\\"q\\\"]}}.\\n\\nThank you,\\nYour Name Here\",\n        \"ccEmail\": \"yourCCemail\",\n        \"subject\": \"={{$node[\\\"Webhook\\\"].data[\\\"query\\\"][\\\"q\\\"]}} - Steam Phishing Website on your network\",\n        \"toEmail\": \"security@cloudflare.com\",\n        \"fromEmail\": \"yourFROMemail\"\n      },\n      \"credentials\": {\n        \"mailgunApi\": \"Mailgun\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Mail Steam\",\n      \"type\": \"n8n-nodes-base.mailgun\",\n      \"position\": [\n        1830,\n        340\n      ],\n      \"parameters\": {\n        \"text\": \"=Hello,\\n\\nI am emailing you to let you know about a Steam phishing website: {{$node[\\\"Webhook\\\"].data[\\\"query\\\"][\\\"q\\\"]}}.\\n\\nThank you,\\nYour Name Here\",\n        \"ccEmail\": \"yourCCemail\",\n        \"subject\": \"={{$node[\\\"Webhook\\\"].data[\\\"query\\\"][\\\"q\\\"]}} - Steam Phishing Website\",\n        \"toEmail\": \"security@valvesoftware.com\",\n        \"fromEmail\": \"yourFROMemail\"\n      },\n      \"credentials\": {\n        \"mailgunApi\": \"Mailgun\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"dig check if domain is valid\",\n      \"type\": \"n8n-nodes-base.executeCommand\",\n      \"color\": \"#FF8000\",\n      \"notes\": \"Install bind-tools\",\n      \"position\": [\n        720,\n        180\n      ],\n      \"parameters\": {\n        \"command\": \"=dig NS  {{$node[\\\"Webhook\\\"].data[\\\"query\\\"][\\\"q\\\"]}} +short | wc -l\"\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 1,\n      \"continueOnFail\": true,\n      \"waitBetweenTries\": 1000\n    },\n    {\n      \"name\": \"If it has nameservers\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        970,\n        180\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"= {{$node[\\\"dig check if domain is valid\\\"].data[\\\"stdout\\\"]}}\",\n              \"operation\": \"larger\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"IF1\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        270,\n        200\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{$node[\\\"Webhook\\\"].data[\\\"query\\\"][\\\"q\\\"]}}\",\n              \"value2\": \"/^[a-zA-Z0-9-_.]+$/\",\n              \"operation\": \"regex\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"settings\": {},\n  \"connections\": {\n    \"IF\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Mail CloudFlare\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Add bind-tools\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"dig check CF\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Add bind-tools\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"dig check if domain is valid\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If it has nameservers\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"dig check CF\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Mail Steam\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"dig check if domain is valid\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If it has nameservers\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.executeCommand",
      "n8n-nodes-base.executeCommand",
      "n8n-nodes-base.if",
      "n8n-nodes-base.mailgun",
      "n8n-nodes-base.mailgun",
      "n8n-nodes-base.executeCommand",
      "n8n-nodes-base.if",
      "n8n-nodes-base.if"
    ],
    "trigger": null
  }
}