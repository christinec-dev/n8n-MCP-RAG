{
  "source": "1601_Webhook_Respondtowebhook_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"PoiRk5w0xd1ysq4U\",\n  \"meta\": {\n    \"instanceId\": \"b9faf72fe0d7c3be94b3ebff0778790b50b135c336412d28fd4fca2cbbf8d1f5\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"AI Agent to chat with you Search Console Data, using OpenAI and Postgres\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"9ee6710b-19b7-4bfd-ac2d-0fe1e2561f1d\",\n      \"name\": \"Postgres Chat Memory\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryPostgresChat\",\n      \"position\": [\n        1796,\n        220\n      ],\n      \"parameters\": {\n        \"tableName\": \"insights_chat_histories\"\n      },\n      \"credentials\": {\n        \"postgres\": {\n          \"id\": \"\",\n          \"name\": \"Postgres\"\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"eb9f07e9-ded1-485c-9bf3-cf223458384a\",\n      \"name\": \"OpenAI Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1356,\n        240\n      ],\n      \"parameters\": {\n        \"model\": \"gpt-4o\",\n        \"options\": {\n          \"maxTokens\": 16000\n        }\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"\",\n          \"name\": \"OpenAi\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1d3d6fb7-a171-4590-be42-df7eb0c208ed\",\n      \"name\": \"Set fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        940,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"9f47b322-e42f-42d7-93eb-a57d22adb849\",\n              \"name\": \"chatInput\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.body?.chatInput || $json.chatInput  }}\"\n            },\n            {\n              \"id\": \"73ec4dd0-e986-4f60-9dca-6aad2f86bdeb\",\n              \"name\": \"sessionId\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.body?.sessionId || $json.sessionId }}\"\n            },\n            {\n              \"id\": \"4b688c46-b60f-4f0a-83d8-e283f2d7055c\",\n              \"name\": \"date_message\",\n              \"type\": \"string\",\n              \"value\": \"={{ $now.format('yyyy-MM-dd') }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"92dc5e8b-5140-49be-8713-5749b7e2d46b\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        407.32142857142867,\n        -320\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 347.9910714285712,\n        \"height\": 516.8973214285712,\n        \"content\": \"## Webhook - ChatInput\\n\\nThis webhook serves as the endpoint for receiving `ChatInput` data. Ensure that you include:\\n- `chatInput` ‚Äì the content you wish to send (üòâ)\\n- `sessionId` ‚Äì a unique identifier for the session\\n\\nIf you're using an interface such as **Open WebUI**, the `sessionId` will be generated automatically.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ca9f3732-9b62-4f44-b970-77d5d470ec76\",\n      \"name\": \"Webhook - ChatInput\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        500,\n        -20\n      ],\n      \"webhookId\": \"a6820b65-76cf-402b-a934-0f836dee6ba0\",\n      \"parameters\": {\n        \"path\": \"a6820b65-76cf-402b-a934-0f836dee6ba0/chat\",\n        \"options\": {},\n        \"httpMethod\": \"POST\",\n        \"responseMode\": \"responseNode\",\n        \"authentication\": \"basicAuth\"\n      },\n      \"credentials\": {\n        \"httpBasicAuth\": {\n          \"id\": \"\",\n          \"name\": \"basic-auth\"\n        }\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"9d684873-6dfe-4709-928d-293b187dfb30\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        820,\n        -320\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 347.9910714285712,\n        \"height\": 516.8973214285712,\n        \"content\": \"## Set fields\\n\\nThis node sets three fields:\\n- `chatInput`: retrieved from the previous webhook node\\n- `sessionId`: retrieved from the previous webhook node\\n- `date_message`: formatted within this node. This will be used later to help the AI agent determine the date range for retrieving Search Console data.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8750215a-1e33-4ac8-a6da-95efa8ffed65\",\n      \"name\": \"Respond to Webhook\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        2600,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"1b879496-5c0f-4bd5-b4cb-18df2662aef2\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1240,\n        -320\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 1154.2857142857138,\n        \"height\": 516.8973214285712,\n        \"content\": \"## AI Agent - Tools Agent\\n\\nThis AI Agent is configured with a system prompt that instructs it to:\\n- On the first user message, **retrieve available Search Console properties** and offer the user the option to **fetch data from these properties**\\n- Based on the user‚Äôs natural language input, **construct an API call** to the selected Search Console property and retrieve the requested data\\n- Present the data in a **markdown-formatted table**\\n\\nThe AI Agent has a friendly tone and is designed to **confirm the user‚Äôs data requirements accurately** before executing any API requests.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c44c6402-9ddd-4a7b-bc5a-b6c3679a3f68\",\n      \"name\": \"Call Search Console Tool\",\n      \"type\": \"@n8n/n8n-nodes-langchain.toolWorkflow\",\n      \"position\": [\n        2196,\n        220\n      ],\n      \"parameters\": {\n        \"name\": \"SearchConsoleRequestTool\",\n        \"workflowId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"PoiRk5w0xd1ysq4U\",\n          \"cachedResultName\": \"My workflow 10\"\n        },\n        \"description\": \"Call this tool when you need to get the website_list or custom_insights\",\n        \"jsonSchemaExample\": \"\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"b1701a89-c5b3-47fb-99d5-4896a6d5c7a2\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1234,\n        220\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 328.9664285714292,\n        \"height\": 468.13107142857154,\n        \"content\": \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### AI Agent Sub-node - OpenAI Chat Model\\n\\nThis sub-node utilizes the selected **OpenAI Chat Model**. You can replace it with any LLM that **supports tool calling**.\\n\\n### ‚ö†Ô∏è Choose Your Model\\nIn this template, the **default model is `gpt-4o`**, a **costly option**. If you'd like a more **affordable alternative**, select `gpt4-o-mini`, though note that responses may occasionally be of slightly lower quality compared to `gpt-4o`.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cd1a7cec-5845-47b1-a2c8-d3b458a02eb0\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1656,\n        220\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 328.9664285714292,\n        \"height\": 468.13107142857154,\n        \"content\": \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### AI Agent Sub-node - Postgres Chat Memory\\n\\nConnect your **Postgres credentials** and specify a **table name** to store the chat history. In this template, the default table name is `insights_chat_histories`, and the **context window length is set to 5**.\\n\\n**üëã Tip:** If you don‚Äôt have a Postgres database, you can quickly **set one up with [Supabase](https://supabase.com/)**.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"290a07d1-c7ed-434d-9851-2a2dcdd35bdf\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2076,\n        220\n      ],\n      \"parameters\": {\n        \"color\": 6,\n        \"width\": 328.9664285714292,\n        \"height\": 468.13107142857154,\n        \"content\": \"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n### AI Agent Sub-node - Call Search Console Tool\\n\\nThis **tool is used by the AI Agent** to:\\n- Retrieve the **list of accessible properties in Search Console**\\n- **Fetch Search Console data** based on the user‚Äôs natural language request\\n\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"07805c90-7ba5-44d0-b6eb-5a65efb0f8be\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2480,\n        -320\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 347.9910714285712,\n        \"height\": 516.8973214285712,\n        \"content\": \"## Respond to Webhook\\n\\nThis node is used to send a response back to the user.\\n\\n**üëã Tip:** `intermediateSteps` are configured, allowing you to use raw data fetched from Search Console to **create charts or other visualizations** if desired.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9a927a40-45e4-4fd5-ab3e-b77578469f82\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        400,\n        800\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 370.3910714285712,\n        \"height\": 492.3973214285712,\n        \"content\": \"## Tool Call Trigger\\n\\nThis **node is triggered when the AI Agent needs to retrieve the `website_list`** (accessible Search Console properties) or **`custom_insights`** based on user data.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c54a4653-0f09-46b0-bd20-68919b96e154\",\n      \"name\": \"Tool calling\",\n      \"type\": \"n8n-nodes-base.executeWorkflowTrigger\",\n      \"position\": [\n        500,\n        1080\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cc7303ee-1afa-4859-83e7-3af0e963a0f1\",\n      \"name\": \"Switch\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        1300,\n        1080\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"custom_insights\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"a30fe6a6-7d0a-4f14-8492-ae021ddc8ec6\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"contains\"\n                    },\n                    \"leftValue\": \"={{ $json.request_type }}\",\n                    \"rightValue\": \"custom_insights\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"website_list\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"1b7d6039-6474-4a73-b157-584743a9d7f0\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"contains\"\n                    },\n                    \"leftValue\": \"={{$json.request_type}}\",\n                    \"rightValue\": \"website_list\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"6860ff98-4050-4f64-b8c1-a153e3388df0\",\n      \"name\": \"Set fields - Consruct API CALL\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        920,\n        1080\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"06373437-8288-4171-9f98-e8a417220dd4\",\n              \"name\": \"request_type\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.query.parseJson().request_type }}\"\n            },\n            {\n              \"id\": \"da45c0c5-05f6-4107-81aa-8c08c972d9bf\",\n              \"name\": \"start_date\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.query.parseJson().startDate }}\"\n            },\n            {\n              \"id\": \"59d55034-c612-43d7-9700-4cacdb630ec2\",\n              \"name\": \"end_date\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.query.parseJson().endDate }}\"\n            },\n            {\n              \"id\": \"4c2478c0-7f96-4d3d-a632-089307dc989e\",\n              \"name\": \"dimensions\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.query.parseJson().dimensions }}\"\n            },\n            {\n              \"id\": \"eceefbf9-44e5-4617-96ea-58aca2a29618\",\n              \"name\": \"rowLimit\",\n              \"type\": \"number\",\n              \"value\": \"={{ $json.query.parseJson().rowLimit }}\"\n            },\n            {\n              \"id\": \"4e18386e-8548-4385-b620-43efbb11cd63\",\n              \"name\": \"startRow\",\n              \"type\": \"number\",\n              \"value\": \"={{ $json.query.parseJson().startRow}}\"\n            },\n            {\n              \"id\": \"a9323a7b-08b4-4015-b3d7-632bcdf56f4e\",\n              \"name\": \"property\",\n              \"type\": \"string\",\n              \"value\": \"={{ encodeURIComponent($json.query.parseJson().property) }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"0a2dfb28-17ee-477f-b9ea-f1d8e05e3745\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        820,\n        800\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 370.3910714285712,\n        \"height\": 492.3973214285712,\n        \"content\": \"## Set Fields - Construct API Call\\n\\nThis node configures fields based on the JSON sent by the AI agent:\\n- The `request_type` field determines the route: `website_list` (to retrieve the list of websites) or `custom_insights` (to get insights from Search Console)\\n- Additional fields are set to construct the API call, following the **[Search Console API Documentation](https://developers.google.com/webmaster-tools/v1/searchanalytics/query?hl=en)**\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e6ef5c28-01e4-4a0b-9081-b62ec28be635\",\n      \"name\": \"Set fields - Create searchConsoleDataArray\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2180,\n        980\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"2cffd36f-72bd-4535-8427-a88028ea0c4c\",\n              \"name\": \"searchConsoleData\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.rows }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"abc80061-a794-4e1d-a055-bd88ea5c93eb\",\n      \"name\": \"Set fields - Create searchConsoleDataArray 2\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        2180,\n        1340\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"2cffd36f-72bd-4535-8427-a88028ea0c4c\",\n              \"name\": \"searchConsoleData\",\n              \"type\": \"array\",\n              \"value\": \"={{ $json.siteEntry }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"24981eea-980e-4e07-9036-d0042c5b2fbe\",\n      \"name\": \"Search Console - Get Custom Insights\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1620,\n        980\n      ],\n      \"parameters\": {\n        \"url\": \"=https://www.googleapis.com/webmasters/v3/sites/{{ $json.property }}/searchAnalytics/query\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"startDate\\\": \\\"{{ $json.start_date }}\\\",\\n  \\\"endDate\\\": \\\"{{ $json.end_date }}\\\",\\n  \\\"dimensions\\\": {{ $json.dimensions }},\\n  \\\"rowLimit\\\": {{ $json.rowLimit }},\\n  \\\"startRow\\\": 0,\\n  \\\"dataState\\\":\\\"all\\\"\\n}\",\n        \"sendBody\": true,\n        \"sendQuery\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"oAuth2Api\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {}\n          ]\n        },\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"oAuth2Api\": {\n          \"id\": \"\",\n          \"name\": \"search-console\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"645ff407-857d-4629-926b-5cfc52cfa8ba\",\n      \"name\": \"Sticky Note9\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1520,\n        800\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 370.3910714285712,\n        \"height\": 364.3185243941325,\n        \"content\": \"## Search Console - Get Custom Insights\\n\\nThis node **performs the API call to retrieve data from Search Console**.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"15aa66e2-f288-4c86-8dad-47e22aa9104f\",\n      \"name\": \"Sticky Note10\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1520,\n        1180\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 370.3910714285712,\n        \"height\": 334.24982142857124,\n        \"content\": \"## Search Console - Get List of Properties\\n\\nThis node **performs the API call to retrieve the list of accessible properties from Search Console**.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"cd804a52-833a-451a-8e0c-f640210ee2c4\",\n      \"name\": \"## Search Console - Get List of Properties\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1620,\n        1340\n      ],\n      \"parameters\": {\n        \"url\": \"=https://www.googleapis.com/webmasters/v3/sites\",\n        \"options\": {},\n        \"sendHeaders\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"oAuth2Api\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"oAuth2Api\": {\n          \"id\": \"\",\n          \"name\": \"search-console\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"3eac4df1-00ac-4262-b520-3a7e218c7e57\",\n      \"name\": \"Sticky Note11\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2040,\n        800\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 370.3910714285712,\n        \"height\": 725.1298214285712,\n        \"content\": \"## Set Fields - Create `searchConsoleDataArray`\\n\\nThese nodes **create an array based on the response from the Search Console API**.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"86db5800-a735-4749-a800-63d78908610b\",\n      \"name\": \"Sticky Note12\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2520,\n        800\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 370.3910714285712,\n        \"height\": 722.6464176100125,\n        \"content\": \"## Array Aggregation - Response to AI Agent\\n\\nThese nodes **aggregate the array from the previous** step and send it back to the AI Agent through the field named output as `response`.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"aefbacc7-8dfc-4655-bc4d-f0498c823711\",\n      \"name\": \"Array aggregation - response to AI Agent\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        2640,\n        980\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"aggregate\": \"aggregateAllItemData\",\n        \"destinationFieldName\": \"response\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e5334c72-981c-4375-ae8e-9a3a0457880b\",\n      \"name\": \"Array aggregation - response to AI Agent1\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"position\": [\n        2660,\n        1340\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"aggregate\": \"aggregateAllItemData\",\n        \"destinationFieldName\": \"response\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2e93a798-6c26-4d34-a553-ba01b64ca3fe\",\n      \"name\": \"Sticky Note13\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -398.45627799387194,\n        -320\n      ],\n      \"parameters\": {\n        \"width\": 735.5589746610085,\n        \"height\": 1615.4504601771982,\n        \"content\": \"# AI Agent to Chat with Your Search Console Data\\n\\nThis **AI Agent enables you to interact with your Search Console data** through a **chat interface**. Each node is **documented within the template**, providing sufficient information for setup and usage. You will also need to **configure Search Console OAuth credentials**.\\n\\nFollow this **[n8n documentation](https://docs.n8n.io/integrations/builtin/credentials/google/oauth-generic/#configure-your-oauth-consent-screen)** to set up the OAuth credentials.\\n\\n## Important Notes\\n\\n### Correctly Configure Scopes for Search Console API Calls\\n- It‚Äôs essential to **configure the scopes correctly** in your Google Search Console API OAuth2 credentials. Incorrect **configuration can cause issues with the refresh token**, requiring frequent reconnections. Below is the configuration I use to **avoid constant re-authentication**:\\n![Search Console API oAuth2 config 1](https://i.imgur.com/vVLM7gG.png)\\n![Search Console API oAuth2 config 2](https://i.imgur.com/naT1NaX.png)\\n\\nOf course, you'll need to add your **client_id** and **client_secret** from the **Google Cloud Platform app** you created to access your Search Console data.\\n\\n### Configure Authentication for the Webhook\\n\\nSince the **webhook will be publicly accessible**, don‚Äôt forget to **set up authentication**. I‚Äôve used **Basic Auth**, but feel free to **choose the method that best meets your security requirements**.\\n\\n## ü§©üíñ Example of awesome things you can do with this AI Agent\\n![Example of chat with this AI Agent](https://i.imgur.com/jbfsYvT.png)\\n\\n\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fa630aa9-3c60-4b27-9477-aaeb79c7f37d\",\n      \"name\": \"AI Agent\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        1676,\n        -20\n      ],\n      \"parameters\": {\n        \"text\": \"=user_message :  {{ $json.chatInput }}\\ndate_message : {{ $json.date_message }}\",\n        \"options\": {\n          \"systemMessage\": \"=Assist users by asking natural, conversational questions to understand their data needs and building a custom JSON API request to retrieve Search Console data. Handle assumptions internally, confirming them with the user in a friendly way. Avoid technical jargon and never imply that the user is directly building an API request.\\n\\nPre-Step: Retrieve the Website List\\nImportant: Initial Action: Before sending your first message to the user, retrieve the list of connected Search Console properties.\\n\\nTool Call for Website List:\\n\\nTool name: SearchConsoleRequestTool\\nRequest:\\n{\\n  \\\"request_type\\\": \\\"website_list\\\" // Always include `request_type` in the API call.\\n}\\nUsage: Use this list to personalize your response in the initial interaction.\\nStep-by-Step Guide\\nStep 1: Initial Interaction and Introduction\\nGreeting:\\n\\n\\\"Hi there! I‚Äôm here to help you gain valuable insights from your Search Console data. Whether you're interested in a specific time frame, performance breakdown by pages, queries, or other dimensions, I've got you covered.\\n\\nI can help you retrieve data for these websites:\\n\\nhttps://example1.com\\nhttps://example2.com\\nhttps://example3.com\\nWhich of these properties would you like to analyze?\\\"\\nStep 2: Handling User Response for Property Selection\\nAction: When the user selects a property, use the property URL exactly as listed (e.g., \\\"https://example.com\\\") when constructing the API call.\\n\\nStep 3: Understanding the User's Needs\\nAcknowledgment and Setting Defaults:\\n\\nIf the user expresses a general need (e.g., \\\"I want the last 3 months of page performance\\\"), acknowledge their request and set reasonable defaults.\\n\\nExample Response:\\n\\n\\\"Great! I'll gather the top 300 queries from the last 3 months for https://example.com. If you'd like more details or adjustments, just let me know.\\\"\\n\\nFollow-up Questions:\\n\\nConfirming Dimensions: If the user doesn‚Äôt specify dimensions, ask:\\n\\n\\\"For this analysis, I‚Äôll look at page performance. Does that sound good, or would you like to include other details like queries, devices, or other dimensions?\\\"\\n\\nNumber of Results: If the user hasn‚Äôt specified the number of results, confirm:\\n\\n\\\"I can show you the top 100 results. Let me know if you'd like more or fewer!\\\"\\n\\nStep 4: Gathering Specific Inputs (If Necessary)\\nAction: If the user provides specific needs, capture and confirm them naturally.\\n\\nExample Response:\\n\\n\\\"Perfect, I‚Äôll pull the data for [specified date range], focusing on [specified dimensions]. Anything else you‚Äôd like me to include?\\\"\\n\\nImplicit Defaults:\\n\\nDate Range: Assume \\\"last 3 months\\\" if not specified.\\nRow Limit: Default to 100, adjustable based on user input.\\nStep 5: Confirming Input with the User\\nAction: Summarize the request to ensure accuracy.\\n\\nExample Response:\\n\\n\\\"Here‚Äôs what I‚Äôm preparing: data for https://example.com, covering the last 3 months, focusing on the top 100 queries. Let me know if you‚Äôd like to adjust anything!\\\"\\n\\nStep 6: Constructing the JSON for Custom Insights\\nAction: Build the API call based on the conversation.\\n\\n{\\n  \\\"property\\\": \\\"<USER_PROVIDED_PROPERTY_URL>\\\", // Use the exact property URL.\\n  \\\"request_type\\\": \\\"custom_insights\\\",\\n  \\\"startDate\\\": \\\"<ASSUMED_OR_USER_SPECIFIED_START_DATE>\\\",\\n  \\\"endDate\\\": \\\"<ASSUMED_OR_USER_SPECIFIED_END_DATE>\\\",\\n  \\\"dimensions\\\": [\\\"<IMPLIED_OR_USER_SPECIFIED_DIMENSIONS>\\\"], // Array of one or more: \\\"page\\\", \\\"query\\\", \\\"searchAppearance\\\", \\\"device\\\", \\\"country\\\"\\n  \\\"rowLimit\\\": 300 // Default or user-specified limit.\\n}\\nStep 7: Presenting the Data\\nWhen Retrieving Custom Insights:\\n\\nImportant: Display all retrieved data in an easy-to-read markdown table format.\\nStep 8: Error Handling\\nAction: Provide clear, user-friendly error messages when necessary.\\n\\nExample Response:\\n\\n\\\"Hmm, there seems to be an issue retrieving the data. Let‚Äôs review what we have or try a different approach.\\\"\\n\\nAdditional Notes\\nProactive Assistance: Offer suggestions based on user interactions, such as adding dimensions or refining details.\\nTone: Maintain a friendly and helpful demeanor throughout the conversation.\",\n          \"returnIntermediateSteps\": true\n        },\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.6\n    }\n  ],\n  \"active\": true,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"abda3766-7d18-46fb-83e7-c2343ff26385\",\n  \"connections\": {\n    \"Switch\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Search Console - Get Custom Insights\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"## Search Console - Get List of Properties\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"AI Agent\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Respond to Webhook\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Tool calling\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set fields - Consruct API CALL\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"OpenAI Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook - ChatInput\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Postgres Chat Memory\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Call Search Console Tool\": {\n      \"ai_tool\": [\n        [\n          {\n            \"node\": \"AI Agent\",\n            \"type\": \"ai_tool\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set fields - Consruct API CALL\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Switch\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Search Console - Get Custom Insights\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set fields - Create searchConsoleDataArray\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"## Search Console - Get List of Properties\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set fields - Create searchConsoleDataArray 2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set fields - Create searchConsoleDataArray\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Array aggregation - response to AI Agent\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set fields - Create searchConsoleDataArray 2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Array aggregation - response to AI Agent1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "n8n-nodes-base.set",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.stickyNote",
      "@n8n/n8n-nodes-langchain.toolWorkflow",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.executeWorkflowTrigger",
      "n8n-nodes-base.switch",
      "n8n-nodes-base.set",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.aggregate",
      "n8n-nodes-base.aggregate",
      "n8n-nodes-base.stickyNote",
      "@n8n/n8n-nodes-langchain.agent"
    ],
    "trigger": null
  }
}