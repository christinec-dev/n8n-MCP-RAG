{
  "source": "0963_Mautic_Webhook_Update_Webhook.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        -550,\n        450\n      ],\n      \"parameters\": {\n        \"path\": \"PuHq2RQsmc3HXB/hook\",\n        \"options\": {\n          \"rawBody\": false\n        },\n        \"httpMethod\": \"POST\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Mautic\",\n      \"type\": \"n8n-nodes-base.mautic\",\n      \"position\": [\n        1260,\n        180\n      ],\n      \"parameters\": {\n        \"email\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"student\\\"][\\\"email\\\"]}}\",\n        \"company\": 1,\n        \"options\": {},\n        \"lastName\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"student\\\"][\\\"lastName\\\"]}}\",\n        \"firstName\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"student\\\"][\\\"firstName\\\"]}}\",\n        \"authentication\": \"oAuth2\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"mauticOAuth2Api\": \"OAuth2 Mautic\"\n      },\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"name\": \"Find User\",\n      \"type\": \"n8n-nodes-base.mautic\",\n      \"position\": [\n        170,\n        260\n      ],\n      \"parameters\": {\n        \"limit\": 1,\n        \"options\": {\n          \"search\": \"={{$node[\\\"Set Webhook Request\\\"].json[\\\"student\\\"][\\\"email\\\"]}}\"\n        },\n        \"operation\": \"getAll\",\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"mauticOAuth2Api\": \"OAuth2 Mautic\"\n      },\n      \"notesInFlow\": false,\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"name\": \"Update User\",\n      \"type\": \"n8n-nodes-base.mautic\",\n      \"position\": [\n        1560,\n        250\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"contactId\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"userFound\\\"]}}\",\n        \"operation\": \"update\",\n        \"updateFields\": {\n          \"email\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"student\\\"][\\\"email\\\"]}}\",\n          \"lastName\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"student\\\"][\\\"lastName\\\"]}}\",\n          \"firstName\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"student\\\"][\\\"firstName\\\"]}}\"\n        },\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"mauticOAuth2Api\": \"OAuth2 Mautic\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Tag User\",\n      \"type\": \"n8n-nodes-base.mautic\",\n      \"position\": [\n        430,\n        670\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"contactId\": \"={{$node[\\\"Find User To Tag Sale\\\"].json[\\\"id\\\"]}}\",\n        \"operation\": \"update\",\n        \"updateFields\": {\n          \"tags\": \"={{$node[\\\"Set Webhook Request\\\"].json[\\\"student\\\"][\\\"course\\\"][\\\"name\\\"]}}\"\n        },\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"mauticOAuth2Api\": \"OAuth2 Mautic\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Unsubscribe User\",\n      \"type\": \"n8n-nodes-base.mautic\",\n      \"position\": [\n        2170,\n        410\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"contactId\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"userFound\\\"]}}\",\n        \"operation\": \"update\",\n        \"updateFields\": {\n          \"tags\": \"=#unsubscribe\"\n        },\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"mauticOAuth2Api\": \"OAuth2 Mautic\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Split Full Name\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        340,\n        420\n      ],\n      \"parameters\": {\n        \"functionCode\": \"const student = items[0].json.student\\nstudent.firstName = student.name ? student.name.split(' ').slice(0, -1).join(' ') : ''\\nstudent.lastName= student.name ? student.name.split(' ').slice(-1).join(' ') : ''\\nitems[0].json.student = student\\nreturn items;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"If not found return -1\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        450,\n        260\n      ],\n      \"parameters\": {\n        \"functionCode\": \"items[0].json.id = items[0].json.id || -1\\nreturn items\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"@MAIN STUDENT DATA\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        900,\n        400\n      ],\n      \"parameters\": {\n        \"join\": \"inner\",\n        \"mode\": \"mergeByIndex\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Remove unsubscribe\",\n      \"type\": \"n8n-nodes-base.mautic\",\n      \"position\": [\n        1770,\n        500\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"contactId\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"userFound\\\"]}}\",\n        \"operation\": \"update\",\n        \"updateFields\": {\n          \"tags\": \"=-#unsubscribe\"\n        },\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"mauticOAuth2Api\": \"OAuth2 Mautic\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Find User To Tag Sale\",\n      \"type\": \"n8n-nodes-base.mautic\",\n      \"position\": [\n        190,\n        670\n      ],\n      \"parameters\": {\n        \"limit\": 1,\n        \"options\": {\n          \"search\": \"={{$node[\\\"Set Webhook Request\\\"].json[\\\"student\\\"][\\\"user\\\"][\\\"email\\\"]}}\"\n        },\n        \"operation\": \"getAll\",\n        \"authentication\": \"oAuth2\"\n      },\n      \"credentials\": {\n        \"mauticOAuth2Api\": \"OAuth2 Mautic\"\n      },\n      \"notesInFlow\": false,\n      \"typeVersion\": 1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"name\": \"Set userFound\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        700,\n        260\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"userFound\",\n              \"value\": \"={{$node[\\\"If not found return -1\\\"].json[\\\"id\\\"]}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Switch Webhook Types\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        -70,\n        450\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"rules\": [\n            {\n              \"value2\": \"User.\",\n              \"operation\": \"contains\"\n            },\n            {\n              \"output\": 1,\n              \"value2\": \"Sale.\",\n              \"operation\": \"contains\"\n            }\n          ]\n        },\n        \"value1\": \"={{$node[\\\"Set Webhook Request\\\"].json[\\\"type\\\"]}}\",\n        \"dataType\": \"string\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set Webhook Request\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -310,\n        450\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"student\",\n              \"value\": \"={{$node[\\\"Webhook\\\"].json[\\\"body\\\"][\\\"object\\\"]}}\"\n            },\n            {\n              \"name\": \"type\",\n              \"value\": \"={{$node[\\\"Webhook\\\"].json[\\\"body\\\"][\\\"type\\\"]}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"IF NOT userFound\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1090,\n        400\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"userFound\\\"]}}\",\n              \"value2\": \"-1\",\n              \"operation\": \"regex\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Switch User.type\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        1380,\n        420\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"rules\": [\n            {\n              \"value2\": \"User.updated\"\n            },\n            {\n              \"output\": 1,\n              \"value2\": \"User.unsubscribe_from_marketing_emails\"\n            },\n            {\n              \"output\": 2,\n              \"value2\": \"=User.subscribe_to_marketing_emails\"\n            }\n          ]\n        },\n        \"value1\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"type\\\"]}}\",\n        \"dataType\": \"string\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"IF unsubscribe_from_marketing_emails\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1770,\n        250\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [],\n          \"boolean\": [\n            {\n              \"value1\": \"={{$node[\\\"@MAIN STUDENT DATA\\\"].json[\\\"student\\\"][\\\"unsubscribe_from_marketing_emails\\\"]}}\",\n              \"value2\": true\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Webhook Request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Find User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If not found return -1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update User\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF unsubscribe_from_marketing_emails\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set userFound\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"@MAIN STUDENT DATA\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Full Name\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"@MAIN STUDENT DATA\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"IF NOT userFound\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Mautic\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Switch User.type\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Switch User.type\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Unsubscribe User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Remove unsubscribe\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"@MAIN STUDENT DATA\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"IF NOT userFound\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Webhook Request\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Switch Webhook Types\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Switch Webhook Types\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Find User\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Split Full Name\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Find User To Tag Sale\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Find User To Tag Sale\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Tag User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If not found return -1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set userFound\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"IF unsubscribe_from_marketing_emails\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Unsubscribe User\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Remove unsubscribe\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.mautic",
      "n8n-nodes-base.mautic",
      "n8n-nodes-base.mautic",
      "n8n-nodes-base.mautic",
      "n8n-nodes-base.mautic",
      "n8n-nodes-base.function",
      "n8n-nodes-base.function",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.mautic",
      "n8n-nodes-base.mautic",
      "n8n-nodes-base.set",
      "n8n-nodes-base.switch",
      "n8n-nodes-base.set",
      "n8n-nodes-base.if",
      "n8n-nodes-base.switch",
      "n8n-nodes-base.if"
    ],
    "trigger": null
  }
}