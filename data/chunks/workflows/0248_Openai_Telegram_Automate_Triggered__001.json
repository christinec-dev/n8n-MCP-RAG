{
  "source": "0248_Openai_Telegram_Automate_Triggered.json",
  "index": 1,
  "content": "{\n  \"id\": \"177\",\n  \"meta\": {\n    \"instanceId\": \"dfdeafd1c3ed2ee08eeab8c2fa0c3f522066931ed8138ccd35dc20a1e69decd3\"\n  },\n  \"name\": \"Telegram AI-bot\",\n  \"tags\": [\n    {\n      \"id\": \"15\",\n      \"name\": \"tutorial\",\n      \"createdAt\": \"2022-10-04T20:07:25.607Z\",\n      \"updatedAt\": \"2022-10-04T20:07:25.607Z\"\n    }\n  ],\n  \"nodes\": [\n    {\n      \"id\": \"ea71a467-a646-4aca-b72e-cef1249c74e2\",\n      \"name\": \"Telegram Trigger\",\n      \"type\": \"n8n-nodes-base.telegramTrigger\",\n      \"position\": [\n        20,\n        340\n      ],\n      \"webhookId\": \"51942fbb-ca0e-4ec4-9423-5fcc7d3c4281\",\n      \"parameters\": {\n        \"updates\": [\n          \"*\"\n        ],\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"70\",\n          \"name\": \"Telegram bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"1cbe43d4-ea8b-4178-bc10-4bfad7abe143\",\n      \"name\": \"CheckCommand\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        980,\n        360\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"rules\": [\n            {\n              \"value2\": \"/\",\n              \"operation\": \"notStartsWith\"\n            },\n            {\n              \"output\": 1,\n              \"value2\": \"/start\",\n              \"operation\": \"startsWith\"\n            },\n            {\n              \"output\": 2,\n              \"value2\": \"=/image \",\n              \"operation\": \"startsWith\"\n            }\n          ]\n        },\n        \"value1\": \"={{ $json.message?.text }}\",\n        \"dataType\": \"string\",\n        \"fallbackOutput\": 3\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"074e907f-634b-4242-b669-33fa064f8472\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1600,\n        581.661764705882\n      ],\n      \"parameters\": {\n        \"width\": 316.1071428571428,\n        \"height\": 231.22373949579838,\n        \"content\": \"## Error fallback for unsupported commands\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2aa961b8-f0af-4d5c-a6af-1be56ea4b2e6\",\n      \"name\": \"Settings\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        380,\n        340\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"number\": [\n            {\n              \"name\": \"model_temperature\",\n              \"value\": 0.8\n            },\n            {\n              \"name\": \"token_length\",\n              \"value\": 500\n            }\n          ],\n          \"string\": [\n            {\n              \"name\": \"system_command\",\n              \"value\": \"=You are a friendly chatbot. User name is {{ $json?.message?.from?.first_name }}. User system language is {{ $json?.message?.from?.language_code }}. First, detect user text language. Next, provide your reply in the same language. Include several suitable emojis in your answer.\"\n            },\n            {\n              \"name\": \"bot_typing\",\n              \"value\": \"={{ $json?.message?.text.startsWith('/image') ? \\\"upload_photo\\\" : \\\"typing\\\" }}\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"2d2fe268-1e3e-483b-847c-4412e586c1ca\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1240,\n        -240\n      ],\n      \"parameters\": {\n        \"width\": 330.5019024637719,\n        \"height\": 233,\n        \"content\": \"## Chatbot mode by default\\n### (when no command is provided)\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"09a9c0b4-ac6e-46eb-b2e0-ef2b55e94ada\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1240,\n        20\n      ],\n      \"parameters\": {\n        \"width\": 330.7863484403046,\n        \"height\": 219.892857142857,\n        \"content\": \"## Welcome message\\n### /start\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"088cffee-5720-488b-a4ec-cfdccbf77e75\",\n      \"name\": \"Chat_mode\",\n      \"type\": \"n8n-nodes-base.openAi\",\n      \"position\": [\n        1340,\n        -160\n      ],\n      \"parameters\": {\n        \"model\": \"gpt-4\",\n        \"prompt\": {\n          \"messages\": [\n            {\n              \"role\": \"system\",\n              \"content\": \"={{ $json.system_command }}\"\n            },\n            {\n              \"content\": \"={{ $json.message.text }}\"\n            }\n          ]\n        },\n        \"options\": {\n          \"maxTokens\": \"={{ $json.token_length }}\",\n          \"temperature\": \"={{ $json.model_temperature }}\"\n        },\n        \"resource\": \"chat\"\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"63\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"41248697-6474-4a8f-a8b8-038c96465948\",\n      \"name\": \"Greeting\",\n      \"type\": \"n8n-nodes-base.openAi\",\n      \"position\": [\n        1340,\n        80\n      ],\n      \"parameters\": {\n        \"prompt\": {\n          \"messages\": [\n            {\n              \"role\": \"system\",\n              \"content\": \"={{ $json.system_command }}\"\n            },\n            {\n              \"content\": \"=This is the first message from a user. Please welcome a new user in `{{ $json.message.from.language_code }}` language\"\n            }\n          ]\n        },\n        \"options\": {\n          \"maxTokens\": \"={{ $json.token_length }}\",\n          \"temperature\": \"={{ $json.model_temperature }}\"\n        },\n        \"resource\": \"chat\"\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"63\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"20c2e7fa-5d65-441b-8d1d-a8d46c624964\",\n      \"name\": \"Text reply\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1700,\n        -40\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $json.message.content }}\",\n        \"chatId\": \"={{ $('Settings').first().json.message.from.id }}\",\n        \"additionalFields\": {\n          \"parse_mode\": \"Markdown\"\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"70\",\n          \"name\": \"Telegram bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"30321276-ebe1-41ac-b420-9dab8daa405b\",\n      \"name\": \"Send Typing action\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        580,\n        480\n      ],\n      \"parameters\": {\n        \"action\": \"={{ $json.bot_typing }}\",\n        \"chatId\": \"={{ $json.message.from.id }}\",\n        \"operation\": \"sendChatAction\"\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"70\",\n          \"name\": \"Telegram bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7d7ff2e8-b0ca-4638-a056-f7b4e2e6273d\",\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        800,\n        360\n      ],\n      \"parameters\": {\n        \"mode\": \"chooseBranch\"\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"656bab5e-b7f7-47a1-8e75-4a17d2070290\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1240,\n        280\n      ],\n      \"parameters\": {\n        \"width\": 329.7428571428562,\n        \"height\": 233.8785714285713,\n        \"content\": \"## Create an image\\n### /image + request\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ca2111d2-463a-4ef0-9436-ee09598dbf07\",\n      \"name\": \"Create an image\",\n      \"type\": \"n8n-nodes-base.openAi\",\n      \"position\": [\n        1340,\n        360\n      ],\n      \"parameters\": {\n        \"prompt\": \"={{ $json.message.text.split(' ').slice(1).join(' ') }}\",\n        \"options\": {\n          \"n\": 1,\n          \"size\": \"512x512\"\n        },\n        \"resource\": \"image\",\n        \"responseFormat\": \"imageUrl\"\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"63\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"e91d616b-1d5e-40e8-8468-2d0b2dda4cf7\",\n      \"name\": \"Send error message\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1700,\n        660\n      ],\n      \"parameters\": {\n        \"text\": \"=Sorry, {{ $json.message.from.first_name }}! This command is not supported yet. Please type some text to a chat bot or try this command:\\n/image \\\\[your prompt]\\n\\nEnter the command, then space and provide your request. Example:\\n\\n`/image a picture or a cute little kitten with big eyes. Miyazaki studio ghibli style`\",\n        \"chatId\": \"={{ $json.message.from.id }}\",\n        \"additionalFields\": {\n          \"parse_mode\": \"Markdown\"\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"70\",\n          \"name\": \"Telegram bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"125e27d2-b03b-4f02-9dd1-8fc81ecf0b6b\",\n      \"name\": \"Send image\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1700,\n        360\n      ],\n      \"parameters\": {\n        \"file\": \"={{ $json.url }}\",\n        \"chatId\": \"={{ $('Settings').first().json.message.from.id }}\",\n        \"operation\": \"sendPhoto\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"70\",\n          \"name\": \"Telegram bot\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"730a51ac-223e-4956-be7f-166eadb6ed81\",\n      \"name\": \"PreProcessing\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        200,\n        340\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"message.text\",\n              \"value\": \"={{ $json?.message?.text || \\\"\\\" }}\"\n            }\n          ]\n        },\n        \"options\": {\n          \"dotNotation\": true\n        }\n      },\n      \"typeVersion\": 2\n    }\n  ],\n  \"active\": true,\n  \"pinData\": {},\n  \"settings\": {\n    \"callerPolicy\": \"workflowsFromSameOwner\",\n    \"saveManualExecutions\": true,\n    \"saveDataSuccessExecution\": \"all\"\n  },\n  \"versionId\": \"6ab99e3f-845d-42cc-847b-37cf19a72e93\",\n  \"connections\": {\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"CheckCommand\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Greeting\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Text reply\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Settings\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Typing action\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Chat_mode\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Text reply\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"CheckCommand\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Chat_mode\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Greeting\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Create an image\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Send error message\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"PreProcessing\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Settings\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create an image\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send image\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Telegram Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"PreProcessing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Send Typing action\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.telegramTrigger",
      "n8n-nodes-base.switch",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.set",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.openAi",
      "n8n-nodes-base.openAi",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.merge",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.openAi",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.set"
    ],
    "trigger": "telegram trigger"
  }
}