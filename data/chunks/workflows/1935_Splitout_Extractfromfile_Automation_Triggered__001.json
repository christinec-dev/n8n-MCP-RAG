{
  "source": "1935_Splitout_Extractfromfile_Automation_Triggered.json",
  "index": 1,
  "content": "{\n  \"id\": \"nkMjcOC4hpte1a0t\",\n  \"meta\": {\n    \"instanceId\": \"3986dc65ca3ddc4ee46e71fc194b0a9d4ef46d960a5e71624f9f7eaa198213cb\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Extract spend details (template)\",\n  \"tags\": [\n    {\n      \"id\": \"9mCuuNEpnYNvVzb8\",\n      \"name\": \"Finance\",\n      \"createdAt\": \"2024-09-15T07:22:30.749Z\",\n      \"updatedAt\": \"2024-09-15T07:22:30.749Z\"\n    }\n  ],\n  \"nodes\": [\n    {\n      \"id\": \"8e1e0861-9f06-4fe2-a9c1-423bab246959\",\n      \"name\": \"Get invoice\",\n      \"type\": \"n8n-nodes-base.gmailTrigger\",\n      \"position\": [\n        600,\n        380\n      ],\n      \"parameters\": {\n        \"simple\": false,\n        \"filters\": {\n          \"labelIds\": [\n            \"Label_7885838942566773656\"\n          ]\n        },\n        \"options\": {\n          \"downloadAttachments\": true\n        },\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"fegneFqi8XJX3NJH\",\n          \"name\": \"Gmail account (hana@hanamizuki.tw)\"\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"364fe355-672a-4074-800a-a7496c4fb1b2\",\n      \"name\": \"Get payment\",\n      \"type\": \"n8n-nodes-base.gmailTrigger\",\n      \"position\": [\n        600,\n        580\n      ],\n      \"parameters\": {\n        \"simple\": false,\n        \"filters\": {\n          \"labelIds\": [\n            \"Label_371722915607774622\"\n          ]\n        },\n        \"options\": {\n          \"downloadAttachments\": true\n        },\n        \"pollTimes\": {\n          \"item\": [\n            {\n              \"mode\": \"everyMinute\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"gmailOAuth2\": {\n          \"id\": \"fegneFqi8XJX3NJH\",\n          \"name\": \"Gmail account (hana@hanamizuki.tw)\"\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"e3218faf-2486-46e0-bf43-3bc52927e2bd\",\n      \"name\": \"Extract invoice\",\n      \"type\": \"n8n-nodes-base.extractFromFile\",\n      \"notes\": \"No attachements\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        820,\n        380\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"password\": \"E223706995\"\n        },\n        \"operation\": \"pdf\",\n        \"binaryPropertyName\": \"attachment_0\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3772b3dc-7601-4005-9b61-263b2c1abd5f\",\n      \"name\": \"Extract payment\",\n      \"type\": \"n8n-nodes-base.extractFromFile\",\n      \"notes\": \"No attachements\",\n      \"onError\": \"continueRegularOutput\",\n      \"position\": [\n        820,\n        580\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"password\": \"E223706995\"\n        },\n        \"operation\": \"pdf\",\n        \"binaryPropertyName\": \"attachment_0\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"10d57038-940e-47aa-84ea-3850f61ac757\",\n      \"name\": \"HTML\",\n      \"type\": \"n8n-nodes-base.html\",\n      \"notes\": \"\\\".spend-table\\\" here is an example when the email use \\\"spend\\\" html tags to display each spends.\\ne.g.\\n<div class=spend-table>Spend 1</div>\\n<div class=spend-table>Spend 2</div>\",\n      \"position\": [\n        1440,\n        200\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"operation\": \"extractHtmlContent\",\n        \"dataPropertyName\": \"=html\",\n        \"extractionValues\": {\n          \"values\": [\n            {\n              \"key\": \"spend\",\n              \"cssSelector\": \".spend-table\",\n              \"returnArray\": true\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"dae6d22e-587d-4102-b006-20a341ede5ee\",\n      \"name\": \"Split Out\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"position\": [\n        1660,\n        200\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"fieldToSplitOut\": \"spend\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0d75443d-0d23-4120-95e5-b3128a760fb4\",\n      \"name\": \"Structured Output Parser1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        2500,\n        640\n      ],\n      \"parameters\": {\n        \"schemaType\": \"manual\",\n        \"inputSchema\": \"{\\n  \\\"title\\\": \\\"Expense Record Schema\\\",\\n  \\\"description\\\": \\\"Schema used to parse expense record emails, including date, service name, transaction details, amount, category, currency, and card.\\\",\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"date\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\": \\\"Transaction date, can refer to the email date or the consumption date within the content. If there are multiple dates, use the earliest one. The format is 'YYYY-MM-DD hh:mm', e.g., '2024-09-02 10:12'.\\\",\\n      \\\"examples\\\": [\\\"2024-09-02 10:12\\\"]\\n    },\\n    \\\"service\\\": {\\n      \\\"type\\\": [\\\"string\\\", \\\"null\\\"],\\n      \\\"description\\\": \\\"Name of the service or store, such as 'GOOGLE', 'Uber', etc.\\\",\\n      \\\"examples\\\": [\\\"GOOGLE\\\", \\\"Uber Eats\\\", \\\"Uber\\\", \\\"CLAUDE.AI\\\"]\\n    },\\n    \\\"details\\\": {\\n      \\\"type\\\": [\\\"string\\\", \\\"null\\\"],\\n      \\\"description\\\": \\\"Detailed transaction information, such as overseas card usage, online transactions, restaurant names, or consumption details. If none, can be left blank or null.\\\",\\n      \\\"examples\\\": [\\\"Uber: from Fuxing North Road to Minquan East Road\\\", \\\"Restaurant name\\\", null]\\n    },\\n    \\\"amount\\\": {\\n      \\\"type\\\": \\\"number\\\",\\n      \\\"description\\\": \\\"Transaction amount. If in USD, keep two decimal places (e.g., 50.12); if in TWD, use integers (e.g., 550).\\\",\\n      \\\"examples\\\": [50.12, 550]\\n    },\\n    \\\"category\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\": \\\"Transaction category\\\",\\n      \\\"enum\\\": [\\\"Food & Beverage\\\", \\\"Transportation\\\", \\\"Daily Necessities\\\", \\\"Housing\\\", \\\"Electronics\\\", \\\"Beauty & Hair\\\", \\\"Apparel & Accessories\\\", \\\"Medical & Healthcare\\\", \\\"Pets\\\", \\\"Education\\\", \\\"Entertainment\\\", \\\"Cloud Services\\\", \\\"Automobile\\\", \\\"Gifts\\\", \\\"Family Care\\\", \\\"Counseling\\\", \\\"Insurance\\\", \\\"Taxes\\\", \\\"Transfer Fees\\\", \\\"Music\\\", \\\"Fitness\\\", \\\"Travel\\\", \\\"Lending\\\", \\\"Donations\\\", \\\"Advertising\\\", \\\"Finance\\\"],\\n      \\\"examples\\\": [\\\"Food & Beverage\\\", \\\"Transportation\\\"]\\n    },\\n    \\\"currency\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\": \\\"Currency code used in the transaction. If the amount starts with NT$, then currency is TWD.\\\",\\n      \\\"enum\\\": [\\\"TWD\\\", \\\"USD\\\", \\\"JPY\\\", \\\"EUR\\\", \\\"SGD\\\"],\\n      \\\"examples\\\": [\\\"USD\\\", \\\"TWD\\\"]\\n    },\\n    \\\"card\\\": {\\n      \\\"type\\\": [\\\"string\\\", \\\"null\\\"],\\n      \\\"description\\\": \\\"Credit card used for the transaction.\\\",\\n      \\\"enum\\\": [\\\"HSBC 3088\\\", \\\"HSBC 3854\\\", \\\"Fubon Card\\\", \\\"Crypto.com Card\\\", \\\"Cathay Card\\\", null],\\n      \\\"examples\\\": [\\\"HSBC 3088\\\", \\\"HSBC 3854\\\"]\\n    }\\n  },\\n  \\\"required\\\": [\\\"date\\\", \\\"amount\\\", \\\"category\\\", \\\"currency\\\"]\\n}\\n\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"7ade499c-015b-4903-8129-6c135264bf75\",\n      \"name\": \"Google Gemini Chat Model1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGoogleGemini\",\n      \"position\": [\n        2320,\n        640\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"modelName\": \"models/gemini-1.5-flash\"\n      },\n      \"credentials\": {\n        \"googlePalmApi\": {\n          \"id\": \"QR3KfTwhKpbgAGWU\",\n          \"name\": \"Google Gemini(PaLM) Api account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"10fe4a38-139b-4284-9e86-dd36e472f59e\",\n      \"name\": \"Send\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        2740,\n        480\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"date\": \"={{ $json.output.date }}\",\n            \"amount\": \"={{ $json.output.amount }}\",\n            \"source\": \"n8n\",\n            \"details\": \"={{ $json.output.details }}\",\n            \"payment\": \"={{ $json.output.card }}\",\n            \"service\": \"={{ $json.output.service }}\",\n            \"category\": \"={{ $json.output.category }}\",\n            \"currency\": \"={{ $json.output.currency }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"date\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"date\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"service\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"service\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"details\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"details\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"amount\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"amount\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"category\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"category\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"currency\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"currency\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"payment\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"payment\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"source\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"source\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": []\n        },\n        \"options\": {},\n        \"operation\": \"append\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": 2071031170,\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1ccwhQeUSUkINccAucC6_clRyNF5Mw4IjIxAtcH4ftIs/edit#gid=2071031170\",\n          \"cachedResultName\": \"raw data 2\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"url\",\n          \"value\": \"https://docs.google.com/spreadsheets/d/1ccwhQeUSUkINccAucC6_clRyNF5Mw4IjIxAtcH4ftIs/edit?gid=370005862#gid=370005862\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"flAcWUeyvdjh7MiW\",\n          \"name\": \"Google Sheets account: hana@hanamizuki.tw (GCP: n8n)\"\n        }\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"87ab4932-aae5-4c5a-a175-c782bebdf781\",\n      \"name\": \"Set data 0\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1860,\n        200\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"75b16672-71cf-4157-bcb6-683099ff1620\",\n              \"name\": \"email_date\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Switch').item.json.date }}\"\n            },\n            {\n              \"id\": \"3298f680-5d17-42fd-8b41-a6ca621af37d\",\n              \"name\": \"email_subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Switch').item.json.subject }}\"\n            },\n            {\n              \"id\": \"cf7181b7-fef9-437a-8bbe-cd4a4eda85b8\",\n              \"name\": \"email_content\",\n              \"type\": \"string\",\n              \"value\": \"={{ $ifEmpty($json.spend, $ifEmpty( $json.text, $json.html)) }}\"\n            },\n            {\n              \"id\": \"1a524cb4-6975-4d45-ac0e-f1ac1f9b0417\",\n              \"name\": \"email_type\",\n              \"type\": \"number\",\n              \"value\": \"=0\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"c2829f41-1e3f-40bc-8d4b-9fd1bac41381\",\n      \"name\": \"Set data 1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1660,\n        440\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"75b16672-71cf-4157-bcb6-683099ff1620\",\n              \"name\": \"email_date\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.date }}\"\n            },\n            {\n              \"id\": \"3298f680-5d17-42fd-8b41-a6ca621af37d\",\n              \"name\": \"email_subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.subject }}\"\n            },\n            {\n              \"id\": \"cf7181b7-fef9-437a-8bbe-cd4a4eda85b8\",\n              \"name\": \"email_content\",\n              \"type\": \"string\",\n              \"value\": \"={{ $ifEmpty( $json.text, $json.html) }}\"\n            },\n            {\n              \"id\": \"1a524cb4-6975-4d45-ac0e-f1ac1f9b0417\",\n              \"name\": \"email_type\",\n              \"type\": \"number\",\n              \"value\": \"=1\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"ecf9ea3c-3f34-43ef-b101-ca4a420e4c24\",\n      \"name\": \"Set data 2\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1640,\n        740\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"75b16672-71cf-4157-bcb6-683099ff1620\",\n              \"name\": \"email_date\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.date }}\"\n            },\n            {\n              \"id\": \"3298f680-5d17-42fd-8b41-a6ca621af37d\",\n              \"name\": \"email_subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.subject }}\"\n            },\n            {\n              \"id\": \"cf7181b7-fef9-437a-8bbe-cd4a4eda85b8\",\n              \"name\": \"email_content\",\n              \"type\": \"string\",\n              \"value\": \"={{ $ifEmpty( $json.text, $json.html) }}\"\n            },\n            {\n              \"id\": \"1a524cb4-6975-4d45-ac0e-f1ac1f9b0417\",\n              \"name\": \"email_type\",\n              \"type\": \"number\",\n              \"value\": \"=2\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"0d9f8bde-af54-480c-bdc9-15cd5b0e6f28\",\n      \"name\": \"Invoice data\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1040,\n        380\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"ac7c18ba-1944-4019-aa85-03d7751a7e1c\",\n              \"name\": \"html\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get invoice').item.json.html }}\"\n            },\n            {\n              \"id\": \"5eb54501-9c55-437d-9918-e5eff92e2229\",\n              \"name\": \"subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get invoice').item.json.subject }}\"\n            },\n            {\n              \"id\": \"87eebc48-0b95-46ae-b41b-b6540b1afaa9\",\n              \"name\": \"date\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get invoice').item.json.date }}\"\n            },\n            {\n              \"id\": \"c6b75367-239e-4e88-9e17-90ee75a064e2\",\n              \"name\": \"text\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get invoice').item.json.text }} \\\\n {{ $json.text }}\"\n            },\n            {\n              \"id\": \"7d5b4b42-6b90-4ffe-ab8f-4288771d1302\",\n              \"name\": \"label\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get invoice').item.json.labelIds }}\"\n            },\n            {\n              \"id\": \"551ea1c3-01ca-4615-9d52-a880e24252ed\",\n              \"name\": \"from\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get invoice').item.json.from.text }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"c1c4c490-d7a9-4b16-a81b-a338103764b6\",\n      \"name\": \"Payment data\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1040,\n        580\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"ac7c18ba-1944-4019-aa85-03d7751a7e1c\",\n              \"name\": \"html\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get payment').item.json.html }}\"\n            },\n            {\n              \"id\": \"5eb54501-9c55-437d-9918-e5eff92e2229\",\n              \"name\": \"subject\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get payment').item.json.subject }}\"\n            },\n            {\n              \"id\": \"87eebc48-0b95-46ae-b41b-b6540b1afaa9\",\n              \"name\": \"date\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get payment').item.json.date }}\"\n            },\n            {\n              \"id\": \"c6b75367-239e-4e88-9e17-90ee75a064e2\",\n              \"name\": \"text\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get payment').item.json.text }} \\\\n {{ $json.text }}\"\n            },\n            {\n              \"id\": \"7d5b4b42-6b90-4ffe-ab8f-4288771d1302\",\n              \"name\": \"label\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get payment').item.json.labelIds }}\"\n            },\n            {\n              \"id\": \"2c976be1-48b8-42fa-b1c9-2fd315da89ae\",\n              \"name\": \"from\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Get payment').item.json.from.text }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"01c5a934-9412-4ef9-81a8-c4aef19c8868\",\n      \"name\": \"Switch\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        1300,\n        480\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"Multiple payment info in one mail\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"contains\"\n                    },\n                    \"leftValue\": \"={{ $json.from }}\",\n                    \"rightValue\": \"service@pxbillrc01.cathaybk.com.tw\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"One payment info in one mail\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"47e3b84f-903c-4594-9297-785cfbea0316\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"regex\"\n                    },\n                    \"leftValue\": \"={{ $json.from }}\",\n                    \"rightValue\": \"\\\\b(?:noreply@messaging\\\\.hsbc\\\\.com\\\\.tw|hello@crypto\\\\.com|taipeifubon\\\\.com\\\\.tw)\\\\b\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"Invoices\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 1,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"db9d40f1-8fa4-4908-9010-985072b3f319\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"notRegex\"\n                    },\n                    \"leftValue\": \"={{ $json.from }}\",\n                    \"rightValue\": \"\\\\b(?:noreply@messaging\\\\.hsbc\\\\.com\\\\.tw|hello@crypto\\\\.com|taipeifubon\\\\.com\\\\.tw)\\\\b\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 3.1,\n      \"alwaysOutputData\": false\n    },\n    {\n      \"id\": \"250bbd9a-3d22-4a04-910c-7cec437b3c33\",\n      \"name\": \"Groq Chat Model\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatGroq\",\n      \"position\": [\n        2320,\n        1120\n      ],\n      \"parameters\": {\n        \"model\": \"llama-3.2-11b-text-preview\",\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"groqApi\": {\n          \"id\": \"vaG2nZFaKeQarQHw\",\n          \"name\": \"Groq account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"b8d2b2fc-748c-43c5-a82b-d5e7357bbef8\",\n      \"name\": \"Structured Output Parser\",\n      \"type\": \"@n8n/n8n-nodes-langchain.outputParserStructured\",\n      \"position\": [\n        2520,\n        1120\n      ],\n      \"parameters\": {\n        \"schemaType\": \"manual\",\n        \"inputSchema\": \"{\\n  \\\"title\\\": \\\"Transaction Record Schema\\\",\\n  \\\"description\\\": \\\"Schema for parsing transaction record emails, including date, service name, transaction details, amount, category, currency, and card.\\\",\\n  \\\"type\\\": \\\"object\\\",\\n  \\\"properties\\\": {\\n    \\\"date\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\": \\\"Transaction date, can refer to email date or transaction date in content. If multiple dates exist, use the earliest date. Format is 'YYYY-MM-DD hh:mm', e.g., '2024-09-02 10:12'.\\\",\\n      \\\"examples\\\": [\\\"2024-09-02 10:12\\\"]\\n    },\\n    \\\"service\\\": {\\n      \\\"type\\\": [\\\"string\\\", \\\"null\\\"],\\n      \\\"description\\\": \\\"Name of service or store, e.g., 'GOOGLE', 'Uber', etc.\\\",\\n      \\\"examples\\\": [\\\"GOOGLE\\\", \\\"Uber Eats\\\", \\\"Uber\\\", \\\"CLAUDE.AI\\\"]\\n    },\\n    \\\"details\\\": {\\n      \\\"type\\\": [\\\"string\\\", \\\"null\\\"],\\n      \\\"description\\\": \\\"Detailed transaction information, such as overseas purchase, online purchase, restaurant name, or consumption details. Can be empty or null if not available.\\\",\\n      \\\"examples\\\": [\\\"Uber: From Fuxing North Road to Minquan East Road\\\", \\\"Restaurant name\\\", null]\\n    },\\n    \\\"amount\\\": {\\n      \\\"type\\\": \\\"number\\\",\\n      \\\"description\\\": \\\"Transaction amount. For USD, keep two decimal places (e.g., 50.12); for TWD, use integers (e.g., 550).\\\",\\n      \\\"examples\\\": [50.12, 550]\\n    },\\n    \\\"category\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\": \\\"Transaction category\\\",\\n      \\\"enum\\\": [\\\"Food & Beverage\\\", \\\"Transportation\\\", \\\"Daily Necessities\\\", \\\"Housing\\\", \\\"Electronics\\\", \\\"Beauty & Hair\\\", \\\"Clothing & Accessories\\\", \\\"Healthcare\\\", \\\"Pets\\\", \\\"Education\\\", \\\"Entertainment\\\", \\\"Cloud Services\\\", \\\"Automotive\\\", \\\"Gifts\\\", \\\"Family Support\\\", \\\"Counseling\\\", \\\"Insurance\\\", \\\"Taxes\\\", \\\"Transfer Fee\\\", \\\"Music\\\", \\\"Fitness\\\", \\\"Travel\\\", \\\"Lending\\\", \\\"Donations\\\", \\\"Advertising\\\", \\\"Finance\\\"],\\n      \\\"examples\\\": [\\\"Food & Beverage\\\", \\\"Transportation\\\"]\\n    },\\n    \\\"currency\\\": {\\n      \\\"type\\\": \\\"string\\\",\\n      \\\"description\\\": \\\"Currency code used for the transaction, if amount starts with NT$, currency is TWD.\\\",\\n      \\\"enum\\\": [\\\"TWD\\\", \\\"USD\\\", \\\"JPY\\\", \\\"EUR\\\", \\\"SGD\\\"],\\n      \\\"examples\\\": [\\\"USD\\\", \\\"TWD\\\"]\\n    }\\n  },\\n  \\\"required\\\": [\\\"date\\\", \\\"amount\\\", \\\"category\\\", \\\"currency\\\"]\\n}\"\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"39b10715-54fe-4c07-9ca1-afbe43ae519e\",\n      \"name\": \"Send1\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        2740,\n        900\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"date\": \"={{ $json.output.date }}\",\n            \"amount\": \"={{ $json.output.amount }}\",\n            \"source\": \"n8n\",\n            \"details\": \"={{ $json.output.details }}\",\n            \"payment\": \"=\",\n            \"service\": \"={{ $json.output.service }}\",\n            \"category\": \"={{ $json.output.category }}\",\n            \"currency\": \"={{ $json.output.currency }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"date\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"date\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"service\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"service\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"details\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"details\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"amount\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"amount\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"category\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"category\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"currency\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"currency\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"payment\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"payment\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"source\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"source\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": []\n        },\n        \"options\": {},\n        \"operation\": \"append\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": 2071031170,\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1ccwhQeUSUkINccAucC6_clRyNF5Mw4IjIxAtcH4ftIs/edit#gid=2071031170\",\n          \"cachedResultName\": \"raw data 2\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"url\",\n          \"value\": \"https://docs.google.com/spreadsheets/d/1ccwhQeUSUkINccAucC6_clRyNF5Mw4IjIxAtcH4ftIs/edit?gid=370005862#gid=370005862\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"flAcWUeyvdjh7MiW\",\n          \"name\": \"Google Sheets account: hana@hanamizuki.tw (GCP: n8n)\"\n        }\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"112f5198-871e-42f9-9376-5fa074497413\",\n      \"name\": \"Extract details1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        2320,\n        900\n      ],\n      \"parameters\": {\n        \"text\": \"=Email Date: {{ $json.email_date }}\\nEmail Subject: {{ $json.email_subject }}\\nEmail Content:\\n{{ $json.email_content }}\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"message\": \"=Please analyze the following email to extract transaction details for bookkeeping purposes.\\n\\nPlease extract relevant transaction details such as transaction date, amount, merchant name, and any other pertinent information, and provide them in a structured format suitable for accounting records.\"\n            }\n          ]\n        },\n        \"promptType\": \"define\",\n        \"hasOutputParser\": true\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 1.4\n    },\n    {\n      \"id\": \"b9c3cb29-e68e-4ae0-8930-185c17bc6cab\",\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"position\": [\n        2060,\n        440\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"b50d632c-b762-4f61-b34a-91f941100668\",\n      \"name\": \"Extract details\",\n      \"type\": \"@n8n/n8n-nodes-langchain.chainLlm\",\n      \"position\": [\n        2320,\n        480\n      ],\n      \"parameters\": {\n        \"text\": \"=Email Date: {{ $json.email_date }}\\nEmail Subject: {{ $json.email_subject }}\\nEmail Content:\\n{{ $json.email_content }}\\nEmail Source: {{ $json.email_type }}\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"message\": \"=Please analyze the following email to extract transaction details for bookkeeping purposes. The \\\"Email Source\\\" field indicates the origin of the email, where 0 represents Cathay Bank card statements and 1 represents other credit card statements.\\n\\nPlease extract relevant transaction details such as transaction date, amount, merchant name, and any other pertinent information, and provide them in a structured format suitable for accounting records.\"\n            }\n          ]\n        },\n        \"promptType\": \"define\",\n        \"hasOutputParser\": true\n      },\n      \"retryOnFail\": true,\n      \"typeVersion\": 1.4\n    },\n    {\n      \"id\": \"7a7e2e36-a8b6-48dc-ad57-2f5eea691285\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        500,\n        220\n      ],\n      \"parameters\": {\n        \"width\": 720,\n        \"height\": 560,\n        \"content\": \"# A. Get data\\n- Set up labels in Gmail\\n- Suggested using Gmail filters to move emails to labels automatically\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"108becad-1a7b-4409-9cb3-36a1c7b64786\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1280,\n        -20\n      ],\n      \"parameters\": {\n        \"width\": 920,\n        \"height\": 960,\n        \"content\": \"# B. Deal with the data\\n1. Multiple payment info in one mail: input the \\\"sender\\\" of the emails that contain more than one payment info. e.g. credit card daily spend notification\\n2. One payment info in one mail: input the \\\"sender\\\" of the emails that contain only one payment info. e.g. instant credit card spend notification\\n3. Invoices: input the mails that contain one invoice in one mail\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"7123f576-87f9-4df1-ae24-f3e5289c7234\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2240,\n        320\n      ],\n      \"parameters\": {\n        \"width\": 840,\n        \"height\": 980,\n        \"content\": \"# C. Get spend details and send to google sheet\\n- Edit the output schema to fit your google sheet format\\n- Edit the prompt to fit your needs\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"callerPolicy\": \"workflowsFromSameOwner\",\n    \"executionOrder\": \"v1\",\n    \"saveManualExecutions\": true,\n    \"saveExecutionProgress\": true\n  },\n  \"versionId\": \"211d9ccc-7a66-41c8-bda1-eacde400eeff\",\n  \"connections\": {\n    \"HTML\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Out\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract details\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Switch\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HTML\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Set data 1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Set data 2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Out\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set data 0\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set data 0\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set data 1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Set data 2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract details1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get invoice\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract invoice\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get payment\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extract payment\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Invoice data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Switch\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Payment data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Switch\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract details\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract invoice\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Invoice data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract payment\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Payment data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Groq Chat Model\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Extract details1\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extract details1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Structured Output Parser\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Extract details1\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Google Gemini Chat Model1\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Extract details\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Structured Output Parser1\": {\n      \"ai_outputParser\": [\n        [\n          {\n            \"node\": \"Extract details\",\n            \"type\": \"ai_outputParser\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.gmailTrigger",
      "n8n-nodes-base.gmailTrigger",
      "n8n-nodes-base.extractFromFile",
      "n8n-nodes-base.extractFromFile",
      "n8n-nodes-base.html",
      "n8n-nodes-base.splitOut",
      "@n8n/n8n-nodes-langchain.outputParserStructured",
      "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.switch",
      "@n8n/n8n-nodes-langchain.lmChatGroq",
      "@n8n/n8n-nodes-langchain.outputParserStructured",
      "n8n-nodes-base.googleSheets",
      "@n8n/n8n-nodes-langchain.chainLlm",
      "n8n-nodes-base.merge",
      "@n8n/n8n-nodes-langchain.chainLlm",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}