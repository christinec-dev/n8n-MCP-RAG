{
  "source": "0119_Manual_Cron_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"12\",\n  \"name\": \"Find a New Book\",\n  \"nodes\": [\n    {\n      \"name\": \"On clicking 'execute'\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        40,\n        140\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Every Friday at 11:00 AM\",\n      \"type\": \"n8n-nodes-base.cron\",\n      \"position\": [\n        20,\n        330\n      ],\n      \"parameters\": {\n        \"triggerTimes\": {\n          \"item\": [\n            {\n              \"hour\": 11,\n              \"mode\": \"everyWeek\",\n              \"weekday\": \"5\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set Subject\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        220,\n        330\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"subject\",\n              \"value\": \"juvenile_literature\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Retrieve Book Count\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        420,\n        330\n      ],\n      \"parameters\": {\n        \"url\": \"=http://openlibrary.org/subjects/{{$json[\\\"subject\\\"]}}.json\",\n        \"options\": {},\n        \"queryParametersUi\": {\n          \"parameter\": [\n            {\n              \"name\": \"limit\",\n              \"value\": \"0\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Check Book Count\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        620,\n        330\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"number\": [\n            {\n              \"value1\": \"={{$node[\\\"Retrieve Book Count\\\"].json[\\\"work_count\\\"]}}\",\n              \"operation\": \"larger\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Select Random Book\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        820,\n        330\n      ],\n      \"parameters\": {\n        \"functionCode\": \"var retrieve_book = 0;\\nvar book_count = items[0].json.work_count;\\n\\nretrieve_book = Math.floor(Math.random() * book_count) + 1\\n\\nitems[0].json.retrieve_book = retrieve_book;\\nreturn items;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Retrieve Detailed Book Info\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1260,\n        330\n      ],\n      \"parameters\": {\n        \"url\": \"=http://openlibrary.org.{{$node[\\\"Retrieve Basic Book Info\\\"].json[\\\"works\\\"][0][\\\"key\\\"]}}.json\",\n        \"options\": {},\n        \"queryParametersUi\": {\n          \"parameter\": [\n            {\n              \"name\": \"limit\",\n              \"value\": \"1\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Retrieve Basic Book Info\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1040,\n        330\n      ],\n      \"parameters\": {\n        \"url\": \"=http://openlibrary.org/subjects/{{$json[\\\"name\\\"]}}.json\",\n        \"options\": {},\n        \"queryParametersUi\": {\n          \"parameter\": [\n            {\n              \"name\": \"limit\",\n              \"value\": \"1\"\n            },\n            {\n              \"name\": \"offset\",\n              \"value\": \"={{$json[\\\"retrieve_book\\\"]}}\"\n            },\n            {\n              \"name\": \"detail\",\n              \"value\": \"true\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Book Recommendation\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1830,\n        330\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"msgSubject\",\n              \"value\": \"=Book Recommendation: {{$node[\\\"Create Author String\\\"].json[\\\"title\\\"]}}\"\n            },\n            {\n              \"name\": \"msgBody\",\n              \"value\": \"=<H2><a href=\\\"{{$node[\\\"Create Author String\\\"].json[\\\"URL\\\"]}}\\\">{{$node[\\\"Create Author String\\\"].json[\\\"title\\\"]}}</a></H2>\\n<p><em>By {{$node[\\\"Create Author String\\\"].json[\\\"authors\\\"]}}</em><br>\\n{{$node[\\\"Create Author String\\\"].json[\\\"description\\\"]}}</p>\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Filtered Book Info\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1460,\n        330\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"authors\",\n              \"value\": \"={{$node[\\\"Retrieve Basic Book Info\\\"].json[\\\"works\\\"][0][\\\"authors\\\"]}}\"\n            },\n            {\n              \"name\": \"title\",\n              \"value\": \"={{$node[\\\"Retrieve Basic Book Info\\\"].json[\\\"works\\\"][0][\\\"title\\\"]}}\"\n            },\n            {\n              \"name\": \"description\",\n              \"value\": \"={{$node[\\\"Retrieve Detailed Book Info\\\"].json[\\\"description\\\"][\\\"value\\\"]}}\"\n            },\n            {\n              \"name\": \"URL\",\n              \"value\": \"=https://openlibrary.org{{$node[\\\"Retrieve Basic Book Info\\\"].json[\\\"works\\\"][0][\\\"key\\\"]}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Create Author String\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        1630,\n        330\n      ],\n      \"parameters\": {\n        \"functionCode\": \"var arrAuthors = items[0].json.authors;\\n\\nvar arrNames = arrAuthors.map(function(author) {\\n  return \\\"<a href=\\\\\\\"https://openlibrary.org\\\" + author['key'] + \\\"\\\\\\\">\\\" + author['name'] + \\\"</a>\\\";\\n});\\n\\nvar names = arrNames.join(\\\", \\\");\\n\\nitems[0].json.authors = names;\\n\\nreturn items;\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Send No Book Email\",\n      \"type\": \"n8n-nodes-base.emailSend\",\n      \"position\": [\n        830,\n        520\n      ],\n      \"parameters\": {\n        \"html\": \"=<p>Unfortunately, there are no books available for the subject of <em>{{$node[\\\"Check Book Count\\\"].json[\\\"name\\\"]}}</em>. Please update your n8n workflow with a different subject.</p>\\n\\n<p>A list of all available subjects can be found at <a href=\\\"https://openlibrary.org/subjects\\\">the Open Library</a>.</p>\",\n        \"options\": {},\n        \"subject\": \"=Book not found in {{$node[\\\"Check Book Count\\\"].json[\\\"name\\\"]}}\",\n        \"toEmail\": \"john.doe@example.com\",\n        \"fromEmail\": \"john.doe@example.com\"\n      },\n      \"credentials\": {\n        \"smtp\": \"Gmail Creds\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Send Book Email\",\n      \"type\": \"n8n-nodes-base.emailSend\",\n      \"position\": [\n        2030,\n        330\n      ],\n      \"parameters\": {\n        \"html\": \"={{$node[\\\"Book Recommendation\\\"].json[\\\"msgBody\\\"]}}\",\n        \"options\": {},\n        \"subject\": \"={{$node[\\\"Book Recommendation\\\"].json[\\\"msgSubject\\\"]}}\",\n        \"toEmail\": \"john.doe@example.com\",\n        \"fromEmail\": \"john.doe@example.com\"\n      },\n      \"credentials\": {\n        \"smtp\": \"Gmail Creds\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"settings\": {},\n  \"connections\": {\n    \"Set Subject\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve Book Count\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Check Book Count\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Select Random Book\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Send No Book Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Filtered Book Info\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Author String\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Select Random Book\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve Basic Book Info\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Book Recommendation\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Book Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve Book Count\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Check Book Count\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Author String\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Book Recommendation\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"On clicking 'execute'\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Subject\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Every Friday at 11:00 AM\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Subject\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve Basic Book Info\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Retrieve Detailed Book Info\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Retrieve Detailed Book Info\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Filtered Book Info\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.cron",
      "n8n-nodes-base.set",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.if",
      "n8n-nodes-base.function",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.set",
      "n8n-nodes-base.set",
      "n8n-nodes-base.function",
      "n8n-nodes-base.emailSend",
      "n8n-nodes-base.emailSend"
    ],
    "trigger": null
  }
}