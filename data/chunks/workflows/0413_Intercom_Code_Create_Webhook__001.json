{
  "source": "0413_Intercom_Code_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"cb484ba7b742928a2048bf8829668bed5b5ad9787579adea888f05980292a4a7\"\n  },\n  \"nodes\": [\n    {\n      \"id\": \"1f578b25-ab5b-40f3-9ccc-7f5975959073\",\n      \"name\": \"Could not find user\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        1620,\n        560\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"236436e0-1fc9-4411-b34c-946246ecbe19\",\n      \"name\": \"On Webhook event from Intercom\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        700,\n        500\n      ],\n      \"webhookId\": \"11e21ebc-27ef-49b5-8c77-648faf3e86e0\",\n      \"parameters\": {\n        \"path\": \"11e21ebc-27ef-49b5-8c77-648faf3e86e0\",\n        \"options\": {},\n        \"httpMethod\": \"POST\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"10e2e89c-6ea2-4888-99c8-2f5d99cb1a1d\",\n      \"name\": \"set key fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1120,\n        340\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"3631124b-89e3-49b5-a792-36264eb502f0\",\n              \"name\": \"user_id\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.body.data.item.id }}\"\n            },\n            {\n              \"id\": \"3c2a877d-186b-4a26-86f2-d686e5630e42\",\n              \"name\": \"email\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.body.data.item.email }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.3\n    },\n    {\n      \"id\": \"078945ff-7c7a-4b45-9f8b-773827b9eb30\",\n      \"name\": \"Update data in Intercom\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1900,\n        140\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.intercom.io/contacts/{{ $('set key fields').item.json.user_id }}\",\n        \"method\": \"PUT\",\n        \"options\": {},\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"email\",\n              \"value\": \"={{ $json.result.current_work_email }} {{ $json.result.full_name }}\"\n            },\n            {\n              \"name\": \"name\",\n              \"value\": \"={{ $json.result.full_name }}\"\n            },\n            {\n              \"name\": \"phone\",\n              \"value\": \"={{ $json.result.phone_numbers?.[0]?.E164 }}\"\n            },\n            {\n              \"name\": \"avatar\",\n              \"value\": \"={{ $json.result.employment?.profile_pic_url }}\"\n            },\n            {\n              \"name\": \"social_profiles\",\n              \"value\": \"={{ $json.social_profiles }}\"\n            },\n            {\n              \"name\": \"location\",\n              \"value\": \"={{ $json.location }}\"\n            }\n          ]\n        },\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Intercom-Version\",\n              \"value\": \"2.10\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"YYOMyAkbDgnGfggq\",\n          \"name\": \"intercom api key\"\n        }\n      },\n      \"typeVersion\": 4.1\n    },\n    {\n      \"id\": \"4ca65df4-7244-485f-8c6c-bb1ae4cd84a8\",\n      \"name\": \"Other event\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"position\": [\n        1120,\n        680\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"87b12749-b81e-460b-97bb-b25b59f303df\",\n      \"name\": \"Intercom\",\n      \"type\": \"n8n-nodes-base.intercom\",\n      \"disabled\": true,\n      \"position\": [\n        1900,\n        -60\n      ],\n      \"parameters\": {\n        \"operation\": \"update\",\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"intercomApi\": {\n          \"id\": \"sIILbFMUzkVWaBE6\",\n          \"name\": \"Intercom account\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ddb1dbb6-3f20-480f-9f49-641d40d9953a\",\n      \"name\": \"massage data\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        1660,\n        140\n      ],\n      \"parameters\": {\n        \"mode\": \"runOnceForEachItem\",\n        \"jsCode\": \"// Add social profiles\\n$input.item.json.social_profiles = $input.item.json.result.social_profiles.map((profile) => {\\n  return {\\n    type: 'social_profile',\\n    name : profile.network,\\n    url: profile.url,\\n  }\\n});\\n\\n$input.item.json.location = {\\n  country: $input.item.json.result.location?.country,\\n  city: $input.item.json.result.location?.city,\\n  region: $input.item.json.result.location?.region,\\n}\\n\\nreturn $input.item;\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"c490bb0d-ec6a-4a9a-9915-dd65ab669873\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        660,\n        240\n      ],\n      \"parameters\": {\n        \"width\": 377.10487444608555,\n        \"height\": 609.3353028064989,\n        \"content\": \"## On User created event in Intercom\\n\\n1. Setup webhook url in intercom\\n2. Make sure `contact.user.created` is enabled\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"3e866480-4ec8-4a27-b946-43d6358edfec\",\n      \"name\": \"On user created\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        880,\n        500\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"user created\",\n              \"conditions\": {\n                \"options\": {\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.body.topic }}\",\n                    \"rightValue\": \"contact.user.created\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {\n          \"fallbackOutput\": \"extra\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"e9efb8f5-8f97-476f-9d60-09a24b4f656a\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1260,\n        20\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 275.71639586410623,\n        \"height\": 609.3353028064989,\n        \"content\": \"## Enrich data from ExactBuyer\\n\\n1. Add api key from Exact buyer\\n2. Use email as identifier to match user\\n\\nUse API Guide here https://docs.exactbuyer.com/contact-enrichment/enrichment\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4a86d237-0908-4a79-9ebf-42711f850b3e\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1600,\n        -280\n      ],\n      \"parameters\": {\n        \"width\": 562.599704579025,\n        \"height\": 763.7223042836036,\n        \"content\": \"## Update user in Intercom\\n\\n1. Set Http node and generic header API Key using this guide https://developers.intercom.com/docs/build-an-integration/learn-more/authentication/\\n2. Update data in intercom using this guide\\nhttps://developers.intercom.com/docs/references/rest-api/api.intercom.io/Contacts/UpdateContact/\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"44eb44fc-9376-4c64-9561-3d9b585eb51f\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        540,\n        -320\n      ],\n      \"parameters\": {\n        \"color\": 4,\n        \"width\": 623.6113141433334,\n        \"height\": 390.44782241577565,\n        \"content\": \"# Enrich new Intercom users with contact details from ExactBuyer\\n\\n## This workflow aims to enrich new contacts in Intercom. The more relevant the Intercom profile, the more useful it is. Once active, this n8n workflow will update the social profiles, contact data (phone, email) as well as location data from ExactBuyer.\\n\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"fc9755ae-07ed-4151-bab0-4dc9b6c2408f\",\n      \"name\": \"Enrich user from ExactBuyer\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"onError\": \"continueErrorOutput\",\n      \"position\": [\n        1340,\n        340\n      ],\n      \"parameters\": {\n        \"url\": \"https://api.exactbuyer.com/v1/enrich\",\n        \"options\": {\n          \"redirect\": {\n            \"redirect\": {}\n          }\n        },\n        \"sendQuery\": true,\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"httpHeaderAuth\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"email\",\n              \"value\": \"={{ $json.email }}\"\n            },\n            {\n              \"name\": \"required\",\n              \"value\": \"work_email,personal_email,email\"\n            }\n          ]\n        }\n      },\n      \"credentials\": {\n        \"httpHeaderAuth\": {\n          \"id\": \"kyMNOdXZX3ugPihF\",\n          \"name\": \"ExactBuyer Api key\"\n        }\n      },\n      \"typeVersion\": 4.1\n    }\n  ],\n  \"pinData\": {\n    \"On Webhook event from Intercom\": [\n      {\n        \"body\": {\n          \"id\": \"notif_6da6874a-0fc5-4d6e-9c50-a9656b741203\",\n          \"data\": {\n            \"item\": {\n              \"id\": \"65d5de6eb71d82abcb782f68\",\n              \"os\": null,\n              \"name\": \"Eadan exact butyer\",\n              \"role\": \"user\",\n              \"tags\": {\n                \"url\": \"/contacts/65d5de6eb71d82abcb782f68/tags\",\n                \"data\": [],\n                \"type\": \"list\",\n                \"has_more\": false,\n                \"total_count\": 0\n              },\n              \"type\": \"contact\",\n              \"email\": \"edan@exactbuyer.com\",\n              \"notes\": {\n                \"url\": \"/contacts/65d5de6eb71d82abcb782f68/notes\",\n                \"data\": [],\n                \"type\": \"list\",\n                \"has_more\": false,\n                \"total_count\": 0\n              },\n              \"phone\": null,\n              \"avatar\": null,\n              \"browser\": null,\n              \"location\": {\n                \"city\": null,\n                \"type\": \"location\",\n                \"region\": null,\n                \"country\": null,\n                \"country_code\": null,\n                \"continent_code\": null\n              },\n              \"owner_id\": null,\n              \"referrer\": null,\n              \"utm_term\": null,\n              \"companies\": {\n                \"url\": \"/contacts/65d5de6eb71d82abcb782f68/companies\",\n                \"data\": [],\n                \"type\": \"list\",\n                \"has_more\": false,\n                \"total_count\": 0\n              },\n              \"created_at\": \"2024-02-21T11:28:46.093+00:00\",\n              \"ios_device\": null,\n              \"updated_at\": \"2024-02-21T11:28:46.090+00:00\",\n              \"utm_medium\": null,\n              \"utm_source\": null,\n              \"external_id\": \"eden_exact_buyer\",\n              \"sms_consent\": false,\n              \"utm_content\": null,\n              \"ios_app_name\": null,\n              \"last_seen_at\": null,\n              \"signed_up_at\": null,\n              \"utm_campaign\": null,\n              \"workspace_id\": \"ub6mafvn\",\n              \"android_device\": null,\n              \"ios_os_version\": null,\n              \"browser_version\": null,\n              \"ios_app_version\": null,\n              \"ios_sdk_version\": null,\n              \"last_replied_at\": null,\n              \"social_profiles\": {\n                \"data\": [],\n                \"type\": \"list\"\n              },\n              \"android_app_name\": null,\n              \"browser_language\": null,\n              \"has_hard_bounced\": false,\n              \"ios_last_seen_at\": null,\n              \"custom_attributes\": {},\n              \"language_override\": null,\n              \"last_contacted_at\": null,\n              \"android_os_version\": null,\n              \"android_app_version\": null,\n              \"android_sdk_version\": null,\n              \"android_last_seen_at\": null,\n              \"last_email_opened_at\": null,\n              \"marked_email_as_spam\": false,\n              \"last_email_clicked_at\": null,\n              \"unsubscribed_from_sms\": false,\n              \"unsubscribed_from_emails\": false,\n              \"opted_in_subscription_types\": {\n                \"url\": \"/contacts/65d5de6eb71d82abcb782f68/subscriptions\",\n                \"data\": [],\n                \"type\": \"list\",\n                \"has_more\": false,\n                \"total_count\": 0\n              },\n              \"opted_out_subscription_types\": {\n                \"url\": \"/contacts/65d5de6eb71d82abcb782f68/subscriptions\",\n                \"data\": [],\n                \"type\": \"list\",\n                \"has_more\": false,\n                \"total_count\": 0\n              }\n            },\n            \"type\": \"notification_event_data\"\n          },\n          \"self\": null,\n          \"type\": \"notification_event\",\n          \"links\": {},\n          \"topic\": \"contact.user.created\",\n          \"app_id\": \"ub6mafvn\",\n          \"created_at\": 1708514926,\n          \"delivered_at\": 0,\n          \"first_sent_at\": 1708514926,\n          \"delivery_status\": \"pending\",\n          \"delivery_attempts\": 1\n        },\n        \"query\": {},\n        \"params\": {},\n        \"headers\": {\n          \"host\": \"test.users.n8n.cloud\"\n        }\n      }\n    ]\n  },\n  \"connections\": {\n    \"massage data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update data in Intercom\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"set key fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Enrich user from ExactBuyer\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"On user created\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"set key fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Other event\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Enrich user from ExactBuyer\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"massage data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Could not find user\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"On Webhook event from Intercom\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"On user created\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.noOp",
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.set",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.noOp",
      "n8n-nodes-base.intercom",
      "n8n-nodes-base.code",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.switch",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.httpRequest"
    ],
    "trigger": null
  }
}