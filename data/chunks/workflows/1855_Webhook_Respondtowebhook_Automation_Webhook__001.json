{
  "source": "1855_Webhook_Respondtowebhook_Automation_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"fW6PV9IaePKSMGbN\",\n  \"meta\": {\n    \"instanceId\": \"a4bfc93e975ca233ac45ed7c9227d84cf5a2329310525917adaf3312e10d5462\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Unique QRcode coupon assignment and validation for Lead Generation system\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"5ef4dd1d-39d6-487e-a48d-420b458ac1ee\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        -420,\n        340\n      ],\n      \"webhookId\": \"bb832325-8c58-4717-b866-41f8a9714cf2\",\n      \"parameters\": {\n        \"path\": \"bb832325-8c58-4717-b866-41f8a9714cf2\",\n        \"options\": {},\n        \"responseMode\": \"responseNode\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"a7102d60-d4bd-450d-92b3-a32e2304b4a9\",\n      \"name\": \"If\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        40,\n        340\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"430aee2d-a788-4d7c-ab64-880c900f0058\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"exists\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.qr }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"f9dfd28e-42b5-488a-acde-dbbff95cf72f\",\n      \"name\": \"Token SuiteCRM\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        700,\n        -320\n      ],\n      \"parameters\": {\n        \"url\": \"=https://SUITECRMURL/Api/access_token\",\n        \"options\": {},\n        \"requestMethod\": \"POST\",\n        \"bodyParametersUi\": {\n          \"parameter\": [\n            {\n              \"name\": \"grant_type\",\n              \"value\": \"client_credentials\"\n            },\n            {\n              \"name\": \"client_id\",\n              \"value\": \"CLIENTID\"\n            },\n            {\n              \"name\": \"client_secret\",\n              \"value\": \"CLIENTSECRET\"\n            }\n          ]\n        },\n        \"allowUnauthorizedCerts\": true\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"0e5c7208-a90a-4612-a5eb-f962546320dc\",\n      \"name\": \"Create Lead SuiteCRM\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        940,\n        -320\n      ],\n      \"parameters\": {\n        \"url\": \"https://SUITECRMURL/Api/V8/module\",\n        \"method\": \"POST\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"responseFormat\": \"json\"\n            }\n          }\n        },\n        \"jsonBody\": \"={\\\"data\\\": \\n  {\\n  \\\"type\\\": \\\"Leads\\\",\\n  \\\"attributes\\\": { \\n  \\\"first_name\\\": \\\"{{ $('Form Fields').item.json.Name }}\\\",\\n  \\\"last_name\\\": \\\"{{ $('Form Fields').item.json.Surname }}\\\",\\n  \\\"email1\\\": \\\"{{ $('Form Fields').item.json.Email }}\\\",\\n  \\\"phone_mobile\\\":\\\"{{ $('Form Fields').item.json.Phone }}\\\",\\n  \\\"coupon_c\\\": \\\"{{ $('Get Coupon').item.json.COUPON }}\\\"\\n  }\\n  }\\n}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Authorization\",\n              \"value\": \"=Bearer {{$node[\\\"Token SuiteCRM\\\"].json[\\\"access_token\\\"]}}\"\n            },\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/vnd.api+json\"\n            }\n          ]\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"e9191ab8-4fb8-40bb-b676-89ac4e58b2dc\",\n      \"name\": \"On form submission\",\n      \"type\": \"n8n-nodes-base.formTrigger\",\n      \"position\": [\n        -420,\n        -420\n      ],\n      \"webhookId\": \"63d1d84b-c41e-4d3d-961a-0aa2af830ceb\",\n      \"parameters\": {\n        \"options\": {},\n        \"formTitle\": \"Landing\",\n        \"formFields\": {\n          \"values\": [\n            {\n              \"fieldLabel\": \"Name\",\n              \"placeholder\": \"Name\",\n              \"requiredField\": true\n            },\n            {\n              \"fieldLabel\": \"Surname\",\n              \"placeholder\": \"Surname\",\n              \"requiredField\": true\n            },\n            {\n              \"fieldType\": \"email\",\n              \"fieldLabel\": \"Email\",\n              \"placeholder\": \"Email\",\n              \"requiredField\": true\n            },\n            {\n              \"fieldLabel\": \"Phone\",\n              \"placeholder\": \"Phone\",\n              \"requiredField\": true\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"4f61d7df-aeb3-4e8d-b30b-8396944e93a3\",\n      \"name\": \"Duplicate Lead?\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        20,\n        -420\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"filtersUI\": {\n          \"values\": [\n            {\n              \"lookupValue\": \"={{ $json.Email }}\",\n              \"lookupColumn\": \"EMAIL\"\n            }\n          ]\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0\",\n          \"cachedResultName\": \"Foglio1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Coupon\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"JYR6a64Qecd6t8Hb\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"393372b3-3aaf-4500-a795-0c0f47ea9625\",\n      \"name\": \"Form Fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -180,\n        -420\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"661d1475-f964-4a12-bfe7-88bf96851319\",\n              \"name\": \"Name\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.Name }}\"\n            },\n            {\n              \"id\": \"9991645d-c716-47db-80d6-850f3d64c782\",\n              \"name\": \"Surname\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.Surname }}\"\n            },\n            {\n              \"id\": \"c999afa6-2ec7-4f7f-bf3b-088a3597591c\",\n              \"name\": \"Email\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.Email }}\"\n            },\n            {\n              \"id\": \"f3faccdb-2412-4363-a0e3-f13b8f85b242\",\n              \"name\": \"Phone\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.Phone }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"40d47841-6fb6-4339-b101-a8e917791229\",\n      \"name\": \"Get Coupon\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        480,\n        -320\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"returnFirstMatch\": true\n        },\n        \"filtersUI\": {\n          \"values\": [\n            {\n              \"lookupColumn\": \"ID LEAD\"\n            }\n          ]\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0\",\n          \"cachedResultName\": \"Foglio1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Coupon\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"JYR6a64Qecd6t8Hb\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"executeOnce\": false,\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"16358f58-eb7c-4fe5-a0aa-960943a7bebd\",\n      \"name\": \"Update Sheet\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        1180,\n        -320\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"DATE\": \"={{ $now.format('dd/LL/yyyy HH:mm:ss') }}\",\n            \"NAME\": \"={{ $json.data.attributes.first_name }}\",\n            \"EMAIL\": \"={{ $json.data.attributes.email1 }}\",\n            \"PHONE\": \"={{ $json.data.attributes.phone_mobile }}\",\n            \"COUPON\": \"={{ $('Get Coupon').item.json.COUPON }}\",\n            \"ID LEAD\": \"={{ $json.data.id }}\",\n            \"SURNAME\": \"={{ $json.data.attributes.last_name }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"NAME\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"NAME\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"SURNAME\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"SURNAME\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"EMAIL\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"EMAIL\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"PHONE\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"PHONE\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"COUPON\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"COUPON\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"DATE\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"DATE\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"ID LEAD\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"ID LEAD\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"row_number\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": true,\n              \"required\": false,\n              \"displayName\": \"row_number\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"COUPON\"\n          ],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {},\n        \"operation\": \"update\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0\",\n          \"cachedResultName\": \"Foglio1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Coupon\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"JYR6a64Qecd6t8Hb\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"36025b8c-41cb-4827-bf0e-ec6f692c13df\",\n      \"name\": \"Is Duplicate?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        220,\n        -420\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"9e3a8422-14f1-453e-bfed-4feecff34662\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.EMAIL }}\",\n              \"rightValue\": \"={{ $('Form Fields').item.json.email }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"e2267b93-9396-4ebf-8307-f8c98c1c3d65\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -200,\n        -500\n      ],\n      \"parameters\": {\n        \"width\": 340,\n        \"height\": 240,\n        \"content\": \"Check if the lead has already received the coupon\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"a8af825a-4e26-4660-8a9e-f7ce3ba33b3a\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        440,\n        -380\n      ],\n      \"parameters\": {\n        \"width\": 180,\n        \"height\": 220,\n        \"content\": \"Find the first available unassigned coupon\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"dd868852-5b0f-4b5b-922f-f70b8a6da01e\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        680,\n        -380\n      ],\n      \"parameters\": {\n        \"width\": 400,\n        \"height\": 220,\n        \"content\": \"Enter the lead with the relative coupon on Suite CRM. Change SUITECRMURL, CLIENTSECRET and CLIENTID\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"d2c26f3a-496e-47d6-b3f6-1aea5d0293fa\",\n      \"name\": \"Get QR\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1400,\n        -320\n      ],\n      \"parameters\": {\n        \"url\": \"=https://quickchart.io/qr?text=https://n8n.n3witalia.com/webhook-test/bb832325-8c58-4717-b866-41f8a9714cf2?qr={{ $('Get Coupon').item.json.COUPON }}&size=250\",\n        \"options\": {}\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"371fa5e5-6f91-4236-83d4-81f579d7d2ab\",\n      \"name\": \"Send Email\",\n      \"type\": \"n8n-nodes-base.emailSend\",\n      \"position\": [\n        1620,\n        -320\n      ],\n      \"webhookId\": \"a84b051c-7d5f-4c17-bac6-68a9df9fa7c7\",\n      \"parameters\": {\n        \"html\": \"=<!DOCTYPE html>\\n<html>\\n<head>\\n    <meta charset=\\\"UTF-8\\\">\\n    <title>Exclusive Discount Coupon</title>\\n</head>\\n<body style=\\\"font-family: Arial, sans-serif; text-align: center;\\\">\\n    <h2>Get Your Exclusive Discount!</h2>\\n    <p>Hi {{ $('On form submission').item.json.Name }},<br>\\n    Scan the QR code below to claim your special discount.</p>\\n    \\n    <img src=\\\"https://quickchart.io/qr?text=https://n8n.n3witalia.com/webhook-test/bb832325-8c58-4717-b866-41f8a9714cf2?qr={{ $('Get Coupon').item.json.COUPON }}&size=250\\\" alt=\\\"Scan to get your discount\\\" style=\\\"margin: 20px;\\\">\\n    \\n    <p>Hurry, the offer is limited!</p>\\n</body>\\n</html>\\n\",\n        \"options\": {},\n        \"subject\": \"[n8n] Exclusive Discount Coupon\",\n        \"toEmail\": \"={{ $('Form Fields').item.json.Email }}\",\n        \"fromEmail\": \"=EMAILFROM\"\n      },\n      \"credentials\": {\n        \"smtp\": {\n          \"id\": \"hRjP3XbDiIQqvi7x\",\n          \"name\": \"SMTP info@n3witalia.com\"\n        }\n      },\n      \"typeVersion\": 2.1\n    },\n    {\n      \"id\": \"5893bd1d-762d-4337-8392-6d358002845a\",\n      \"name\": \"Update Lead\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1020,\n        100\n      ],\n      \"parameters\": {\n        \"url\": \"=https://suitecrm.dev.n3witalia.com/Api/V8/module\",\n        \"method\": \"PATCH\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"responseFormat\": \"json\"\n            }\n          }\n        },\n        \"jsonBody\": \"={\\n  \\\"data\\\": {\\n    \\\"type\\\": \\\"Leads\\\",\\n    \\\"id\\\": \\\"{{ $('Not used?').item.json['ID LEAD'] }}\\\",\\n    \\\"attributes\\\": {\\n      \\\"coupon_used_c\\\": \\\"yes\\\"\\n    }\\n  }\\n}\",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Authorization\",\n              \"value\": \"=Bearer {{$node[\\\"Token SuiteCRM 1\\\"].json[\\\"access_token\\\"]}}\"\n            },\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/vnd.api+json\"\n            }\n          ]\n        }\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"fd0a43f4-a3f1-4008-947c-f8208d2126f7\",\n      \"name\": \"Not used?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        540,\n        240\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"50546d87-ab37-4c8a-b835-e1a60f3aa0dc\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"empty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json['USED COUPON?'] }}\",\n              \"rightValue\": \"\"\n            },\n            {\n              \"id\": \"025a42b8-fb90-44a8-951a-0e321b42c3b9\",\n              \"operator\": {\n                \"type\": \"number\",\n                \"operation\": \"exists\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json.row_number }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"0029c366-aec1-4305-aab5-2ab6845e2828\",\n      \"name\": \"Coupon OK\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        1480,\n        100\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"respondWith\": \"text\",\n        \"responseBody\": \"Qr valid!\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"4c326412-0965-4f1c-9b77-2704d37a7151\",\n      \"name\": \"No coupon\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        320,\n        460\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"responseCode\": 200\n        },\n        \"respondWith\": \"text\",\n        \"responseBody\": \"Coupon not valid\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"e18cf9e7-584d-4f49-88b8-4c3a513ff613\",\n      \"name\": \"Coupon KO\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        800,\n        320\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"responseCode\": 200\n        },\n        \"respondWith\": \"text\",\n        \"responseBody\": \"Coupon already used\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"55a63a65-5472-4e50-8150-604c6bc9dd18\",\n      \"name\": \"Token SuiteCRM 1\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        800,\n        100\n      ],\n      \"parameters\": {\n        \"url\": \"=https://SUITECRMURL/Api/access_token\",\n        \"options\": {},\n        \"requestMethod\": \"POST\",\n        \"bodyParametersUi\": {\n          \"parameter\": [\n            {\n              \"name\": \"grant_type\",\n              \"value\": \"client_credentials\"\n            },\n            {\n              \"name\": \"client_id\",\n              \"value\": \"CLIENTID\"\n            },\n            {\n              \"name\": \"client_secret\",\n              \"value\": \"CLIENTSECRET\"\n            }\n          ]\n        },\n        \"allowUnauthorizedCerts\": true\n      },\n      \"notesInFlow\": true,\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"c843c9f2-9940-423c-bc9d-8530fb43f229\",\n      \"name\": \"Set coupon\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -180,\n        340\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"4e9a4330-d654-410f-9b99-aa57545c2c80\",\n              \"name\": \"qr\",\n              \"type\": \"string\",\n              \"value\": \"={{ $json.query.qr }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"9a2d877d-9016-460e-b376-ea27c59a492a\",\n      \"name\": \"Get Lead\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        320,\n        240\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"returnFirstMatch\": true\n        },\n        \"filtersUI\": {\n          \"values\": [\n            {\n              \"lookupValue\": \"={{ $json.qr }}\",\n              \"lookupColumn\": \"COUPON\"\n            }\n          ]\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0\",\n          \"cachedResultName\": \"Foglio1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Coupon\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"JYR6a64Qecd6t8Hb\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"da2e62e5-898c-4024-8d85-517b18dcefc3\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -200,\n        280\n      ],\n      \"parameters\": {\n        \"width\": 360,\n        \"height\": 220,\n        \"content\": \"Check if the QR code scan is valid\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"507dc2ab-a762-49b8-a13a-c9b20c7135d8\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        300,\n        180\n      ],\n      \"parameters\": {\n        \"width\": 360,\n        \"height\": 220,\n        \"content\": \"Check if coupon is valid\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"f44b5645-1611-4c16-83ac-ee8a4821970b\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        760,\n        40\n      ],\n      \"parameters\": {\n        \"width\": 420,\n        \"height\": 220,\n        \"content\": \"Enter the lead with the relative coupon on Suite CRM. Change SUITECRMURL, CLIENTSECRET and CLIENTID\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ad0a5999-2616-4c7b-8108-6f13e573490b\",\n      \"name\": \"Update coupon used\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        1240,\n        100\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"ID LEAD\": \"={{ $json.data.id }}\",\n            \"USED COUPON?\": \"yes\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"NAME\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"NAME\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"SURNAME\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"SURNAME\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"EMAIL\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"EMAIL\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"PHONE\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"PHONE\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"COUPON\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"COUPON\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"DATE\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"DATE\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"ID LEAD\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"ID LEAD\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"USED COUPON?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"USED COUPON?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"row_number\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"readOnly\": true,\n              \"required\": false,\n              \"displayName\": \"row_number\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"ID LEAD\"\n          ],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {},\n        \"operation\": \"update\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit#gid=0\",\n          \"cachedResultName\": \"Foglio1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1lnRZodxZSOA0QSuzkAb7ZJcfFfNXpX7NcxMdckMTN90/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Coupon\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"JYR6a64Qecd6t8Hb\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"acd6a7fb-aeae-4baf-8f60-af16715a6de6\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1560,\n        -380\n      ],\n      \"parameters\": {\n        \"width\": 220,\n        \"height\": 220,\n        \"content\": \"Set the Webhook URL\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"091a00b6-34bd-4221-b2f1-4d55719a273a\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -480,\n        -900\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 680,\n        \"height\": 240,\n        \"content\": \"## Coupon assignment and simple validation system\\n\\nThis workflow is designed to manage the assignment and validation of unique QR code coupons within a lead generation system. The process begins with a webhook that receives data from a user-filled form, containing information such as name, surname, email, and phone number. This data is then processed to check if the lead already exists in the system, preventing duplicates.\\n\\nDISCLAIMER: The system is very simple and basic but can be improved and made very efficient through specific controls and new implementations\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"00ea32a4-635c-41c0-a789-e7b45efdf193\",\n  \"connections\": {\n    \"If\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Lead\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"No coupon\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get QR\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Email\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set coupon\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Lead\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Not used?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Not used?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Token SuiteCRM 1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Coupon KO\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Coupon\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Token SuiteCRM\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set coupon\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Form Fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Duplicate Lead?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update Lead\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update coupon used\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update Sheet\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get QR\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Is Duplicate?\": {\n      \"main\": [\n        [],\n        [\n          {\n            \"node\": \"Get Coupon\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Token SuiteCRM\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Lead SuiteCRM\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Duplicate Lead?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is Duplicate?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Token SuiteCRM 1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Lead\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"On form submission\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Form Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update coupon used\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Coupon OK\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Lead SuiteCRM\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Sheet\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.if",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.formTrigger",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.set",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.if",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.emailSend",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.if",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.set",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}