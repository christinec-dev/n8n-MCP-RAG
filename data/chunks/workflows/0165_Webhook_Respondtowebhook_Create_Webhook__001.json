{
  "source": "0165_Webhook_Respondtowebhook_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"nodes\": [\n    {\n      \"name\": \"Receive Slash Command\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"position\": [\n        240,\n        100\n      ],\n      \"webhookId\": \"3c0d3820-5896-41c5-83bf-1cd5e956c32c\",\n      \"parameters\": {\n        \"path\": \"3c0d3820-5896-41c5-83bf-1cd5e956c32c\",\n        \"options\": {},\n        \"httpMethod\": \"POST\",\n        \"responseMode\": \"responseNode\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Reject\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        680,\n        200\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"responseCode\": 403\n        },\n        \"respondWith\": \"noData\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Set\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        680,\n        0\n      ],\n      \"parameters\": {\n        \"values\": {\n          \"string\": [\n            {\n              \"name\": \"operation\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"text\\\"].split(\\\" \\\")[0].toLowerCase()}}\"\n            },\n            {\n              \"name\": \"email\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"text\\\"].split(\\\" \\\")[1].toLowerCase()}}\"\n            }\n          ]\n        },\n        \"options\": {},\n        \"keepOnlySet\": true\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Read Command\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        900,\n        0\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"rules\": [\n            {\n              \"value2\": \"delete\"\n            }\n          ]\n        },\n        \"value1\": \"={{$json[\\\"operation\\\"]}}\",\n        \"dataType\": \"string\",\n        \"fallbackOutput\": 3\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Wrong Command Error\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        1120,\n        100\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"respondWith\": \"json\",\n        \"responseBody\": \"{\\n  \\\"text\\\": \\\"Sorry, I didn't understand your command. You can request data deletion like so: `/gdpr delete <email>`.\\\"\\n}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Acknowledge\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        1340,\n        0\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"respondWith\": \"json\",\n        \"responseBody\": \"{\\n  \\\"text\\\": \\\"On it!\\\"\\n}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Empty Email?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1120,\n        -100\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{$json[\\\"email\\\"]}}\",\n              \"operation\": \"isEmpty\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Missing Email Error\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"position\": [\n        1340,\n        -200\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"respondWith\": \"json\",\n        \"responseBody\": \"{\\n  \\\"text\\\": \\\"It looks like the user email address is missing. You can request data deletion like so: `/gdpr delete <email>`.\\\"\\n}\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Valid Token?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        460,\n        100\n      ],\n      \"parameters\": {\n        \"conditions\": {\n          \"string\": [\n            {\n              \"value1\": \"={{$json[\\\"body\\\"][\\\"token\\\"]}}\",\n              \"value2\": \"foo\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Paddle Data Deletion\",\n      \"type\": \"n8n-nodes-base.executeWorkflow\",\n      \"position\": [\n        1560,\n        0\n      ],\n      \"parameters\": {\n        \"workflowId\": \"1231\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Customer.io Data Deletion\",\n      \"type\": \"n8n-nodes-base.executeWorkflow\",\n      \"position\": [\n        1780,\n        0\n      ],\n      \"parameters\": {\n        \"workflowId\": \"1237\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Zendesk Data Deletion\",\n      \"type\": \"n8n-nodes-base.executeWorkflow\",\n      \"position\": [\n        2000,\n        0\n      ],\n      \"parameters\": {\n        \"workflowId\": \"1240\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Airtable\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"position\": [\n        1780,\n        200\n      ],\n      \"parameters\": {\n        \"table\": \"Log\",\n        \"options\": {},\n        \"operation\": \"append\",\n        \"application\": \"app3wAXUUwalhapFV\"\n      },\n      \"credentials\": {\n        \"airtableApi\": {\n          \"id\": \"12\",\n          \"name\": \"mutedjam@n8n.io\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Prepare Log Entry\",\n      \"type\": \"n8n-nodes-base.function\",\n      \"position\": [\n        1340,\n        200\n      ],\n      \"parameters\": {\n        \"functionCode\": \"let deletion_nodes = [\\n  'Paddle Data Deletion',\\n  'Customer.io Data Deletion',\\n  'Zendesk Data Deletion'\\n]\\n\\nconst deletion_results = deletion_nodes.map(node_name => $items(node_name)[0].json);\\nconst deletion_success = deletion_results.filter(json => json.success == true).length == deletion_nodes.length;\\n\\nreturn [{\\n  json: {\\n    Result: deletion_success ? 'Done' : 'Error',\\n    Notes: deletion_results.map(json => json.service + ': ' + json.message).join('\\\\n'),\\n    Processed: new Date().toISOString()\\n  }\\n}];\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Crypto\",\n      \"type\": \"n8n-nodes-base.crypto\",\n      \"position\": [\n        1560,\n        200\n      ],\n      \"parameters\": {\n        \"type\": \"SHA256\",\n        \"value\": \"={{$node[\\\"Set\\\"].json[\\\"email\\\"]}}\",\n        \"dataPropertyName\": \"Email Hash\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"name\": \"Respond to Slack\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        2000,\n        200\n      ],\n      \"parameters\": {\n        \"url\": \"={{$node[\\\"Receive Slash Command\\\"].json[\\\"body\\\"][\\\"response_url\\\"]}}\",\n        \"options\": {},\n        \"requestMethod\": \"POST\",\n        \"responseFormat\": \"string\",\n        \"bodyParametersUi\": {\n          \"parameter\": [\n            {\n              \"name\": \"text\",\n              \"value\": \"=GDPR data deletion process finished.\\nStatus: {{$node[\\\"Prepare Log Entry\\\"].json[\\\"Result\\\"] == \\\"Done\\\" ? \\\":white_check_mark: OK\\\" : \\\":x: Error\\\"}}\\nLog: <https://airtable.com/app3wAXUUwalhapFV/tbljkxW55l2Gq7Fzq/viwOJdJM1taITEaPr/{{$node[\\\"Airtable\\\"].json[\\\"id\\\"]}}?blocks=hide|View in Airtable>\"\n            },\n            {\n              \"name\": \"delete_original\",\n              \"value\": \"true\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"connections\": {\n    \"Set\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Read Command\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Crypto\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Airtable\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Airtable\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Respond to Slack\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Acknowledge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Paddle Data Deletion\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Empty Email?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Missing Email Error\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Acknowledge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Read Command\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Empty Email?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        null,\n        null,\n        [\n          {\n            \"node\": \"Wrong Command Error\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Valid Token?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Reject\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Prepare Log Entry\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Crypto\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Paddle Data Deletion\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Customer.io Data Deletion\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Receive Slash Command\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Valid Token?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Zendesk Data Deletion\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Prepare Log Entry\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Customer.io Data Deletion\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Zendesk Data Deletion\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.webhook",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.set",
      "n8n-nodes-base.switch",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.if",
      "n8n-nodes-base.respondToWebhook",
      "n8n-nodes-base.if",
      "n8n-nodes-base.executeWorkflow",
      "n8n-nodes-base.executeWorkflow",
      "n8n-nodes-base.executeWorkflow",
      "n8n-nodes-base.airtable",
      "n8n-nodes-base.function",
      "n8n-nodes-base.crypto",
      "n8n-nodes-base.httpRequest"
    ],
    "trigger": null
  }
}