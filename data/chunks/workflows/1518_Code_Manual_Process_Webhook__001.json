{
  "source": "1518_Code_Manual_Process_Webhook.json",
  "index": 1,
  "content": "{\n  \"id\": \"IyDJ7Zgh4MV43YTh\",\n  \"meta\": {\n    \"instanceId\": \"a4bfc93e975ca233ac45ed7c9227d84cf5a2329310525917adaf3312e10d5462\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"name\": \"Convert image from jpg/png to webp\",\n  \"tags\": [],\n  \"nodes\": [\n    {\n      \"id\": \"09977b8b-e095-4419-b136-bcbadf0f5d84\",\n      \"name\": \"When clicking ‘Test workflow’\",\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"position\": [\n        -320,\n        -20\n      ],\n      \"parameters\": {},\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"55c01841-9576-4663-bb24-c9e0082ecab5\",\n      \"name\": \"Set API KEY\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        40,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"1fa468da-3e30-46b0-a44b-a723e45c5fda\",\n              \"name\": \"apikey\",\n              \"type\": \"string\",\n              \"value\": \"APY**************************************************************\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"2d50e290-a861-4575-abbc-7f311d1934bb\",\n      \"name\": \"Get images\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        380,\n        -20\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"returnFirstMatch\": true\n        },\n        \"filtersUI\": {\n          \"values\": [\n            {\n              \"lookupColumn\": \"DONE\"\n            }\n          ]\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1upj3EDLwU1N7NHWWV3DhwMuE6ty39tIK5z5lCVDWWuM/edit#gid=0\",\n          \"cachedResultName\": \"Foglio1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1upj3EDLwU1N7NHWWV3DhwMuE6ty39tIK5z5lCVDWWuM\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1upj3EDLwU1N7NHWWV3DhwMuE6ty39tIK5z5lCVDWWuM/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Convert images\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"JYR6a64Qecd6t8Hb\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"b3c5d64c-0e2a-472b-83f7-91cabd4d1646\",\n      \"name\": \"Get extension\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"position\": [\n        660,\n        -20\n      ],\n      \"parameters\": {\n        \"jsCode\": \"// Loop over input items and add new fields 'FILENAME' and 'EXTENSION' to the JSON of each one\\nfor (const item of $input.all()) {\\n  // Extract the 'FROM' field\\n  const url = item.json.FROM;\\n\\n  const filenameWithExtension = url.split('/').pop().split(/[#?]/)[0];\\n\\n  const extension = filenameWithExtension.split('.').pop();\\n\\n  const filename = filenameWithExtension.substring(0, filenameWithExtension.length - extension.length - 1);\\n\\n  item.json.FILENAME = filename;\\n  item.json.EXTENSION = extension;\\n}\\n\\nreturn $input.all();\\n\"\n      },\n      \"typeVersion\": 2\n    },\n    {\n      \"id\": \"e281cd63-79d1-4ca3-88c0-81aaa7e0dbe8\",\n      \"name\": \"JPG or PNG?\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        -320,\n        460\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"jpeg\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"f25651ea-ee05-4e8d-91a8-fa96997e2794\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.EXTENSION }}\",\n                    \"rightValue\": \"jpg\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"jpeg\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"6a2dc1fd-5e5a-4015-bad1-e258dfead84f\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.EXTENSION }}\",\n                    \"rightValue\": \"jpeg\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"png\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"1d0e09dd-edee-4778-9b3a-9a4429a06db0\",\n                    \"operator\": {\n                      \"name\": \"filter.operator.equals\",\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"leftValue\": \"={{ $json.EXTENSION }}\",\n                    \"rightValue\": \"png\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"f3257837-88e0-4f5f-bbd5-5c63c5ba4ed1\",\n      \"name\": \"From JPG to WEBP\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -100,\n        320\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.apyhub.com/convert/image/jpeg/webp/url?output=test-sample\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"url\\\":\\\"{{ $json.FROM }}\\\"\\n} \",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            },\n            {\n              \"name\": \"api-token\",\n              \"value\": \"={{ $('Set API KEY').item.json.apikey }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"de1198c3-17a2-4b45-a334-6334b2b935c4\",\n      \"name\": \"PNG to WEBP\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        -100,\n        580\n      ],\n      \"parameters\": {\n        \"url\": \"=https://api.apyhub.com/convert/image/png/webp/url?output=test-sample\",\n        \"method\": \"POST\",\n        \"options\": {},\n        \"jsonBody\": \"={\\n  \\\"url\\\":\\\"{{ $json.FROM }}\\\"\\n} \",\n        \"sendBody\": true,\n        \"sendHeaders\": true,\n        \"specifyBody\": \"json\",\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            },\n            {\n              \"name\": \"apy-token\",\n              \"value\": \"={{ $('Set API KEY').item.json.apikey }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"38b46480-c089-4bca-88ac-7f006c12d3b9\",\n      \"name\": \"Update Sheet\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        160,\n        440\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"TO\": \"={{ $json.data }}\",\n            \"DONE\": \"x\",\n            \"row_number\": \"={{ $('Get images').item.json.row_number }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"FROM\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"FROM\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"TO\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"TO\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"DONE\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"required\": false,\n              \"displayName\": \"DONE\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"row_number\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"readOnly\": true,\n              \"required\": false,\n              \"displayName\": \"row_number\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"row_number\"\n          ],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {},\n        \"operation\": \"update\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1upj3EDLwU1N7NHWWV3DhwMuE6ty39tIK5z5lCVDWWuM/edit#gid=0\",\n          \"cachedResultName\": \"Foglio1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1upj3EDLwU1N7NHWWV3DhwMuE6ty39tIK5z5lCVDWWuM\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1upj3EDLwU1N7NHWWV3DhwMuE6ty39tIK5z5lCVDWWuM/edit?usp=drivesdk\",\n          \"cachedResultName\": \"Convert images from jpg/png to webp\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"JYR6a64Qecd6t8Hb\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"2dc29c73-efcb-4bef-8d9a-5a1914df62ad\",\n      \"name\": \"Get file image\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        420,\n        440\n      ],\n      \"parameters\": {\n        \"url\": \"={{ $json.TO }}\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"responseFormat\": \"file\"\n            }\n          }\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"acee7120-ceb4-472e-a941-066056da5cd6\",\n      \"name\": \"Upload image\",\n      \"type\": \"n8n-nodes-base.googleDrive\",\n      \"position\": [\n        700,\n        440\n      ],\n      \"parameters\": {\n        \"name\": \"={{ $('Get extension').item.json.FILENAME }}.webp\",\n        \"driveId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"My Drive\"\n        },\n        \"options\": {},\n        \"folderId\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"1XyUSYXdNrZIw0XyZ3YpuaxGJjOaARyEJ\",\n          \"cachedResultUrl\": \"https://drive.google.com/drive/folders/1XyUSYXdNrZIw0XyZ3YpuaxGJjOaARyEJ\",\n          \"cachedResultName\": \"Immagini\"\n        }\n      },\n      \"credentials\": {\n        \"googleDriveOAuth2Api\": {\n          \"id\": \"HEy5EuZkgPZVEa9w\",\n          \"name\": \"Google Drive account (n3w.it)\"\n        }\n      },\n      \"typeVersion\": 3\n    },\n    {\n      \"id\": \"0a491e7b-2482-429e-9901-cb2bf3d34509\",\n      \"name\": \"Sticky Note\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -360,\n        -520\n      ],\n      \"parameters\": {\n        \"color\": 3,\n        \"width\": 800,\n        \"height\": 200,\n        \"content\": \"## Convert image from jpg/png to webp\\n\\nThis workflow automates the process of converting images from **JPG/PNG** format to **WEBP** using the **APYHub API**. It retrieves image URLs from a **Google Sheet**, converts the images, and uploads the converted files to **Google Drive**. \\n\\nThis workflow is a powerful tool for automating image conversion tasks, saving time and ensuring that images are efficiently converted and stored in the desired format.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"78a198c4-449f-4a68-96e4-20ecd044fe1f\",\n      \"name\": \"Sticky Note1\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -360,\n        -280\n      ],\n      \"parameters\": {\n        \"width\": 800,\n        \"height\": 120,\n        \"content\": \"## PRELIMINARY STEP\\n- Get your FREE API KEY from [APYHub](https://apyhub.com//)\\n- Clone [this sheet](https://docs.google.com/spreadsheets/d/1upj3EDLwU1N7NHWWV3DhwMuE6ty39tIK5z5lCVDWWuM/edit?usp=sharing) and insert the URL of your images (only jpg, jpeg and png format) in the column \\\"FROM\\\"\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"active\": false,\n  \"pinData\": {},\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"versionId\": \"e2fa7236-fbf9-43ec-a217-aeb43664d129\",\n  \"connections\": {\n    \"Get images\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get extension\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"JPG or PNG?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"From JPG to WEBP\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"From JPG to WEBP\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"PNG to WEBP\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"PNG to WEBP\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Sheet\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set API KEY\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get images\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update Sheet\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get file image\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get extension\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"JPG or PNG?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get file image\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Upload image\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"From JPG to WEBP\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Sheet\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"When clicking ‘Test workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set API KEY\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.manualTrigger",
      "n8n-nodes-base.set",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.code",
      "n8n-nodes-base.switch",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.googleDrive",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": null
  }
}