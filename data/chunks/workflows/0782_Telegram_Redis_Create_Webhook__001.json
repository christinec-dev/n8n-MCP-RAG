{
  "source": "0782_Telegram_Redis_Create_Webhook.json",
  "index": 1,
  "content": "{\n  \"meta\": {\n    \"instanceId\": \"408f9fb9940c3cb18ffdef0e0150fe342d6e655c3a9fac21f0f644e8bedabcd9\",\n    \"templateCredsSetupCompleted\": true\n  },\n  \"nodes\": [\n    {\n      \"id\": \"c537229c-ffdf-4a4b-8cdd-1d88621e58a0\",\n      \"name\": \"Telegram Trigger\",\n      \"type\": \"n8n-nodes-base.telegramTrigger\",\n      \"position\": [\n        -1060,\n        2060\n      ],\n      \"webhookId\": \"1b9f2217-7c53-4440-b62b-aafcf1e1d45d\",\n      \"parameters\": {\n        \"updates\": [\n          \"message\"\n        ],\n        \"additionalFields\": {}\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"wJqs1eMdbjilZH1W\",\n          \"name\": \"jimleuk_ai_survey_demo_bot\"\n        }\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"90426896-35d8-4449-8607-70e8485441ed\",\n      \"name\": \"Send Next Question\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        2560,\n        1900\n      ],\n      \"webhookId\": \"4306c719-0b05-4986-8ea8-8bcda06e0ad1\",\n      \"parameters\": {\n        \"text\": \"={{ $('Get Survey State1').first().json.next_question_idx }}. {{ Object.values($('Get Columns1').first().json)[$('Get Survey State1').first().json.next_question_idx+1] }}\",\n        \"chatId\": \"={{ $('Telegram Trigger').first().json.message.chat.id }}\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"wJqs1eMdbjilZH1W\",\n          \"name\": \"jimleuk_ai_survey_demo_bot\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"614b6d06-7bca-4710-aebf-3a2a685ace09\",\n      \"name\": \"Send Response\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        1540,\n        2540\n      ],\n      \"webhookId\": \"dd1c616f-891c-48d4-8828-e612b13bca63\",\n      \"parameters\": {\n        \"text\": \"={{ $('Interview Agent1').first().json.output }}\",\n        \"chatId\": \"={{ $('Telegram Trigger').first().json.message.chat.id }}\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"wJqs1eMdbjilZH1W\",\n          \"name\": \"jimleuk_ai_survey_demo_bot\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"c7f7acc4-c3f7-4fae-98dd-25dca9caae8b\",\n      \"name\": \"Has No Record?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        60,\n        2260\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"a9f08592-d870-44a4-a7f9-d70193cf721b\",\n              \"operator\": {\n                \"type\": \"object\",\n                \"operation\": \"empty\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $json }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"207a2647-56eb-419a-8269-9a32edabe43a\",\n      \"name\": \"Is Survey Continue?\",\n      \"type\": \"n8n-nodes-base.if\",\n      \"position\": [\n        1980,\n        2060\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"conditions\": {\n          \"options\": {\n            \"version\": 2,\n            \"leftValue\": \"\",\n            \"caseSensitive\": true,\n            \"typeValidation\": \"strict\"\n          },\n          \"combinator\": \"and\",\n          \"conditions\": [\n            {\n              \"id\": \"5685829b-a2b2-42c8-b6bc-22eaa03db1d2\",\n              \"operator\": {\n                \"type\": \"boolean\",\n                \"operation\": \"false\",\n                \"singleValue\": true\n              },\n              \"leftValue\": \"={{ $('Increment Index1').item.json.is_survey_complete }}\",\n              \"rightValue\": \"\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 2.2\n    },\n    {\n      \"id\": \"a8e98579-6afa-4d7d-859d-9e635a0a1b0c\",\n      \"name\": \"Get State2\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        -520,\n        2060\n      ],\n      \"parameters\": {\n        \"key\": \"={{ $json.cacheKey }}\",\n        \"options\": {},\n        \"operation\": \"get\",\n        \"propertyName\": \"data\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zU4DA70qSDrZM1El\",\n          \"name\": \"Redis account (localhost)\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"8074143c-eab7-4146-937c-16c44ef40333\",\n      \"name\": \"Get Columns1\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        1440,\n        2060\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"dataLocationOnSheet\": {\n            \"values\": {\n              \"firstDataRow\": 1,\n              \"rangeDefinition\": \"specifyRange\"\n            }\n          }\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1KMNqWWO36osZx7jF-i1UL53z2GZnCn9fiBjtlGpvWB4/edit#gid=0\",\n          \"cachedResultName\": \"Sheet1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Set Variables1').first().json.gsheetId }}\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5\n    },\n    {\n      \"id\": \"1f75f3fc-7893-444d-8a1e-59ec3d42ea1d\",\n      \"name\": \"Set Variables1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -880,\n        2060\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"2140b769-2e90-4828-8022-1b0a9baf6e44\",\n              \"name\": \"title\",\n              \"type\": \"string\",\n              \"value\": \"Product Satisfaction Survey: DJI Mini 2\"\n            },\n            {\n              \"id\": \"fb7110cb-82d3-4c95-81ba-ac97a26fe05e\",\n              \"name\": \"gsheetId\",\n              \"type\": \"string\",\n              \"value\": \"1KMNqWWO36osZx7jF-i1UL53z2GZnCn9fiBjtlGpvWB4\"\n            },\n            {\n              \"id\": \"6d9c4b02-8326-49f4-ac22-24bdec7fdd67\",\n              \"name\": \"cacheKey\",\n              \"type\": \"string\",\n              \"value\": \"=survey_user_{{ $json.sessionId }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"a0c06eb9-46d6-4888-85b0-e9a31a31337b\",\n      \"name\": \"Message Type1\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        -320,\n        2060\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"is_bot_command\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"f5fa8b7c-fdda-4c6d-b610-e243d6299598\",\n                    \"operator\": {\n                      \"type\": \"boolean\",\n                      \"operation\": \"true\",\n                      \"singleValue\": true\n                    },\n                    \"leftValue\": \"={{ ['/start','/next', '/reset'].includes($('Telegram Trigger').first().json.message.text) }}\",\n                    \"rightValue\": \"=\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {\n          \"fallbackOutput\": \"extra\",\n          \"renameFallbackOutput\": \"is_normal_message\"\n        }\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"315585fe-d2e4-4cb1-9d0e-a3e8bc053da3\",\n      \"name\": \"Get Command1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        -120,\n        1760\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"73335bd3-ce50-46c5-8bcf-f7b8cd992208\",\n              \"name\": \"command\",\n              \"type\": \"string\",\n              \"value\": \"={{ $('Telegram Trigger').first().json.message.text.slice($('Telegram Trigger').first().json.message.entities[0].offset, $('Telegram Trigger').first().json.message.entities[0].length ) }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"7036d250-0271-4c93-9f60-01b9ccaf8be3\",\n      \"name\": \"Bot Actions1\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"position\": [\n        60,\n        1760\n      ],\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"outputKey\": \"new_session\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"6f427c86-090d-429a-bc99-d2dd7753c153\",\n                    \"operator\": {\n                      \"type\": \"boolean\",\n                      \"operation\": \"true\",\n                      \"singleValue\": true\n                    },\n                    \"leftValue\": \"={{ $('Get Command1').first().json.command === '/start' }}\",\n                    \"rightValue\": \"/start\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            },\n            {\n              \"outputKey\": \"next_question\",\n              \"conditions\": {\n                \"options\": {\n                  \"version\": 2,\n                  \"leftValue\": \"\",\n                  \"caseSensitive\": true,\n                  \"typeValidation\": \"strict\"\n                },\n                \"combinator\": \"and\",\n                \"conditions\": [\n                  {\n                    \"id\": \"bca60df4-278d-4598-afc9-6e8ee61b7ac5\",\n                    \"operator\": {\n                      \"type\": \"boolean\",\n                      \"operation\": \"true\",\n                      \"singleValue\": true\n                    },\n                    \"leftValue\": \"={{ $('Get Command1').first().json.command === '/next' }}\",\n                    \"rightValue\": \"\"\n                  }\n                ]\n              },\n              \"renameOutput\": true\n            }\n          ]\n        },\n        \"options\": {\n          \"fallbackOutput\": \"extra\"\n        }\n      },\n      \"typeVersion\": 3.2\n    },\n    {\n      \"id\": \"fa755815-29c2-419e-8e36-51102ee88681\",\n      \"name\": \"Memory3\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryRedisChat\",\n      \"position\": [\n        2220,\n        2060\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('Set Variables1').first().json.cacheKey }}_history\",\n        \"sessionIdType\": \"customKey\",\n        \"contextWindowLength\": 10\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zU4DA70qSDrZM1El\",\n          \"name\": \"Redis account (localhost)\"\n        }\n      },\n      \"typeVersion\": 1.4\n    },\n    {\n      \"id\": \"a231e026-e5bf-4864-a57b-29d01e32e1a8\",\n      \"name\": \"Get Survey State1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        1620,\n        2060\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"6836a5aa-2b51-48cc-8d8f-d64a85d8a52f\",\n              \"name\": \"title\",\n              \"type\": \"string\",\n              \"value\": \"={{ Object.values($json)[1] }}\"\n            },\n            {\n              \"id\": \"7b2fdf1b-4f55-4b55-be54-a7b97dd094cb\",\n              \"name\": \"num_questions\",\n              \"type\": \"number\",\n              \"value\": \"={{ Object.keys($json).length - 2 }}\"\n            },\n            {\n              \"id\": \"dc6d5c41-0f35-49c9-b9c9-b6b4f2ceb66c\",\n              \"name\": \"next_question_idx\",\n              \"type\": \"number\",\n              \"value\": \"={{ (Number($('Get State3').first().json.data?.current_question_idx) || 0) + 1 }}\"\n            },\n            {\n              \"id\": \"8b17703f-fbff-40d2-a7bb-d450f2edfea3\",\n              \"name\": \"is_survey_complete\",\n              \"type\": \"boolean\",\n              \"value\": \"={{ ((Number($('Get State3').first().json.data?.current_question_idx) || 0) + 1) >= (Object.keys($json).length - 1) }}\"\n            }\n          ]\n        }\n      },\n      \"executeOnce\": true,\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"a3bb744d-c59f-45a9-8b9d-3c291fa8d860\",\n      \"name\": \"Reset Agent Memory1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryManager\",\n      \"position\": [\n        2240,\n        1900\n      ],\n      \"parameters\": {\n        \"mode\": \"insert\",\n        \"messages\": {\n          \"messageValues\": [\n            {\n              \"message\": \"=You are a curious and inquisitive researcher conducting a survey with a user.\\n* In this conversation, you are only interested in one of the questions from the survey which you will ask.\\n* When asking an open-ended question, converse with the user to dig deeper into their answer and reveal insights into the user's experience. Do not ask other questions which do not try to expand the user's answer to the initial question.\\n* If this is closed-ended question, it is okay to receive a static response and move on to the next question.\\n* Only the initial question is numbered, following questions or messages should not be numbered or bulletpointed.\\n* If the user goes off-topic, doesn't want to answer the question or wants to do something else which is not related to the survey, then ignore what they say/ask and politely repeat the question.\"\n            },\n            {\n              \"type\": \"ai\",\n              \"message\": \"={{ $('Get Survey State1').first().json.next_question_idx }}. {{ Object.values($('Get Columns1').first().json)[$('Get Survey State1').first().json.next_question_idx+1] }}\"\n            }\n          ]\n        },\n        \"insertMode\": \"override\"\n      },\n      \"typeVersion\": 1.1\n    },\n    {\n      \"id\": \"b9d693b7-c139-45d8-b0d8-fd8134c7ba84\",\n      \"name\": \"Memory4\",\n      \"type\": \"@n8n/n8n-nodes-langchain.memoryRedisChat\",\n      \"position\": [\n        1120,\n        2700\n      ],\n      \"parameters\": {\n        \"sessionKey\": \"={{ $('Set Variables1').first().json.cacheKey }}_history\",\n        \"sessionIdType\": \"customKey\",\n        \"contextWindowLength\": 100\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zU4DA70qSDrZM1El\",\n          \"name\": \"Redis account (localhost)\"\n        }\n      },\n      \"typeVersion\": 1.4\n    },\n    {\n      \"id\": \"c8fd56f5-c4c0-40cb-b727-07a94b633657\",\n      \"name\": \"Start Session1\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        440,\n        1620\n      ],\n      \"parameters\": {\n        \"key\": \"={{ $('Set Variables1').first().json.cacheKey }}\",\n        \"value\": \"={{\\n{\\n  \\\"has_session\\\": true,\\n  \\\"session_createdAt\\\": $now,\\n  \\\"current_question_idx\\\": 0\\n}\\n}}\",\n        \"keyType\": \"hash\",\n        \"operation\": \"set\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zU4DA70qSDrZM1El\",\n          \"name\": \"Redis account (localhost)\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"02eaa2cf-512c-4526-948e-b68989b3a8f4\",\n      \"name\": \"Get State3\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        1260,\n        2060\n      ],\n      \"parameters\": {\n        \"key\": \"={{ $('Set Variables1').first().json.cacheKey }}\",\n        \"options\": {},\n        \"operation\": \"get\",\n        \"propertyName\": \"data\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zU4DA70qSDrZM1El\",\n          \"name\": \"Redis account (localhost)\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"85631c2a-9317-4b14-92d1-895ac022eb70\",\n      \"name\": \"Increment Index1\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        1800,\n        2060\n      ],\n      \"parameters\": {\n        \"key\": \"={{ $('Set Variables1').first().json.cacheKey }}\",\n        \"value\": \"={{\\n{\\n  \\\"current_question_idx\\\": $json.next_question_idx < $json.num_questions\\n    ? $json.next_question_idx\\n    : $json.num_questions,\\n  \\\"session_updated\\\": $now,\\n}\\n}}\",\n        \"keyType\": \"hash\",\n        \"operation\": \"set\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zU4DA70qSDrZM1El\",\n          \"name\": \"Redis account (localhost)\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4464f6fe-d579-4e03-a8ca-918515d38b30\",\n      \"name\": \"Interview Agent1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.agent\",\n      \"position\": [\n        1040,\n        2540\n      ],\n      \"parameters\": {\n        \"text\": \"={{ $('Telegram Trigger').first().json.message.text }}\",\n        \"options\": {},\n        \"promptType\": \"define\"\n      },\n      \"typeVersion\": 1.7\n    },\n    {\n      \"id\": \"11ec3d5a-5f89-4a84-96ef-291526ae7365\",\n      \"name\": \"Get Record1\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        -120,\n        2260\n      ],\n      \"parameters\": {\n        \"options\": {\n          \"returnFirstMatch\": true\n        },\n        \"filtersUI\": {\n          \"values\": [\n            {\n              \"lookupValue\": \"={{ $('Telegram Trigger').first().json.message.from.id }}\",\n              \"lookupColumn\": \"ID\"\n            }\n          ]\n        },\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1KMNqWWO36osZx7jF-i1UL53z2GZnCn9fiBjtlGpvWB4/edit#gid=0\",\n          \"cachedResultName\": \"Sheet1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Set Variables1').first().json.gsheetId }}\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"665d58f8-ba2f-4d87-ae56-260333c5ecdf\",\n      \"name\": \"Append Responses1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"position\": [\n        440,\n        2440\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"8069d106-0918-4bc3-9f49-789322129136\",\n              \"name\": \"payload\",\n              \"type\": \"string\",\n              \"value\": \"={{\\n[\\n  Object.values($('Get Record1').first().json)[Number($('Get State2').first().json.data.current_question_idx || 0) + 1],\\n  'User: ' + $('Telegram Trigger').first().json.message.text,\\n].join('\\\\n\\\\n').trim()\\n}}\"\n            },\n            {\n              \"id\": \"d25c278c-d3a9-4a5a-9f49-01ee3ca8285a\",\n              \"name\": \"cell\",\n              \"type\": \"string\",\n              \"value\": \"={{\\n'abcdefghijklmnopqrstuvxyz'.toUpperCase().split('')[$('Message Type1').first().json.data.current_question_idx]\\n}}{{ $('Get Record1').first().json.row_number }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 3.4\n    },\n    {\n      \"id\": \"4771e9e4-8b79-4530-8c4a-6e7ab0623d98\",\n      \"name\": \"Update Answer2\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1360,\n        2540\n      ],\n      \"parameters\": {\n        \"url\": \"=https://sheets.googleapis.com/v4/spreadsheets/{{ $('Set Variables1').first().json.gsheetId }}/values/Sheet1!{{ $('Append Responses1').first().json.cell }}\",\n        \"method\": \"PUT\",\n        \"options\": {},\n        \"jsonBody\": \"={{\\n{\\n  \\\"range\\\": `Sheet1!${$('Append Responses1').first().json.cell}`,\\n  \\\"majorDimension\\\": \\\"ROWS\\\",\\n  \\\"values\\\": [[\\n    $('Append Responses1').first().json.payload + '\\\\n\\\\nAgent: ' + $('Interview Agent1').first().json.output]]\\n}\\n}}\",\n        \"sendBody\": true,\n        \"sendQuery\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"valueInputOption\",\n              \"value\": \"RAW\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"googleSheetsOAuth2Api\"\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"b7094d87-97ce-4f1a-8d30-4d6d57d24477\",\n      \"name\": \"Get Last Bot Message1\",\n      \"type\": \"n8n-nodes-base.redis\",\n      \"position\": [\n        260,\n        2440\n      ],\n      \"parameters\": {\n        \"key\": \"={{ $('Set Variables1').item.json.cacheKey }}_history\",\n        \"options\": {},\n        \"operation\": \"get\",\n        \"propertyName\": \"data\"\n      },\n      \"credentials\": {\n        \"redis\": {\n          \"id\": \"zU4DA70qSDrZM1El\",\n          \"name\": \"Redis account (localhost)\"\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6dc77f41-6c3b-4358-82bc-2ea299ef69b2\",\n      \"name\": \"Update Answer3\",\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"position\": [\n        1020,\n        2180\n      ],\n      \"parameters\": {\n        \"url\": \"=https://sheets.googleapis.com/v4/spreadsheets/{{ $('Set Variables1').first().json.gsheetId }}/values/Sheet1!{{ $('Append Responses1').first().json.cell }}\",\n        \"method\": \"PUT\",\n        \"options\": {},\n        \"jsonBody\": \"={{\\n{\\n  \\\"range\\\": `Sheet1!${$('Append Responses1').first().json.cell}`,\\n  \\\"majorDimension\\\": \\\"ROWS\\\",\\n  \\\"values\\\": [[$('Append Responses1').first().json.payload]]\\n}\\n}}\",\n        \"sendBody\": true,\n        \"sendQuery\": true,\n        \"specifyBody\": \"json\",\n        \"authentication\": \"predefinedCredentialType\",\n        \"queryParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"valueInputOption\",\n              \"value\": \"RAW\"\n            }\n          ]\n        },\n        \"nodeCredentialType\": \"googleSheetsOAuth2Api\"\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.2\n    },\n    {\n      \"id\": \"dd67ca61-b36c-4f9f-84fe-0b25d411e459\",\n      \"name\": \"Model2\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        1000,\n        2700\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"57698127-eea0-434e-af3a-4d49db4a7f15\",\n      \"name\": \"Model3\",\n      \"type\": \"@n8n/n8n-nodes-langchain.lmChatOpenAi\",\n      \"position\": [\n        600,\n        2600\n      ],\n      \"parameters\": {\n        \"model\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gpt-4o-mini\"\n        },\n        \"options\": {}\n      },\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"8gccIjcuf3gvaoEr\",\n          \"name\": \"OpenAi account\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"bad16467-bb3c-4d50-9dd8-014bac25fd61\",\n      \"name\": \"Should Follow Up?1\",\n      \"type\": \"@n8n/n8n-nodes-langchain.textClassifier\",\n      \"position\": [\n        620,\n        2440\n      ],\n      \"parameters\": {\n        \"options\": {},\n        \"inputText\": \"=AI: {{ $('Get Last Bot Message1').item.json.data?.first().parseJson().data.content ?? ''}}\\nUSER: {{ $('Telegram Trigger').first().json.message.text }}\",\n        \"categories\": {\n          \"categories\": [\n            {\n              \"category\": \"should_not_ask_followup_questions\",\n              \"description\": \"=Either\\n* The user was asked a close-ended question and gave an adequate static response\\n* There are no further insights to be learned from the user's answer\"\n            },\n            {\n              \"category\": \"should_ask_followup_questions\",\n              \"description\": \"=Either one of\\n* There are possibly more insights to be learned from the user's answer if we enquire. hint: did the user explaied or justified their answer?\\n* The user didn't answer the question\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"86545380-9ff1-4815-bfaf-c4137fa00fda\",\n      \"name\": \"Execution Data2\",\n      \"type\": \"n8n-nodes-base.executionData\",\n      \"position\": [\n        -700,\n        2060\n      ],\n      \"parameters\": {\n        \"dataToSave\": {\n          \"values\": [\n            {\n              \"key\": \"jobType\",\n              \"value\": \"=state_message\"\n            },\n            {\n              \"key\": \"gsheetId\",\n              \"value\": \"={{ $json.gsheetId }}\"\n            },\n            {\n              \"key\": \"title\",\n              \"value\": \"={{ $json.title }}\"\n            },\n            {\n              \"key\": \"fromId\",\n              \"value\": \"={{ $('Telegram Trigger').item.json.message.from.id }}\"\n            }\n          ]\n        }\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"ed16f03b-621e-4766-b8fd-f1f662b2dd0b\",\n      \"name\": \"Create Record2\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        260,\n        2060\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"ID\": \"={{ $('Telegram Trigger').first().json.message.from.id }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"ID\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"ID\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"What's your name?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"What's your name?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"What were the main factors that influenced your decision to purchase the DJI Mini 2?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"What were the main factors that influenced your decision to purchase the DJI Mini 2?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Did you compare the DJI Mini 2 with other drone models before purchasing? If yes, which other drone models were you considering? \",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Did you compare the DJI Mini 2 with other drone models before purchasing? If yes, which other drone models were you considering? \",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"What ultimately convinced you to choose the DJI Mini 2 over other options?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"What ultimately convinced you to choose the DJI Mini 2 over other options?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"How satisfied are you with the DJI Mini 2?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"How satisfied are you with the DJI Mini 2?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"What features do you like most about the DJI Mini 2?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"What features do you like most about the DJI Mini 2?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Are there any features you feel are missing or could be improved?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Are there any features you feel are missing or could be improved?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Have you experienced any technical issues with the DJI Mini 2?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Have you experienced any technical issues with the DJI Mini 2?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"How likely are you to recommend the DJI Mini 2 to others?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"How likely are you to recommend the DJI Mini 2 to others?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Where did you purchase your DJI Mini 2?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Where did you purchase your DJI Mini 2?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"How was your overall purchase experience?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"How was your overall purchase experience?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Did you find all the information you needed before purchasing?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Did you find all the information you needed before purchasing?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"If you interacted with DJI customer support, how would you rate the experience?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"If you interacted with DJI customer support, how would you rate the experience?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"How can DJI improve the Mini 2 or future drone models?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"How can DJI improve the Mini 2 or future drone models?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"How can DJI improve the overall shopping and customer service experience?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"How can DJI improve the overall shopping and customer service experience?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Any additional comments or feedback?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Any additional comments or feedback?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"ID\"\n          ],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {},\n        \"operation\": \"appendOrUpdate\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1KMNqWWO36osZx7jF-i1UL53z2GZnCn9fiBjtlGpvWB4/edit#gid=0\",\n          \"cachedResultName\": \"Sheet1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Set Variables1').first().json.gsheetId }}\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"f2119ef5-aef3-4b0f-80f5-1715a4afe3e0\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1120,\n        1820\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 760,\n        \"height\": 500,\n        \"content\": \"## 1. Initiate Survey by Inviting User to Chat\\n[Learn more about the chat trigger](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-langchain.chattrigger/)\\n\\nTo present the survey to the user, we'll use n8n's builtin hosted chat. Survey questions are predefined and pulled from Google Sheet. Finally, for state and session management such as tracking which question we're asking, we'll use Redis as it's a fast write and ready database suitable for our chat.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"9e7ca15c-0e31-4d78-b8af-31fd6260cd61\",\n      \"name\": \"Send Start\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        600,\n        1620\n      ],\n      \"webhookId\": \"c5d13268-df58-450b-84c4-a61cd2e027ed\",\n      \"parameters\": {\n        \"text\": \"={{ $('Set Variables1').first().json.title }}.\\nWelcome! Thank you for taking the time to participate in our survey.\\n\\nYou'll be asked a couple of pre-defined questions. For each question, we may ask follow-up questions to better understand your situation. If you want to skip to the next question at any time, simply reply with the \\\"/next\\\". Your responses will be recorded.\\n\\nTo start the survey, simply reply with \\\"/next\\\".\",\n        \"chatId\": \"={{ $('Telegram Trigger').first().json.message.chat.id }}\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"wJqs1eMdbjilZH1W\",\n          \"name\": \"jimleuk_ai_survey_demo_bot\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"e8be2d00-39c8-4dd1-a597-813fc4bffe10\",\n      \"name\": \"Send Start1\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        260,\n        1900\n      ],\n      \"webhookId\": \"c5d13268-df58-450b-84c4-a61cd2e027ed\",\n      \"parameters\": {\n        \"text\": \"=Sorry, that command is unrecognised. The available options are /start or /next.\",\n        \"chatId\": \"={{ $('Telegram Trigger').first().json.message.chat.id }}\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"wJqs1eMdbjilZH1W\",\n          \"name\": \"jimleuk_ai_survey_demo_bot\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"153bbe8b-52bc-403c-ae5f-346060a5aac3\",\n      \"name\": \"Completed Survey\",\n      \"type\": \"n8n-nodes-base.telegram\",\n      \"position\": [\n        2220,\n        2280\n      ],\n      \"webhookId\": \"409dbc48-4916-415b-8c1b-caf3b359e1e4\",\n      \"parameters\": {\n        \"text\": \"=Done! Thank you for completing our survey.\\nTo start the survey again, use \\\"/start\\\".\",\n        \"chatId\": \"={{ $('Telegram Trigger').first().json.message.chat.id }}\",\n        \"additionalFields\": {\n          \"appendAttribution\": false\n        }\n      },\n      \"credentials\": {\n        \"telegramApi\": {\n          \"id\": \"wJqs1eMdbjilZH1W\",\n          \"name\": \"jimleuk_ai_survey_demo_bot\"\n        }\n      },\n      \"typeVersion\": 1.2\n    },\n    {\n      \"id\": \"c2e39206-f586-4c90-aeb0-d6a141e81d1d\",\n      \"name\": \"Sticky Note2\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -180,\n        1540\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 420,\n        \"height\": 380,\n        \"content\": \"## 2. Handle Bot Commands\\n[Learn more about the switch node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.switch/)\\n\\nOur chatbot can be a mix of traditional chat mechanics and AI agent. Using bot commands, gives the user some control over the flow of the conversation such as skipping to the next question or starting over the survey.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"6b6241ae-17b7-4f0f-9c00-f5de4d62f692\",\n      \"name\": \"Create Record1\",\n      \"type\": \"n8n-nodes-base.googleSheets\",\n      \"position\": [\n        280,\n        1620\n      ],\n      \"parameters\": {\n        \"columns\": {\n          \"value\": {\n            \"ID\": \"={{ $('Telegram Trigger').first().json.message.from.id }}\"\n          },\n          \"schema\": [\n            {\n              \"id\": \"ID\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": false,\n              \"required\": false,\n              \"displayName\": \"ID\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"What's your name?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"What's your name?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"What were the main factors that influenced your decision to purchase the DJI Mini 2?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"What were the main factors that influenced your decision to purchase the DJI Mini 2?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Did you compare the DJI Mini 2 with other drone models before purchasing? If yes, which other drone models were you considering? \",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Did you compare the DJI Mini 2 with other drone models before purchasing? If yes, which other drone models were you considering? \",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"What ultimately convinced you to choose the DJI Mini 2 over other options?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"What ultimately convinced you to choose the DJI Mini 2 over other options?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"How satisfied are you with the DJI Mini 2?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"How satisfied are you with the DJI Mini 2?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"What features do you like most about the DJI Mini 2?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"What features do you like most about the DJI Mini 2?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Are there any features you feel are missing or could be improved?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Are there any features you feel are missing or could be improved?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Have you experienced any technical issues with the DJI Mini 2?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Have you experienced any technical issues with the DJI Mini 2?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"How likely are you to recommend the DJI Mini 2 to others?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"How likely are you to recommend the DJI Mini 2 to others?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Where did you purchase your DJI Mini 2?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Where did you purchase your DJI Mini 2?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"How was your overall purchase experience?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"How was your overall purchase experience?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Did you find all the information you needed before purchasing?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Did you find all the information you needed before purchasing?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"If you interacted with DJI customer support, how would you rate the experience?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"If you interacted with DJI customer support, how would you rate the experience?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"How can DJI improve the Mini 2 or future drone models?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"How can DJI improve the Mini 2 or future drone models?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"How can DJI improve the overall shopping and customer service experience?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"How can DJI improve the overall shopping and customer service experience?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            },\n            {\n              \"id\": \"Any additional comments or feedback?\",\n              \"type\": \"string\",\n              \"display\": true,\n              \"removed\": true,\n              \"required\": false,\n              \"displayName\": \"Any additional comments or feedback?\",\n              \"defaultMatch\": false,\n              \"canBeUsedToMatch\": true\n            }\n          ],\n          \"mappingMode\": \"defineBelow\",\n          \"matchingColumns\": [\n            \"ID\"\n          ],\n          \"attemptToConvertTypes\": false,\n          \"convertFieldsToString\": false\n        },\n        \"options\": {},\n        \"operation\": \"appendOrUpdate\",\n        \"sheetName\": {\n          \"__rl\": true,\n          \"mode\": \"list\",\n          \"value\": \"gid=0\",\n          \"cachedResultUrl\": \"https://docs.google.com/spreadsheets/d/1KMNqWWO36osZx7jF-i1UL53z2GZnCn9fiBjtlGpvWB4/edit#gid=0\",\n          \"cachedResultName\": \"Sheet1\"\n        },\n        \"documentId\": {\n          \"__rl\": true,\n          \"mode\": \"id\",\n          \"value\": \"={{ $('Set Variables1').first().json.gsheetId }}\"\n        }\n      },\n      \"credentials\": {\n        \"googleSheetsOAuth2Api\": {\n          \"id\": \"XHvC7jIRR8A2TlUl\",\n          \"name\": \"Google Sheets account\"\n        }\n      },\n      \"typeVersion\": 4.5,\n      \"alwaysOutputData\": true\n    },\n    {\n      \"id\": \"f8f6b582-75d7-40a1-95a5-c1b80fa41c64\",\n      \"name\": \"Sticky Note3\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        520,\n        2180\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 440,\n        \"height\": 420,\n        \"content\": \"## 3. Support to Follow-Up Questions\\n[Learn more about the Text Classifier node](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.text-classifier/)\\n\\nDepending on whether the current question is open-ended or closed-ended, we may not require the Agent to spend too much time on the answer. Here we're using the text classifier node to make that judgement call - when closed-ended, we can skip to the next question and when open-ended, we can attempt to dig deeper into the answer.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"5aa8956b-787d-4b4a-b4dc-a2415434a331\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        980,\n        2340\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 700,\n        \"height\": 500,\n        \"content\": \"## 4. Deeper Insights with a Conversational AI Agent\\n[Learn more about the AI Agent](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent/)\\n\\nThe way we utilise the AI in this workflow is by allowing the agent to converse back-and-forth with the user on any given question of the survey. This means answers can be more than just single sentence and can expand to minute-long conversations, producting much deeper insights for the survey.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"aa304745-6d30-4fdb-8279-eb505ee06a61\",\n      \"name\": \"Sticky Note5\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        1200,\n        1820\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 740,\n        \"height\": 380,\n        \"content\": \"## 5. Managing Conversational Flow with External State\\n[Learn more about the Redis node](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.redis/)\\n\\nWe use Redis as a quick and easy way to store and track the question index (or \\\"state\\\") as the user progresses through the survey. To calculate which question should be next or if the survey is complete, we query the spreadsheet row for the user's session and calculate our next state from there. \"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"4ce7ce73-d771-4794-b1fb-87c15ccdbdaf\",\n      \"name\": \"Sticky Note6\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        2160,\n        1680\n      ],\n      \"parameters\": {\n        \"color\": 7,\n        \"width\": 620,\n        \"height\": 520,\n        \"content\": \"## 6. Resetting Chat Memory for Every Question\\n[Learn more about the Chat Memory Manager](https://docs.n8n.io/integrations/builtin/cluster-nodes/sub-nodes/n8n-nodes-langchain.memorymanager/)\\n\\nI discovered that to ensure my agent focused on a specific question when interacting with the user, I needed to clear all previous message context to prevent it from using past references. This is a really unconventional approach to controlling Agent behaviour but from my observation, greatly reduces hallucinations during the conversation.\"\n      },\n      \"typeVersion\": 1\n    },\n    {\n      \"id\": \"2b26317c-6ba6-4ff0-92a6-525cce9e725d\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"position\": [\n        -1740,\n        1300\n      ],\n      \"parameters\": {\n        \"width\": 580,\n        \"height\": 1020,\n        \"content\": \"## Try It Out\\n### This n8n template demonstrates how you can build a structured chat journey augmented with AI for your business.\\n\\nIn this scenario, a chatbot conducts a product satisfaction survey with a user using a predefined set of questions. For each question, the agent can dive deeper into the user's answers by asking follow-up questions.\\n\\nThis chatbot template isn't fully \\\"agentic\\\" which makes it a bit more complicated and scripted but ensures a more deterministic user journey; suitable when you need more guide-rails on the experience.\\n\\nSee example survey here: https://docs.google.com/spreadsheets/d/e/2PACX-1vQWcREg75CzbZd8loVI12s-DzSTj3NE_02cOCpAh7umj0urazzYCfzPpYvvh7jqICWZteDTALzBO46i/pubhtml?gid=0&single=true\\n\\n### How it works\\n* A chat session is started with the user who needs to enter the bot command \\\"/next\\\" to start the survey.\\n* Once started, the template pulls in questions from a google sheet to ask the user. Questions are asked in sequence from left to right.\\n* When the user answers the question, a text classifier node is used to determine \\nif a follow-up question could be asked.\\n* If not, the survey proceeds to the next question. Otherwise, an AI Agent will generate a follow-up question based on the user's response.\\n* All answers and AI conversations are recorded in the Google Sheet.\\n* When all questions are answered, the template will stop the survey and give the user a chance to restart.\\n\\n### How to use\\n* You'll need to setup a Telegram bot ([see docs](https://docs.n8n.io/integrations/builtin/credentials/telegram/))\\n* Create a google sheet with an ID column. Populate the rest of the columns with your survey questions ([see sample](https://docs.google.com/spreadsheets/d/e/2PACX-1vQWcREg75CzbZd8loVI12s-DzSTj3NE_02cOCpAh7umj0urazzYCfzPpYvvh7jqICWZteDTALzBO46i/pubhtml?gid=0&single=true))\\n* Ensure you have a Redis instance to capture state. Either self-host or sign-up to [Upstash](https://upstash.com?ref=jimleuk) for a free account.\\n* Update the \\\"Set Variable\\\" node with your google sheet ID and survey title.\\n* Share the bot with users to allow others to participate in your survey.\\n\\n### Can I use this for WhatsApp?\\nYes you can! Swapping out all telegram nodes for WhatsApp nodes should produce the same result.\\n\\n\\n### Need Help?\\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\"\n      },\n      \"typeVersion\": 1\n    }\n  ],\n  \"pinData\": {},\n  \"connections\": {\n    \"Model2\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Interview Agent1\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Model3\": {\n      \"ai_languageModel\": [\n        [\n          {\n            \"node\": \"Should Follow Up?1\",\n            \"type\": \"ai_languageModel\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Memory3\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Reset Agent Memory1\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Memory4\": {\n      \"ai_memory\": [\n        [\n          {\n            \"node\": \"Interview Agent1\",\n            \"type\": \"ai_memory\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get State2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Message Type1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get State3\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Columns1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Send Start\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"Get Record1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Has No Record?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Send Start1\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"Bot Actions1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Record1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Get State3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Send Start1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Columns1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Survey State1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Command1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Bot Actions1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Message Type1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get Command1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Get Record1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Send Response\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"Create Record1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Start Session1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Create Record2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get State3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Has No Record?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Create Record2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Get Last Bot Message1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Set Variables1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Execution Data2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Start Session1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Start\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update Answer2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Response\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update Answer3\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get State3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Execution Data2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Get State2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Increment Index1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Is Survey Continue?\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Interview Agent1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Answer2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Telegram Trigger\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Set Variables1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Append Responses1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Should Follow Up?1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Survey State1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Increment Index1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Send Next Question\": {\n      \"main\": [\n        []\n      ]\n    },\n    \"Should Follow Up?1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update Answer3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Interview Agent1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Is Survey Continue?\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Reset Agent Memory1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Completed Survey\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Reset Agent Memory1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Send Next Question\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Get Last Bot Message1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Append Responses1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  }\n}",
  "metadata": {
    "node_types": [
      "n8n-nodes-base.telegramTrigger",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.if",
      "n8n-nodes-base.if",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.set",
      "n8n-nodes-base.switch",
      "n8n-nodes-base.set",
      "n8n-nodes-base.switch",
      "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "n8n-nodes-base.set",
      "@n8n/n8n-nodes-langchain.memoryManager",
      "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.redis",
      "@n8n/n8n-nodes-langchain.agent",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.set",
      "n8n-nodes-base.httpRequest",
      "n8n-nodes-base.redis",
      "n8n-nodes-base.httpRequest",
      "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "@n8n/n8n-nodes-langchain.textClassifier",
      "n8n-nodes-base.executionData",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.telegram",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.googleSheets",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote",
      "n8n-nodes-base.stickyNote"
    ],
    "trigger": "telegram trigger"
  }
}